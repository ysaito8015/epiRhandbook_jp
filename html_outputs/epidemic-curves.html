<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>32 Epidemic curves | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="epidemic-curves" class="section level1" number="32">
<h1><span class="header-section-number">32</span> Epidemic curves</h1>
<p>An epidemic curve (also known as an “epi curve”) is a core epidemiological chart typically used to visualize the temporal pattern of illness onset among a cluster or epidemic of cases.</p>
<p>Analysis of the epicurve can reveal temporal trends, outliers, the magnitude of the outbreak, the most likely time period of exposure, time intervals between case generations, and can even help identify the mode of transmission of an unidentified disease (e.g. point source, continuous common source, person-to-person propagation). One online lesson on interpretation of epi curves can be found at the website of the <a href="https://www.cdc.gov/training/quicklearns/epimode/index.html">US CDC</a>.</p>
<p>In this page we demonstrate two approaches to producing epicurves in R:</p>
<ul>
<li>The <strong>incidence2</strong> package, which can produce an epi curve with simple commands<br />
</li>
<li>The <strong>ggplot2</strong> package, which allows for advanced customizability via more complex commands</li>
</ul>
<p>Also addressed are specific use-cases such as:</p>
<ul>
<li>Plotting aggregated count data<br />
</li>
<li>Faceting or producing small-multiples<br />
</li>
<li>Applying moving averages<br />
</li>
<li>Showing which data are “tentative” or subject to reporting delays<br />
</li>
<li>Overlaying cumulative case incidence using a second axis</li>
</ul>
<!-- ======================================================= -->
<div id="preparation-24" class="section level2" number="32.1">
<h2><span class="header-section-number">32.1</span> Preparation</h2>
<div id="packages-4" class="section level3 unnumbered">
<h3>Packages</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code>library()</code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
</div>
<div id="import-data-19" class="section level3 unnumbered">
<h3>Import data</h3>
<p>Two example datasets are used in this section:</p>
<ul>
<li>Linelist of individual cases from a simulated epidemic<br />
</li>
<li>Aggregated counts by hospital from the same simulated epidemic</li>
</ul>
<p>The datasets are imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data.</p>
<p><strong>Case linelist</strong></p>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instruction in the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page. We assume the file is in the working directory so no sub-folders are specified in this file path.</p>
<p>The first 50 rows are displayed below.</p>
<p><strong>Case counts aggregated by hospital</strong></p>
<p>For the purposes of the handbook, the dataset of weekly aggregated counts by hospital is created from the <code>linelist</code> with the following code.</p>
<p>The first 50 rows are displayed below:</p>
</div>
<div id="set-parameters" class="section level3 unnumbered">
<h3>Set parameters</h3>
<p>For production of a report, you may want to set editable parameters such as the date for which the data is current (the “data date”). You can then reference the object <code>data_date</code> in your code when applying filters or in dynamic captions.</p>
</div>
<div id="verify-dates" class="section level3 unnumbered">
<h3>Verify dates</h3>
<p>Verify that each relevant date column is class Date and has an appropriate range of values. You can do this simply using <code>hist()</code> for histograms, or <code>range()</code> with <code>na.rm=TRUE</code>, or with <code>ggplot()</code> as below.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurves-with-incidence2-package" class="section level2" number="32.2">
<h2><span class="header-section-number">32.2</span> Epicurves with <strong>incidence2</strong> package</h2>
<p>Below we demonstrate how to make epicurves using the <strong>incidence2</strong> package. The authors of this package have tried to allow the user to create and modify epicurves without needing to know <strong>ggplot2</strong> syntax. Much of this page is adapted from the package vignettes, which can be found at the <strong>incidence2</strong> <a href="https://github.com/reconhub/incidence2">github page</a>.</p>
<!-- ======================================================= -->
<div id="simple-example" class="section level3 unnumbered">
<h3>Simple example</h3>
<p><strong>2 steps are required to plot an epidemic curve with the <em>incidence2</em> package:</strong></p>
<ol style="list-style-type: decimal">
<li><strong>Create</strong> an <em>incidence object</em> (using the function <code>incidence()</code>)
<ul>
<li>Provide the data<br />
</li>
<li>Specify the date column to <code>date_index =</code><br />
</li>
<li>Specify the <code>interval =</code> into which the cases should be aggregated (daily, weekly, monthly..)<br />
</li>
<li>Specify any grouping columns (e.g. gender, hospital, outcome)<br />
</li>
</ul></li>
<li><strong>Plot</strong> the incidence object
<ul>
<li>Specify labels, colors, titles, etc.</li>
</ul></li>
</ol>
<p>Below, we load the <strong>incidence2</strong> package, create the incidence object from the <code>linelist</code> on column <code>date_onset</code> and aggregated cases by day. We then print a summary of the incidence object.</p>
<p>The <strong>incidence2</strong> object itself looks like a tibble (like a data frame) and can be printed or further manipulated like a data frame.</p>
<p>Here is what it looks like when printed. It has a <code>date_index</code> column and a <code>count</code> column.</p>
<p>You can also print a summary of the object:</p>
<p>To <em>plot</em> the <em>incidence</em> object, use <code>plot()</code> on the <em>name of the incidence object</em>. In the background, the function <code>plot.incidence2()</code> is called, so to read the <strong>incidence2</strong>-specific documentation you would run <code>?plot.incidence2</code>.</p>
<p>If you notice lots of tiny white vertical lines (like above) try to adjust the size of your image. For example, if you export your plot with <code>ggsave()</code>, you can provide numbers to <code>width =</code> and <code>height =</code>. If you widen the plot those lines may disappear.</p>
</div>
<div id="change-time-interval-of-case-aggregation" class="section level3 unnumbered">
<h3>Change time interval of case aggregation</h3>
<p>The <code>interval</code> argument of <code>incidence()</code> defines how the observations are grouped into vertical bars.</p>
<p><strong>Specify interval</strong></p>
<p><strong>incidence2</strong> provides flexibility and understandable syntax for specifying how you want to aggregate your cases into epicurve bars. Provide a value like the ones below to the <code>interval =</code> argument:</p>
<table>
<thead>
<tr class="header">
<th>Argument option</th>
<th>Further explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Number (1, 7, 13, 14, etc.)</td>
<td>Number of days</td>
</tr>
<tr class="even">
<td>“week”</td>
<td>note: Monday start day is default</td>
</tr>
<tr class="odd">
<td>“2 weeks”</td>
<td>or 3, 4, 5…</td>
</tr>
<tr class="even">
<td>“Sunday week”</td>
<td>weeks beginning on Sundays (could also use Thursday, etc.)</td>
</tr>
<tr class="odd">
<td>“2 Sunday weeks”</td>
<td>or 3, 4, 5…</td>
</tr>
<tr class="even">
<td>“MMWRweek”</td>
<td>week starts on Sundays - see US CDC</td>
</tr>
<tr class="odd">
<td>“month”</td>
<td>1st of month</td>
</tr>
<tr class="even">
<td>“quarter”</td>
<td>1st of month of quarter</td>
</tr>
<tr class="odd">
<td>“2 months”</td>
<td>or 3, 4, 5…</td>
</tr>
<tr class="even">
<td>“year”</td>
<td>1st day of calendar year</td>
</tr>
</tbody>
</table>
<p>Below are examples of how different intervals look when applied to the linelist. Note how the default format and frequency of the date <em>labels</em> on the x-axis change as the date interval changes.</p>
<p><strong>Begin at first case</strong></p>
<p>If you want the intervals to begin at the first case, you can add the argument <code>standard = TRUE</code> to the <code>incidence()</code> command. This only works if the interval is either “week”, “month”, “quarter” or “year”.</p>
<p><strong>First and late date</strong></p>
<p>You can optionally specify the <code>first_date =</code> and <code>last_date =</code> in the <code>incidence()</code> command. If given, the data will be trimmed to this range.</p>
</div>
<div id="groups" class="section level3 unnumbered">
<h3>Groups</h3>
<p>Groups are specified in the <code>incidence()</code> command, and can be used to color the bars or to facet the data. To specify groups in your data provide the column name(s) to the <code>groups =</code> argument in the <code>incidence()</code> command (no quotes). If specifying multiple columns, put their names within <code>c()</code>.</p>
<p>You can specify that cases with missing values in the grouping columns be listed as a distinct <code>NA</code> group by setting <code>na_as_group = TRUE</code>. Otherwise, they will be excluded from the plot.</p>
<ul>
<li><p>To color the bars by a grouping column*, you must again provide the column name to <code>fill =</code> in the <code>plot()</code> command.</p></li>
<li><p>To facet based on a grouping column*, see the section below on facets with <strong>incidence2</strong>.</p></li>
</ul>
<p>In the example below, the cases in the whole outbreak are grouped by their age category. Missing values are included as a group. The epicurve interval is weeks.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Change the title of the legend by adding <code>+</code> the <strong>ggplot2</strong> command <code>labs(fill = "your title")</code> to your <strong>incidence2</strong> plot.</span></p>
<p>You can also have the grouped bars display side-by-side by setting <code>stack = FALSE</code> in <code>plot()</code>, as shown below:</p>
</div>
<div id="filtered-data" class="section level3 unnumbered">
<h3>Filtered data</h3>
<p>To plot the epicurve of a subset of data:</p>
<ol style="list-style-type: decimal">
<li>Filter the linelist data<br />
</li>
<li>Provide the filtered data to the <code>incidence()</code> command<br />
</li>
<li>Plot the incidence object</li>
</ol>
<p>The example below uses data filtered to show only cases at Central Hospital.</p>
</div>
<div id="aggregated-counts" class="section level3 unnumbered">
<h3>Aggregated counts</h3>
<p>If your original data are aggregated (counts), provide the name of the column that contains the case counts to the <code>count =</code> argument when creating the incidence object.</p>
<p>For example, this data frame <code>count_data</code> is the linelist aggregated into daily counts by hospital. The first 50 rows look like this:</p>
<p>If you are beginning your analysis with daily count data like the dataset above, your <code>incidence()</code> command to convert this to a weekly epicurve by hospital would look like this:</p>
</div>
<div id="facetssmall-multiples" class="section level3 unnumbered">
<h3>Facets/small multiples</h3>
<p>To facet the data by group (i.e. produce “small multiples”):</p>
<ol style="list-style-type: decimal">
<li>Specify the faceting column to <code>groups =</code> when you create the incidence object<br />
</li>
<li>Use the <code>facet_plot()</code> command instead of <code>plot()</code><br />
</li>
<li>Specify which grouping columns to use as <code>fill =</code> and which to use as <code>facets =</code></li>
</ol>
<p>Below, we set both columns <code>hospital</code> and <code>outcome</code> as grouping columns in the <code>incidence()</code> command. Then, in <code>facet_plot()</code> we plot the epicurve, specifying that we want a different epicurve for each hospital and that within each epicurve the bars should be stacked and colored by outcome.</p>
<p>Note that the package <strong>ggtree</strong> (used for displaying phylogenetic trees) also has a function <code>facet_plot()</code> - this is why we specified <code>incidence2::facet_plot()</code> above.</p>
</div>
<div id="modifications-with-plot" class="section level3 unnumbered">
<h3>Modifications with <code>plot()</code></h3>
<p>An epicurve produced by <strong>incidence2</strong> can be modified via these arguments <em>within the <strong>incidence2</strong> <code>plot()</code> function</em>.</p>
<p><strong>Here are <code>plot()</code> arguments relating to the bars:</strong></p>
<table>
<colgroup>
<col width="23%" />
<col width="51%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Argument</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>fill =</code></td>
<td>Bar color. Either a color name or a column name previously specified to <code>groups =</code> in <code>incidence()</code> command</td>
<td><code>fill = "red"</code>, or <code>fill = gender</code></td>
</tr>
<tr class="even">
<td><code>na_as_group =</code></td>
<td>If FALSE, missing values of a grouping column are excluded from plot</td>
<td><code>na_as_group = FALSE</code></td>
</tr>
<tr class="odd">
<td><code>border =</code></td>
<td>Color around each bar/box, or grouping within a bar</td>
<td><code>border = "white"</code></td>
</tr>
<tr class="even">
<td><code>legend =</code></td>
<td>Location of legend</td>
<td>One of “bottom”, “top”, “left”, “right”, or “none”</td>
</tr>
<tr class="odd">
<td><code>alpha =</code></td>
<td>Transparency of bars/boxes</td>
<td>1 is fully opaque, 0 is fully transparent</td>
</tr>
<tr class="even">
<td><code>show_cases =</code></td>
<td>Logical; if TRUE, each case shows as a box. Displays best on smaller outbreaks. Can be used with <code>coord_equal = T</code> to ensure squares.</td>
<td><code>show_cases = TRUE</code></td>
</tr>
<tr class="odd">
<td><code>coord_equal =</code></td>
<td>For use if <code>show_cases = TRUE</code>; if TRUE the x and y axes display with equal ratio</td>
<td><code>coord_equal = TRUE</code></td>
</tr>
</tbody>
</table>
<p><strong>Here are <code>plot()</code> arguments relating to the date axis:</strong></p>
<table>
<colgroup>
<col width="29%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th>Argument(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>n_breaks =</code></td>
<td>Number of x-axis label breaks, absent other modifications. These will start counting from the interval of the first case.</td>
</tr>
<tr class="even">
<td><code>angle =</code></td>
<td>Angle of x-axis date labels</td>
</tr>
<tr class="odd">
<td><code>group_labels =</code></td>
<td>Used if plotting weekly interval. If FALSE labels will appear YYYY-MM-DD, else YYYY-Www (absent other modifications)</td>
</tr>
</tbody>
</table>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> For breaks every “nth” interval (e.g. every 4th), use <code>n_breaks = nrow(i)/n</code> (where “i” is your incidence object name and “n” is a number). If your data are grouped, you will need to multiply “n” by the number of unique groups.</span></p>
<p><strong>Here are <code>plot()</code> arguments relating to labels:</strong></p>
<table>
<colgroup>
<col width="29%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th>Argument(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>title =</code></td>
<td>Title of plot</td>
</tr>
<tr class="even">
<td><code>xlab =</code></td>
<td>Title of x-axis</td>
</tr>
<tr class="odd">
<td><code>ylab =</code></td>
<td>Title of y-axis</td>
</tr>
<tr class="even">
<td><code>size =</code></td>
<td>Size of x-axis text in pts (use ggplot’s theme() to adjust other sizes etc.)</td>
</tr>
</tbody>
</table>
<p>An example using many of the above arguments:</p>
<p>To further adjust plot appearance, see the section below on applying <code>ggplot()</code> to the <strong>incidence</strong> plot.</p>
</div>
<div id="modifications-with-ggplot2" class="section level3 unnumbered">
<h3>Modifications with ggplot2</h3>
<p>You can further modify an <strong>incidence2</strong> plot by adding <strong>ggplot2</strong> modifications with a <code>+</code> after the close of the incidence <code>plot()</code> function, as demonstrated below.</p>
<p>Below, the <strong>incidence2</strong> plot finishes and then <strong>ggplot2</strong> commands are used to modify the axes, add a caption, and adjust the bold font and text size.</p>
<p>Note that if you add <code>scale_x_date()</code>, most date formatting from <code>plot()</code> will be overwritten. See the <code>ggplot()</code> epicurves section and the Handbook page <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> for more options.</p>
</div>
<div id="change-colors" class="section level3 unnumbered">
<h3>Change colors</h3>
<div id="specify-a-palette" class="section level4 unnumbered">
<h4>Specify a palette</h4>
<p>Provide the name of a pre-defined palette to the <code>col_pal =</code> argument in <code>plot()</code>. The <strong>incidence2</strong> package comes with 2 pre-defined paletted: “vibrant” and “muted”. In “vibrant” the first 6 colors and distinct and in “muted” the first 9 colors are distinct. After these numbers, the colors are interpolations/intermediaries of other colors. These pre-defined palettes can be found at <a href="https://personal.sron.nl/~pault/#sec:qualitative">this website</a>. The palettes exclude grey, which is reserved for missing data (use <code>na_color =</code> to change this default).</p>
<p>You can also use one of the <strong>base</strong> R palettes (put the name of the palette <em>without</em> quotes).</p>
<p>You can also add a color palette from the <strong>viridis</strong> package or <strong>RColorBrewer</strong> package. First those packages must be loaded, then add their respective <code>scale_fill_*()</code> functions with a <code>+</code>, as shown below.</p>
</div>
<div id="specify-manually" class="section level4 unnumbered">
<h4>Specify manually</h4>
<p>To specify colors manually, add the <strong>ggplot2</strong> function <code>scale_fill_manual()</code> to the <code>plot()</code> with a <code>+</code> and provide the vector of colors names or HEX codes to the argument <code>values =</code>. The number of colors listed must equal the number of groups. Be aware of whether missing values are a group - they can be converted to a character value like “Missing” during your data preparation with the function <code>fct_explicit_na()</code> as explained in the page on <a href="factors.html#factors">Factors</a>.</p>
<p>As mentioned in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page, you can create your own palettes using <code>colorRampPalette()</code> on a vector of colors and specifying the number of colors you want in return. This is a good way to get many colors in a ramp by specifying a few.</p>
</div>
</div>
<div id="adjust-level-order" class="section level3 unnumbered">
<h3>Adjust level order</h3>
<p>To adjust the order of group appearance (on plot and in legend), the grouping column must be class Factor. See the page on <a href="factors.html#factors">Factors</a> for more information.</p>
<p>First, let’s see a weekly epicurve by hospital with the default ordering:</p>
<p>Now, to adjust the order so that “Missing” and “Other” are at the top of the epicurve we can do the following:</p>
<ul>
<li>Load the package <strong>forcats</strong>, to work with factors<br />
</li>
<li>Adjust the dataset - in this case we’ll define a new dataset (<code>plot_data</code>) in which:
<ul>
<li>the <code>gender</code> column is defined as a factor the order of levels are set with <code>fct_relevel()</code> so that “Other” and “Missing” are first, so they appear at the top of the bars<br />
</li>
</ul></li>
<li>The incidence object is created and plotted as before<br />
</li>
<li>We add <strong>ggplot2</strong> modifications
<ul>
<li><code>scale_fill_manual()</code> to manually assign colors so that “Missing” is grey and “Other” is beige</li>
</ul></li>
</ul>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> If you want to reverse the order of the legend only, add this <strong>ggplot2</strong> command <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="vertical-gridlines" class="section level3 unnumbered">
<h3>Vertical gridlines</h3>
<p>If you plot with default <strong>incidence2</strong> settings, you may notice that the vertical gridlines appear at each date label and once between each date label. This can result in gridlines intersecting with the top of some bars.</p>
<!-- [TO DO Note this paragraph is not applicable with version 1.0.0 of incidence2). You can specify the interval for the gridlines by adding **ggplot2**'s `scale_x_date()` command to your **incidence2** plot. Within it, specify the intervals for `date_breaks = ` and `date_minor_breaks = ` (e.g. "weeks" or "3 weeks" or "months"). Note that use of `scale_x_date()` will over-ride any formatting of the date labels in `plot()`, so you will need to specify any string format to `date_labels = ` as below.   -->
<p>You can remove all gridlines by adding the <strong>ggplot2</strong> command <code>theme_classic()</code>.</p>
<p>Note however, that if using weeks, the <code>date_breaks</code> and <code>date_minor_breaks</code> arguments only work for <em>Monday</em> weeks. If your weeks are by another day of the week you will need to manually provide a vector of dates to the <code>breaks =</code> and <code>minor_breaks =</code> arguments instead. See the <strong>ggplot2</strong> section for examples of this using <code>seq.Date()</code>.</p>
</div>
<div id="cumulative-incidence" class="section level3 unnumbered">
<h3>Cumulative incidence</h3>
<p>You can easily produce a plot of cumulative incidence by passing the incidence object to the <strong>incidence2</strong> command <code>cumulate()</code> and then to <code>plot()</code>. This also works with <code>facet_plot()</code>.</p>
<p>See the section farther down on this page for alternative method to plot cumulative incidence with <strong>ggplot2</strong> - for example to overlay a cumulative incidence line over an epicurve.</p>
</div>
<div id="rolling-average" class="section level3 unnumbered">
<h3>Rolling average</h3>
<p>You can add a rolling average to an <strong>incidence2</strong> plot easily with <code>add_rolling_average()</code> from the <strong>i2extras</strong> package. Pass your incidence2 object to this function, and then to <code>plot()</code>. Set <code>before =</code> as the number of previous days you want included in the rolling average (default is 2). If your data are grouped, the rolling average will be calculated per group.</p>
<p>To learn how to apply rolling averages more generally on data, see the Handbook page on <a href="epidemic-curves.html#moving-averages-1">Moving averages</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurves-with-ggplot2" class="section level2" number="32.3">
<h2><span class="header-section-number">32.3</span> Epicurves with ggplot2</h2>
<p>Using <code>ggplot()</code> to build your epicurve allows for more flexibility and customization, but requires more effort and understanding of how <code>ggplot()</code> works.</p>
<p>Unlike using the <strong>incidence2</strong> package, you must <em>manually</em> control the aggregation of the cases by time (into weeks, months, etc) <em>and</em> the intervals of the labels on the date axis. This must be carefully managed.</p>
<p>These examples use a subset of the <code>linelist</code> dataset - only the cases from Central Hospital.</p>
<p>To produce an epicurve with <code>ggplot()</code> there are three main elements:</p>
<ul>
<li>A histogram, with linelist cases aggregated into “bins” distinguished by specific “break” points<br />
</li>
<li>Scales for the axes and their labels<br />
</li>
<li>Themes for the plot appearance, including titles, labels, captions, etc.</li>
</ul>
<div id="specify-case-bins" class="section level3 unnumbered">
<h3>Specify case bins</h3>
<p>Here we show how to specify how cases will be aggregated into histogram bins (“bars”). It is important to recognize that the aggregation of cases into histogram bins is <strong>not</strong> necessarily the same intervals as the dates that will appear on the x-axis.</p>
<p>Below is perhaps the most simple code to produce daily and weekly epicurves.</p>
<p>In the over-arching <code>ggplot()</code> command the dataset is provided to <code>data =</code>. Onto this foundation, the geometry of a histogram is added with a <code>+</code>. Within the <code>geom_histogram()</code>, we map the aesthetics such that the column <code>date_onset</code> is mapped to the x-axis. Also within the <code>geom_histogram()</code> but <em>not</em> within <code>aes()</code> we set the <code>binwidth =</code> of the histogram bins, in days. If this <strong>ggplot2</strong> syntax is confusing, review the page on <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a>.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Plotting weekly cases by using <code>binwidth = 7</code> starts the first 7-day bin at the first case, which could be any day of the week! To create specific weeks, see section below .</span></p>
<p>Let us note that the first case in this Central Hospital dataset had symptom onset on:</p>
<p><strong>To manually specify the histogram bin breaks, do <em>not</em> use the <code>binwidth =</code> argument, and instead supply a vector of dates to <code>breaks =</code>.</strong></p>
<p>Create the vector of dates with the <strong>base</strong> R function <code>seq.Date()</code>. This function expects arguments <code>to =</code>, <code>from =</code>, and <code>by =</code>. For example, the command below returns monthly dates starting at Jan 15 and ending by June 28.</p>
<p>This vector can be provided to <code>geom_histogram()</code> as <code>breaks =</code>:</p>
<p>A simple weekly date sequence can be returned by setting <code>by = "week"</code>. For example:</p>
<p>An alternative to supplying specific start and end dates is to write <em>dynamic</em> code so that weekly bins begin <em>the Monday before the first case</em>. <strong>We will use these date vectors throughout the examples below.</strong></p>
<p>Let’s unpack the rather daunting code above:</p>
<ul>
<li>The “from” value (earliest date of the sequence) is created as follows: the minimum date value (<code>min()</code> with <code>na.rm=TRUE</code>) in the column <code>date_onset</code> is fed to <code>floor_date()</code> from the <strong>lubridate</strong> package. <code>floor_date()</code> set to “week” returns the start date of that cases’s “week”, given that the start day of each week is a Monday (<code>week_start = 1</code>).<br />
</li>
<li>Likewise, the “to” value (end date of the sequence) is created using the inverse function <code>ceiling_date()</code> to return the Monday <em>after</em> the last case.<br />
</li>
<li>The “by” argument of <code>seq.Date()</code> can be set to any number of days, weeks, or months.<br />
</li>
<li>Use <code>week_start = 7</code> for Sunday weeks</li>
</ul>
<p>As we will use these date vectors throughout this page, we also define one for the whole outbreak (the above is for Central Hospital only).</p>
<p>These <code>seq.Date()</code> outputs can be used to create histogram bin breaks, but also the breaks for the date labels, which may be independent from the bins. Read more about the date labels in later sections.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> For a more simple <code>ggplot()</code> command, save the bin breaks and date label breaks as named vectors in advance, and simply provide their names to <code>breaks =</code>.</span></p>
</div>
<div id="weekly-epicurve-example" class="section level3 unnumbered">
<h3>Weekly epicurve example</h3>
<p><strong>Below is detailed example code to produce weekly epicurves for Monday weeks, with aligned bars, date labels, and vertical gridlines.</strong> This section is for the user who needs code quickly. To understand each aspect (themes, date labels, etc.) in-depth, continue to the subsequent sections. Of note:</p>
<ul>
<li>The <em>histogram bin breaks</em> are defined with <code>seq.Date()</code> as explained above to begin the Monday before the earliest case and to end the Monday after the last case<br />
</li>
<li>The interval of <em>date labels</em> is specified by <code>date_breaks =</code> within <code>scale_x_date()</code><br />
</li>
<li>The interval of minor vertical gridlines between date labels is specified to <code>date_minor_breaks =</code><br />
</li>
<li><code>expand = c(0,0)</code> in the x and y scales removes excess space on each side of the axes, which also ensures the date labels begin from the first bar.</li>
</ul>
<div id="sunday-weeks" class="section level4 unnumbered">
<h4>Sunday weeks</h4>
<p>To achieve the above plot for Sunday weeks a few modifications are needed, because the <code>date_breaks = "weeks"</code> only work for Monday weeks.</p>
<ul>
<li>The break points of the <em>histogram bins</em> must be set to Sundays (<code>week_start = 7</code>)<br />
</li>
<li>Within <code>scale_x_date()</code>, the similar date breaks should be provided to <code>breaks =</code> and <code>minor_breaks =</code> to ensure the date labels and vertical gridlines align on Sundays.</li>
</ul>
<p>For example, the <code>scale_x_date()</code> command for Sunday weeks could look like this:</p>
</div>
</div>
<div id="groupcolor-by-value" class="section level3 unnumbered">
<h3>Group/color by value</h3>
<p>The histogram bars can be colored by group and “stacked”. To designate the grouping column, make the following changes. See the <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a> page for details.</p>
<ul>
<li>Within the histogram aesthetic mapping <code>aes()</code>, map the column name to the <code>group =</code> and <code>fill =</code> arguments<br />
</li>
<li>Remove any <code>fill =</code> argument <em>outside</em> of <code>aes()</code>, as it will override the one inside<br />
</li>
<li>Arguments <em>inside</em> <code>aes()</code> will apply <em>by group</em>, whereas any <em>outside</em> will apply to all bars (e.g. you may still want <code>color =</code> outside, so each bar has the same border)</li>
</ul>
<p>Here is what the <code>aes()</code> command would look like to group and color the bars by gender:</p>
<p>Here it is applied:</p>
</div>
<div id="adjust-colors" class="section level3 unnumbered">
<h3>Adjust colors</h3>
<ul>
<li>To <em>manually</em> set the fill for each group, use <code>scale_fill_manual()</code> (note: <code>scale_color_manual()</code> is different!).
<ul>
<li>Use the <code>values =</code> argument to apply a vector of colors.<br />
</li>
<li>Use <code>na.value =</code> to specify a color for <code>NA</code> values.<br />
</li>
<li>Use the <code>labels =</code> argument to change the text of legend items. To be safe, provide as a named vector like <code>c("old" = "new", "old" = "new")</code> or adjust the values in the data itself.<br />
</li>
<li>Use <code>name =</code> to give a proper title to the legend<br />
</li>
</ul></li>
<li>For more tips on color scales and palettes, see the page on <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a>.</li>
</ul>
</div>
<div id="adjust-level-order-1" class="section level3 unnumbered">
<h3>Adjust level order</h3>
<p>The order in which grouped bars are stacked is best adjusted by classifying the grouping column as class Factor. You can then designate the factor level order (and their display labels). See the page on <a href="factors.html#factors">Factors</a> or <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> for details.</p>
<p>Before making the plot, use the <code>fct_relevel()</code> function from <strong>forcats</strong> package to convert the grouping column to class factor and manually adjust the level order, as detailed in the page on <a href="factors.html#factors">Factors</a>.</p>
<p>In the below plot, the only differences from previous is that column <code>hospital</code> has been consolidated as above, and we use <code>guides()</code> to reverse the legend order, so that “Missing” is on the bottom of the legend.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> To reverse the order of the legend only, add this <strong>ggplot2</strong> command: <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="adjust-legend" class="section level3 unnumbered">
<h3>Adjust legend</h3>
<p>Read more about legends and scales in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page. Here are a few highlights:</p>
<ul>
<li>Edit legend title either in the scale function or with <code>labs(fill = "Legend title")</code> (if your are using <code>color =</code> aesthetic, then use <code>labs(color = "")</code>)<br />
</li>
<li><code>theme(legend.title = element_blank())</code> to have no legend title<br />
</li>
<li><code>theme(legend.position = "top")</code> (“bottom”, “left”, “right”, or “none” to remove the legend)</li>
<li><code>theme(legend.direction = "horizontal")</code> horizontal legend</li>
<li><code>guides(fill = guide_legend(reverse = TRUE))</code> to reverse order of the legend</li>
</ul>
</div>
<div id="bars-side-by-side" class="section level3 unnumbered">
<h3>Bars side-by-side</h3>
<p>Side-by-side display of group bars (as opposed to stacked) is specified within <code>geom_histogram()</code> with <code>position = "dodge"</code> placed outside of <code>aes()</code>.</p>
<p>If there are more than two value groups, these can become difficult to read. Consider instead using a faceted plot (small multiples). To improve readability in this example, missing gender values are removed.</p>
</div>
<div id="axis-limits" class="section level3 unnumbered">
<h3>Axis limits</h3>
<p>There are two ways to limit the extent of axis values.</p>
<p>Generally the preferred way is to use the command <code>coord_cartesian()</code>, which accepts <code>xlim = c(min, max)</code> and <code>ylim = c(min, max)</code> (where you provide the min and max values). This acts as a “zoom” without actually removing any data, which is important for statistics and summary measures.</p>
<p>Alternatively, you can set maximum and minimum date values using <code>limits = c()</code> within <code>scale_x_date()</code>. For example:</p>
<p>Likewise, if you want to the x-axis to extend to a specific date (e.g. current date), even if no new cases have been reported, you can use:</p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Be cautious setting the y-axis scale breaks or limits (e.g. 0 to 30 by 5: <code>seq(0, 30, 5)</code>). Such static numbers can cut-off your plot too short if the data changes to exceed the limit!.</span></p>
</div>
<div id="date-axis-labelsgridlines" class="section level3 unnumbered">
<h3>Date-axis labels/gridlines</h3>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Remember that date-axis <strong>labels</strong> are independent from the aggregation of the data into bars, but visually it can be important to align bins, date labels, and vertical grid lines.</span></p>
<p>To <strong>modify the date labels and grid lines</strong>, use <code>scale_x_date()</code> in one of these ways:</p>
<ul>
<li><strong>If your histogram bins are days, Monday weeks, months, or years</strong>:
<ul>
<li>Use <code>date_breaks =</code> to specify the interval of labels and major gridlines (e.g. “day”, “week”, “3 weeks”, “month”, or “year”)</li>
<li>Use <code>date_minor_breaks =</code> to specify interval of minor vertical gridlines (between date labels)<br />
</li>
<li>Add <code>expand = c(0,0)</code> to begin the labels at the first bar<br />
</li>
<li>Use <code>date_labels =</code> to specify format of date labels - see the Dates page for tips (use <code>\n</code> for a new line)<br />
</li>
</ul></li>
<li><strong>If your histogram bins are Sunday weeks</strong>:
<ul>
<li>Use <code>breaks =</code> and <code>minor_breaks =</code> by providing a sequence of date breaks for each</li>
<li>You can still use <code>date_labels =</code> and <code>expand =</code> for formatting as described above</li>
</ul></li>
</ul>
<p>Some notes:</p>
<ul>
<li>See the opening ggplot section for instructions on how to create a sequence of dates using <code>seq.Date()</code>.<br />
</li>
<li>See <a href="https://rdrr.io/r/base/strptime.html">this page</a> or the <a href="working-with-dates.html#working-with-dates-1">Working with dates</a> page for tips on creating date labels.</li>
</ul>
<div id="demonstrations" class="section level4 unnumbered">
<h4>Demonstrations</h4>
<p>Below is a demonstration of plots where the bins and the plot labels/grid lines are aligned and not aligned:</p>
</div>
</div>
<div id="aggregated-data" class="section level3 unnumbered">
<h3>Aggregated data</h3>
<p>Often instead of a linelist, you begin with aggregated counts from facilities, districts, etc. You can make an epicurve with <code>ggplot()</code> but the code will be slightly different. This section will utilize the <code>count_data</code> dataset that was imported earlier, in the data preparation section. This dataset is the <code>linelist</code> aggregated to day-hospital counts. The first 50 rows are displayed below.</p>
<div id="plotting-daily-counts" class="section level4 unnumbered">
<h4>Plotting daily counts</h4>
<p>We can plot a daily epicurve from these <em>daily counts</em>. Here are the differences to the code:</p>
<ul>
<li>Within the aesthetic mapping <code>aes()</code>, specify <code>y =</code> as the counts column (in this case, the column name is <code>n_cases</code>)</li>
<li>Add the argument <code>stat = "identity"</code> within <code>geom_histogram()</code>, which specifies that bar height should be the <code>y =</code> value, not the number of rows as is the default<br />
</li>
<li>Add the argument <code>width =</code> to avoid vertical white lines between the bars. For daily data set to 1. For weekly count data set to 7. For monthly count data, white lines are an issue (each month has different number of days) - consider transforming your x-axis to a categorical ordered factor (months) and using <code>geom_col()</code>.</li>
</ul>
</div>
<div id="plotting-weekly-counts" class="section level4 unnumbered">
<h4>Plotting weekly counts</h4>
<p>If your data are already case counts by week, they might look like this dataset (called <code>count_data_weekly</code>):</p>
<p>The first 50 rows of <code>count_data_weekly</code> are displayed below. You can see that the counts have been aggregated into weeks. Each week is displayed by the first day of the week (Monday by default).</p>
<p>Now plot so that <code>x =</code> the epiweek column. Remember to add <code>y =</code> the counts column to the aesthetic mapping, and add <code>stat = "identity"</code> as explained above.</p>
</div>
</div>
<div id="moving-averages-1" class="section level3 unnumbered">
<h3>Moving averages</h3>
<p>See the page on <a href="epidemic-curves.html#moving-averages-1">Moving averages</a> for a detailed description and several options. Below is one option for calculating moving averages with the package <strong>slider</strong>. In this approach, <em>the moving average is calculated in the dataset prior to plotting</em>:</p>
<ol style="list-style-type: decimal">
<li>Aggregate the data into counts as necessary (daily, weekly, etc.) (see <a href="grouping-data.html#grouping-data">Grouping data</a> page)<br />
</li>
<li>Create a new column to hold the moving average, created with <code>slide_index()</code> from <strong>slider</strong> package<br />
</li>
<li>Plot the moving average as a <code>geom_line()</code> on top of (after) the epicurve histogram</li>
</ol>
<p>See the helpful online <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">vignette for the <strong>slider</strong> package</a></p>
</div>
<div id="facetingsmall-multiples" class="section level3 unnumbered">
<h3>Faceting/small-multiples</h3>
<p>As with other ggplots, you can create facetted plots (“small multiples”). As explained in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page of this handbook, you can use either <code>facet_wrap()</code> or <code>facet_grid()</code>. Here we demonstrate with <code>facet_wrap()</code>. For epicurves, <code>facet_wrap()</code> is typically easier as it is likely that you only need to facet on one column.</p>
<p>The general syntax is <code>facet_wrap(rows ~ cols)</code>, where to the left of the tilde (~) is the name of a column to be spread across the “rows” of the facetted plot, and to the right of the tilde is the name of a column to be spread across the “columns” of the facetted plot. Most simply, just use one column name, to the right of the tilde: <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Free axes</strong><br />
You will need to decide whether the scales of the axes for each facet are “fixed” to the same dimensions (default), or “free” (meaning they will change based on the data within the facet). Do this with the <code>scales =</code> argument within <code>facet_wrap()</code> by specifying “free_x” or “free_y”, or “free”.</p>
<p><strong>Number of cols and rows of facets</strong><br />
This can be specified with <code>ncol =</code> and <code>nrow =</code> within <code>facet_wrap()</code>.</p>
<p><strong>Order of panels</strong><br />
To change the order of appearance, change the underlying order of the levels of the factor column used to create the facets.</p>
<p><strong>Aesthetics</strong><br />
Font size and face, strip color, etc. can be modified through <code>theme()</code> with arguments like:</p>
<ul>
<li><code>strip.text = element_text()</code> (size, colour, face, angle…)</li>
<li><code>strip.background = element_rect()</code> (e.g. element_rect(fill=“grey”))<br />
</li>
<li><code>strip.position =</code> (position of the strip “bottom”, “top”, “left”, or “right”)</li>
</ul>
<p><strong>Strip labels</strong><br />
Labels of the facet plots can be modified through the “labels” of the column as a factor, or by the use of a “labeller”.</p>
<p>Make a labeller like this, using the function <code>as_labeller()</code> from <strong>ggplot2</strong>. Then provide the labeller to the <code>labeller =</code> argument of <code>facet_wrap()</code> as shown below.</p>
<p><strong>An example facetted plot</strong> - facetted by column <code>age_cat</code>.</p>
<p>See this <a href="https://ggplot2.tidyverse.org/reference/labellers.html">link</a> for more information on labellers.</p>
<div id="total-epidemic-in-facet-background" class="section level4 unnumbered">
<h4>Total epidemic in facet background</h4>
<p>To show the total epidemic in the background of each facet, add the function <code>gghighlight()</code> with empty parentheses to the ggplot. This is from the package <strong>gghighlight</strong>. Note that the y-axis maximum in all facets is now based on the peak of the entire epidemic. There are more examples of this package in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page.</p>
</div>
<div id="one-facet-with-data" class="section level4 unnumbered">
<h4>One facet with data</h4>
<p>If you want to have one facet box that contains all the data, duplicate the entire dataset and treat the duplicates as one faceting value. A “helper” function <code>CreateAllFacet()</code> below can assist with this (thanks to this <a href="https://stackoverflow.com/questions/18933575/easily-add-an-all-facet-to-facet-wrap-in-ggplot2">blog post</a>). When it is run, the number of rows doubles and there will be a new column called <code>facet</code> in which the duplicated rows will have the value “all”, and the original rows have the their original value of the faceting colum. Now you just have to facet on the <code>facet</code> column.</p>
<p>Here is the helper function. Run it so that it is available to you.</p>
<p>Now apply the helper function to the dataset, on column <code>age_cat</code>:</p>
<p>Notable changes to the <code>ggplot()</code> command are:</p>
<ul>
<li>The data used is now central_data2 (double the rows, with new column “facet”)</li>
<li>Labeller will need to be updated, if used<br />
</li>
<li>Optional: to achieve vertically stacked facets: the facet column is moved to rows side of equation and on right is replaced by “.” (<code>facet_wrap(facet~.)</code>), and <code>ncol = 1</code>. You may also need to adjust the width and height of the saved png plot image (see <code>ggsave()</code> in <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a>).</li>
</ul>
</div>
</div>
</div>
<div id="tentative-data" class="section level2" number="32.4">
<h2><span class="header-section-number">32.4</span> Tentative data</h2>
<p>The most recent data shown in epicurves should often be marked as tentative, or subject to reporting delays. This can be done in by adding a vertical line and/or rectangle over a specified number of days. Here are two options:</p>
<ol style="list-style-type: decimal">
<li>Use <code>annotate()</code>:
<ul>
<li>For a line use <code>annotate(geom = "segment")</code>. Provide <code>x</code>, <code>xend</code>, <code>y</code>, and <code>yend</code>. Adjust size, linetype (<code>lty</code>), and color.<br />
</li>
<li>For a rectangle use <code>annotate(geom = "rect")</code>. Provide xmin/xmax/ymin/ymax. Adjust color and alpha.<br />
</li>
</ul></li>
<li>Group the data by tentative status and color those bars differently</li>
</ol>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> You might try <code>geom_rect()</code> to draw a rectangle, but adjusting the transparency does not work in a linelist context. This function overlays one rectangle for each observation/row!. Use either a very low alpha (e.g. 0.01), or another approach. </span></p>
<div id="using-annotate" class="section level3 unnumbered">
<h3>Using <code>annotate()</code></h3>
<ul>
<li>Within <code>annotate(geom = "rect")</code>, the <code>xmin</code> and <code>xmax</code> arguments must be given inputs of class Date.<br />
</li>
<li>Note that because these data are aggregated into weekly bars, and the last bar extends to the Monday after the last data point, the shaded region may appear to cover 4 weeks<br />
</li>
<li>Here is an <code>annotate()</code> <a href="https://ggplot2.tidyverse.org/reference/annotate.html">online example</a></li>
</ul>
<p>The same black vertical line can be achieved with the code below, but using <code>geom_vline()</code> you lose the ability to control the height:</p>
</div>
<div id="bars-color" class="section level3 unnumbered">
<h3>Bars color</h3>
<p>An alternative approach could be to adjust the color or display of the tentative bars of data themselves. You could create a new column in the data preparation stage and use it to group the data, such that the <code>aes(fill = )</code> of tentative data can be a different color or alpha than the other bars.</p>
</div>
</div>
<div id="multi-level-date-labels" class="section level2" number="32.5">
<h2><span class="header-section-number">32.5</span> Multi-level date labels</h2>
<p>If you want multi-level date labels (e.g. month and year) <em>without duplicating the lower label levels</em>, consider one of the approaches below:</p>
<p>Remember - you can can use tools like <code>\n</code> <em>within</em> the <code>date_labels</code> or <code>labels</code> arguments to put parts of each label on a new line below. However, the code below helps you take years or months (for example) on a lower line <em>and only once</em>. A few notes on the code below:</p>
<ul>
<li>Case counts are aggregated into weeks for aesthetic reasons. See Epicurves page (aggregated data tab) for details.<br />
</li>
<li>A <code>geom_area()</code> line is used instead of a histogram, as the faceting approach below does not work well with histograms.</li>
</ul>
<p><strong>Aggregate to weekly counts</strong></p>
<p><strong>Make plots</strong></p>
<p>The above techniques were adapted from <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">this</a> and <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">this</a> post on stackoverflow.com.</p>
<!-- ======================================================= -->
</div>
<div id="dual-axis" class="section level2" number="32.6">
<h2><span class="header-section-number">32.6</span> Dual-axis</h2>
<p>Although there are fierce discussions about the validity of dual axes within the data visualization community, many epi supervisors still want to see an epicurve or similar chart with a percent overlaid with a second axis. This is discussed more extensively in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page, but one example using the <strong>cowplot</strong> method is shown below:</p>
<ul>
<li>Two distinct plots are made, and then combined with <strong>cowplot</strong> package.<br />
</li>
<li>The plots must have the exact same x-axis (set limits) or else the data and labels will not align<br />
</li>
<li>Each uses <code>theme_cowplot()</code> and one has the y-axis moved to the right side of the plot</li>
</ul>
<p>Now use <strong>cowplot</strong> to overlay the two plots. Attention has been paid to the x-axis alignment, side of the y-axis, and use of <code>theme_cowplot()</code>.</p>
</div>
<div id="cumulative-incidence-1" class="section level2" number="32.7">
<h2><span class="header-section-number">32.7</span> Cumulative Incidence</h2>
<p>Note: If using <strong>incidence2</strong>, see the section on how you can produce cumulative incidence with a simple function. This page will address how to calculate cumulative incidence and plot it with <code>ggplot()</code>.</p>
<p>If beginning with a case linelist, create a new column containing the cumulative number of cases per day in an outbreak using <code>cumsum()</code> from <strong>base</strong> R:</p>
<p>The first 10 rows are shown below:</p>
<p>This cumulative column can then be plotted against <code>date_onset</code>, using <code>geom_line()</code>:</p>
<p>It can also be overlaid onto the epicurve, with dual-axis using the <strong>cowplot</strong> method described above and in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page:</p>
<p>Now use <strong>cowplot</strong> to overlay the two plots. Attention has been paid to the x-axis alignment, side of the y-axis, and use of <code>theme_cowplot()</code>.</p>
<!-- ======================================================= -->
</div>
<div id="resources-25" class="section level2" number="32.8">
<h2><span class="header-section-number">32.8</span> Resources</h2>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-05-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
