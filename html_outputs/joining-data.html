<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>13 Joining data | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Editorial and technical notes</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Download handbook and data</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transition to R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Suggested packages</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Import and export</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Cleaning data and core functions</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">10</span> Factors</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivoting data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Grouping data</a></li>
<li><a class="active" href="joining-data.html"><span class="header-section-number">13</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">14</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteration, loops, and lists</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Descriptive tables</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Simple statistical tests</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Univariate and multivariable regression</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Missing data</a></li>
<li><a class="" href="standardization-1.html"><span class="header-section-number">21</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection-1.html"><span class="header-section-number">23</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Epidemic modeling</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> Contact tracing</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">28</span> Tables for presentation</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">29</span> ggplot basics</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">30</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">31</span> Plot categorical data</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">32</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">33</span> Epidemic curves</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">34</span> Demographic pyramids and Likert-scales</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagrams and charts</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Combinations analysis</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">37</span> Heat plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">38</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">39</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">40</span> Interactive plots</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">41</span> Reports with R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">42</span> Organizing routine reports</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">43</span> Dashboards with R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">44</span> Dashboards with Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="version-control-and-collaboration-with-github.html"><span class="header-section-number">46</span> Version control and collaboration with Github</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
<li><a class="" href="errors-help.html"><span class="header-section-number">48</span> Errors &amp; help</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">49</span> Relational databases</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">50</span> R on network drives</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">51</span> Data Table</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">52</span> Advanced RStudio</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="joining-data" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Joining data<a class="anchor" aria-label="anchor" href="#joining-data"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/left-join.gif" width="50%"></div>
<p>This page describes common “joins” and also probabilistic matching between dataframes.</p>
<!-- ======================================================= -->
<div id="preparation-4" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-4"><i class="fas fa-link"></i></a>
</h2>
<div id="load-packages-5" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages-5"><i class="fas fa-link"></i></a>
</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,            <span class="co"># import/export</span>
  <span class="va">here</span>,           <span class="co"># relative filepaths</span>
  <span class="va">tidyverse</span>,      <span class="co"># data management/viz</span>
  <span class="va">RecordLinkage</span>,  <span class="co"># probabilistic matches</span>
  <span class="va">fastLink</span>        <span class="co"># probabilistic matches</span>
<span class="op">)</span></code></pre></div>
<p>Because traditional joins (non-probabilistic) can be very specific, requiring exact string matches, you may need to do cleaning on the datasets <em>prior to</em> the join (e.g. change spellings, change case to all lower or upper).</p>
</div>
<div id="import-data-5" class="section level3 unnumbered">
<h3>Import data<a class="anchor" aria-label="anchor" href="#import-data-5"><i class="fas fa-link"></i></a>
</h3>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page. The dataset is imported using the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data.</p>
<div class="sourceCode" id="cb513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the linelist</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p>The first 50 rows of the linelist are displayed below.</p>
<div id="htmlwidget-eef94039b0ab220887c8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-eef94039b0ab220887c8">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="datasets" class="section level3" number="13.1.1">
<h3>
<span class="header-section-number">13.1.1</span> Datasets<a class="anchor" aria-label="anchor" href="#datasets"><i class="fas fa-link"></i></a>
</h3>
<p>In the joining examples, we’ll use the following datasets:</p>
<ol style="list-style-type: decimal">
<li>A “miniature” version of the <code>linelist</code>, containing only the columns <code>case_id</code>, <code>date_onset</code>, and <code>hospital</code>, and only the first 10 rows<br>
</li>
<li>A separate dataframe named <code>hosp_info</code>, which contains more details about each hospital<br>
</li>
<li>Two separate small dataframes for the probabilistic matching section</li>
</ol>
<div id="miniature-linelist" class="section level4 unnumbered">
<h4>“Miniature” linelist<a class="anchor" aria-label="anchor" href="#miniature-linelist"><i class="fas fa-link"></i></a>
</h4>
<p>Below is the the miniature linelist, which contains only 10 rows and only columns <code>case_id</code>, <code>date_onset</code>, and <code>hospital</code>.</p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                 <span class="co"># start with original linelist</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># select columns</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>                                    <span class="co"># only take the first 10 rows</span></code></pre></div>
<div id="htmlwidget-83b4a2c5aebb48899c83" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-83b4a2c5aebb48899c83">{"x":{"filter":"none","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="hospital-information-dataframe" class="section level4 unnumbered">
<h4>Hospital information dataframe<a class="anchor" aria-label="anchor" href="#hospital-information-dataframe"><i class="fas fa-link"></i></a>
</h4>
<p>Below is the separate dataframe with additional information about each hospital.</p>
<div class="sourceCode" id="cb515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make the hospital information dataframe</span>
<span class="va">hosp_info</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  hosp_name     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"central hospital"</span>, <span class="st">"military"</span>, <span class="st">"military"</span>, <span class="st">"port"</span>, <span class="st">"St. Mark's"</span>, <span class="st">"ignace"</span>, <span class="st">"sisters"</span><span class="op">)</span>,
  catchment_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1950280</span>, <span class="fl">40500</span>, <span class="fl">10000</span>, <span class="fl">50280</span>, <span class="fl">12000</span>, <span class="fl">5000</span>, <span class="fl">4200</span><span class="op">)</span>,
  level         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tertiary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Primary"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="htmlwidget-76e282fbfe1ee7022fda" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-76e282fbfe1ee7022fda">{"x":{"filter":"none","data":[["central hospital","military","military","port","St. Mark's","ignace","sisters"],[1950280,40500,10000,50280,12000,5000,4200],["Tertiary","Secondary","Primary","Secondary","Secondary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="pre-cleaning" class="section level3 unnumbered">
<h3>Pre-cleaning<a class="anchor" aria-label="anchor" href="#pre-cleaning"><i class="fas fa-link"></i></a>
</h3>
<p>Because traditional (non-probabilistic) joins are case-sensitive and require exact string matches, we will clean-up the <code>hosp_info</code> dataset prior to the joins.</p>
<p><strong>Identify differences</strong></p>
<p>We need the values of <code>hosp_name</code> column in <code>hosp_info</code> dataframe to match the values of <code>hospital</code> column in the <code>linelist</code> dataframe.</p>
<p>Here are the values in <code>linelist_mini</code>:</p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist_mini</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Other"                                "Missing"                              "St. Mark's Maternity Hospital (SMMH)"
## [4] "Port Hospital"                        "Military Hospital"</code></pre>
<p>and here are the values in <code>hosp_info</code>:</p>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hosp_info</span><span class="op">$</span><span class="va">hosp_name</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "central hospital" "military"         "port"             "St. Mark's"       "ignace"           "sisters"</code></pre>
<p><strong>Align matching values</strong></p>
<p>We begin by cleaning the values in <code>hosp_name</code>. We use logic to code the values in the new column using <code>case_when()</code> (read more about <code>case_when()</code> in the <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Cleaning data and core functions</a> page). We correct the hospital names that exist in both dataframes, and leave the others as they are (<code>TRUE ~ hosp_name</code>).</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Typically, one should create a new column (e.g. <code>hosp_name_clean</code>), but for ease of demonstration we show modification of the old column</span></p>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosp_info</span> <span class="op">&lt;-</span> <span class="va">hosp_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    hosp_name <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"military"</span>          <span class="op">~</span> <span class="st">"Military Hospital"</span>,
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"port"</span>              <span class="op">~</span> <span class="st">"Port Hospital"</span>,
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"St. Mark's"</span>        <span class="op">~</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"central hospital"</span>  <span class="op">~</span> <span class="st">"Central Hospital"</span>,
      <span class="cn">TRUE</span>                             <span class="op">~</span> <span class="va">hosp_name</span>
      <span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>We now see that the hospital names that appear in both dataframe are aligned. There are some hospitals in <code>hosp_info</code> that are not present in <code>linelist</code> - we will deal with these later, in the join.</p>
<div class="sourceCode" id="cb521"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hosp_info</span><span class="op">$</span><span class="va">hosp_name</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Central Hospital"                     "Military Hospital"                    "Port Hospital"                       
## [4] "St. Mark's Maternity Hospital (SMMH)" "ignace"                               "sisters"</code></pre>
<p>If you need to convert all values to UPPER or lower case, use these functions from <strong>stringr</strong>, as shown in the page on <a href="characters-and-strings.html#characters-and-strings">Characters and strings</a>.</p>
<p><code>str_to_upper()</code><br><code>str_to_upper()</code><br><code>str_to_title()</code></p>
<!-- ======================================================= -->
</div>
</div>
<div id="dplyr-joins" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> <strong>dplyr</strong> joins<a class="anchor" aria-label="anchor" href="#dplyr-joins"><i class="fas fa-link"></i></a>
</h2>
<p>The <strong>dplyr</strong> package offers several different joins. <strong>dplyr</strong> is included in the <strong>tidyverse</strong> package. These join functions are described below, with simple use cases. Many thanks to <a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">https://github.com/gadenbuie</a> for the moving images!</p>
<!-- ======================================================= -->
<div id="general-syntax" class="section level3 unnumbered">
<h3>General syntax<a class="anchor" aria-label="anchor" href="#general-syntax"><i class="fas fa-link"></i></a>
</h3>
<p><strong>General function structure</strong></p>
<p>Any of these join commands can be run independently, like below.</p>
<p>An object is being created, or re-defined: dataframe 2 (<code>df2</code>) is being joined to dataframe 1 (<code>df1</code>), on the basis of matches between the column “ID” in <code>df1</code> and the column “identifier” in <code>df2</code>. Because this example uses <code>left_join()</code>, any rows in <code>df2</code> that do not match to a row in <code>df1</code> will be dropped.</p>
<div class="sourceCode" id="cb523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">object</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"identifier"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The join commands can also be run within a pipe chain. The first dataframe <code>df1</code> is the dataframe that is being passed through the pipes. <code>df2</code> is joined to it with the <code>left_join()</code> command. An example is shown below.</p>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">object</span> <span class="op">&lt;-</span> <span class="va">df1</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"identifier"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># join df2 to df1</span></code></pre></div>
<p><strong>Join columns (<code>by =</code>)</strong></p>
<p>You must specify the columns in each dataset in which the values must match, using the arguemnt <code>by =</code>. You have a few options:</p>
<ul>
<li>Specify only one column name (<code>by = "ID"</code>) - this only works if this exact column name is present in both dataframes!<br>
</li>
<li>Specify the different names (<code>by = c("ID" = "Identifier")</code> - use this if the column names are different in the 2 dataframes<br>
</li>
<li>Specify multiple columns to match on (<code>by = c("ID" = "Identifier", "date_onset" = "Date_of_Onset")</code>) - this will require exact matches on multiple columns for rows to join.</li>
</ul>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Joins are case-specific! Therefore it is useful to convert all values to lowercase or uppercase prior to joining. See the page on characters/strings.</span></p>
<!-- ======================================================= -->
</div>
<div id="add-columns-left-right-joins" class="section level3 unnumbered">
<h3>Add columns: left &amp; right joins<a class="anchor" aria-label="anchor" href="#add-columns-left-right-joins"><i class="fas fa-link"></i></a>
</h3>
<p><strong>A left or right join is commonly used to add information to a dataframe</strong> - new information is added only to rows that already exist in the baseline (starting) dataframe.</p>
<p>These are common joins in epidemiological work - they are used to add information from one dataset into another.</p>
<p><em>The order of the dataframes is important</em>.</p>
<ul>
<li>In a <em>left join</em>, the <em>first</em> (left) dataframe listed is the baseline<br>
</li>
<li>In a <em>right join</em>, the <em>second</em> (right) dataframe listed is the baseline</li>
</ul>
<p><strong>All rows of the baseline dataframe are kept.</strong> Information in the secondary dataframe is joined to the baseline dataframe <em>only if there is a match via the identifier column(s)</em>. In addition:</p>
<ul>
<li>Rows in the secondary dataframe that do not match are dropped.<br>
</li>
<li>If there are many baseline rows that match to one row in the secondary dataframe (many-to-one), the baseline information is added to each matching baseline row.<br>
</li>
<li>If a baseline row matches to multiple rows in the secondary dataframe (one-to-many), all combinations are given, meaning <em>new rows may be added to your returned dataframe!</em>
</li>
</ul>
<p><img src="images/left-join.gif" width="50%"><img src="images/right-join.gif" width="50%"></p>
<p><strong>Example</strong></p>
<p>Below is the output of a <code>left_join()</code> of <code>hosp_info</code> (secondary dataframe) <em>into</em> <code>linelist_mini</code> (baseline dataframe). Note the following:</p>
<ul>
<li>Two new columns, <code>catchment_pop</code> and <code>level</code> have been added on the left<br>
</li>
<li>All original rows of the baseline dataframe <code>linelist_mini</code> are kept<br>
</li>
<li>Any original rows of <code>linelist_mini</code> for “Military Hospital” are duplicated because it matched to <em>two</em> rows in the secondary dataframe, so both combinations are returned<br>
</li>
<li>The join identifier column of the secondary dataset (<code>hosp_name</code>) has disappeared because it is redundant with the identifier column in the primary dataset (<code>hospital</code>)<br>
</li>
<li>When a baseline row did not match to any secondary row (e.g. when <code>hospital</code> is “Other” or “Missing”), <code>NA</code> fills in the columns from the secondary dataframe<br>
</li>
<li>Rows in the secondary dataframe with no match to the baseline dataframe (“sisters” and “ignace”) were dropped</li>
</ul>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-8ac7151e586f9b1a0ab1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8ac7151e586f9b1a0ab1">{"x":{"filter":"none","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>“Should I use a right join, or a left join?”</strong><br>
Most important is to ask “which dataframe should retain all of its rows?” - use this one as the baseline.</p>
<p>The two commands below achieve the same output - 10 rows of <code>hosp_info</code> joined <em>into</em> a <code>linelist_mini</code> baseline. However, the column order will differ based on whether <code>hosp_info</code> arrives from the right (in the left join) or arrives from the left (in the right join). The order of the rows may also shift consequently.</p>
<p>Also consider whether your use-case is within a pipe chain (<code>%&gt;%</code>). If the dataset in the pipes is the baseline, you will likely use a left join to add data to it.</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The two commands below achieve the same data, but with differently ordered rows and columns</span>
<span class="fu">left_join</span><span class="op">(</span><span class="va">linelist_mini</span>, <span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">right_join</span><span class="op">(</span><span class="va">hosp_info</span>, <span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-036fc584dafb26804504" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-036fc584dafb26804504">{"x":{"filter":"none","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="htmlwidget-2dc3ae6e3f16e753fdcc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2dc3ae6e3f16e753fdcc">{"x":{"filter":"none","data":[["Military Hospital","Military Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Missing","Missing","Missing","Missing","Missing"],[40500,10000,50280,50280,12000,null,null,null,null,null,null],["Secondary","Primary","Secondary","Secondary","Secondary",null,null,null,null,null,null],["893f25","893f25","b8812a","be99c8","11f8ea","5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-21","2014-05-21","2014-05-18","2014-05-22","2014-05-16","2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="full-join" class="section level3 unnumbered">
<h3>Full join<a class="anchor" aria-label="anchor" href="#full-join"><i class="fas fa-link"></i></a>
</h3>
<p><strong>A full join is the most <em>inclusive</em> of the joins</strong> - it returns all rows from both dataframes.</p>
<p>If there are any rows present in one and not the other (where no match was found), the dataframe will become wider as <code>NA</code> values are added to fill-in. Watch the number of columns and rows carefully and troubleshoot case-sensitivity and exact string matches.</p>
<p>Adjustment of the “baseline” (first) dataframe will not impact which records are returned, but it will impact the column order, row order, and which identifier column is retained.</p>
<div class="inline-figure"><img src="images/full-join.gif" width="50%"></div>
<p><strong>Example</strong></p>
<p>Below is the output of a <code>full_join()</code> of <code>hosp_info</code> <em>into</em> <code>linelist_mini</code>. Note the following:</p>
<ul>
<li>All baseline rows (<code>linelist_mini</code>) are kept<br>
</li>
<li>Any baseline rows for “Military Hospital” are duplicated because they match to two secondary rows and both combinations are returned<br>
</li>
<li>Only the identifier column from the baseline is kept (<code>hospital</code>)<br>
</li>
<li>
<code>NA</code> fills in where baseline rows did not match to secondary rows (<code>hospital</code> was “Other” or “Missing”), or the opposite (where <code>hosp_name</code> was “ignace” or “sisters”)</li>
</ul>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">full_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-92bc80b3a6817bcb8bcf" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-92bc80b3a6817bcb8bcf">{"x":{"filter":"none","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca",null,null,null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05",null,null,null],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Central Hospital","ignace","sisters"],[null,null,12000,50280,40500,10000,50280,null,null,null,null,1950280,5000,4200],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null,"Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":13,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,13,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="inner-join" class="section level3 unnumbered">
<h3>Inner join<a class="anchor" aria-label="anchor" href="#inner-join"><i class="fas fa-link"></i></a>
</h3>
<p><strong>An inner join is the most <em>restrictive</em> of the joins</strong> - it returns only rows with matches across both dataframes.<br>
This means that your original dataset may reduce in number of rows. Adjustment of the “baseline” (first) dataframe will not impact which records are returned, but it will impact the column order, row order, and which identifier column is retained.</p>
<div class="inline-figure"><img src="images/inner-join.gif" width="50%"></div>
<p><strong>Example</strong></p>
<p>Below is the output of an <code>inner_join()</code> of <code>linelist_mini</code> (baseline) with <code>hosp_info</code> (secondary). Note the following:</p>
<ul>
<li>Not all baseline rows are kept (rows where <code>hospital</code> is “Missing” or “Other” are removed because had no match in the secondary dataframe<br>
</li>
<li>Likewise, secondary rows where <code>hosp_name</code> is “sisters” or “ignace” are removed as they have no match in the baseline dataframe<br>
</li>
<li>Only the identifier column from the baseline is kept (<code>hospital</code>)</li>
</ul>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">inner_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosp_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">inner_join</span><span class="op">(</span><span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-4ed5e764a32417c3ee65" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4ed5e764a32417c3ee65">{"x":{"filter":"none","data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="semi-join" class="section level3 unnumbered">
<h3>Semi join<a class="anchor" aria-label="anchor" href="#semi-join"><i class="fas fa-link"></i></a>
</h3>
<p>A semi join is a “filtering join” which uses another dataset <em>not to add rows or columns, but to perform filtering</em>.<br>
A <strong>semi-join keeps all observations in dataframe 1 that have a match in dataframe 2</strong> (but does not add new columns or duplicate any rows with multiple matches). Read more about filtering joins <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">here</a>.</p>
<div class="inline-figure"><img src="images/semi-join.gif" width="50%"></div>
<p>The below code would return <strong>0</strong> rows, because the two dataframes are completely different - there are no rows that are in both.</p>
<div class="sourceCode" id="cb530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosp_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">semi_join</span><span class="op">(</span><span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="anti-join" class="section level3 unnumbered">
<h3>Anti join<a class="anchor" aria-label="anchor" href="#anti-join"><i class="fas fa-link"></i></a>
</h3>
<p><strong>The anti join is a “filtering join” that returns rows in dataframe 1 that <em>do not</em> have a match in dataframe 2.</strong></p>
<p>Read more about filtering joins <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">here</a>.</p>
<p>Common scenarios for an anti-join include identifying records not present in another dataframe, troubleshooting spelling in a join (catching records that <em>should have</em> matched), and examining records that were excluded after another join.</p>
<p><strong>As with right_join() and left_join(), the <em>baseline</em> dataframe (listed first) is important</strong>. The returned rows are from it only. Notice in the gif below that row in the non-baseline dataframe (purple 4) is not returned even though it does not match.</p>
<div class="inline-figure"><img src="images/anti-join.gif" width="50%"></div>
<p><strong>Simple <code>anti_join()</code> example</strong></p>
<p>For an example, let’s find the <code>hosp_info</code> hospitals that do not have any cases present in <code>linelist_mini</code>. We list <code>hosp_info</code> first, as the baseline dataframe. The two hospitals which are not present in <code>linelist_mini</code> are returned.</p>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosp_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">anti_join</span><span class="op">(</span><span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-81375042e18df2e72ea0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-81375042e18df2e72ea0">{"x":{"filter":"none","data":[["Central Hospital","ignace","sisters"],[1950280,5000,4200],["Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong><code>anti_join()</code> example 2</strong></p>
<p>For another example, let us say we ran an <code>inner_join()</code> between <code>linelist_mini</code> and <code>hosp_info</code>. This returns only 8 of the original 11 <code>linelist_mini</code> records.</p>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">inner_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-e79e64192617c24915cb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e79e64192617c24915cb">{"x":{"filter":"none","data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>To review the 3 <code>linelist_mini</code> records that were excluded in the inner join, we can run an anti-join with <code>linelist_mini</code> as the baseline dataframe.</p>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">anti_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-3926e06aa96d2ef37578" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3926e06aa96d2ef37578">{"x":{"filter":"none","data":[["5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>To see the <code>hosp_info</code> records that were excluded in the inner join, we could also run an anti-join with <code>hosp_info</code> as the baseline dataframe.</p>
</div>
</div>
<div id="binding-and-aligning" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Binding and aligning<a class="anchor" aria-label="anchor" href="#binding-and-aligning"><i class="fas fa-link"></i></a>
</h2>
<p>Another method of combining two data frames is “binding” them. You can also think of this as “appending” or “adding” rows/columns.</p>
<p>In some circumstances, it is necessary to “align” the rows of one data frame in the same order as in another data frame. This topic is also discussed below in the Bind columns section.</p>
<div id="bind-rows" class="section level3 unnumbered">
<h3>Bind rows<a class="anchor" aria-label="anchor" href="#bind-rows"><i class="fas fa-link"></i></a>
</h3>
<p>To bind rows of one data frame to the bottom of another data frame, use <code>bind_rows()</code> from <strong>dplyr</strong>. It is very inclusive, so any column present in either data frame will be included in the output. A few notes:</p>
<ul>
<li>Unlike the <strong>base</strong> R version <code>row.bind()</code>, <code>bind_rows()</code> does not require that the order of columns be the same in both data frames. As long as the column names are spelled identically, it will align them correctly.<br>
</li>
<li>You can optionally specify the argument <code>.id =</code>. Provide a character column name. This will produce a data frame identifier column so that you can know which rows came from which data frame.<br>
</li>
<li>You can use <code>bind_rows()</code> on a list of dataframes to collapse them into one data frame. See an example in the <a href="iteration-loops-and-lists.html#iteration-loops-and-lists">Iteration, loops, and lists</a> page involving importing and combining multiple linelists with <strong>purrr</strong>.</li>
</ul>
<p>One common example of row binding is to bind a “total” row onto a descriptive table made with <strong>dplyr</strong>. Below we create a table of case counts and median CT values by hospital. Since <code>summarise()</code> do not automatically produce a “totals” row, we create it by summarising a different table (not grouped by hospital), and then row-binding the data frames together.</p>
<p>See other worked examples like this in the <a href="descriptive-tables.html#descriptive-tables-1">Descriptive tables</a> and <a href="tables-for-presentation.html#tables-for-presentation">Tables for presentation</a> pages.</p>
<div class="sourceCode" id="cb534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create core table</span>
<span class="co">###################</span>
<span class="va">table</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>                              <span class="co"># Group data by hospital</span>
  <span class="fu">summarise</span><span class="op">(</span>                                          <span class="co"># Create new summary columns of indicators of interest</span>
    N <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,                                            <span class="co"># Number of rows per hospital-outcome group     </span>
    ct_value_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">ct_blood</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>           <span class="co"># median CT value per group</span></code></pre></div>
<p>Here is the <code>table</code> data frame:</p>
<div id="htmlwidget-23d97f775325f55aaffc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-23d97f775325f55aaffc">{"x":{"filter":"none","data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[22,21,21,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>N<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Create a data frame with the “total” statistics (not grouped by hospital). This should be just one row.</p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create totals</span>
<span class="co">###############</span>
<span class="va">totals</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    N <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,                                       <span class="co"># Number of rows for whole dataset     </span>
    ct_value_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">ct_blood</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>      <span class="co"># Median CT for whole dataset</span></code></pre></div>
<p>And below is that <code>totals</code> data frame. Note how there are only two columns. These columns are also in <code>table</code>, but there is one column in <code>table</code> that is not in <code>totals</code> (<code>hospital</code>).</p>
<div id="htmlwidget-5f72f2315f4d23efae98" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5f72f2315f4d23efae98">{"x":{"filter":"none","data":[[5888],[22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>N<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Now we can bind the rows together with <code>bind_rows()</code>.</p>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Bind rows together</span>
<span class="co">####################</span>
<span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">table</span>, <span class="va">totals</span><span class="op">)</span></code></pre></div>
<p>Now we can view the result. See how in the final row, an empty <code>NA</code> value fills in for the column <code>hospital</code> that was not in <code>totals</code>. As explained in the <a href="tables-for-presentation.html#tables-for-presentation">Tables for presentation</a> page, you could “fill-in” this value with “Total” using <code>replace_na()</code>.</p>
<div id="htmlwidget-2da192e7950ff4f86f20" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2da192e7950ff4f86f20">{"x":{"filter":"none","data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null],[454,896,1469,885,1762,422,5888],[22,21,21,22,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>N<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="bind-columns" class="section level3 unnumbered">
<h3>Bind columns<a class="anchor" aria-label="anchor" href="#bind-columns"><i class="fas fa-link"></i></a>
</h3>
<p>There is a similar <strong>dplyr</strong> function <code>bind_cols()</code> which you can use to combine two data frames sideways. Note that rows are matched <em>by position</em> (not like a <em>join</em> above) - so for example the 12th row in each data frame will be aligned.</p>
<p>For an example, we bind several summary tables together. In order to do this, we also demonstrate how to re-arrange the order of rows in one data frame to match the order in another dataframe, with <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>.</p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Case information</span>
<span class="va">case_info</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div id="htmlwidget-823d041b1094ad76de9e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-823d041b1094ad76de9e">{"x":{"filter":"none","data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[193,399,611,395,785,199]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>And let’s say that here is a table of information on contact follow-up by hospital.</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contact_fu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>, <span class="st">"Military Hospital"</span>, <span class="st">"Missing"</span>, <span class="st">"Central Hospital"</span>, <span class="st">"Port Hospital"</span>, <span class="st">"Other"</span><span class="op">)</span>,
  investigated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"80%"</span>, <span class="st">"82%"</span>, <span class="cn">NA</span>, <span class="st">"78%"</span>, <span class="st">"64%"</span>, <span class="st">"55%"</span><span class="op">)</span>,
  per_fu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"60%"</span>, <span class="st">"25%"</span>, <span class="cn">NA</span>, <span class="st">"20%"</span>, <span class="st">"75%"</span>, <span class="st">"80%"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="htmlwidget-2f4941bbd45c1fe0fbbf" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2f4941bbd45c1fe0fbbf">{"x":{"filter":"none","data":[["St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Central Hospital","Port Hospital","Other"],["80%","82%",null,"78%","64%","55%"],["60%","25%",null,"20%","75%","80%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Note that the hospitals are the same, but are in different orders in each data frame. A simple <code>bind_cols()</code> would result in a mis-match of data. We can use <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> from <strong>base</strong> R to align the rows of data frame two in the same order by hospital as in data frame 1. We assume for this approach that there are no duplicate values in either data frame.</p>
<p>When we use <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>, the syntax is <code>match(TARGET ORDER VECTOR, DATA FRAME COLUMN TO CHANGE)</code>, where the first argument is the desired order (either a stand-alone vector, or in this case a column in a data frame), and the second argument is the data frame column in the data frame that will be re-ordered. The output of <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> is a vector of numbers representing the correct position ordering. You can read more with <code><a href="https://rdrr.io/r/base/match.html">?match</a></code>.</p>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">case_info</span><span class="op">$</span><span class="va">hospital</span>, <span class="va">contact_fu</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 4 2 3 6 5 1</code></pre>
<p>You can use this numeric vector to re-order the data frame - place it with subset brackets <code>[ ]</code> <em>before the comma</em>. Read more about <strong>base</strong> R subsetting syntax in the <a href="r-basics.html#r-basics">R basics</a> page. The command below creates a new data frame, defined as the old one in which the rows are ordered in the numeric vector above.</p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contact_fu_aligned</span> <span class="op">&lt;-</span> <span class="va">contact_fu</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">case_info</span><span class="op">$</span><span class="va">hospital</span>, <span class="va">contact_fu</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>,<span class="op">]</span>

<span class="va">contact_fu_aligned</span></code></pre></div>
<pre><code>##                               hospital investigated per_fu
## 4                     Central Hospital          78%    20%
## 2                    Military Hospital          82%    25%
## 3                              Missing         &lt;NA&gt;   &lt;NA&gt;
## 6                                Other          55%    80%
## 5                        Port Hospital          64%    75%
## 1 St. Mark's Maternity Hospital (SMMH)          80%    60%</code></pre>
<p>Now we can bind the data frame columns together, with the correct row order:</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bind_cols</span><span class="op">(</span><span class="va">case_info</span>, <span class="va">contact_fu</span><span class="op">)</span></code></pre></div>
<pre><code>## New names:
## * hospital -&gt; hospital...1
## * hospital -&gt; hospital...4</code></pre>
<pre><code>## # A tibble: 6 x 6
##   hospital...1                         cases deaths hospital...4                         investigated per_fu
##   &lt;chr&gt;                                &lt;int&gt;  &lt;int&gt; &lt;chr&gt;                                &lt;chr&gt;        &lt;chr&gt; 
## 1 Central Hospital                       454    193 St. Mark's Maternity Hospital (SMMH) 80%          60%   
## 2 Military Hospital                      896    399 Military Hospital                    82%          25%   
## 3 Missing                               1469    611 Missing                              &lt;NA&gt;         &lt;NA&gt;  
## 4 Other                                  885    395 Central Hospital                     78%          20%   
## 5 Port Hospital                         1762    785 Port Hospital                        64%          75%   
## 6 St. Mark's Maternity Hospital (SMMH)   422    199 Other                                55%          80%</code></pre>
<p>A <strong>base</strong> R alternative to <code>bind_cols</code> is <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>, which performs the same operation.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="probabalistic-matching" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> Probabalistic matching<a class="anchor" aria-label="anchor" href="#probabalistic-matching"><i class="fas fa-link"></i></a>
</h2>
<p>If you do not have a unique identifier common across datasets to join on, consider using a probabilistic matching algorithm. This would find matches between records based on similarity (e.g. Jaro–Winkler string distance, or numeric distance). Below is a simple example using the package <strong>fastLink</strong> .</p>
<p><strong>Load packages</strong></p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">tidyverse</span>,      <span class="co"># data manipulation and visualization</span>
  <span class="va">fastLink</span>        <span class="co"># record matching</span>
  <span class="op">)</span></code></pre></div>
<p>Here are two small example datasets that we will use to demonstrate the probabilistic matching (<code>cases</code> and <code>test_results</code>):</p>
<p>Here is the code used to make the datasets:</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make datasets</span>

<span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span>
  <span class="op">~</span><span class="va">gender</span>, <span class="op">~</span><span class="va">first</span>,      <span class="op">~</span><span class="va">middle</span>,     <span class="op">~</span><span class="va">last</span>,        <span class="op">~</span><span class="va">yr</span>,   <span class="op">~</span><span class="va">mon</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">district</span>,
  <span class="st">"M"</span>,     <span class="st">"Amir"</span>,      <span class="cn">NA</span>,          <span class="st">"Khan"</span>,       <span class="fl">1989</span>,  <span class="fl">11</span>,   <span class="fl">22</span>,   <span class="st">"River"</span>,
  <span class="st">"M"</span>,     <span class="st">"Anthony"</span>,   <span class="st">"B."</span>,        <span class="st">"Smith"</span>,      <span class="fl">1970</span>, <span class="fl">09</span>, <span class="fl">19</span>,      <span class="st">"River"</span>, 
  <span class="st">"F"</span>,     <span class="st">"Marialisa"</span>, <span class="st">"Contreras"</span>, <span class="st">"Rodrigues"</span>,  <span class="fl">1972</span>, <span class="fl">04</span>, <span class="fl">15</span>,      <span class="st">"River"</span>,
  <span class="st">"F"</span>,     <span class="st">"Elizabeth"</span>, <span class="st">"Casteel"</span>,   <span class="st">"Chase"</span>,      <span class="fl">1954</span>, <span class="fl">03</span>, <span class="fl">03</span>,      <span class="st">"City"</span>,
  <span class="st">"M"</span>,     <span class="st">"Jose"</span>,      <span class="st">"Sanchez"</span>,   <span class="st">"Lopez"</span>,      <span class="fl">1996</span>, <span class="fl">01</span>, <span class="fl">06</span>,      <span class="st">"City"</span>,
  <span class="st">"F"</span>,     <span class="st">"Cassidy"</span>,   <span class="st">"Jones"</span>,      <span class="st">"Davis"</span>,     <span class="fl">1980</span>, <span class="fl">07</span>, <span class="fl">20</span>,      <span class="st">"City"</span>,
  <span class="st">"M"</span>,     <span class="st">"Michael"</span>,   <span class="st">"Murphy"</span>,     <span class="st">"O'Calaghan"</span>,<span class="fl">1969</span>, <span class="fl">04</span>, <span class="fl">12</span>,      <span class="st">"Rural"</span>, 
  <span class="st">"M"</span>,     <span class="st">"Oliver"</span>,    <span class="st">"Laurent"</span>,    <span class="st">"De Bordow"</span> , <span class="fl">1971</span>, <span class="fl">02</span>, <span class="fl">04</span>,     <span class="st">"River"</span>,
  <span class="st">"F"</span>,      <span class="st">"Blessing"</span>,  <span class="cn">NA</span>,          <span class="st">"Adebayo"</span>,   <span class="fl">1955</span>,  <span class="fl">02</span>, <span class="fl">14</span>,     <span class="st">"Rural"</span>
<span class="op">)</span>

<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span>
  <span class="op">~</span><span class="va">gender</span>,  <span class="op">~</span><span class="va">first</span>,     <span class="op">~</span><span class="va">middle</span>,     <span class="op">~</span><span class="va">last</span>,          <span class="op">~</span><span class="va">yr</span>, <span class="op">~</span><span class="va">mon</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">district</span>, <span class="op">~</span><span class="va">result</span>,
  <span class="st">"M"</span>,      <span class="st">"Amir"</span>,     <span class="cn">NA</span>,          <span class="st">"Khan"</span>,         <span class="fl">1989</span>, <span class="fl">11</span>,   <span class="fl">22</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Tony"</span>,   <span class="st">"B"</span>,         <span class="st">"Smith"</span>,          <span class="fl">1970</span>, <span class="fl">09</span>,   <span class="fl">19</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"F"</span>,      <span class="st">"Maria"</span>,    <span class="st">"Contreras"</span>, <span class="st">"Rodriguez"</span>,    <span class="fl">1972</span>, <span class="fl">04</span>,   <span class="fl">15</span>,  <span class="st">"Cty"</span>,   <span class="st">"negative"</span>,
  <span class="st">"F"</span>,      <span class="st">"Betty"</span>,    <span class="st">"Castel"</span>,   <span class="st">"Chase"</span>,        <span class="fl">1954</span>,  <span class="fl">03</span>,   <span class="fl">30</span>,  <span class="st">"City"</span>,  <span class="st">"positive"</span>,
  <span class="st">"F"</span>,      <span class="st">"Andrea"</span>,   <span class="cn">NA</span>,          <span class="st">"Kumaraswamy"</span>,  <span class="fl">2001</span>, <span class="fl">01</span>,   <span class="fl">05</span>,  <span class="st">"Rural"</span>, <span class="st">"positive"</span>,      
  <span class="st">"F"</span>,      <span class="st">"Caroline"</span>, <span class="cn">NA</span>,          <span class="st">"Wang"</span>,         <span class="fl">1988</span>, <span class="fl">12</span>,   <span class="fl">11</span>,  <span class="st">"Rural"</span>, <span class="st">"negative"</span>,
  <span class="st">"F"</span>,      <span class="st">"Trang"</span>,    <span class="cn">NA</span>,          <span class="st">"Nguyen"</span>,       <span class="fl">1981</span>, <span class="fl">06</span>,   <span class="fl">10</span>,  <span class="st">"Rural"</span>, <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Olivier"</span> , <span class="st">"Laurent"</span>,   <span class="st">"De Bordeaux"</span>,  <span class="cn">NA</span>,   <span class="cn">NA</span>,   <span class="cn">NA</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Mike"</span>,     <span class="st">"Murphy"</span>,    <span class="st">"O'Callaghan"</span>,  <span class="fl">1969</span>, <span class="fl">04</span>,   <span class="fl">12</span>,  <span class="st">"Rural"</span>, <span class="st">"negative"</span>,
  <span class="st">"F"</span>,      <span class="st">"Cassidy"</span>,  <span class="st">"Jones"</span>,     <span class="st">"Davis"</span>,        <span class="fl">1980</span>, <span class="fl">07</span>,   <span class="fl">02</span>,  <span class="st">"City"</span>,  <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Mohammad"</span>, <span class="cn">NA</span>,          <span class="st">"Ali"</span>,          <span class="fl">1942</span>, <span class="fl">01</span>,   <span class="fl">17</span>,  <span class="st">"City"</span>,  <span class="st">"negative"</span>,
  <span class="cn">NA</span>,       <span class="st">"Jose"</span>,     <span class="st">"Sanchez"</span>,   <span class="st">"Lopez"</span>,        <span class="fl">1995</span>, <span class="fl">01</span>,   <span class="fl">06</span>,  <span class="st">"City"</span>,  <span class="st">"negative"</span>,
  <span class="st">"M"</span>,      <span class="st">"Abubakar"</span>, <span class="cn">NA</span>,          <span class="st">"Abullahi"</span>,     <span class="fl">1960</span>, <span class="fl">01</span>,   <span class="fl">01</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"F"</span>,      <span class="st">"Maria"</span>,    <span class="st">"Salinas"</span>,   <span class="st">"Contreras"</span>,    <span class="fl">1955</span>, <span class="fl">03</span>,   <span class="fl">03</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>
  <span class="op">)</span></code></pre></div>
<p><strong>The <code>cases</code> dataset has 9 records</strong> of patients who are awaiting test results.</p>
<div id="htmlwidget-2d481edd205aeb597e07" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2d481edd205aeb597e07">{"x":{"filter":"none","data":[["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>The <code>test_results</code> dataset</strong> has 14 records and contains the column <code>result</code>, which we want to add to the records in <code>cases</code> based on probabilistic matching of records.</p>
<div id="htmlwidget-9f5a6f453385434f8ad6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9f5a6f453385434f8ad6">{"x":{"filter":"none","data":[["M","M","F","F","F","F","F","M","M","F","M",null,"M","F"],["Amir","Tony","Maria","Betty","Andrea","Caroline","Trang","Olivier","Mike","Cassidy","Mohammad","Jose","Abubakar","Maria"],[null,"B","Contreras","Castel",null,null,null,"Laurent","Murphy","Jones",null,"Sanchez",null,"Salinas"],["Khan","Smith","Rodriguez","Chase","Kumaraswamy","Wang","Nguyen","De Bordeaux","O'Callaghan","Davis","Ali","Lopez","Abullahi","Contreras"],[1989,1970,1972,1954,2001,1988,1981,null,1969,1980,1942,1995,1960,1955],[11,9,4,3,1,12,6,null,4,7,1,1,1,3],[22,19,15,30,5,11,10,null,12,2,17,6,1,3],["River","River","Cty","City","Rural","Rural","Rural","River","Rural","City","City","City","River","River"],["positive","positive","negative","positive","positive","negative","positive","positive","negative","positive","negative","negative","positive","positive"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":14,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,14,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="probabilistic-matching" class="section level3 unnumbered">
<h3>Probabilistic matching<a class="anchor" aria-label="anchor" href="#probabilistic-matching"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>fastLink()</code> function from the <strong>fastLink</strong> package can be used to apply a matching algorithm. Here is the basic informaton. You can read more detail by entering <code>?fastLink</code> in your console.</p>
<ul>
<li>Define the two dataframes for comparison to arguments <code>dfA =</code> and <code>dfB =</code><br>
</li>
<li>In <code>varnames =</code> give all column names to be used for matching. They must all exist in both <code>dfA</code> and <code>dfB</code>.<br>
</li>
<li>In <code>stringdist.match =</code> give columns from those in <code>varnames</code> to be evaluated on string “distance”.<br>
</li>
<li>In <code>numeric.match =</code> give columns from those in <code>varnames</code> to be evaluated on numeric distance.<br>
</li>
<li>Missing values are ignored<br>
</li>
<li>By default, each row in either dataframe is matched to at most one row in the other dataframe. If you want to see all the evaluated matches, set <code>dedupe.matches = FALSE</code>. The deduplication is done using Winkler’s linear assignment solution.</li>
</ul>
<p><em>Tip: split one date column into three separate numeric columns using <code>day()</code>, <code>month()</code>, and <code>year()</code> from <strong>lubridate</strong> package</em></p>
<p>The default threshold for matches is 0.94 (<code>threshold.match =</code>) but you can adjust it higher or lower. If you define the threshold, consider that higher thresholds could yield more false-negatives (rows that do not match which actually should match) and likewise a lower threshold could yield more false-positive matches.</p>
<p>Below, the data are matched on string distance across the name and district columns, and on numeric distance for year, month, and day of birth. A match threshold of 95% probability is set.</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl_output</span> <span class="op">&lt;-</span> <span class="fu">fastLink</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fastLink/man/fastLink.html">fastLink</a></span><span class="op">(</span>
  dfA <span class="op">=</span> <span class="va">cases</span>,
  dfB <span class="op">=</span> <span class="va">results</span>,
  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span><span class="op">)</span>,
  stringdist.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"district"</span><span class="op">)</span>,
  numeric.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span><span class="op">)</span>,
  threshold.match <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Deduping the estimated matches.
## Getting the match patterns for each estimated match.</code></pre>
<p><strong>Review matches</strong></p>
<p>We defined the object returned from <code>fastLink()</code> as <code>fl_output</code>. It is of class <code>list</code>, and it actually contains several dataframes within it, detailing the results of the matching. One of these dataframes is <code>matches</code>, which contains the most likely matches across <code>cases</code> and <code>results</code>. You can access this “matches” dataframe with <code>fl_output$matches</code>. Below, it is saved as <code>my_matches</code> for ease of accessing later.</p>
<p>When <code>my_matches</code> is printed, you see two column vectors: the pairs of row numbers/indices (also called “rownames”) in <code>cases</code> (“inds.a”) and in <code>results</code> (“inds.b”) representing the best matches. If a row number from a datafrane is missing, then no match was found in the other at the specified match threshold.</p>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print matches</span>
<span class="va">my_matches</span> <span class="op">&lt;-</span> <span class="va">fl_output</span><span class="op">$</span><span class="va">matches</span>
<span class="va">my_matches</span></code></pre></div>
<pre><code>##   inds.a inds.b
## 1      1      1
## 2      2      2
## 3      3      3
## 4      4      4
## 5      8      8
## 6      7      9
## 7      6     10
## 8      5     12</code></pre>
<p>Things to note:</p>
<ul>
<li>Matches occurred despite slight differences in name spelling and dates of birth:
<ul>
<li>“Tony” matched to “Anthony”<br>
</li>
<li>“Maria” matched to “Marialisa”<br>
</li>
<li>“Betty” matched to “Elizabeth”<br>
</li>
<li>“Olivier Laurent De Bordeaux” matched to “Oliver Laurent De Bordow” (missing date of birth ignored)<br>
</li>
</ul>
</li>
<li>One row from <code>cases</code> (for “Blessing Adebayo”, row 9) had no good match in <code>results</code>, so it is not present in <code>my_matches</code>.</li>
</ul>
<p><strong>Join based on the probabilistic matches</strong></p>
<p>To use these matches to join <code>results</code> to <code>cases</code>, one strategy is:</p>
<ol style="list-style-type: decimal">
<li>Use <code>left_join()</code> to join <code>my_matches</code> to <code>cases</code> (matching rownames in <code>cases</code> to “inds.a” in <code>my_matches</code>)<br>
</li>
<li>Then use another <code>left_join()</code> to join <code>results</code> to <code>cases</code> (matching the newly-acquired “inds.b” in <code>cases</code> to rownames in <code>results</code>)</li>
</ol>
<p>Before the joins, we should clean the three datasets:</p>
<ul>
<li>Both <code>dfA</code> and <code>dfB</code> should have their row numbers (“rowname”) converted to a proper column<br>
</li>
<li>Both the columns in <code>my_matches</code> are converted to class character, so they can be joined to the character rownames</li>
</ul>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Clean data prior to joining</span>
<span class="co">#############################</span>

<span class="co"># convert cases rownames to a column </span>
<span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span>

<span class="co"># convert test_results rownames to a column</span>
<span class="va">results_clean</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span>  

<span class="co"># convert all columns in matches dataset to character, so they can be joined to the rownames</span>
<span class="va">matches_clean</span> <span class="op">&lt;-</span> <span class="va">my_matches</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span>



<span class="co"># Join matches to dfA, then add dfB</span>
<span class="co">###################################</span>
<span class="co"># column "inds.b" is added to dfA</span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">cases_clean</span>, <span class="va">matches_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rowname"</span> <span class="op">=</span> <span class="st">"inds.a"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># column(s) from dfB are added </span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">complete</span>, <span class="va">results_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inds.b"</span> <span class="op">=</span> <span class="st">"rowname"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As performed using the code above, the resulting dataframe <code>complete</code> will contain <em>all</em> columns from both <code>cases</code> and <code>results</code>. Many will be appended with suffixes “.x” and “.y”, because the column names would otherwise be duplicated.</p>
<div id="htmlwidget-2ce5315aaed068add2cd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2ce5315aaed068add2cd">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["M","M","F","F",null,"F","M","M",null],["Amir","Tony","Maria","Betty","Jose","Cassidy","Mike","Olivier",null],[null,"B","Contreras","Castel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodriguez","Chase","Lopez","Davis","O'Callaghan","De Bordeaux",null],[1989,1970,1972,1954,1995,1980,1969,null,null],[11,9,4,3,1,7,4,null,null],[22,19,15,30,6,2,12,null,null],["River","River","Cty","City","City","City","Rural","River",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender.x<\/th>\n      <th>first.x<\/th>\n      <th>middle.x<\/th>\n      <th>last.x<\/th>\n      <th>yr.x<\/th>\n      <th>mon.x<\/th>\n      <th>day.x<\/th>\n      <th>district.x<\/th>\n      <th>inds.b<\/th>\n      <th>gender.y<\/th>\n      <th>first.y<\/th>\n      <th>middle.y<\/th>\n      <th>last.y<\/th>\n      <th>yr.y<\/th>\n      <th>mon.y<\/th>\n      <th>day.y<\/th>\n      <th>district.y<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,14,15,16]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Alternatively, to achieve only the “original” 9 records in <code>cases</code> with the new column(s) from <code>results</code>, use <code>select()</code> on <code>results</code> before the joins, so that it contains only rownames and the columns that you want to add to <code>cases</code> (e.g. the column <code>result</code>).</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span>

<span class="va">results_clean</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span>
  <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">rowname</span>, <span class="va">result</span><span class="op">)</span>    <span class="co"># select only certain columns </span>

<span class="va">matches_clean</span> <span class="op">&lt;-</span> <span class="va">my_matches</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span>

<span class="co"># joins</span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">cases_clean</span>, <span class="va">matches_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rowname"</span> <span class="op">=</span> <span class="st">"inds.a"</span><span class="op">)</span><span class="op">)</span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">complete</span>, <span class="va">results_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inds.b"</span> <span class="op">=</span> <span class="st">"rowname"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-534a20f2c77cac6273fc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-534a20f2c77cac6273fc">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>inds.b<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>If you want to subset either dataset to only the rows that matched, you can use the codes below:</p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_matched</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="va">my_matches</span><span class="op">$</span><span class="va">inds.a</span>,<span class="op">]</span>  <span class="co"># Rows in cases that matched to a row in results</span>
<span class="va">results_matched</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">my_matches</span><span class="op">$</span><span class="va">inds.b</span>,<span class="op">]</span>  <span class="co"># Rows in results that matched to a row in cases</span></code></pre></div>
<p>Or, to see only the rows that did <strong>not</strong> match:</p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_not_matched</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">my_matches</span><span class="op">$</span><span class="va">inds.a</span>,<span class="op">]</span>  <span class="co"># Rows in cases that did NOT match to a row in results</span>
<span class="va">results_not_matched</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">my_matches</span><span class="op">$</span><span class="va">inds.b</span>,<span class="op">]</span>  <span class="co"># Rows in results that did NOT match to a row in cases</span></code></pre></div>
</div>
<div id="probabilistic-deduplication" class="section level3 unnumbered">
<h3>Probabilistic deduplication<a class="anchor" aria-label="anchor" href="#probabilistic-deduplication"><i class="fas fa-link"></i></a>
</h3>
<p>Probabilistic matching can be used to deduplicate a dataset as well. See the page on deduplication for other methods of deduplication.</p>
<p>Here we began with the <code>cases</code> dataset, but are now calling it <code>cases_dup</code>, as it has 2 additional rows that could be duplicates of previous rows:
See “Tony” with “Anthony”, and “Marialisa Rodrigues” with “Maria Rodriguez”.</p>
<div id="htmlwidget-287fd4e502c2e176ce02" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-287fd4e502c2e176ce02">{"x":{"filter":"none","data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Run <code>fastLink()</code> like before, but compare the <code>cases_dup</code> dataframe to itself. When the two dataframes provided are identical, the function assumes you want to de-duplicate. Note we do not specify <code>stringdist.match =</code> or <code>numeric.match =</code> as we did previously.</p>
<div class="sourceCode" id="cb556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Run fastLink on the same dataset</span>
<span class="va">dedupe_output</span> <span class="op">&lt;-</span> <span class="fu">fastLink</span><span class="op">(</span>
  dfA <span class="op">=</span> <span class="va">cases_dup</span>,
  dfB <span class="op">=</span> <span class="va">cases_dup</span>,
  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## dfA and dfB are identical, assuming deduplication of a single data set.
## Setting return.all to FALSE.
## 
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Calculating the posterior for each pair of matched observations.
## Getting the match patterns for each estimated match.</code></pre>
<p>Now, you can review the potential duplicates with <code>getMatches()</code>. Provide the dataframe as both <code>dfA =</code> and <code>dfB =</code>, and provide the output of the <code>fastLink()</code> function as <code>fl.out =</code>. <code>fl.out</code> must be of class <code>fastLink.dedupe</code>, or in other words, the result of <code>fastLink()</code>.</p>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Run getMatches()</span>
<span class="va">cases_dedupe</span> <span class="op">&lt;-</span> <span class="fu">getMatches</span><span class="op">(</span>
  dfA <span class="op">=</span> <span class="va">cases_dup</span>,
  dfB <span class="op">=</span> <span class="va">cases_dup</span>,
  fl.out <span class="op">=</span> <span class="va">dedupe_output</span><span class="op">)</span></code></pre></div>
<p>See the right-most column, which indicates the duplicate IDs - the final two rows are identified as being likely duplicates of rows 2 and 3.</p>
<div id="htmlwidget-e24d38a24fd5e74c26bc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e24d38a24fd5e74c26bc">{"x":{"filter":"none","data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"],[1,2,3,4,5,6,7,8,9,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>dedupe.ids<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>To return the row numbers of rows which are likely duplicates, you can count the number of rows per unique value in the <code>dedupe.ids</code> column, and then filter to keep only those with more than one row. In this case this leaves rows 2 and 3.</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_dedupe</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">dedupe.ids</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>##   dedupe.ids n
## 1          2 2
## 2          3 2</code></pre>
<p>To inspect the whole rows of the likely duplicates, put the row number in this command:</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># displays row 2 and all likely duplicates of it</span>
<span class="va">cases_dedupe</span><span class="op">[</span><span class="va">cases_dedupe</span><span class="op">$</span><span class="va">dedupe.ids</span> <span class="op">==</span> <span class="fl">2</span>,<span class="op">]</span>   </code></pre></div>
<pre><code>##    gender   first middle  last   yr mon day district dedupe.ids
## 2       M Anthony     B. Smith 1970   9  19    River          2
## 10      M    Tony     B. Smith 1970   9  19    River          2</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-6" class="section level2" number="13.5">
<h2>
<span class="header-section-number">13.5</span> Resources<a class="anchor" aria-label="anchor" href="#resources-6"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://dplyr.tidyverse.org/reference/join.html">dplyr page on joins</a></p>
<p>Th <a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr page</a> on binding</p>
<p>See this vignette on <a href="https://github.com/kosukeimai/fastLink">fastLink</a> at the package’s Github page</p>
<p>Publication describing methodology of <a href="https://imai.fas.harvard.edu/research/files/linkage.pdf">fastLink</a></p>
<p>Publication describing <a href="https://journal.r-project.org/archive/2010/RJ-2010-017/RJ-2010-017.pdf">RecordLinkage package</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="grouping-data.html"><span class="header-section-number">12</span> Grouping data</a></div>
<div class="next"><a href="characters-and-strings.html"><span class="header-section-number">14</span> Characters and strings</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#joining-data"><span class="header-section-number">13</span> Joining data</a></li>
<li>
<a class="nav-link" href="#preparation-4"><span class="header-section-number">13.1</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-packages-5">Load packages</a></li>
<li><a class="nav-link" href="#import-data-5">Import data</a></li>
<li><a class="nav-link" href="#datasets"><span class="header-section-number">13.1.1</span> Datasets</a></li>
<li><a class="nav-link" href="#pre-cleaning">Pre-cleaning</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dplyr-joins"><span class="header-section-number">13.2</span> dplyr joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#general-syntax">General syntax</a></li>
<li><a class="nav-link" href="#add-columns-left-right-joins">Add columns: left &amp; right joins</a></li>
<li><a class="nav-link" href="#full-join">Full join</a></li>
<li><a class="nav-link" href="#inner-join">Inner join</a></li>
<li><a class="nav-link" href="#semi-join">Semi join</a></li>
<li><a class="nav-link" href="#anti-join">Anti join</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#binding-and-aligning"><span class="header-section-number">13.3</span> Binding and aligning</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#bind-rows">Bind rows</a></li>
<li><a class="nav-link" href="#bind-columns">Bind columns</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#probabalistic-matching"><span class="header-section-number">13.4</span> Probabalistic matching</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#probabilistic-matching">Probabilistic matching</a></li>
<li><a class="nav-link" href="#probabilistic-deduplication">Probabilistic deduplication</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-6"><span class="header-section-number">13.5</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-04-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
