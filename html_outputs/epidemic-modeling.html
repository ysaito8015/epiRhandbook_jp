<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>24 Epidemic modeling | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="epidemic-modeling" class="section level1" number="24">
<h1><span class="header-section-number">24</span> Epidemic modeling</h1>
<!-- ======================================================= -->
<div id="overview-3" class="section level2" number="24.1">
<h2><span class="header-section-number">24.1</span> Overview</h2>
<p>There exists a growing body of tools for epidemic modelling that lets us conduct
fairly complex analyses with minimal effort. This section will provide an
overview on how to use these tools to:</p>
<ul>
<li>estimate the effective reproduction number R<sub>t</sub> and related statistics
such as the doubling time</li>
<li>produce short-term projections of future incidence</li>
</ul>
<p>It is <em>not</em> intended as an overview of the methodologies and statistical methods
underlying these tools, so please refer to the Resources tab for links to some
papers covering this. Make sure you have an understanding of
the methods before using these tools; this will ensure you can accurately
interpret their results.</p>
<p>Below is an example of one of the outputs we’ll be producing in this section.</p>
<!-- ======================================================= -->
</div>
<div id="preparation-15" class="section level2" number="24.2">
<h2><span class="header-section-number">24.2</span> Preparation</h2>
<p>We will use two different methods and packages for R<sub>t</sub> estimation,
namely <strong>EpiNow</strong> and <strong>EpiEstim</strong>, as well as the <strong>projections</strong> package for
forecasting case incidence.</p>
<p>This code chunk shows the loading of packages required for the analyses.
In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use.
You can also load installed packages with <code>library()</code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<p>We will use the cleaned case linelist for all analyses in this section. If you want to follow along, <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>click to download the “clean” linelist</a> (as .rds file). See the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page to download all example data used in this handbook.</p>
<!-- ======================================================= -->
</div>
<div id="estimating-rt" class="section level2" number="24.3">
<h2><span class="header-section-number">24.3</span> Estimating R<sub>t</sub></h2>
<div id="epinow2-vs.-epiestim" class="section level3 unnumbered">
<h3>EpiNow2 vs. EpiEstim</h3>
<p>The reproduction number R is a measure of the transmissibility of a disease and
is defined as the expected number of secondary cases per infected case. In a
fully susceptible population, this value represents the basic reproduction
number R<sub>0</sub>. However, as the number of susceptible individuals in a
population changes over the course of an outbreak or pandemic, and as various
response measures are implemented, the most commonly used measure of
transmissibility is the effective reproduction number R<sub>t</sub>; this is
defined as the expected number of secondary cases per infected case at a given
time <em>t</em>.</p>
<p>The <strong>EpiNow2</strong> package provides the most sophisticated framework for estimating
R<sub>t</sub>. It has two key advantages over the other commonly used package,
<strong>EpiEstim</strong>:</p>
<ul>
<li>It accounts for delays in reporting and can therefore estimate R<sub>t</sub>
even when recent data is incomplete.</li>
<li>It estimates R<sub>t</sub> on <em>dates of infection</em> rather than the dates of
onset of reporting, which means that the effect of an intervention will
be immediately reflected in a change in R<sub>t</sub>, rather than with a
delay.</li>
</ul>
<p>However, it also has two key disadvantages:</p>
<ul>
<li>It requires knowledge of the generation time distribution (i.e. distribution
of delays between infection of a primary and secondary cases), incubation
period distribution (i.e. distribution of delays between infection and symptom
onset) and any further delay distribution relevant to your data (e.g. if you
have dates of reporting, you require the distribution of delays from symptom
onset to reporting). While this will allow more accurate estimation of
R<sub>t</sub>, <strong>EpiEstim</strong> only requires the serial interval distribution
(i.e. the distribution of delays between symptom onset of a primary and a
secondary case), which may be the only distribution available to you.</li>
<li><strong>EpiNow2</strong> is significantly slower than <strong>EpiEstim</strong>, anecdotally by a factor
of about 100-1000! For example, estimating R<sub>t</sub> for the sample outbreak
considered in this section takes about four hours (this was run for a large
number of iterations to ensure high accuracy and could probably be reduced if
necessary, however the points stands that the algorithm is slow in
general). This may be unfeasible if you are regularly updating your
R<sub>t</sub> estimates.</li>
</ul>
<p>Which package you choose to use will therefore depend on the data, time and
computational resources available to you.</p>
</div>
<div id="epinow2" class="section level3 unnumbered">
<h3>EpiNow2</h3>
<div id="estimating-delay-distributions" class="section level4 unnumbered">
<h4>Estimating delay distributions</h4>
<p>The delay distributions required to run <strong>EpiNow2</strong> depend on the data you
have. Essentially, you need to be able to describe the delay from the date of
infection to the date of the event you want to use to estimate R<sub>t</sub>. If
you are using dates of onset, this would simply be the incubation period
distribution. If you are using dates of reporting, you require the
delay from infection to reporting. As this distribution is unlikely to be known
directly, <strong>EpiNow2</strong> lets you chain multiple delay distributions together; in
this case, the delay from infection to symptom onset (e.g. the incubation
period, which is likely known) and from symptom onset to reporting (which you
can often estimate from the data).</p>
<p>As we have the dates of onset for all our cases in the example linelist, we will
only require the incubation period distribution to link our data (e.g. dates of
symptom onset) to the date of infection. We can either estimate this distribution
from the data or use values from the literature.</p>
<p>A literature estimate of the incubation period of Ebola (taken
from <a href="https://www.nejm.org/doi/full/10.1056/nejmoa1411100">this paper</a>) with a
mean of 9.1, standard deviation of 7.3 and maximum value of 30 would be
specified as follows:</p>
<p>Note that <strong>EpiNow2</strong> requires these delay distributions to be provided on a <strong>log</strong>
scale, hence the <code>log</code> call around each value (except the <code>max</code> parameter which,
confusingly, has to be provided on a natural scale). The <code>mean_sd</code> and <code>sd_sd</code>
define the standard deviation of the mean and standard deviation estimates. As
these are not known in this case, we choose the fairly arbitrary value of 0.1.</p>
<p>In this analysis, we instead estimate the incubation period distribution
from the linelist itself using the function <code>bootstrapped_dist_fit</code>, which will
fit a lognormal distribution to the observed delays between infection and onset
in the linelist.</p>
<p>The other distribution we require is the generation time. As we have data on
infection times <strong>and</strong> transmission links, we can estimate this
distribution from the linelist by calculating the delay between infection times
of infector-infectee pairs. To do this, we use the handy <code>get_pairwise</code> function
from the package <strong>epicontacts</strong>, which allows us to calculate pairwise
differences of linelist properties between transmission pairs. We first create an
epicontacts object (see <a href="transmission-chains.html#transmission-chains">Transmission chains</a> page for further
details):</p>
<p>We then fit the difference in infection times between transmission pairs,
calculated using <code>get_pairwise</code>, to a gamma distribution:</p>
</div>
<div id="running-epinow2" class="section level4 unnumbered">
<h4>Running <strong>EpiNow2</strong></h4>
<p>Now we just need to calculate daily incidence from the linelist, which we can do
easily with the <strong>dplyr</strong> functions <code>group_by()</code> and <code>n()</code>. Note
that <strong>EpiNow2</strong> requires the column names to be <code>date</code> and <code>confirm</code>.</p>
<p>We can then estimate R<sub>t</sub> using the <code>epinow</code> function. Some notes on
the inputs:</p>
<ul>
<li>We can provide any number of ‘chained’ delay distributions to the <code>delays</code>
argument; we would simply insert them alongside the <code>incubation_period</code> object
within the <code>delay_opts</code> function.</li>
<li><code>return_output</code> ensures the output is returned within R and not just saved to
a file.</li>
<li><code>verbose</code> specifies that we want a readout of the progress.</li>
<li><code>horizon</code> indicates how many days we want to project future incidence for.</li>
<li>We pass additional options to the <code>stan</code> argument to specify how long
we want to run the inference for. Increasing <code>samples</code> and <code>chains</code> will give
you a more accurate estimate that better characterises uncertainty, however
will take longer to run.</li>
</ul>
</div>
<div id="analysing-outputs" class="section level4 unnumbered">
<h4>Analysing outputs</h4>
<p>Once the code has finished running, we can plot a summary very easily as follows. Scroll the image to see the full extent.</p>
<p>We can also look at various summary statistics:</p>
<p>For further analyses and custom plotting, you can access the summarised daily
estimates via <code>$estimates$summarised</code>. We will convert this from the default
<code>data.table</code> to a <code>tibble</code> for ease of use with <strong>dplyr</strong>.</p>
<p>As an example, let’s make a plot of the doubling time and R<sub>t</sub>. We will
only look at the first few months of the outbreak when R<sub>t</sub> is well
above one, to avoid plotting extremely high doublings times.</p>
<p>We use the formula <code>log(2)/growth_rate</code> to calculate the doubling time from the
estimated growth rate.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="epiestim" class="section level3 unnumbered">
<h3>EpiEstim</h3>
<p>To run <strong>EpiEstim</strong>, we need to provide data on daily incidence and specify the
serial interval (i.e. the distribution of delays between symptom onset of
primary and secondary cases).</p>
<p>Incidence data can be provided to <strong>EpiEstim</strong> as a vector, a data frame, or an <code>incidence</code>
object from the original <strong>incidence</strong> package. You can even distinguish between imports
and locally acquired infections; see the documentation at <code>?estimate_R</code> for
further details.</p>
<p>We will create the input using <strong>incidence2</strong>. See the page on <a href="epidemic-curves.html#epidemic-curves">Epidemic curves</a> for more examples with the <strong>incidence2</strong> package. Since there have been updates to the <strong>incidence2</strong> package that don’t completely align with <code>estimateR()</code>’s expected input, there are some minor additional steps needed. The incidence object consists of a tibble with dates and their respective case counts. We use <code>complete()</code> from <strong>tidyr</strong> to ensure all dates are included (even those with no cases), and then <code>rename()</code> the columns to align with what is expected by <code>estimate_R()</code> in a later step.</p>
<p>The package provides several options for specifying the serial interval, the
details of which are provided in the documentation at <code>?estimate_R</code>. We will
cover two of them here.</p>
<div id="using-serial-interval-estimates-from-the-literature" class="section level4 unnumbered">
<h4>Using serial interval estimates from the literature</h4>
<p>Using the option <code>method = "parametric_si"</code>, we can manually specify the mean and
standard deviation of the serial interval in a <code>config</code> object created using the
function <code>make_config</code>. We use a mean and standard deviation of 12.0 and 5.2, respectively, defined in
<a href="https://bmcmedicine.biomedcentral.com/articles/10.1186/s12916-014-0196-0">this paper</a>:</p>
<p>We can then estimate R<sub>t</sub> with the <code>estimate_R</code> function:</p>
<p>and plot a summary of the outputs:</p>
</div>
<div id="using-serial-interval-estimates-from-the-data" class="section level4 unnumbered">
<h4>Using serial interval estimates from the data</h4>
<p>As we have data on dates of symptom onset <em>and</em> transmission links, we can
also estimate the serial interval from the linelist by calculating the delay
between onset dates of infector-infectee pairs. As we did in the <strong>EpiNow2</strong>
section, we will use the <code>get_pairwise</code> function from the <strong>epicontacts</strong>
package, which allows us to calculate pairwise differences of linelist
properties between transmission pairs. We first create an epicontacts object
(see <a href="transmission-chains.html#transmission-chains">Transmission chains</a> page for further details):</p>
<p>We then fit the difference in onset dates between transmission pairs, calculated
using <code>get_pairwise</code>, to a gamma distribution. We use the handy <code>fit_disc_gamma</code>
from the <strong>epitrix</strong> package for this fitting procedure, as we require a
<em>discretised</em> distribution.</p>
<p>We then pass this information to the <code>config</code> object, run <strong>EpiEstim</strong>
again and plot the results:</p>
</div>
<div id="specifying-estimation-time-windows" class="section level4 unnumbered">
<h4>Specifying estimation time windows</h4>
<p>These default options will provide a weekly sliding estimate and might act as a
warning that you are estimating R<sub>t</sub> too early in the outbreak for a
precise estimate. You can change this by setting a later start date for the
estimation as shown below. Unfortunately, <strong>EpiEstim</strong> only provides a very
clunky way of specifying these estimations times, in that you have to provide a
vector of <strong>integers</strong> referring to the start and end dates for each time
window.</p>
<p>Now we re-run <strong>EpiEstim</strong> and can see that the estimates only start from June:</p>
</div>
<div id="analysing-outputs-1" class="section level4 unnumbered">
<h4>Analysing outputs</h4>
<p>The main outputs can be accessed via <code>$R</code>. As an example, we will create a plot of
R<sub>t</sub> and a measure of “transmission potential” given by the product of
R<sub>t</sub> and the number of cases reported on that day; this represents the
expected number of cases in the next generation of infection.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="projecting-incidence" class="section level2" number="24.4">
<h2><span class="header-section-number">24.4</span> Projecting incidence</h2>
<div id="epinow2-1" class="section level3 unnumbered">
<h3>EpiNow2</h3>
<p>Besides estimating R<sub>t</sub>, <strong>EpiNow2</strong> also supports forecasting of
R<sub>t</sub> and projections of case numbers by integration with the
<strong>EpiSoon</strong> package under the hood. All you need to do is specify the <code>horizon</code>
argument in your <code>epinow</code> function call, indicating how many days you want to
project into the future; see the <strong>EpiNow2</strong> section under the “Estimating
R<sub>t</sub>” for details on how to get <strong>EpiNow2</strong> up and running. In this
section, we will just plot the outputs from that analysis, stored in the
<code>epinow_res</code> object.</p>
</div>
<div id="projections" class="section level3 unnumbered">
<h3>projections</h3>
<p>The <strong>projections</strong> package developed by RECON makes it very easy to make short
term incidence forecasts, requiring only knowledge of the effective reproduction
number R<sub>t</sub> and the serial interval. Here we will cover how to use
serial interval estimates from the literature and how to use our own estimates
from the linelist.</p>
<div id="using-serial-interval-estimates-from-the-literature-1" class="section level4 unnumbered">
<h4>Using serial interval estimates from the literature</h4>
<p><strong>projections</strong> requires a discretised serial interval distribution of the class
<code>distcrete</code> from the package <strong>distcrete</strong>. We will use a gamma distribution
with a mean of 12.0 and and standard deviation of 5.2 defined in
<a href="https://bmcmedicine.biomedcentral.com/articles/10.1186/s12916-014-0196-0">this paper</a>. To
convert these values into the shape and scale parameters required for a gamma
distribution, we will use the function <code>gamma_mucv2shapescale</code> from the
<strong>epitrix</strong> package.</p>
<p>Here is a quick check to make sure the serial interval looks correct. We
access the density of the gamma distribution we have just defined by <code>$d</code>, which
is equivalent to calling <code>dgamma</code>:</p>
</div>
<div id="using-serial-interval-estimates-from-the-data-1" class="section level4 unnumbered">
<h4>Using serial interval estimates from the data</h4>
<p>As we have data on dates of symptom onset <em>and</em> transmission links, we can
also estimate the serial interval from the linelist by calculating the delay
between onset dates of infector-infectee pairs. As we did in the <strong>EpiNow2</strong>
section, we will use the <code>get_pairwise</code> function from the <strong>epicontacts</strong>
package, which allows us to calculate pairwise differences of linelist
properties between transmission pairs. We first create an epicontacts object
(see <a href="transmission-chains.html#transmission-chains">Transmission chains</a> page for further details):</p>
<p>We then fit the difference in onset dates between transmission pairs, calculated
using <code>get_pairwise</code>, to a gamma distribution. We use the handy <code>fit_disc_gamma</code>
from the <strong>epitrix</strong> package for this fitting procedure, as we require a
<em>discretised</em> distribution.</p>
</div>
<div id="projecting-incidence-1" class="section level4 unnumbered">
<h4>Projecting incidence</h4>
<p>To project future incidence, we still need to provide historical incidence in
the form of an <code>incidence</code> object, as well as a sample of plausible
R<sub>t</sub> values. We will generate these values using the R<sub>t</sub>
estimates generated by <strong>EpiEstim</strong> in the previous section (under “Estimating
R<sub>t</sub>”) and stored in the <code>epiestim_res_emp</code> object. In the code below,
we extract the mean and standard deviation estimates of R<sub>t</sub> for the
last time window of the outbreak (using the <code>tail</code> function to access the last
element in a vector), and simulate 1000 values from a gamma distribution using
<code>rgamma</code>. You can also provide your own vector of R<sub>t</sub> values that you
want to use for forward projections.</p>
<p>We then use the <code>project()</code> function to make the actual forecast. We specify how
many days we want to project for via the <code>n_days</code> arguments, and specify the
number of simulations using the <code>n_sim</code> argument.</p>
<p>We can then handily plot the incidence and projections using the <code>plot()</code> and
<code>add_projections()</code> functions. We can easily subset the <code>incidence</code> object to only
show the most recent cases by using the square bracket operator.</p>
<p>You can also easily extract the raw estimates of daily case numbers by
converting the output to a dataframe.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="resources-17" class="section level2" number="24.5">
<h2><span class="header-section-number">24.5</span> Resources</h2>
<ul>
<li><a href="https://www.sciencedirect.com/science/article/pii/S1755436519300350">Here is the paper</a> describing
the methodology implemented in <strong>EpiEstim</strong>.</li>
<li><a href="https://wellcomeopenresearch.org/articles/5-112/v1">Here is the paper</a> describing
the methodology implemented in <strong>EpiNow2</strong>.</li>
<li><a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008409">Here is a paper</a> describing
various methodological and practical considerations for estimating R<sub>t</sub>.</li>
</ul>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-05-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
