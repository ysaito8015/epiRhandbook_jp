<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>37 Transmission chains | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="transmission-chains" class="section level1" number="37">
<h1><span class="header-section-number">37</span> Transmission chains</h1>
<!-- ======================================================= -->
<div id="overview-7" class="section level2" number="37.1">
<h2><span class="header-section-number">37.1</span> Overview</h2>
<p>The primary tool to handle, analyse and visualise transmission chains and contact
tracing data is the package <strong>epicontacts</strong>, developed by the folks at
RECON. Try out the interactive plot below by hovering over the nodes for more
information, dragging them to move them and clicking on them to highlight downstream cases.</p>
<!-- ======================================================= -->
</div>
<div id="preparation-30" class="section level2" number="37.2">
<h2><span class="header-section-number">37.2</span> Preparation</h2>
<div id="load-packages-27" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>First load the standard packages required for data import and manipulation. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load packages with <code>library()</code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<p>You will require the development version of <strong>epicontacts</strong>, which can be
installed from github using the <code>p_install_github()</code> function from <strong>pacman</strong>. You only need to run this command
below once, not every time you use the package (thereafter, you can use <code>p_load()</code> as usual).</p>
</div>
<div id="import-data-23" class="section level3 unnumbered">
<h3>Import data</h3>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page. The dataset is imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data.</p>
<p>The first 50 rows of the linelist are displayed below. Of particular interest are the columns <code>case_id</code>, <code>generation</code>, <code>infector</code>, and <code>source</code>.</p>
</div>
<div id="creating-an-epicontacts-object" class="section level3 unnumbered">
<h3>Creating an epicontacts object</h3>
<p>We then need to create an <strong>epicontacts</strong> object, which requires two types of
data:</p>
<ul>
<li>a linelist documenting cases where columns are variables and rows correspond to unique cases</li>
<li>a list of edges defining links between cases on the basis of their unique IDs (these can be contacts,
transmission events, etc.)</li>
</ul>
<p>As we already have a linelist, we just need to create a list of edges between
cases, more specifically between their IDs. We can extract transmission links from the
linelist by linking the <code>infector</code> column with the <code>case_id</code> column. At this point we can also add “edge
properties”, by which we mean any variable describing the link between the two
cases, not the cases themselves. For illustration, we will add a <code>location</code>
variable describing the location of the transmission event, and a duration
variable describing the duration of the contact in days.</p>
<p>In the code below, the <strong>dplyr</strong> function <code>transmute</code> is similar to <code>mutate</code>, except it only keeps
the columns we have specified within the function. The <code>drop_na</code> function will
filter out any rows where the specified columns have an <code>NA</code> value; in this
case, we only want to keep the rows where the infector is known.</p>
<p>We can now create the <strong>epicontacts</strong> object using the <code>make_epicontacts</code>
function. We need to specify which column in the linelist points to the unique case
identifier, as well as which columns in the contacts point to the unique
identifiers of the cases involved in each link. These links are directional in
that infection is going <em>from</em> the infector <em>to</em> the case, so we need to specify
the <code>from</code> and <code>to</code> arguments accordingly. We therefore also set the <code>directed</code>
argument to <code>TRUE</code>, which will affect future operations.</p>
<p>Upon examining the <strong>epicontacts</strong> objects, we can see that the <code>case_id</code> column
in the linelist has been renamed to <code>id</code> and the <code>case_id</code> and <code>infector</code>
columns in the contacts have been renamed to <code>from</code> and <code>to</code>. This ensures
consistency in subsequent handling, visualisation and analysis operations.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="handling" class="section level2" number="37.3">
<h2><span class="header-section-number">37.3</span> Handling</h2>
<div id="subsetting" class="section level3 unnumbered">
<h3>Subsetting</h3>
<p>The <code>subset()</code> method for <code>epicontacts</code> objects allows for, among other things,
filtering of networks based on properties of the linelist (“node attributes”) and the contacts
database (“edge attributes”). These values must be passed as named lists to the
respective argument. For example, in the code below we are keeping only the
male cases in the linelist that have an infection date between April and
July 2014 (dates are specified as ranges), and transmission links that occured
in the hospital.</p>
<p>We can use the <code>thin</code> function to either filter the linelist to include cases
that are found in the contacts by setting the argument <code>what = "linelist"</code>, or
filter the contacts to include cases that are found in the linelist by setting
the argument <code>what = "contacts"</code>. In the code below, we are further filtering the
epicontacts object to keep only the transmission links involving the male cases
infected between April and July which we had filtered for above. We can see that
only two known transmission links fit that specification.</p>
<p>In addition to subsetting by node and edge attributes, networks can be pruned to
only include components that are connected to certain nodes. The <code>cluster_id</code>
argument takes a vector of case IDs and returns the linelist of individuals that
are linked, directly or indirectly, to those IDs. In the code below, we can see
that a total of 13 linelist cases are involved in the clusters containing
<code>2ae019</code> and <code>71577a</code>.</p>
<p>The <code>subset()</code> method for <code>epicontacts</code> objects also allows filtering by cluster
size using the <code>cs</code>, <code>cs_min</code> and <code>cs_max</code> arguments. In the code below, we are
keeping only the cases linked to clusters of 10 cases or larger, and can see that
271 linelist cases are involved in such clusters.</p>
</div>
<div id="accessing-ids" class="section level3 unnumbered">
<h3>Accessing IDs</h3>
<p>The <code>get_id()</code> function retrieves information on case IDs in the
dataset, and can be parameterized as follows:</p>
<ul>
<li><strong>linelist</strong>: IDs in the line list data</li>
<li><strong>contacts</strong>: IDs in the contact dataset (“from” and “to” combined)</li>
<li><strong>from</strong>: IDs in the “from” column of contact datset</li>
<li><strong>to</strong> IDs in the “to” column of contact dataset</li>
<li><strong>all</strong>: IDs that appear anywhere in either dataset</li>
<li><strong>common</strong>: IDs that appear in both contacts dataset and line list</li>
</ul>
<p>For example, what are the first ten IDs in the contacts dataset?</p>
<p>How many IDs are found in both the linelist and the contacts?</p>
<!-- ======================================================= -->
</div>
</div>
<div id="visualization" class="section level2" number="37.4">
<h2><span class="header-section-number">37.4</span> Visualization</h2>
<div id="basic-plotting" class="section level3 unnumbered">
<h3>Basic plotting</h3>
<p>All visualisations of <strong>epicontacts</strong> objects are handled by the <code>plot</code>
function. We will first filter the <strong>epicontacts</strong> object to include only the
cases with onset dates in June 2014 using the <code>subset</code> function, and only
include the contacts linked to those cases using the <code>thin</code> function.</p>
<p>We can then create the basic, interactive plot very simply as follows:</p>
<p>You can move the nodes around by dragging them, hover over them for more
information and click on them to highlight connected cases.</p>
<p>There are a large number of arguments to further modify this plot. We will cover
the main ones here, but check out the documentation via <code>?vis_epicontacts</code> (the
function called when using <code>plot</code> on an <strong>epicontacts</strong> object) to get a full
description of the function arguments.</p>
<div id="visualising-node-attributes" class="section level4 unnumbered">
<h4>Visualising node attributes</h4>
<p>Node color, node shape and node size can be mapped to a given column in the linelist
using the <code>node_color</code>, <code>node_shape</code> and <code>node_size</code> arguments. This is similar
to the <code>aes</code> syntax you may recognise from <strong>ggplot2</strong>.</p>
<p>The specific colors, shapes and sizes of nodes can be specified as follows:</p>
<ul>
<li><p><strong>Colors</strong> via the <code>col_pal</code> argument, either by providing a name list for manual
specification of each color as done below, or by providing a color palette
function such as <code>colorRampPalette(c("black", "red", "orange"))</code>, which would
provide a gradient of colours between the ones specified.</p></li>
<li><p><strong>Shapes</strong> by passing a named list to the <code>shapes</code> argument, specifying one shape
for each unique element in the linelist column specified by the <code>node_shape</code>
argument. See <code>codeawesome</code> for available shapes.</p></li>
<li><p><strong>Size</strong> by passing a size range of the nodes to the <code>size_range</code> argument.</p></li>
</ul>
<p>Here an example, where color represents the outcome, shape the gender and size
the age:</p>
</div>
<div id="visualising-edge-attributes" class="section level4 unnumbered">
<h4>Visualising edge attributes</h4>
<p>Edge color, width and linetype can be mapped to a given column in the contacts
dataframe using the <code>edge_color</code>, <code>edge_width</code> and <code>edge_linetype</code>
arguments. The specific colors and widths of the edges can be specified as follows:</p>
<ul>
<li><p><strong>Colors</strong> via the <code>edge_col_pal</code> argument, in the same manner used for <code>col_pal</code>.</p></li>
<li><p><strong>Widths</strong> by passing a size range of the nodes to the <code>width_range</code> argument.</p></li>
</ul>
<p>Here an example:</p>
</div>
</div>
<div id="temporal-axis" class="section level3 unnumbered">
<h3>Temporal axis</h3>
<p>We can also visualise the network along a temporal axis by mapping the <code>x_axis</code>
argument to a column in the linelist. In the example below, the x-axis
represents the date of symptom onset. We have also specified the <code>arrow_size</code>
argument to ensure the arrows are not too large, and set <code>label = FALSE</code> to make
the figure less cluttered.</p>
<p>There are a large number of additional arguments to futher specify how this
network is visualised along a temporal axis, which you can check out
via <code>?vis_temporal_interactive</code> (the function called when using <code>plot</code> on
an <strong>epicontacts</strong> object with <code>x_axis</code> specified). We’ll go through some
below.</p>
<div id="specifying-transmission-tree-shape" class="section level4 unnumbered">
<h4>Specifying transmission tree shape</h4>
<p>There are two main shapes that the transmission tree can assume, specified using
the <code>network_shape</code> argument. The first is a <code>branching</code> shape as shown above,
where a straight edge connects any two nodes. This is the most intuitive
representation, however can result in overlapping edges in a densely connected
network. The second shape is <code>rectangle</code>, which produces a tree resembling a
phylogeny. For example:</p>
<p>Each case node can be assigned a unique vertical position by toggling the
<code>position_dodge</code> argument. The position of unconnected cases (i.e. with no
reported contacts) is specified using the <code>unlinked_pos</code> argument.</p>
<p>The position of the parent node relative to the children nodes can be
specified using the <code>parent_pos</code> argument. The default option is to place the
parent node in the middle, however it can be placed at the bottom (<code>parent_pos = 'bottom'</code>) or at the top (<code>parent_pos = 'top'</code>).</p>
</div>
<div id="saving-plots-and-figures" class="section level4 unnumbered">
<h4>Saving plots and figures</h4>
<p>You can save a plot as an interactive, self-contained html file with the
<code>visSave</code> function from the <strong>VisNetwork</strong> package:</p>
<p>Saving these network outputs as an image is unfortunately less easy and requires
you to save the file as an html and then take a screenshot of this file using
the <code>webshot</code> package. In the code below, we are converting the html file saved
above into a PNG:</p>
</div>
</div>
<div id="timelines" class="section level3 unnumbered">
<h3>Timelines</h3>
<p>You can also case timelines to the network, which are represented on the x-axis
of each case. This can be used to visualise case locations, for example, or time
to outcome. To generate a timeline, we need to create a data.frame of at least
three columns indicating the case ID, the start date of the “event” and the end
of date of the “event”. You can also add any number of other columns which can
then be mapped to node and edge properties of the timeline. In the code below,
we generate a timeline going from the date of symptom onset to the date of
outcome, and keep the outcome and hospital variables which we use to define the
node shape and colour. Note that you can have more than one timeline row/event
per case, for example if a case is transferred between multiple hospitals.</p>
<p>We then pass the timeline element to the <code>timeline</code> argument. We can map
timeline attributes to timeline node colours, shapes and sizes in the same way
defined in previous sections, except that we have <em>two</em> nodes: the start and end
node of each timeline, which have seperate arguments. For example,
<code>tl_start_node_color</code> defines which timeline column is mapped to the colour of
the start node, while <code>tl_end_node_shape</code> defines which timeline column is
mapped to the shape of the end node. We can also map colour, width, linetype and
labels to the timeline <em>edge</em> via the <code>tl_edge_*</code> arguments.</p>
<p>See <code>?vis_temporal_interactive</code> (the function called when plotting an
epicontacts object) for detailed documentation on the arguments. Each argument
is annotated in the code below too:</p>
<!-- ======================================================= -->
</div>
</div>
<div id="analysis" class="section level2" number="37.5">
<h2><span class="header-section-number">37.5</span> Analysis</h2>
<div id="summarising" class="section level3 unnumbered">
<h3>Summarising</h3>
<p>We can get an overview of some of the network properties using the
<code>summary</code> function.</p>
<p>For example, we can see that only 57% of contacts have both cases in the
linelist; this means that the we do not have linelist data on a significant
number of cases involved in these transmission chains.</p>
</div>
<div id="pairwise-characteristics" class="section level3 unnumbered">
<h3>Pairwise characteristics</h3>
<p>The <code>get_pairwise()</code> function allows processing of variable(s) in the line list
according to each pair in the contact dataset. For the following example, date
of onset of disease is extracted from the line list in order to compute the
difference between disease date of onset for each pair. The value that is
produced from this comparison represents the <strong>serial interval (si)</strong>.</p>
<p>The <code>get_pairwise()</code> will interpret the class of the column being used for
comparison, and will adjust its method of comparing the values accordingly. For
numbers and dates (like the <strong>si</strong> example above), the function will subtract
the values. When applied to columns that are characters or categorical,
<code>get_pairwise()</code> will paste values together. Because the function also allows
for arbitrary processing (see “f” argument), these discrete combinations can be
easily tabulated and analyzed.</p>
<p>Here, we see a significant association between transmission links and gender.</p>
</div>
<div id="identifying-clusters" class="section level3 unnumbered">
<h3>Identifying clusters</h3>
<p>The <code>get_clusters()</code> function can be used for to identify connected components
in an <code>epicontacts</code> object. First, we use it to retrieve a <code>data.frame</code>
containing the cluster information:</p>
<p>Let us look at the largest clusters. For this, we add cluster information to the
<code>epicontacts</code> object and then subset it to keep only the largest clusters:</p>
</div>
<div id="calculating-degrees" class="section level3 unnumbered">
<h3>Calculating degrees</h3>
<p>The degree of a node corresponds to its number of edges or connections to other
nodes. <code>get_degree()</code> provides an easy method for calculating this value for
<code>epicontacts</code> networks. A high degree in this context indicates an individual
who was in contact with many others. The <code>type</code> argument indicates that we want
to count both the in-degree and out-degree, the <code>only_linelist</code> argument
indicates that we only want to calculate the degree for cases in the linelist.</p>
<p>Which individuals have the ten most contacts?</p>
<p>What is the mean number of contacts?</p>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-30" class="section level2" number="37.6">
<h2><span class="header-section-number">37.6</span> Resources</h2>
<p>The
<a href="https://www.repidemicsconsortium.org/epicontacts/index.html">epicontacts page</a>
provides an overview of the package functions and includes some more in-depth
vignettes.</p>
<p>The <a href="http://github.com/reconhub/epicontacts">github page</a> can be used to raise
issues and request features.</p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-05-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
