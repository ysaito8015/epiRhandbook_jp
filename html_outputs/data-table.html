<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>50 Data Table | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="data-table" class="section level1" number="50">
<h1><span class="header-section-number">50</span> Data Table</h1>
<p>The handbook focusses on the <strong>dplyr</strong> “verb” functions and the <strong>magrittr</strong> pipe operator <code>%&gt;%</code> as a method to clean and group data, but the <strong>data.table</strong> package offers an alternative method that you may encounter in your R career.</p>
<!-- ======================================================= -->
<div id="intro-to-data-tables" class="section level2" number="50.1">
<h2><span class="header-section-number">50.1</span> Intro to data tables</h2>
<p>A data table is a 2-dimensional data structure like a data frame that allows complex grouping operations to be performed. The data.table syntax is structured so that operations can be performed on rows, columns and groups.</p>
<p>The structure is <strong>DT[i, j, by]</strong>, separated by 3 parts; the <strong>i, j</strong> and <strong>by</strong> arguments. The <strong>i</strong> argument allows for subsetting of required rows, the <strong>j</strong> argument allows you to operate on columns and the <strong>by</strong> argument allows you operate on columns by groups.</p>
<p>This page will address the following topics:</p>
<ul>
<li>Importing data and use of <code>fread()</code> and <code>fwrite()</code></li>
<li>Selecting and filtering rows using the <strong>i</strong> argument</li>
<li>Using helper functions <code>%like%</code>, <code>%chin%</code>, <code>%between%</code></li>
<li>Selecting and computing on columns using the <strong>j</strong> argument</li>
<li>Computing by groups using the <strong>by</strong> argument</li>
<li>Adding and updating data to data tables using <code>:=</code></li>
</ul>
<!-- ======================================================= -->
</div>
<div id="load-packages-and-import-data" class="section level2" number="50.2">
<h2><span class="header-section-number">50.2</span> Load packages and import data</h2>
<div id="load-packages-34" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>Using the <code>p_load()</code> function from <strong>pacman</strong>, we load (and install if necessary) packages required for this analysis.</p>
</div>
<div id="import-data-29" class="section level3 unnumbered">
<h3>Import data</h3>
<p>This page will explore some of the core functions of <strong>data.table</strong> using the case linelist referenced throughout the handbook.</p>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the [Download book and data] page. The dataset is imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data. From here we use <code>data.table()</code> to convert the data frame to a data table.</p>
<p>The <code>fread()</code> function is used to directly import regular delimited files, such as .csv files, directly to a data table format. This function, and its counterpart, <code>fwrite()</code>, used for writing data.tables as regular delimited files are very fast and computationally efficient options for large databases.</p>
<p>The first 20 rows of <code>linelist</code>:</p>
<p>Base R commands such as <code>dim()</code> that are used for data frames can also be used for data tables</p>
<!-- ======================================================= -->
</div>
</div>
<div id="the-i-argument-selecting-and-filtering-rows" class="section level2" number="50.3">
<h2><span class="header-section-number">50.3</span> The i argument: selecting and filtering rows</h2>
<p>Recalling the <strong>DT[i, j, by]</strong> structure, we can filter rows using either row numbers or logical expressions. The i argument is first; therefore, the syntax <strong>DT[i]</strong> or <strong>DT[i,]</strong> can be used.</p>
<p>The first example retrieves the first 5 rows of the data table, the second example subsets cases are 18 years or over, and the third example subsets cases 18 years old or over but not diagnosed at the Central Hospital:</p>
<p>Using .N in the i argument represents the total number of rows in the data table. This can be used to subset on the row numbers:</p>
<div id="using-helper-functions-for-filtering" class="section level3 unnumbered">
<h3>Using helper functions for filtering</h3>
<p>Data table uses helper functions that make subsetting rows easy. The <code>%like%</code> function is used to match a pattern in a column, <code>%chin%</code> is used to match a specific character, and the <code>%between%</code> helper function is used to match numeric columns within a prespecified range.</p>
<p>In the following examples we:
* filter rows where the hospital variable contains “Hospital”
* filter rows where the outcome is “Recover” or “Death”
* filter rows in the age range 40-60</p>
</div>
</div>
<div id="the-j-argument-selecting-and-computing-on-columns" class="section level2" number="50.4">
<h2><span class="header-section-number">50.4</span> The j argument: selecting and computing on columns</h2>
<p>Using the <strong>DT[i, j, by]</strong> structure, we can select columns using numbers or names. The <strong>j</strong> argument is second; therefore, the syntax <strong>DT[, j]</strong> is used. To facilitate computations on the <strong>j</strong> argument, the column is wrapped using either <code>list()</code> or <code>.()</code>.</p>
<div id="selecting-columns" class="section level3 unnumbered">
<h3>Selecting columns</h3>
<p>The first example retrieves the first, third and fifth columns of the data table, the second example selects all columns except the height, weight and gender columns. The third example uses the <code>.()</code> wrap to select the <strong>case_id</strong> and <strong>outcome</strong> columns.</p>
</div>
<div id="computing-on-columns" class="section level3 unnumbered">
<h3>Computing on columns</h3>
<p>By combining the <strong>i</strong> and <strong>j</strong> arguments it is possible to filter rows and compute on the columns. Using <strong>.N</strong> in the <strong>j</strong> argument also represents the total number of rows in the data table and can be useful to return the number of rows after row filtering.</p>
<p>In the following examples we:
* Count the number of cases that stayed over 7 days in hospital
* Calculate the mean age of the cases that died at the military hospital
* Calculate the standard deviation, median, mean age of the cases that recovered at the central hospital</p>
<p>Remember using the .() wrap in the j argument facilitates computation, returns a data table and allows for column naming.</p>
</div>
</div>
<div id="the-by-argument-computing-by-groups" class="section level2" number="50.5">
<h2><span class="header-section-number">50.5</span> The by argument: computing by groups</h2>
<p>The <strong>by</strong> argument is the third argument in the <strong>DT[i, j, by]</strong> structure. The <strong>by</strong> argument accepts both a character vector and the <code>list()</code> or <code>.()</code> syntax. Using the <code>.()</code> syntax in the <strong>by</strong> argument allows column renaming on the fly.</p>
<p>In the following examples we:<br />
* group the number of cases by hospital
* in cases 18 years old or over, calculate the mean height and weight of cases according to gender and whether they recovered or died
* in admissions that lasted over 7 days, count the number of cases according to the month they were admitted and the hospital they were admitted to</p>
<p>Data.table also allows the chaining expressions as follows:</p>
<p>In these examples we are following the assumption that a row in the data table is equal to a new case, and so we can use the <strong>.N</strong> to represent the number of rows in the data table. Another useful function to represent the number of unique cases is <code>uniqueN()</code>, which returns the number of unique values in a given input. This is illustrated here:</p>
<p>The answer is 3, as the unique values in the gender column are m, f and N/A. Compare with the base R function <code>unique()</code>, which returns all the unique values in a given input:</p>
<p>To find the number of unique cases in a given month we would write the following:</p>
</div>
<div id="adding-and-updating-to-data-tables" class="section level2" number="50.6">
<h2><span class="header-section-number">50.6</span> Adding and updating to data tables</h2>
<p>The <code>:=</code> operator is used to add or update data in a data table. Adding columns to your data table can be done in the following ways:</p>
<p>Further complex aggregations are beyond the scope of this introductory chapter, but the idea is to provide a popular and viable alternative to <strong>dplyr</strong> for grouping and cleaning data. The <strong>data.table</strong> package is a great package that allows for neat and readable code.</p>
</div>
<div id="resources-41" class="section level2" number="50.7">
<h2><span class="header-section-number">50.7</span> Resources</h2>
<p>Here are some useful resources for more information:
* <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a>
* <a href="https://github.com/Rdatatable/data.table" class="uri">https://github.com/Rdatatable/data.table</a>
* <a href="https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf" class="uri">https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf</a>
* <a href="https://www.machinelearningplus.com/data-manipulation/datatable-in-r-complete-guide/" class="uri">https://www.machinelearningplus.com/data-manipulation/datatable-in-r-complete-guide/</a>
* <a href="https://www.datacamp.com/community/tutorials/data-table-r-tutorial" class="uri">https://www.datacamp.com/community/tutorials/data-table-r-tutorial</a></p>
<p>You can perform any summary function on grouped data; see the Cheat Sheet here for more info:
<a href="https://s3.amazonaws.com/assets.datacamp.com/blog_assets/datatable_Cheat_Sheet_R.pdf" class="uri">https://s3.amazonaws.com/assets.datacamp.com/blog_assets/datatable_Cheat_Sheet_R.pdf</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-05-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
