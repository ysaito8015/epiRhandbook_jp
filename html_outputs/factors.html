<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10 Factors | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Editorial and technical notes</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Download handbook and data</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transition to R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Suggested packages</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Import and export</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Cleaning data and core functions</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></li>
<li><a class="active" href="factors.html"><span class="header-section-number">10</span> Factors</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivoting data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">13</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">14</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteration, loops, and lists</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Descriptive tables</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Simple statistical tests</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Univariate and multivariable regression</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Missing data</a></li>
<li><a class="" href="standardization-1.html"><span class="header-section-number">21</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection-1.html"><span class="header-section-number">23</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">28</span> Tables for presentation</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">29</span> ggplot basics</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">30</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">31</span> Plot categorical data</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">32</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">33</span> Epidemic curves</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">34</span> Demographic pyramids and Likert-scales</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagrams and charts</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Combinations analysis</a></li>
<li><a class="" href="heat-tiles.html"><span class="header-section-number">37</span> Heat tiles</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">38</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">39</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">40</span> Interactive plots</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="r-markdown-reports.html"><span class="header-section-number">41</span> R Markdown reports</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">42</span> Organizing routine reports</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">43</span> Dashboards with R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">44</span> Dashboards with Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="version-control-and-collaboration-with-github.html"><span class="header-section-number">46</span> Version control and collaboration with Github</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
<li><a class="" href="errors-help.html"><span class="header-section-number">48</span> Errors &amp; help</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">49</span> Relational databases</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">50</span> R on network drives</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">51</span> Advanced RStudio</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="factors" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Factors<a class="anchor" aria-label="anchor" href="#factors"><i class="fas fa-link"></i></a>
</h1>
<p>In R, <em>factors</em> allow for ordered categorical data. A column can be converted from class numeric, categorical, or even logical to class <em>factor</em>. In this case, the values are stored as <em>ordered integer <strong>levels</strong></em>, and can display with assigned <em>labels</em>.</p>
<p>In a column of class <em>factor</em>:</p>
<ul>
<li>the possible values are restricted - values not already defined as levels are rejected<br>
</li>
<li>values are ordered, which impacts how they display in tables and plots</li>
</ul>
<p>This page demonstrates use of functions from the package <strong>forcats</strong> (a short name for “For categorical variables”) and some <strong>base</strong> R functions. We also touch upon the use of <strong>lubridate</strong> and <strong>aweek</strong> for special cases related to epiweeks.</p>
<p>Factors are useful in statistical modeling, which allows integer values such as 1/0 to be evaluated categorically and not continuously.</p>
<!-- ======================================================= -->
<div id="preparation-1" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-1"><i class="fas fa-link"></i></a>
</h2>
<div id="load-packages-2" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages-2"><i class="fas fa-link"></i></a>
</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,           <span class="co"># import/export</span>
  <span class="va">here</span>,          <span class="co"># filepaths</span>
  <span class="va">lubridate</span>,     <span class="co"># working with dates</span>
  <span class="va">forcats</span>,       <span class="co"># factors</span>
  <span class="va">aweek</span>,         <span class="co"># create epiweeks with automatic factor levels</span>
  <span class="va">tidyverse</span>      <span class="co"># data mgmt and viz</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="import-data-2" class="section level3 unnumbered">
<h3>Import data<a class="anchor" aria-label="anchor" href="#import-data-2"><i class="fas fa-link"></i></a>
</h3>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page. The dataset is imported using the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data.</p>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fake import the linelist</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-new-categorical-column" class="section level3" number="10.1.1">
<h3>
<span class="header-section-number">10.1.1</span> Example: new categorical column<a class="anchor" aria-label="anchor" href="#example-new-categorical-column"><i class="fas fa-link"></i></a>
</h3>
<p>For demonstration in this page we will use a common scenario - the creation of a categorical variable.</p>
<p>We use the existing column <code>days_onset_hosp</code> (days from symptom onset to hospital admission) and classify each row into one of several categorical groupings.</p>
<p>We can use the <strong>dplyr</strong> function <code>case_when()</code> to apply logical criteria on each row, resulting in values for the new column <code>delay</code></p>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">2</span>                        <span class="op">~</span> <span class="st">"&lt;2 days"</span>,
    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"2-5 days"</span>,
    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">5</span>                       <span class="op">~</span> <span class="st">"&gt;5 days"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">days_onset_hosp</span><span class="op">)</span>                     <span class="op">~</span> <span class="cn">NA_character_</span>,
    <span class="cn">TRUE</span>                                       <span class="op">~</span> <span class="st">"Check me"</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
</div>
</div>
<div id="non-factor-categorical" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Non-factor categorical<a class="anchor" aria-label="anchor" href="#non-factor-categorical"><i class="fas fa-link"></i></a>
</h2>
<p>The column <code>delay</code> (created in the Preparation section above) is a categorical column of class Character - <em>not</em> yet a Factor. Thus, in a frequency table, we see that the values appear in a default alphabetical order - an order that does not make much intuitive sense:</p>
<div class="sourceCode" id="cb390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  &lt;2 days  &gt;5 days 2-5 days     &lt;NA&gt; 
##     2990      602     2040      256</code></pre>
<p>Likewise, if we make a bar plot, the values also appear in this order on the x-axis. This order does not make sense. (see the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page for more on <strong>ggplot2</strong> - a very common and useful visualization package).</p>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-287-1.png" width="672"></div>
</div>
<div id="convert-to-factor" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Convert to factor<a class="anchor" aria-label="anchor" href="#convert-to-factor"><i class="fas fa-link"></i></a>
</h2>
<p>To initially convert a character or numeric column to class Factor, we suggest using the <strong>base</strong> R function <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>. Below the data frame <code>linelist</code> is modified such that the column <code>delay</code> is converted to a factor. The default order of the values will be alpha-numeric.</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Unless specified, the levels will still be in alphabetic (or numeric) order. Use the <strong>base</strong> R function <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code> to see how the levels of <code>time_period</code> are ordered. Note that <code>NA</code> is not a factor level.</p>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "&gt;5 days"  "2-5 days"</code></pre>
<p>You can specify the levels and their order <em>in your initial conversion command</em> to the <code>levels =</code> argument.</p>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">delay</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "2-5 days" "&gt;5 days"</code></pre>
</div>
<div id="adjust-level-order" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Adjust level order<a class="anchor" aria-label="anchor" href="#adjust-level-order"><i class="fas fa-link"></i></a>
</h2>
<p>The package <strong>forcats</strong> offers several useful functions to easily <em>adjust</em> the order of a factor’s levels:</p>
<ul>
<li>Use <code>fct_relevel()</code> to <em>manually</em> adjust the order<br>
</li>
<li>Use <code>fct_infreq()</code> to reorder by frequency (highest to lowest)<br>
</li>
<li>Use <code>fct_inorder()</code> to reorder by order of appearance in the data<br>
</li>
<li>Use <code>fct_reorder()</code> to reorder by another column (e.g. order time_period levels by their row’s median delay to admission)<br>
</li>
<li>Use <code>fct_rev()</code> to reverse the existing order<br>
</li>
<li>Use <code>fct_reorder2()</code> to reorder by the final values when plotted with two other columns</li>
</ul>
<p>These functions can be applied outside of a plot to re-define the column, or within a plot to affect just one specific plot.</p>
<div id="examples-1" class="section level3 unnumbered">
<h3>Examples<a class="anchor" aria-label="anchor" href="#examples-1"><i class="fas fa-link"></i></a>
</h3>
<p><strong><code>fct_relevel()</code></strong></p>
<p>This function is used to manually order the factor levels. Within the parentheses, first provide the factor column, then provide the levels in the desired order (as a character vector within <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>). Here is an example of redefining the column <code>delay</code> (which is already class Factor) and specifying the desired order of levels.</p>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># re-define level order</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If you only want to move one level, you can specify it to <code>fct_relevel()</code> alone and give a number to the <code>after =</code> argument to indicate where in the order it should be. For example:</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># re-define level order</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay</span>, <span class="st">"&lt;2 days"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2-5 days" "&lt;2 days"  "&gt;5 days"</code></pre>
<p>The above will define the level order in the data frame. Alternatively, you can adjust the levels from <em>within</em> a ggplot, and the re-ordering of the levels will only apply within the plot. Below, as the the <code>delay</code> column is mapped to the x-axis of the plot it is wrapped within <code>fct_relevel()</code>.</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Incorrect order - no adjustment within ggplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Factor level order adjusted within ggplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-294-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-294-2.png" width="50%"></p>
<p>Note how the default x-axis label is now quite complicated - you can overwrite this with the <code>labs()</code> in ggplot.</p>
<p><strong><code>fct_infreq()</code></strong></p>
<p>To order by frequency that the value appears in the data, use <code>fct_infreq()</code>. Any missing values (<code>NA</code>) will automatically be included at the end. You can reverse this order by further modifying with <code>fct_rev()</code>.</p>
<p>This function can be used within a <code>ggplot()</code>, as shown below.</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ordered by frequency</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span><span class="op">)</span>

<span class="co"># reversed frequency</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-295-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-295-2.png" width="50%"></p>
<p>Here is an example within a data frame:</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,
         delay <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong><code>fct_reorder()</code></strong></p>
<p>Use this function to order the levels by another column. For example, to order boxplots showing delay <em>by the median CT value of each delay group</em>.</p>
<p>In the examples below, the x-axis if delay group, and the y = axis is CT value. The boxplots are also colored by delay group.</p>
<p>In the first example, the baseline order of the levels applies (as set earlier in this page) - they increase incrementally updward by delay.<br>
In the second example, the x-axis column has been wrapped in <code>fct_reorder()</code>, with the column <code>ct_blood</code> as the second argument. The default is order <code>delay</code> by the <em>median</em> <code>ct_value</code>. An alternative function can be supplied, e.g. “mean”, or “max”.</p>
<p>Note there are no explicit grouping steps required prior to the <code>ggplot()</code> - the grouping and calculations are all done internally.</p>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># boxplots ordered by original factor levels</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span>,
        y <span class="op">=</span> <span class="va">ct_blood</span>, 
        fill <span class="op">=</span> <span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Ordered by increasing delay (original factor levels)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-297-1.png" width="672"></div>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># boxplots ordered by median CT value</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">delay</span>, <span class="va">ct_blood</span>, <span class="st">"median"</span><span class="op">)</span>,
        y <span class="op">=</span> <span class="va">ct_blood</span>,
        fill <span class="op">=</span> <span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Ordered by median CT value in group"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-297-2.png" width="672"></div>
<p><strong><code>fct_reorder2()</code></strong></p>
<p>Use this function to order the <em>legend colors</em> by the vertical order of groups at the “end” of the plot. For example, if you have lines showing case counts by hospital over time, you can apply <code>fct_reorder2()</code> to the <code>color =</code> argument within <code>aes()</code>, such that the vertical order of hospitals appearing in the legend aligns with the order of lines at the terminal end of the plot. Read more in the <a href="https://forcats.tidyverse.org/reference/fct_reorder.html">function documentation</a>.</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>         <span class="co"># begin with the linelist            </span>
  <span class="fu">count</span><span class="op">(</span>             <span class="co"># summarise so n = counts of rows by epiweek and by hospital</span>
    epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span>,  <span class="co"># create and group by epiweeks</span>
    <span class="va">hospital</span>         <span class="co"># also group by hospital</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>           <span class="co"># start plot</span>
  <span class="fu">geom_line</span><span class="op">(</span>          <span class="co"># make lines</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>,  <span class="co"># x-axis epiweek</span>
        y <span class="op">=</span> <span class="va">n</span>,        <span class="co"># height in number of rows</span>
        color <span class="op">=</span> <span class="fu">fct_reorder2</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">epiweek</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># grouped by hospital and colors ordered by n value at end of plot</span>
  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>  <span class="co"># change legend title</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-298-1.png" width="672"></div>
<p><strong><code>fct_lump()</code></strong></p>
<p>To “lump” together many low-frequency levels into an “Other” group, you can use this function. Do one of the following:</p>
<ul>
<li>Set <code>n =</code> argument as the number of groups you want to keep. All other values will combine into “Other”.<br>
</li>
<li>set <code>prop =</code> argument as the proportion above which you want to keep. All other values will combine into “Other”.</li>
</ul>
<p>You can also change the label for “Other” by using <code>other_level =</code>. Below, all but the two most-frequent hospitals are combined into “Other hospitals”.</p>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_lump</span><span class="op">(</span><span class="va">hospital</span>,    <span class="co"># column for x-axis</span>
                            n <span class="op">=</span> <span class="fl">2</span>,       <span class="co"># keep two most-frequent levels</span>
                            other_level <span class="op">=</span> <span class="st">"Other hospitals"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># label for "Other" group</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-299-1.png" width="672"></div>
<p>You can also use <code>fct_other()</code> to manually assign factor levels to an “Other” group. Below, all <code>hospital</code> values aside from “Port Hospital” and “Central Hospital” are combined into “Other”.</p>
<p>You can use the arguments <code>keep =</code>, or <code>drop =</code>, and can change the label of “Other” with <code>other_label =</code>.</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_other</span><span class="op">(</span><span class="va">hospital</span>, keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Port Hospital"</span>, <span class="st">"Central Hospital"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
## Central Hospital    Port Hospital            Other 
##              454             1762             3672</code></pre>
</div>
</div>
<div id="missing-values-3" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Missing values<a class="anchor" aria-label="anchor" href="#missing-values-3"><i class="fas fa-link"></i></a>
</h2>
<p>If you have <code>NA</code> values in your column, you can easily convert them to a named value such as “Missing” with <code>fct_explicit_na()</code>, as performed below temporarily on the column <code>delay</code>:</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span><span class="va">delay</span>, na_level <span class="op">=</span> <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## .
## 2-5 days  &lt;2 days  &gt;5 days  Missing     &lt;NA&gt; 
##     2040     2990      602      256        0</code></pre>
</div>
<div id="edit-labels" class="section level2" number="10.6">
<h2>
<span class="header-section-number">10.6</span> Edit labels<a class="anchor" aria-label="anchor" href="#edit-labels"><i class="fas fa-link"></i></a>
</h2>
<p>Adjust the factor labels with <code>fct_recode()</code>. remember that these do not change the underlying values, only their labels.<br>
Below, the labels of the factor column <code>delay</code> (grouped days from onset to admission) are edited:</p>
<p>The old labels:</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## 2-5 days  &lt;2 days  &gt;5 days     &lt;NA&gt; 
##     2040     2990      602      256</code></pre>
<p>Now the labels are changed, using syntax <code>fct_recode(column, "new" = "old","new" = "old", "new" = "old")</code>. Remember that <code>NA</code> is not a formal level unless changed (e.g. with <code>fct_explicit_na()</code> as shown above).</p>
<div class="sourceCode" id="cb415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span><span class="va">delay</span>,
                            <span class="st">"Less than 2 days"</span> <span class="op">=</span> <span class="st">"&lt;2 days"</span>,
                            <span class="st">"2 to 5 days"</span>      <span class="op">=</span> <span class="st">"2-5 days"</span>,
                            <span class="st">"More than 5 days"</span> <span class="op">=</span> <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##      2 to 5 days Less than 2 days More than 5 days 
##             2040             2990              602</code></pre>
</div>
<div id="adddrop-levels" class="section level2" number="10.7">
<h2>
<span class="header-section-number">10.7</span> Add/drop levels<a class="anchor" aria-label="anchor" href="#adddrop-levels"><i class="fas fa-link"></i></a>
</h2>
<p>If you have a factor and want to add levels (regardless of whether there are any rows with those values), use <code>fct_expand()</code>.</p>
<p>See how if we classify “hospital” as a factor, and then try to change the values, an error is returned:</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Central Hospital"                     "Military Hospital"                   
## [3] "Missing"                              "Other"                               
## [5] "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"</code></pre>
<p>Now we can add the level “University Hospital”:</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_expand</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"University Hospital"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Central Hospital"                     "Military Hospital"                   
## [3] "Missing"                              "Other"                               
## [5] "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"
## [7] "University Hospital"</code></pre>
<div id="epiweeks" class="section level3 unnumbered">
<h3>Epiweeks<a class="anchor" aria-label="anchor" href="#epiweeks"><i class="fas fa-link"></i></a>
</h3>
<p>Please see the extensive discussion of how to create epidemiological weeks in the <a href="grouping-data.html#grouping-data">Grouping data</a> page.<br>
Please also see the <a href="working-with-dates.html#working-with-dates-1">Working with dates</a> page for tips on how to create and format epi weeks.</p>
<div id="floor_date" class="section level4 unnumbered">
<h4>
<code>floor_date()</code><a class="anchor" aria-label="anchor" href="#floor_date"><i class="fas fa-link"></i></a>
</h4>
<p>If you create epiweeks with <strong>lubridate</strong>’s <code>floor_date()</code>, the values returned be of class Date with format YYYY-MM-DD. If you use them in a plot the dates will naturally order correctly, and you do not need to worry about class Factor. For example, in the <code>ggplot()</code> histogram of onset dates below.</p>
<p>You can adjust the <em>display</em> of the dates on an axis with <code>scale_x_date()</code>. See the page on <a href="epidemic-curves.html#epidemic-curves">Epidemic curves</a> for more information. You can specify a “strptime” display format to the <code>date_labels =</code> argument. These formats use “%” placeholders and are covered in the <a href="working-with-dates.html#working-with-dates-1">Working with dates</a> page. Use “%Y” to represent a 4-digit year, and either “%W” or “%U” to represent the week number (Monday or Sunday weeks respectively).</p>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>epiweek_date <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># create week column</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                                  <span class="co"># begin ggplot</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek_date</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>           <span class="co"># histogram of date of onset</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%Y-W%W"</span><span class="op">)</span>                       <span class="co"># adjust disply of dates to be YYYY-WWw</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-306-1.png" width="672"></div>
<p>However, if your purpose in factoring is <em>not</em> to plot, you may convert this epiweek column (YYYY-MM-DD) to a different display format (YYYY-WWw) <em>within the data frame itself</em>, and convert it to class Factor. Use <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> from <strong>base</strong> R to convert the display, then convert to class Factor with <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>.</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>epiweek_date <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span>,       <span class="co"># create epiweeks (YYYY-MM-DD)</span>
         epiweek_formatted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">epiweek_date</span>, <span class="st">"%Y-W%W"</span><span class="op">)</span>,  <span class="co"># Convert to display (YYYY-WWw)</span>
         epiweek_formatted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">epiweek_formatted</span><span class="op">)</span><span class="op">)</span>       <span class="co"># Convert to factor</span>

<span class="co"># Display levels</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">epiweek_formatted</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "2014-W13" "2014-W14" "2014-W15" "2014-W16" "2014-W17" "2014-W18" "2014-W19" "2014-W20" "2014-W21" "2014-W22"
## [11] "2014-W23" "2014-W24" "2014-W25" "2014-W26" "2014-W27" "2014-W28" "2014-W29" "2014-W30" "2014-W31" "2014-W32"
## [21] "2014-W33" "2014-W34" "2014-W35" "2014-W36" "2014-W37" "2014-W38" "2014-W39" "2014-W40" "2014-W41" "2014-W42"
## [31] "2014-W43" "2014-W44" "2014-W45" "2014-W46" "2014-W47" "2014-W48" "2014-W49" "2014-W50" "2014-W51" "2015-W00"
## [41] "2015-W01" "2015-W02" "2015-W03" "2015-W04" "2015-W05" "2015-W06" "2015-W07" "2015-W08" "2015-W09" "2015-W10"
## [51] "2015-W11" "2015-W12" "2015-W13" "2015-W14" "2015-W15" "2015-W16"</code></pre>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> If you use “Www-YYYY” (“%W-%Y”) display format instead, the default alpha-numeric level ordering will be incorrect (e.g. 01-2015 will be before 35-2014).</span></p>
</div>
<div id="aweek" class="section level4 unnumbered">
<h4>
<strong>aweek</strong><a class="anchor" aria-label="anchor" href="#aweek"><i class="fas fa-link"></i></a>
</h4>
<p>An alternative method if you want to convert dates to epiweeks <em>within a data frame</em> is to use the <strong>aweek</strong> package function <code>date2week()</code>. You can set the <code>week_start =</code> and if you set <code>factor = TRUE</code> then the output column is an ordered factor. As a bonus, the factor includes levels for <em>all</em> weeks in the span - even if there are no cases that week. This ensure that if you create a table or bar plot that all weeks will appear.</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>epiweek <span class="op">=</span> <span class="fu">date2week</span><span class="op">(</span><span class="va">date_onset</span>, week_start <span class="op">=</span> <span class="st">"Monday"</span>, factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">epiweek</span><span class="op">)</span></code></pre></div>
<p>See the <a href="working-with-dates.html#working-with-dates-1">Working with dates</a> page for more information about <strong>aweek</strong>. It also offers the reverse function <code>week2date()</code>.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="resources-3" class="section level2" number="10.8">
<h2>
<span class="header-section-number">10.8</span> Resources<a class="anchor" aria-label="anchor" href="#resources-3"><i class="fas fa-link"></i></a>
</h2>
<p>R for Data Science page on <a href="https://r4ds.had.co.nz/factors.html">factors</a>.
<a href="https://cran.r-project.org/web/packages/aweek/vignettes/introduction.html">aweek vignette</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></div>
<div class="next"><a href="pivoting-data.html"><span class="header-section-number">11</span> Pivoting data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#factors"><span class="header-section-number">10</span> Factors</a></li>
<li>
<a class="nav-link" href="#preparation-1"><span class="header-section-number">10.1</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-packages-2">Load packages</a></li>
<li><a class="nav-link" href="#import-data-2">Import data</a></li>
<li><a class="nav-link" href="#example-new-categorical-column"><span class="header-section-number">10.1.1</span> Example: new categorical column</a></li>
</ul>
</li>
<li><a class="nav-link" href="#non-factor-categorical"><span class="header-section-number">10.2</span> Non-factor categorical</a></li>
<li><a class="nav-link" href="#convert-to-factor"><span class="header-section-number">10.3</span> Convert to factor</a></li>
<li>
<a class="nav-link" href="#adjust-level-order"><span class="header-section-number">10.4</span> Adjust level order</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#examples-1">Examples</a></li></ul>
</li>
<li><a class="nav-link" href="#missing-values-3"><span class="header-section-number">10.5</span> Missing values</a></li>
<li><a class="nav-link" href="#edit-labels"><span class="header-section-number">10.6</span> Edit labels</a></li>
<li>
<a class="nav-link" href="#adddrop-levels"><span class="header-section-number">10.7</span> Add/drop levels</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#epiweeks">Epiweeks</a></li></ul>
</li>
<li><a class="nav-link" href="#resources-3"><span class="header-section-number">10.8</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-04-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
