<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>26 Survival analysis | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Editorial and technical notes</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Download handbook and data</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transition to R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Suggested packages</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Import and export</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Cleaning data and core functions</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">10</span> Factors</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivoting data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">13</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">14</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteration, loops, and lists</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Descriptive tables</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Simple statistical tests</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Univariate and multivariable regression</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Missing data</a></li>
<li><a class="" href="standardization-1.html"><span class="header-section-number">21</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection-1.html"><span class="header-section-number">23</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Survey analysis</a></li>
<li><a class="active" href="survival-analysis.html"><span class="header-section-number">26</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">28</span> Tables for presentation</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">29</span> ggplot basics</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">30</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">31</span> Plot categorical data</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">32</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">33</span> Epidemic curves</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">34</span> Demographic pyramids and Likert-scales</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagrams and charts</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Combinations analysis</a></li>
<li><a class="" href="heat-tiles.html"><span class="header-section-number">37</span> Heat tiles</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">38</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">39</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">40</span> Interactive plots</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="r-markdown-reports.html"><span class="header-section-number">41</span> R Markdown reports</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">42</span> Organizing routine reports</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">43</span> Dashboards with R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">44</span> Dashboards with Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="version-control-and-collaboration-with-github.html"><span class="header-section-number">46</span> Version control and collaboration with Github</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
<li><a class="" href="errors-help.html"><span class="header-section-number">48</span> Errors &amp; help</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">49</span> Relational databases</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">50</span> R on network drives</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">51</span> Advanced RStudio</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="survival-analysis" class="section level1" number="26">
<h1>
<span class="header-section-number">26</span> Survival analysis<a class="anchor" aria-label="anchor" href="#survival-analysis"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="overview-9" class="section level2" number="26.1">
<h2>
<span class="header-section-number">26.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-9"><i class="fas fa-link"></i></a>
</h2>
<p><em>Survival analysis</em> focuses on describing for a given individual or group of individuals, a defined point of event called <strong><em>the failure</em></strong> (occurrence of a disease, cure from a disease, death, relapse after response to treatment…) that occurs after a period of time called <strong><em>failure time</em></strong> (or <strong><em>follow-up time</em></strong> in cohort/population-based studies) during which individuals are observed. To determine the failure time, it is then necessary to define a time of origin (that can be the inclusion date, the date of diagnosis…).</p>
<p>The target of inference for survival analysis is then the time between an origin and an event.
In current medical research, it is widely used in clinical studies to assess the effect of a treatment for instance, or in cancer epidemiology to assess a large variety of cancer survival measures.</p>
<p>It is usually expressed through the <strong><em>survival probability</em></strong> which is the probability that the event of interest has not occurred by a duration t.</p>
<p><strong><em>Censoring</em></strong>: Censoring occurs when at the end of follow-up, some of the individuals have not had the event of interest, and thus their true time to event is unknown. We will mostly focus on right censoring here but for more details on censoring and survival analysis in general, you can see references.</p>
<!-- ======================================================= -->
</div>
<div id="preparation-17" class="section level2" number="26.2">
<h2>
<span class="header-section-number">26.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-17"><i class="fas fa-link"></i></a>
</h2>
<div id="load-packages-15" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages-15"><i class="fas fa-link"></i></a>
</h3>
<p>To run survival analyses in R, one the most widely used package is the <strong>survival</strong> package. We first install it and then load it as well as the other packages that will be used in this section:</p>
<p>In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<p>This page explores survival analyses using the linelist used in most of the previous pages and on which we apply some changes to have a proper survival data.</p>
</div>
<div id="import-dataset" class="section level3 unnumbered">
<h3>Import dataset<a class="anchor" aria-label="anchor" href="#import-dataset"><i class="fas fa-link"></i></a>
</h3>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page. The dataset is imported using the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data.</p>
<div class="sourceCode" id="cb1147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import linelist</span>
<span class="va">linelist_case_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-management-and-transformation" class="section level3 unnumbered">
<h3>Data management and transformation<a class="anchor" aria-label="anchor" href="#data-management-and-transformation"><i class="fas fa-link"></i></a>
</h3>
<p>In short, survival data can be described as having the following three characteristics:</p>
<ol style="list-style-type: decimal">
<li>the dependent variable or response is the waiting time until the occurrence of a well-defined event,</li>
<li>observations are censored, in the sense that for some units the event of interest has not occurred at the time the data are analyzed, and</li>
<li>there are predictors or explanatory variables whose effect on the waiting time we wish to assess or control.</li>
</ol>
<p>Thus, we will create different variables needed to respect that structure and run the survival analysis.</p>
<p>We define:</p>
<ul>
<li>our event of interest as being “death” (hence our survival probability will be the probability of being alive after a certain time after the time of origin),</li>
<li>the follow-up time (<code>futime</code>) as the time between the time of onset and the time of outcome <em>in days</em>,</li>
<li>censored patients as those who recovered or for whom the final outcome is not known ie the event “death” was not observed (<code>event=0</code>).</li>
</ul>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Since in a real cohort study, the information on the time of origin and the end of the follow-up is known given individuals are observed, we will remove observations where the date of onset or the date of outcome is unknown. Also the cases where the date of onset is later than the date of outcome will be removed since they are considered as wrong.</span></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Given that filtering to greater than (&gt;) or less than (&lt;) a date can remove rows with missing values, applying the filter on the wrong dates will also remove the rows with missing dates.</span></p>
<p>We then create from the var <code>age_cat</code> another variable <code>age_cat_small</code> that indicates reduces the categories of the age groups to 3.</p>
<div class="sourceCode" id="cb1148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#create a new data called linelist_surv from the linelist_case_data</span>

<span class="va">linelist_surv</span> <span class="op">&lt;-</span>  <span class="va">linelist_case_data</span> <span class="op">%&gt;%</span> 
     
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
       <span class="co"># remove observations with wrong or missing dates of onset or date of outcome</span>
       <span class="va">date_outcome</span> <span class="op">&gt;</span> <span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
       <span class="co"># create the event var which is 1 if the patient died and 0 if he was right censored</span>
       event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|</span> <span class="va">outcome</span> <span class="op">==</span> <span class="st">"Recover"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, 
    
       <span class="co"># create the var on the follow-up time in days</span>
       futime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">date_outcome</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span>, 
    
       <span class="co"># create a new age category variable with only 3 strata levels</span>
       age_cat_small <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span> 
            <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">5</span>  <span class="op">~</span> <span class="st">"0-4"</span>,
            <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"5-19"</span>,
            <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">20</span>   <span class="op">~</span> <span class="st">"20+"</span><span class="op">)</span>,
       
       <span class="co"># previous step created age_cat_small var as character.</span>
       <span class="co"># now convert it to factor and specify the levels.</span>
       <span class="co"># Note that the NA values remain NA's and are not put in a level "unknown" for example,</span>
       <span class="co"># since in the next analyses they have to be removed.</span>
       age_cat_small <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat_small</span>,
                              levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-19"</span>, <span class="st">"20+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> We can verify the new variables we have created by doing a summary on the <code>futime</code> and a cross-tabulation between <code>event</code> and <code>outcome</code> from which it was created. Besides this verification it is a good habit communicating on the median follow-up time when interpreting survival analysis results.</span></p>
<div class="sourceCode" id="cb1149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelist_surv</span><span class="op">$</span><span class="va">futime</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    6.00   10.00   11.98   16.00   64.00</code></pre>
<div class="sourceCode" id="cb1151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># cross tabulate the new event var and the outcome var from which it was created</span>
<span class="co"># to make sure the code did what it was intended to</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">linelist_surv</span>, 
     <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">event</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span>
     <span class="op">)</span></code></pre></div>
<pre><code>##          event
## outcome      0    1
##   Death      0 1952
##   Recover 1547    0
##   &lt;NA&gt;    1040    0</code></pre>
<div class="sourceCode" id="cb1153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># cross tabulate the new age_cat_small var and the age_cat var from which it was created,</span>
<span class="co"># to make sure the code did what it was intended to</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">linelist_surv</span>, 
     <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">age_cat_small</span>, <span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span>
     <span class="op">)</span> </code></pre></div>
<pre><code>##              age_cat
## age_cat_small 0-4 5-9 10-14 15-19 20-29 30-49 50-69 70+ &lt;NA&gt;
##          0-4  834   0     0     0     0     0     0   0    0
##          5-19   0 852   717   575     0     0     0   0    0
##          20+    0   0     0     0   862   554    69   5    0
##          &lt;NA&gt;   0   0     0     0     0     0     0   0   71</code></pre>
<div class="sourceCode" id="cb1155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print the 10 first observations of the linelist_surv data looking at specific variables (including those newly created)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">linelist_surv</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"case_id"</span>, <span class="st">"age_cat_small"</span>, <span class="st">"date_onset"</span>,<span class="st">"date_outcome"</span>,<span class="st">"outcome"</span>,<span class="st">"event"</span>,<span class="st">"futime"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##    case_id age_cat_small date_onset date_outcome outcome event futime
## 1   8689b7           0-4 2014-05-13   2014-05-18 Recover     0      5
## 2   11f8ea           20+ 2014-05-16   2014-05-30 Recover     0     14
## 3   893f25           0-4 2014-05-21   2014-05-29 Recover     0      8
## 4   be99c8          5-19 2014-05-22   2014-05-24 Recover     0      2
## 5   07e3e8          5-19 2014-05-27   2014-06-01 Recover     0      5
## 6   369449           0-4 2014-06-02   2014-06-07   Death     1      5
## 7   f393b4           20+ 2014-06-05   2014-06-18 Recover     0     13
## 8   1389ca           20+ 2014-06-05   2014-06-09   Death     1      4
## 9   2978ac          5-19 2014-06-06   2014-06-15   Death     1      9
## 10  fc15ef          5-19 2014-06-16   2014-07-09 Recover     0     23</code></pre>
<p>We can also cross-tabule the variable <code>age_cat_small</code> and <code>gender</code> to have more details on the distribution of this new variable among the gender groups. For this we use the <code>stat.table()</code> function of the <strong>Epi</strong> package.</p>
<div class="sourceCode" id="cb1157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">Epi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Epi/man/stattable.html">stat.table</a></span><span class="op">(</span> 
  <span class="co">#give variables for the cross tabulation</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va">gender</span>, 
    <span class="va">age_cat_small</span>
    <span class="op">)</span>,
  
  <span class="co">#precise the function you want to call (mean,count..)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> 
    <span class="fu">count</span><span class="op">(</span><span class="op">)</span>,
    <span class="fu">percent</span><span class="op">(</span><span class="va">age_cat_small</span><span class="op">)</span>
    <span class="op">)</span>, 
  
  <span class="co">#add margins</span>
  margins<span class="op">=</span><span class="cn">T</span>, 
  
  <span class="co">#data used</span>
  data <span class="op">=</span> <span class="va">linelist_surv</span> 
  <span class="op">)</span></code></pre></div>
<pre><code>##  ----------------------------------------- 
##          ----------age_cat_small---------- 
##  gender       0-4    5-19     20+   Total  
##  ----------------------------------------- 
##  f            482    1184     490    2156  
##              22.4    54.9    22.7   100.0  
##                                            
##  m            325     880     960    2165  
##              15.0    40.6    44.3   100.0  
##                                            
##                                            
##  Total        834    2144    1490    4539  
##              18.7    48.0    33.3   100.0  
##  -----------------------------------------</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="basics-of-survival-analysis" class="section level2" number="26.3">
<h2>
<span class="header-section-number">26.3</span> Basics of survival analysis<a class="anchor" aria-label="anchor" href="#basics-of-survival-analysis"><i class="fas fa-link"></i></a>
</h2>
<div id="building-a-surv-type-object" class="section level3 unnumbered">
<h3>Building a surv-type object<a class="anchor" aria-label="anchor" href="#building-a-surv-type-object"><i class="fas fa-link"></i></a>
</h3>
<p>We will first use <code>Surv()</code> to build a standard survival object form the follow-up time and the event variables.The result of such a step is to produce an object of type <em>survival</em> that focuses on the time information by precising whether or not the event of interest (death) was observed. This is done using a “+” after the time in the print out of <em>survobj</em> that indicates right-censoring.</p>
<div class="sourceCode" id="cb1159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survobj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">linelist_surv</span>, 
                
                <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span>
                
                <span class="op">)</span>

<span class="co">#print the 50 first elements of the vector to see how it presents</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">survobj</span>,<span class="fl">50</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1]  5+ 14+  8+  2+  5+  5  13+  4   9  23+ 12+ 22+  9+  2+ 11   6  11+  5+ 12+ 13   6+  2   8   3+  6  13+  4   9 
## [29] 28+ 14+  4  37+  6+  9+  7  43+  2   4   5+ 13   6+ 19+ 20+  9   7  32+  6   4  19+ 15+</code></pre>
</div>
<div id="running-initial-analyses" class="section level3 unnumbered">
<h3>Running initial analyses<a class="anchor" aria-label="anchor" href="#running-initial-analyses"><i class="fas fa-link"></i></a>
</h3>
<p>We then start our analysis using the <code>survfit()</code> function to produce a <em>survfit object</em>, which fits the default calculations for <strong><em>Kaplan Meier</em></strong> (KM) estimates of the overall (marginal) survival curve, which are in fact a step function with jumps at observed event times. The final <em>survfit object</em> contains one or more survival curvesis and is created using the <em>Surv object</em> as a response variable in the model formul.</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> The Kaplan-Meier estimate is a nonparametric maximum likelihood estimate (MLE) of the survival function. . (see resources for more information).</span></p>
<p>The summary of this <em>survfit object</em> will give what is called a <em>life table</em> that contains:</p>
<ul>
<li>for each of the time of the follow-up (<code>time</code>) where an event happened and that are ascending ordered,</li>
<li>the number of people who were at risk of developing the event (people who did not have the event yet nor were censored: <code>n.risk</code>),</li>
<li>those who did develop it (<code>n.event</code>),</li>
<li>and from this, the probability of not developing the event (probability of not dying or of surviving past that specific time ).</li>
<li>Finally the standard error and the confidence interval for that probability are derived.</li>
</ul>
<div class="sourceCode" id="cb1161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#fit the KM estimates using the formula where the previously Surv object "survobj" is the response variable. "~ 1" precises we run the model for the overall survival.</span>

<span class="va">linelistsurv_fit</span> <span class="op">&lt;-</span>  <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span>
  <span class="va">survobj</span> <span class="op">~</span> <span class="fl">1</span>
  <span class="op">)</span>

<span class="co">#print its summary for more details</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     1   4539      30    0.993 0.00120        0.991        0.996
##     2   4500      69    0.978 0.00217        0.974        0.982
##     3   4394     149    0.945 0.00340        0.938        0.952
##     4   4176     194    0.901 0.00447        0.892        0.910
##     5   3899     214    0.852 0.00535        0.841        0.862
##     6   3592     210    0.802 0.00604        0.790        0.814
##     7   3223     179    0.757 0.00656        0.745        0.770
##     8   2899     167    0.714 0.00700        0.700        0.728
##     9   2593     145    0.674 0.00735        0.660        0.688
##    10   2311     109    0.642 0.00761        0.627        0.657
##    11   2081     119    0.605 0.00788        0.590        0.621
##    12   1843      89    0.576 0.00809        0.560        0.592
##    13   1608      55    0.556 0.00823        0.540        0.573
##    14   1448      43    0.540 0.00837        0.524        0.556
##    15   1296      31    0.527 0.00848        0.511        0.544
##    16   1152      48    0.505 0.00870        0.488        0.522
##    17   1002      29    0.490 0.00886        0.473        0.508
##    18    898      21    0.479 0.00900        0.462        0.497
##    19    798       7    0.475 0.00906        0.457        0.493
##    20    705       4    0.472 0.00911        0.454        0.490
##    21    626      13    0.462 0.00932        0.444        0.481
##    22    546       8    0.455 0.00948        0.437        0.474
##    23    481       5    0.451 0.00962        0.432        0.470
##    24    436       4    0.447 0.00975        0.428        0.466
##    25    378       4    0.442 0.00993        0.423        0.462
##    26    336       3    0.438 0.01010        0.419        0.458
##    27    297       1    0.436 0.01017        0.417        0.457
##    29    235       1    0.435 0.01030        0.415        0.455
##    38     73       1    0.429 0.01175        0.406        0.452</code></pre>
<p>While using <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> we can add the option <code>times</code> and precise the specific times at which we want to see the survival information</p>
<div class="sourceCode" id="cb1163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print its summary at specific times</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span>
  <span class="va">linelistsurv_fit</span>,
        times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">60</span><span class="op">)</span>
        <span class="op">)</span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     5   3899     656    0.852 0.00535        0.841        0.862
##    10   2311     810    0.642 0.00761        0.627        0.657
##    20    705     446    0.472 0.00911        0.454        0.490
##    30    210      39    0.435 0.01030        0.415        0.455
##    60      2       1    0.429 0.01175        0.406        0.452</code></pre>
<p>We can also use the <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> function. The <code>print.rmean=TRUE</code> argument is used to obtain the mean survival time and its standard error (se).</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> The restricted mean survival time (RMST) is a specific survival measure more and more used in cancer survival analysis and which is often defined as the area under the survival curve given we observe patients up to restricted time T: more details in resources</span></p>
<div class="sourceCode" id="cb1165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print the linelistsurv_fit object and ask for information on the mean survival time and its se. </span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>
  <span class="va">linelistsurv_fit</span>, 
      print.rmean <span class="op">=</span> <span class="cn">TRUE</span>
      <span class="op">)</span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##          n     events     *rmean *se(rmean)     median    0.95LCL    0.95UCL 
##   4539.000   1952.000     33.105      0.539     17.000     16.000     18.000 
##     * restricted mean with upper limit =  64</code></pre>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> We can create the <em>surv object</em> directly in the <code>survfit()</code> function and save a line of code. This will then give <code>linelistsurv_quick &lt;-  survfit(Surv(futime, event) ~ 1, data=linelist_surv)</code>. But as you have seen, in such case we have to precise the data where the variables time and event are taken from.</span></p>
<p>Besides the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function, we can also use the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function that gives more details on the structure of the <code>survfit()</code> object. Among those details is an important one: <em>cumhaz</em> which allows for instance to plot the <strong><em>cumulative hazard</em></strong>, with the <strong><em>hazard</em></strong> being the <strong><em>instantaneous rate of event occurrence</em></strong> (see references).</p>
<div class="sourceCode" id="cb1167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span><span class="op">)</span>
      <span class="op">)</span></code></pre></div>
<pre><code>## List of 16
##  $ n        : int 4539
##  $ time     : num [1:59] 1 2 3 4 5 6 7 8 9 10 ...
##  $ n.risk   : num [1:59] 4539 4500 4394 4176 3899 ...
##  $ n.event  : num [1:59] 30 69 149 194 214 210 179 167 145 109 ...
##  $ n.censor : num [1:59] 9 37 69 83 93 159 145 139 137 121 ...
##  $ surv     : num [1:59] 0.993 0.978 0.945 0.901 0.852 ...
##  $ std.err  : num [1:59] 0.00121 0.00222 0.00359 0.00496 0.00628 ...
##  $ cumhaz   : num [1:59] 0.00661 0.02194 0.05585 0.10231 0.15719 ...
##  $ std.chaz : num [1:59] 0.00121 0.00221 0.00355 0.00487 0.00615 ...
##  $ type     : chr "right"
##  $ logse    : logi TRUE
##  $ conf.int : num 0.95
##  $ conf.type: chr "log"
##  $ lower    : num [1:59] 0.991 0.974 0.938 0.892 0.841 ...
##  $ upper    : num [1:59] 0.996 0.982 0.952 0.91 0.862 ...
##  $ call     : language survfit(formula = survobj ~ 1)
##  - attr(*, "class")= chr "survfit"
## NULL</code></pre>
<!-- ======================================================= -->
</div>
<div id="plotting-kaplan-meir-curves" class="section level3 unnumbered">
<h3>Plotting Kaplan-Meir curves<a class="anchor" aria-label="anchor" href="#plotting-kaplan-meir-curves"><i class="fas fa-link"></i></a>
</h3>
<p>Once the KM estimates are fitted, we can visualize that probability of being alive through the time using the basic <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function that draws the so-known “Kaplan-Meier curve”. In other words the curve below is a conventional illustration of the survival experience in the whole patient group.</p>
<p>We can easily verify the follow-up time min and max on the curve.</p>
<p>An easy way to interpret it is to say that at time zero, all the participants are still alive: survival probability is then 100%. Then it decreases over time as patients die. The proportion of participants surviving past 60 days of f-u is around 40%.</p>
<div class="sourceCode" id="cb1169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span>, 
     xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,    <span class="co">#xaxis label</span>
     ylab<span class="op">=</span><span class="st">"Survival Probability"</span>,   <span class="co">#yaxis label</span>
     main<span class="op">=</span> <span class="st">"Overall survival curve"</span> <span class="co">#figure title</span>
     <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-817-1.png" width="672"></div>
<p>The confidence interval of the KM estimates of the survival are also plotted by default and can be dismissed by adding the option <code>conf.int=FALSE</code> to the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> command.</p>
<p>Since the event of interest is “death”, drawing a curve describing the complements of the survival proportions will lead to drawing the cumulative mortality proportions.</p>
<div class="sourceCode" id="cb1170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
     <span class="va">linelistsurv_fit</span>,
     xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,       
     ylab<span class="op">=</span><span class="st">"Survival Probability"</span>,       
     mark.time<span class="op">=</span><span class="cn">TRUE</span>,              <span class="co">#mark times of events to facilitate reading of the curve: a "+" sign is printed on the curve at every event</span>
     conf.int<span class="op">=</span><span class="cn">FALSE</span>,             <span class="co">#do not plot the confidence interval</span>
     main<span class="op">=</span> <span class="st">"Overall survival curve and cumulative mortality"</span>
     <span class="op">)</span>



<span class="co">#draw an additional curve to the previous plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span> 
      <span class="va">linelistsurv_fit</span>, 
      lty<span class="op">=</span><span class="fl">3</span>,          <span class="co">#use a different line type to differenciate between the two curves and for legend clarity purposes</span>
      fun <span class="op">=</span> <span class="st">"event"</span>, <span class="co">#draw the cumulative events instead of the survival </span>
      mark.time<span class="op">=</span><span class="cn">FALSE</span>, 
      conf.int<span class="op">=</span><span class="cn">FALSE</span> 
      <span class="op">)</span>

<span class="co">#add a legend to the plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="co">#position of the legend in the plot</span>
       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Survival"</span>,<span class="st">"Cum. Mortality"</span><span class="op">)</span>, <span class="co">#legend text </span>
       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, <span class="co">#line types to use in the legend, should follow linetype used to draw the two curves</span>
       cex<span class="op">=</span><span class="fl">.85</span>, <span class="co">#factor that defines size of the legend text</span>
       bty <span class="op">=</span> <span class="st">"n"</span> <span class="co">#no box type to be drawn for the legend</span>
       <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-818-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="comparison-of-survival-curves" class="section level2" number="26.4">
<h2>
<span class="header-section-number">26.4</span> Comparison of survival curves<a class="anchor" aria-label="anchor" href="#comparison-of-survival-curves"><i class="fas fa-link"></i></a>
</h2>
<p>To compare the survival within different groups of our observed participants or patients, we might need to first look at their respective survival curves and then run tests to evaluate the difference between independent groups. This comparison can concern groups based on gender, age, treatment, comorbidity…</p>
<div id="log-rank-test" class="section level3 unnumbered">
<h3>Log rank test<a class="anchor" aria-label="anchor" href="#log-rank-test"><i class="fas fa-link"></i></a>
</h3>
<p>The log rank test is a popular test that compares the entire survival experience between two or more <em>independent</em> groups and can be thought of as a test of whether the survival curves are identical (overlapping) or not (null hypothesis of no difference in survival between the groups). The <code>survdiff()</code> function of the <strong>survival package</strong> allows running the log-rank test when we specify <code>rho=0</code> (which is the default). The test results gives a chi-square statistic along with a p-value since the log rank statistic is approximately distributed as a chi-square test statistic.</p>
<p>We first try to compare the survival curves by gender group. For this, we first try to visualize it (check whether the two survival curves are overlapping). A new <em>survfit object</em> will be created with a slightly different formula. Then the <em>survdiff object</em> will be created.</p>
<div class="sourceCode" id="cb1171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#create the new survfit object based on gender</span>
<span class="va">linelistsurv_fit_sex</span> <span class="op">&lt;-</span>  <span class="fu">survfit</span><span class="op">(</span>
  
              <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span>, <span class="co">#formula to create the survival curve: ~ gender indicates we no longer plot the overall survival but based on gender</span>
              data <span class="op">=</span> <span class="va">linelist_surv</span> <span class="co">#data to use </span>
              <span class="op">)</span>


<span class="co">#plot the survival curves by gender: have a look at the order of the strata level in the gender var before defining your colors</span>
<span class="va">col_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">linelistsurv_fit_sex</span>,
     col<span class="op">=</span><span class="va">col_sex</span>,
     xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>, 
     ylab<span class="op">=</span><span class="st">"Survival Probability"</span>
     <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, 
       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span>, 
       col <span class="op">=</span><span class="va">col_sex</span>,
       lty <span class="op">=</span> <span class="fl">1</span>, cex<span class="op">=</span><span class="fl">.9</span>, bty <span class="op">=</span> <span class="st">"n"</span> 
       <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/comp_surv-1.png" width="672"></div>
<div class="sourceCode" id="cb1172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#compute the test of the difference between the survival curves</span>
<span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survdiff.html">survdiff</a></span><span class="op">(</span>
          <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span>, 
          data <span class="op">=</span> <span class="va">linelist_surv</span>
         <span class="op">)</span></code></pre></div>
<pre><code>## Call:
## survival::survdiff(formula = Surv(futime, event) ~ gender, data = linelist_surv)
## 
## n=4321, 218 observations deleted due to missingness.
## 
##             N Observed Expected (O-E)^2/E (O-E)^2/V
## gender=f 2156      924      909     0.255     0.524
## gender=m 2165      929      944     0.245     0.524
## 
##  Chisq= 0.5  on 1 degrees of freedom, p= 0.5</code></pre>
<p>We see that the survival curve for women and the one for men overlap up to 15 days of follow-up and then women seem to have a slightly better survival. Yet the log-rank test does not gives enough evidence of a statistical difference between the survival for women and the survival for Men at <code>\alpha= 0.05</code>.</p>
<p>Some packages allow illustrating survival curves for different groups and testing the difference at once. Using the <code>ggsurvplot()</code> function from the <em>survminer</em> package, we can add in our curve the print of the risk tables for each group as well the p-value from the log-rank test.</p>
<p>We find back the p-value that was found in the previous step.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> <strong>survminer</strong> functions require since the latest versions, specifying again the data used to fit the survival object. Remember doing this to avoid non-specific error messages. </span></p>
<div class="sourceCode" id="cb1174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span>
  
    <span class="va">linelistsurv_fit_sex</span>, 
    data<span class="op">=</span> <span class="va">linelist_surv</span>, <span class="co">#precise again the data used to fit the linelistsurv_fit_sex even though it is already precised in that object</span>
    conf.int <span class="op">=</span> <span class="cn">F</span>, <span class="co">#do not show confidence interval of KM estimates</span>
    surv.scale <span class="op">=</span> <span class="st">"percent"</span>,  <span class="co">#present probabilities in the y axis in %</span>
    break.time.by<span class="op">=</span><span class="fl">10</span>, <span class="co">#present the time axis with an increment of 10 days</span>
    xlab <span class="op">=</span> <span class="st">"Follow-up days"</span>, ylab<span class="op">=</span> <span class="st">"Survival Probability"</span>,
    pval<span class="op">=</span><span class="cn">T</span>, pval.coord<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">.91</span><span class="op">)</span>,  <span class="co">#print p-value of Log-rank test and at the position with these coordinates</span>
    risk.table<span class="op">=</span><span class="cn">T</span>,  <span class="co">#print the risk table </span>
    legend.title <span class="op">=</span> <span class="st">"Gender"</span>,
    legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span>, font.legend <span class="op">=</span> <span class="fl">10</span>, <span class="co">#legend characteristics</span>
    palette <span class="op">=</span> <span class="st">"Dark2"</span>, <span class="co">#existing palette name precised,</span>
    surv.median.line <span class="op">=</span> <span class="st">"hv"</span>, <span class="co">#draw a line to the median survival</span>
    ggtheme <span class="op">=</span> <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-819-1.png" width="672"></div>
<p>We can then look for a difference in the source of the contamination. In this case, the Log rank test gives enough evidence of a difference in the survival probabilities at <code>\alpha= 0.005</code>.
The survival probabilities for patients that got infected in funerals are higher than the survival probabilities for patients that got infected in other places, suggesting a survival benefit.</p>
<div class="sourceCode" id="cb1175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelistsurv_fit_source</span> <span class="op">&lt;-</span>  <span class="fu">survfit</span><span class="op">(</span>
              <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">source</span>,
              data <span class="op">=</span> <span class="va">linelist_surv</span>
              <span class="op">)</span>

<span class="fu">ggsurvplot</span><span class="op">(</span> 
      <span class="va">linelistsurv_fit_source</span>, data<span class="op">=</span> <span class="va">linelist_surv</span>,
      size<span class="op">=</span><span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"strata"</span>,
      conf.int <span class="op">=</span> <span class="cn">T</span>, 
      surv.scale <span class="op">=</span> <span class="st">"percent"</span>,  
      break.time.by<span class="op">=</span><span class="fl">10</span>, 
      xlab <span class="op">=</span> <span class="st">"Follow-up days"</span>, ylab<span class="op">=</span> <span class="st">"Survival Probability"</span>,
      pval<span class="op">=</span><span class="cn">T</span>, pval.coord<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">.91</span><span class="op">)</span>,  
      risk.table<span class="op">=</span><span class="cn">T</span>,
      legend.title <span class="op">=</span> <span class="st">"Source of \ninfection"</span>, legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Funeral"</span>,<span class="st">"Other"</span><span class="op">)</span>, 
      font.legend <span class="op">=</span> <span class="fl">10</span>,
      palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#E7B800"</span>,<span class="st">"#3E606F"</span><span class="op">)</span>,
      surv.median.line <span class="op">=</span> <span class="st">"hv"</span>, 
      ggtheme <span class="op">=</span> <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-820-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="cox-regression-analysis" class="section level2" number="26.5">
<h2>
<span class="header-section-number">26.5</span> Cox regression analysis<a class="anchor" aria-label="anchor" href="#cox-regression-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>Cox proportional hazards regression is one of the most popular regression techniques for survival analysis. Other models can also be used since the Cox model requires <em>important assumptions</em> that need to be verified for an appropriate use such as the proportional hazards assumption: see references.</p>
<p>In a Cox proportional hazards regression model, the measure of effect is the <strong><em>hazard rate</em></strong> (HR), which is the risk of failure (or the risk of death in our example), given that the participant has survived up to a specific time. Usually, we are interested in comparing <em>independent</em> groups with respect to their hazards, and we use a hazard ratio, which is analogous to an odds ratio in the setting of multiple logistic regression analysis. The <code>cox.ph()</code> from the <strong>survival</strong> package is used to fit the model.
The function <code>cox.zph()</code> from <strong>survival</strong> package may be used to test the proportional hazards assumption for a Cox regression model fit.</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> A probability must lie in the range 0 to 1. However, the hazard represents the expected number of events per one unit of time.</span></p>
<ul>
<li>If the hazard ratio for a predictor is close to 1 then that predictor does not affect survival,</li>
<li>if the HR is less than 1, then the predictor is protective (i.e., associated with improved survival),</li>
<li>and if the HR is greater than 1, then the predictor is associated with increased risk (or decreased survival).</li>
</ul>
<div id="fitting-a-cox-model" class="section level3 unnumbered">
<h3>Fitting a Cox model<a class="anchor" aria-label="anchor" href="#fitting-a-cox-model"><i class="fas fa-link"></i></a>
</h3>
<p>We can first fit a model to assess the effect of age and gender on the survival. By just printing the model, we have the information on:</p>
<ul>
<li>the estimated regression coefficients (<code>coef</code>) which quantifies the association between the predictors and the outcome,</li>
<li>their exponential (for interpretability, <code><a href="https://rdrr.io/r/base/Log.html">exp(coef)</a></code>) which produces the <em>hazard ratio</em>,</li>
<li>their standard error (<code>se(coef)</code>),</li>
<li>the z-score: how many standard errors is the estimated coefficient away from 0,</li>
<li>and the p-value: the propability that the estimated coefficient could be 0.</li>
</ul>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function applied to the cox model object gives more info such as the confidence interval of the estimated HR and the different test scores.</p>
<p>The effect of the first covariate <code>gender</code> is presented in the first row. <code>genderm</code> is printed stating that the first strata level (“f”) i.e the female group is the reference group for the gender. Thus the interpretation of the test parameter is that of men compared to women. The p-value indicates there was no enough evidence of an effect of the gender on the expected hazard or of an association between gender and all-cause mortality.</p>
<p>The same lack of evidence is noted regarding age-group.</p>
<div class="sourceCode" id="cb1176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#fitting the cox model</span>
<span class="va">linelistsurv_cox_sexage</span> <span class="op">&lt;-</span>  <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span>
              <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age_cat_small</span>, 
              data <span class="op">=</span> <span class="va">linelist_surv</span>
              <span class="op">)</span>


<span class="co">#printing the model fitted</span>
<span class="va">linelistsurv_cox_sexage</span></code></pre></div>
<pre><code>## Call:
## survival::coxph(formula = Surv(futime, event) ~ gender + age_cat_small, 
##     data = linelist_surv)
## 
##                       coef exp(coef) se(coef)      z     p
## genderm           -0.03149   0.96900  0.04767 -0.661 0.509
## age_cat_small5-19  0.09400   1.09856  0.06454  1.456 0.145
## age_cat_small20+   0.05032   1.05161  0.06953  0.724 0.469
## 
## Likelihood ratio test=2.8  on 3 df, p=0.4243
## n= 4321, number of events= 1853 
##    (218 observations deleted due to missingness)</code></pre>
<div class="sourceCode" id="cb1178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#summary of the model</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_cox_sexage</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## survival::coxph(formula = Surv(futime, event) ~ gender + age_cat_small, 
##     data = linelist_surv)
## 
##   n= 4321, number of events= 1853 
##    (218 observations deleted due to missingness)
## 
##                       coef exp(coef) se(coef)      z Pr(&gt;|z|)
## genderm           -0.03149   0.96900  0.04767 -0.661    0.509
## age_cat_small5-19  0.09400   1.09856  0.06454  1.456    0.145
## age_cat_small20+   0.05032   1.05161  0.06953  0.724    0.469
## 
##                   exp(coef) exp(-coef) lower .95 upper .95
## genderm               0.969     1.0320    0.8826     1.064
## age_cat_small5-19     1.099     0.9103    0.9680     1.247
## age_cat_small20+      1.052     0.9509    0.9176     1.205
## 
## Concordance= 0.514  (se = 0.007 )
## Likelihood ratio test= 2.8  on 3 df,   p=0.4
## Wald test            = 2.78  on 3 df,   p=0.4
## Score (logrank) test = 2.78  on 3 df,   p=0.4</code></pre>
<p>It was interesting to run the model and look at the results but a first look to verify whether the proportional hazards assumptions is respected could help saving time.</p>
<div class="sourceCode" id="cb1180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_ph_sexage</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cox.zph.html">cox.zph</a></span><span class="op">(</span><span class="va">linelistsurv_cox_sexage</span><span class="op">)</span>
<span class="va">test_ph_sexage</span></code></pre></div>
<pre><code>##               chisq df    p
## gender        0.454  1 0.50
## age_cat_small 0.838  2 0.66
## GLOBAL        1.399  3 0.71</code></pre>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> A second argument called <em>method</em> can be specified when computing the cox model. It is the determines how ties are handled. The <em>default</em> is “efron”, and the other options are “breslow” and “exact”.</span></p>
<p>In another model we add more risk factors such as the source of infection and the number of days between date of onset and admission. This time, we first verify the proportional hazards assumption before going forward.</p>
<p>In this model, we have included a continuous predictor (<code>days_onset_hosp</code>). In this case we interpret the parameter estimates as the increase in the expected log of the relative hazard for each one unit increase in the predictor, holding other predictors constant. We first verify the proportional hazards assumption. The graphical verification of this assumption may be performed with the function <code>ggcoxzph()</code> from the <em>survminer</em> package.</p>
<div class="sourceCode" id="cb1182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#fit the model</span>
<span class="va">linelistsurv_cox</span> <span class="op">&lt;-</span>  <span class="fu">coxph</span><span class="op">(</span>
                        <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age_years</span><span class="op">+</span> <span class="va">source</span> <span class="op">+</span> <span class="va">days_onset_hosp</span>,
                        data <span class="op">=</span> <span class="va">linelist_surv</span>
                        <span class="op">)</span>


<span class="co">#test the proportional hazard model</span>
<span class="va">linelistsurv_ph_test</span> <span class="op">&lt;-</span> <span class="fu">cox.zph</span><span class="op">(</span><span class="va">linelistsurv_cox</span><span class="op">)</span>
<span class="va">linelistsurv_ph_test</span></code></pre></div>
<pre><code>##                    chisq df       p
## gender           0.45062  1    0.50
## age_years        0.00199  1    0.96
## source           1.79622  1    0.18
## days_onset_hosp 31.66167  1 1.8e-08
## GLOBAL          34.08502  4 7.2e-07</code></pre>
<div class="sourceCode" id="cb1184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggcoxzph.html">ggcoxzph</a></span><span class="op">(</span><span class="va">linelistsurv_ph_test</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/coxmodel_fit_ph-1.png" width="672"></div>
<p>The model results indicates there is a negative association between onset to admission duration and all-cause mortality. The expected hazard is 0.9 times lower in a person who who is one day later admitted than another, holding gender constant. Or in a more straightforward explanation, a one unit increase in the duration of onset to admission is associated with a 10.7% (<code>coef *100</code>) decrease in the risk of death.</p>
<p>Results show also a positive association between the source of infection and the all-cause mortality. Which is to say there is an increased risk of death (1.21x) for patients that got a source of infection other than funerals.</p>
<div class="sourceCode" id="cb1185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print the summary of the model</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_cox</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(futime, event) ~ gender + age_years + source + 
##     days_onset_hosp, data = linelist_surv)
## 
##   n= 2772, number of events= 1180 
##    (1767 observations deleted due to missingness)
## 
##                      coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
## genderm          0.004710  1.004721  0.060827  0.077   0.9383    
## age_years       -0.002249  0.997753  0.002421 -0.929   0.3528    
## sourceother      0.178393  1.195295  0.084291  2.116   0.0343 *  
## days_onset_hosp -0.104063  0.901169  0.014245 -7.305 2.77e-13 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
##                 exp(coef) exp(-coef) lower .95 upper .95
## genderm            1.0047     0.9953    0.8918    1.1319
## age_years          0.9978     1.0023    0.9930    1.0025
## sourceother        1.1953     0.8366    1.0133    1.4100
## days_onset_hosp    0.9012     1.1097    0.8764    0.9267
## 
## Concordance= 0.566  (se = 0.009 )
## Likelihood ratio test= 71.31  on 4 df,   p=1e-14
## Wald test            = 59.22  on 4 df,   p=4e-12
## Score (logrank) test = 59.54  on 4 df,   p=4e-12</code></pre>
<!-- ======================================================= -->
</div>
<div id="forest-plots" class="section level3 unnumbered">
<h3>Forest plots<a class="anchor" aria-label="anchor" href="#forest-plots"><i class="fas fa-link"></i></a>
</h3>
<p>We can then visualize the results of the cox model using the practical forest plots with the <code>ggforest()</code> function of the <strong>survminer package</strong>.</p>
<div class="sourceCode" id="cb1187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggforest</span><span class="op">(</span><span class="va">linelistsurv_cox</span>, data <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/forestp-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="time-dependent-covariates-in-survival-models" class="section level2" number="26.6">
<h2>
<span class="header-section-number">26.6</span> Time-dependent covariates in survival models<a class="anchor" aria-label="anchor" href="#time-dependent-covariates-in-survival-models"><i class="fas fa-link"></i></a>
</h2>
<p>Some of the following sections have been adapted with permission from an excellent <a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">introduction to survival analysis in R</a> by <a href="https://www.emilyzabor.com/">Dr. Emily Zabor</a></p>
<p>In the last section we covered using Cox regression to examine associations between covariates of interest and survival outcomes.But these analyses rely on the covariate being measured at baseline, that is, before follow-up time for the event begins.</p>
<p>What happens if you are interested in a covariate that is measured <strong>after</strong> follow-up time begins? Or, what if you have a covariate that can change over time?</p>
<p>For example, maybe you are working with clinical data where you repeated measures of hospital laboratory values that can change over time. This is an example of a <strong>Time Dependent Covariate</strong>. In order to address this you need a special setup, but fortunately the cox model is very flexible and this type of data can also be modeled with tools from the <strong>survival</strong> package.</p>
<div id="time-dependent-covariate-setup" class="section level3 unnumbered">
<h3>Time-dependent covariate setup<a class="anchor" aria-label="anchor" href="#time-dependent-covariate-setup"><i class="fas fa-link"></i></a>
</h3>
<p>Analysis of time-dependent covariates in R requires setup of a special dataset. If interested, see the more detailed paper on this by the author of the <strong>survival</strong> package <a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf">Using Time Dependent Covariates and Time Dependent Coefficients in the Cox Model</a>.</p>
<p>For this, we’ll use a new dataset from the <code>SemiCompRisks</code> package named <code>BMT</code>, which includes data on 137 bone marrow transplant patients. The variables we’ll focus on are:</p>
<ul>
<li>
<code>T1</code> - time (in days) to death or last follow-up<br>
</li>
<li>
<code>delta1</code> - death indicator; 1-Dead, 0-Alive<br>
</li>
<li>
<code>TA</code> - time (in days) to acute graft-versus-host disease<br>
</li>
<li>
<code>deltaA</code> - acute graft-versus-host disease indicator;
<ul>
<li>1 - Developed acute graft-versus-host disease<br>
</li>
<li>0 - Never developed acute graft-versus-host disease</li>
</ul>
</li>
</ul>
<p>We’ll load this dataset from the <strong>survival</strong> package using the <strong>base</strong> R command <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code>, which can be used for loading data that is already included in a R package that is loaded. The data frame <code>BMT</code> will appear in your R environment.</p>
<div class="sourceCode" id="cb1188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">BMT</span>, package <span class="op">=</span> <span class="st">"SemiCompRisks"</span><span class="op">)</span></code></pre></div>
<div id="add-unique-patient-identifier" class="section level4 unnumbered">
<h4>Add unique patient identifier<a class="anchor" aria-label="anchor" href="#add-unique-patient-identifier"><i class="fas fa-link"></i></a>
</h4>
<p>There is no unique ID column in the <code>BMT</code> data, which is needed to create the type of dataset we want. So we use the function <code>rowid_to_column()</code> from the <strong>tidyverse</strong> package <strong>tibble</strong> to create a new id column called <code>my_id</code> (adds column at start of data frame with sequential row ids, starting at 1). We name the data frame <code>bmt</code>.</p>
<div class="sourceCode" id="cb1189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bmt</span> <span class="op">&lt;-</span> <span class="fu">rowid_to_column</span><span class="op">(</span><span class="va">BMT</span>, <span class="st">"my_id"</span><span class="op">)</span></code></pre></div>
<p>The dataset now looks like this:</p>
<div id="htmlwidget-4226dcb6990ee855cf01" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4226dcb6990ee855cf01">{"x":{"filter":"none","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[2081,1602,1496,1462,1433,1377,1330,996,226,1199,1111,530,1182,1167,418,417,276,156,781,172,487,716,194,371,526,122,1279,110,243,86,466,262,162,262,1,107,269,350,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,2246,1870,1799,1709,1674,1568,1527,1324,957,932,847,848,1850,1843,1535,1447,1384,414,2204,1063,481,105,641,390,288,522,79,1156,583,48,431,1074,393,10,53,80,35,1499,704,653,222,1356,2640,2430,2252,2140,2133,1238,1631,2024,1345,1136,845,491,162,1298,121,2,62,265,547,341,318,195,469,93,515,183,105,128,164,129,122,80,677,73,168,74,16,248,732,105,392,63,97,153,363],[2081,1602,1496,1462,1433,1377,1330,996,226,1199,1111,530,1182,1167,418,383,276,104,609,172,487,662,194,230,526,122,129,74,122,86,466,192,109,55,1,107,110,332,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,2246,1870,1799,1709,1674,1568,1527,1324,957,932,847,848,1850,1843,1535,1447,1384,414,2204,1063,481,105,641,390,288,421,79,748,486,48,272,1074,381,10,53,80,35,248,704,211,219,606,2640,2430,2252,2140,2133,1238,1631,2024,1345,1136,845,422,162,84,100,2,47,242,456,268,318,32,467,47,390,183,105,115,164,93,120,80,677,64,168,74,16,157,625,48,273,63,76,113,363],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,0,1,0,0,1,1,1,0,0,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,1,0,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,1,1,1,0,1,1,1,1,0,0,1,0,1,1,0,0,1,0,0,0,1,1,1,1,0,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[67,1602,1496,70,1433,1377,1330,72,226,1199,1111,38,1182,39,418,417,276,28,781,22,487,716,194,371,526,88,1279,110,243,86,466,10,162,262,1,107,269,350,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,52,1870,1799,20,1674,1568,1527,25,957,29,847,848,1850,1843,1535,1447,1384,414,2204,1063,30,21,641,390,18,25,16,1156,583,48,431,1074,393,10,53,10,35,1499,36,653,222,1356,2640,2430,2252,2140,2133,1238,1631,2024,32,1136,845,491,162,1298,28,2,62,265,547,21,318,195,469,93,515,183,105,128,164,129,122,21,677,73,168,29,16,248,732,105,392,38,97,153,363],[1,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0],[121,139,307,95,236,123,96,121,226,91,1111,84,112,487,220,417,81,156,781,172,76,716,94,184,121,122,1279,110,243,86,119,84,162,262,1,107,120,350,2569,2506,2409,2218,260,1829,1562,180,200,210,860,120,380,230,140,348,1674,1568,1527,1324,957,932,847,155,1850,1843,1535,220,200,414,2204,240,120,105,641,390,100,140,79,180,583,48,431,120,100,10,53,80,35,1499,155,653,123,1356,2640,2430,150,220,250,250,150,180,360,140,845,180,162,1298,121,2,62,210,130,100,140,195,90,93,515,130,105,128,164,129,122,80,150,73,200,74,16,100,732,105,122,63,97,153,363],[1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,0,0,0,1,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,0,1,0,0,0,1,1,0,0,0,0,0,1,0,1,0,0,0,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,1,0,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,0,0,0],[13,18,12,13,12,12,17,12,10,29,22,34,22,1167,21,16,21,20,26,37,22,17,25,9,11,13,22,49,23,86,100,59,40,24,1,107,27,33,21,17,16,11,15,19,18,14,12,14,15,66,15,16,12,19,24,14,13,15,69,7,16,16,9,19,21,24,19,27,12,16,24,15,11,11,288,20,79,18,11,14,12,19,16,10,53,80,35,9,18,23,52,14,22,14,17,18,17,18,40,16,14,15,20,491,13,1298,65,2,11,14,24,17,12,16,20,28,31,21,105,12,164,51,12,0,8,38,48,24,16,52,18,30,24,16,97,59,19],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1],[26,21,26,17,32,22,20,22,18,24,19,17,24,27,18,15,18,20,27,40,22,28,26,39,15,20,17,28,37,17,15,29,36,23,42,30,29,22,19,31,35,16,29,19,26,27,13,25,25,30,45,33,32,23,37,15,22,46,18,27,28,23,37,34,35,33,21,21,25,50,35,37,26,50,45,28,43,14,17,32,30,30,33,34,33,30,23,35,29,23,28,33,18,29,35,27,36,24,27,35,50,47,40,22,22,8,39,20,27,32,31,20,35,36,35,7,23,11,14,37,19,37,25,35,15,45,32,41,27,33,39,17,43,44,48,31,52],[33,37,35,21,36,31,17,24,21,40,28,28,23,22,14,20,5,33,27,37,20,32,32,31,20,26,20,25,38,26,18,32,43,16,48,19,20,20,13,34,31,16,35,18,30,34,24,29,31,16,39,30,23,28,34,19,12,31,17,30,29,26,36,32,32,28,18,15,19,38,36,34,24,48,43,30,43,19,14,33,23,32,28,54,41,35,25,18,21,16,30,22,23,26,31,17,39,28,21,41,36,27,39,21,23,2,48,19,25,32,28,23,40,39,33,2,25,7,18,35,32,34,29,28,14,42,43,29,36,39,43,14,50,37,56,25,48],[1,1,1,0,1,1,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0,1,1,0,1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,0,0,0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,1,0,1,1,1,1,1,0,0,1,0,1,1,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,0,1],[0,1,1,1,1,1,0,0,1,1,1,1,0,1,1,1,0,1,0,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,0,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1],[1,0,1,0,1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,1,0,1,0,1,1,0,0,0,1,0,1,1,0,1,1,1,0,0,1,1,0,0,0,1,1,1,0,1,0,1,0,0,1,0,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1],[1,0,0,0,1,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,0,0,0,1,0,1,0,0,1,0,0,0,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,0,0,0,0,1,1,0,1,0,1,1,0,1,1,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0],[98,1720,127,168,93,2187,1006,1319,208,174,236,151,203,191,110,824,146,85,187,129,128,84,329,147,943,2616,937,303,170,239,508,74,393,331,196,178,361,834,270,60,120,60,90,210,90,240,90,210,180,180,105,225,120,90,60,90,450,75,90,60,75,180,180,270,180,150,120,120,60,270,90,120,90,120,90,90,90,60,120,150,120,150,120,240,180,150,150,30,105,90,120,210,750,24,120,210,240,240,690,105,120,900,210,210,300,105,210,75,90,180,630,180,300,90,120,135,210,120,150,270,285,240,510,780,150,180,150,750,180,180,150,210,240,360,330,240,180],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,0,0,0,1,0,0,1,0,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,0,1,0,0,0],[1,1,1,1,1,1,1,1,1,3,3,3,2,2,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,4,4,4,3,3,1,1,1,1,1,1,2,4,4,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,4,4,4,4,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>my_id<\/th>\n      <th>g<\/th>\n      <th>T1<\/th>\n      <th>T2<\/th>\n      <th>delta1<\/th>\n      <th>delta2<\/th>\n      <th>delta3<\/th>\n      <th>TA<\/th>\n      <th>deltaA<\/th>\n      <th>TC<\/th>\n      <th>deltaC<\/th>\n      <th>TP<\/th>\n      <th>deltaP<\/th>\n      <th>Z1<\/th>\n      <th>Z2<\/th>\n      <th>Z3<\/th>\n      <th>Z4<\/th>\n      <th>Z5<\/th>\n      <th>Z6<\/th>\n      <th>Z7<\/th>\n      <th>Z8<\/th>\n      <th>Z9<\/th>\n      <th>Z10<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="expand-patient-rows" class="section level4 unnumbered">
<h4>Expand patient rows<a class="anchor" aria-label="anchor" href="#expand-patient-rows"><i class="fas fa-link"></i></a>
</h4>
<p>Next, we’ll use the <code>tmerge()</code> function with the <code>event()</code> and <code>tdc()</code> helper functions to create the restructured dataset. Our goal is to restructure the dataset to create a separate row for each patient for each time interval where they have a different value for <code>deltaA</code>. In this case, each patient can have at most two rows depending on whether they developed acute graft-versus-host disease during the data collection period. We’ll call our new indicator for the development of acute graft-versus-host disease <code>agvhd</code>.</p>
<ul>
<li>
<code>tmerge()</code> creates a long dataset with multiple time intervals for the different covariate values for each patient</li>
<li>
<code>event()</code> creates the new event indicator to go with the newly-created time intervals</li>
<li>
<code>tdc()</code> creates the time-dependent covariate column, <code>agvhd</code>, to go with the newly created time intervals</li>
</ul>
<div class="sourceCode" id="cb1190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">td_dat</span> <span class="op">&lt;-</span> 
  <span class="fu">tmerge</span><span class="op">(</span>
    data1 <span class="op">=</span> <span class="va">bmt</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span><span class="op">)</span>, 
    data2 <span class="op">=</span> <span class="va">bmt</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span>, <span class="va">TA</span>, <span class="va">deltaA</span><span class="op">)</span>, 
    id <span class="op">=</span> <span class="va">my_id</span>, 
    death <span class="op">=</span> <span class="fu">event</span><span class="op">(</span><span class="va">T1</span>, <span class="va">delta1</span><span class="op">)</span>,
    agvhd <span class="op">=</span> <span class="fu">tdc</span><span class="op">(</span><span class="va">TA</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>To see what this does, let’s look at the data for the first 5 individual patients.</p>
<p>The variables of interest in the original data looked like this:</p>
<div class="sourceCode" id="cb1191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bmt</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span>, <span class="va">TA</span>, <span class="va">deltaA</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">my_id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   my_id   T1 delta1   TA deltaA
## 1     1 2081      0   67      1
## 2     2 1602      0 1602      0
## 3     3 1496      0 1496      0
## 4     4 1462      0   70      1
## 5     5 1433      0 1433      0</code></pre>
<p>The new dataset for these same patients looks like this:</p>
<div class="sourceCode" id="cb1193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">td_dat</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">my_id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   my_id   T1 delta1 tstart tstop death agvhd
## 1     1 2081      0      0    67     0     0
## 2     1 2081      0     67  2081     0     1
## 3     2 1602      0      0  1602     0     0
## 4     3 1496      0      0  1496     0     0
## 5     4 1462      0      0    70     0     0
## 6     4 1462      0     70  1462     0     1
## 7     5 1433      0      0  1433     0     0</code></pre>
<p>Now some of our patients have two rows in the dataset corresponding to intervals where they have a different value of our new variable, <code>agvhd</code>. For example, Patient 1 now has two rows with a <code>agvhd</code> value of zero from time 0 to time 67, and a value of 1 from time 67 to time 2081.</p>
</div>
</div>
<div id="cox-regression-with-time-dependent-covariates" class="section level3 unnumbered">
<h3>Cox regression with time-dependent covariates<a class="anchor" aria-label="anchor" href="#cox-regression-with-time-dependent-covariates"><i class="fas fa-link"></i></a>
</h3>
<p>Now that we’ve reshaped our data and added the new time-dependent <code>aghvd</code> variable, let’s fit a simple single variable cox regression model. We can use the same <code>coxph()</code> function as before, we just need to change our <code>Surv()</code> function to specify both the start and stop time for each interval using the <code>time1 =</code> and <code>time2 =</code> arguments.</p>
<div class="sourceCode" id="cb1195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bmt_td_model</span> <span class="op">=</span> <span class="fu">coxph</span><span class="op">(</span>
  <span class="fu">Surv</span><span class="op">(</span>time <span class="op">=</span> <span class="va">tstart</span>, time2 <span class="op">=</span> <span class="va">tstop</span>, event <span class="op">=</span> <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="va">agvhd</span>, 
  data <span class="op">=</span> <span class="va">td_dat</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bmt_td_model</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(time = tstart, time2 = tstop, event = death) ~ 
##     agvhd, data = td_dat)
## 
##   n= 163, number of events= 80 
## 
##         coef exp(coef) se(coef)    z Pr(&gt;|z|)
## agvhd 0.3351    1.3980   0.2815 1.19    0.234
## 
##       exp(coef) exp(-coef) lower .95 upper .95
## agvhd     1.398     0.7153    0.8052     2.427
## 
## Concordance= 0.535  (se = 0.024 )
## Likelihood ratio test= 1.33  on 1 df,   p=0.2
## Wald test            = 1.42  on 1 df,   p=0.2
## Score (logrank) test = 1.43  on 1 df,   p=0.2</code></pre>
<p>Again, we’ll visualize our cox model results using the <code>ggforest()</code> function from the <strong>survminer package</strong>.:</p>
<div class="sourceCode" id="cb1197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggforest</span><span class="op">(</span><span class="va">bmt_td_model</span>, data <span class="op">=</span> <span class="va">td_dat</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-828-1.png" width="672"></div>
<p>As you can see from the forest plot, confidence interval, and p-value, there does not appear to be a strong association between death and acute graft-versus-host disease in the context of our simple model.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-19" class="section level2" number="26.7">
<h2>
<span class="header-section-number">26.7</span> Resources<a class="anchor" aria-label="anchor" href="#resources-19"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2394262/">Survival Analysis Part I: Basic concepts and first analyses</a></p>
<p><a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">Survival Analysis in R</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2954271/">Survival analysis in infectious disease research: Describing events in time</a></p>
<p><a href="https://data.princeton.edu/wws509/notes/c7.pdf">Chapter on advanced survival models Princeton</a></p>
<p><a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf">Using Time Dependent Covariates and Time Dependent Coefficients in the Cox Model</a></p>
<p><a href="https://publicifsv.sund.ku.dk/~ts/survival/survival-cheat.pdf">Survival analysis cheatsheet R</a></p>
<p><a href="https://paulvanderlaken.files.wordpress.com/2017/08/survminer_cheatsheet.pdf">Survminer cheastsheet</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6322561/">Paper on different survival measures for cancer registry data with Rcode provided as supplementary materials</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="survey-analysis.html"><span class="header-section-number">25</span> Survey analysis</a></div>
<div class="next"><a href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#survival-analysis"><span class="header-section-number">26</span> Survival analysis</a></li>
<li><a class="nav-link" href="#overview-9"><span class="header-section-number">26.1</span> Overview</a></li>
<li>
<a class="nav-link" href="#preparation-17"><span class="header-section-number">26.2</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-packages-15">Load packages</a></li>
<li><a class="nav-link" href="#import-dataset">Import dataset</a></li>
<li><a class="nav-link" href="#data-management-and-transformation">Data management and transformation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#basics-of-survival-analysis"><span class="header-section-number">26.3</span> Basics of survival analysis</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#building-a-surv-type-object">Building a surv-type object</a></li>
<li><a class="nav-link" href="#running-initial-analyses">Running initial analyses</a></li>
<li><a class="nav-link" href="#plotting-kaplan-meir-curves">Plotting Kaplan-Meir curves</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#comparison-of-survival-curves"><span class="header-section-number">26.4</span> Comparison of survival curves</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#log-rank-test">Log rank test</a></li></ul>
</li>
<li>
<a class="nav-link" href="#cox-regression-analysis"><span class="header-section-number">26.5</span> Cox regression analysis</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#fitting-a-cox-model">Fitting a Cox model</a></li>
<li><a class="nav-link" href="#forest-plots">Forest plots</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#time-dependent-covariates-in-survival-models"><span class="header-section-number">26.6</span> Time-dependent covariates in survival models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#time-dependent-covariate-setup">Time-dependent covariate setup</a></li>
<li><a class="nav-link" href="#cox-regression-with-time-dependent-covariates">Cox regression with time-dependent covariates</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-19"><span class="header-section-number">26.7</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-04-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
