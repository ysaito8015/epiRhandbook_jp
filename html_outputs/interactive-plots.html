<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>39 Interactive plots | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="interactive-plots" class="section level1" number="39">
<h1><span class="header-section-number">39</span> Interactive plots</h1>
<p>Data visualisation is increasingly required to be interrogable by the audience. Consequently, is is becoming common to create interactive plots. There are several ways to include these but the two most common are <strong>plotly</strong> and <strong>shiny</strong>.</p>
<p>In this page we will focus on converting an existing <code>ggplot()</code> plot into an interactive plot with <strong>plotly</strong>. You can read more about <strong>shiny</strong> in the <a href="dashboards-with-shiny.html#dashboards-with-shiny">Dashboards with Shiny</a> page. What is worth mentioning is that interactive plots are only useable in HTML format R markdown documents, not PDF or Word documents.</p>
<p>Below is a basic epicurve that has been transformed to be interactive using the integration of <strong>ggplot2</strong> and <strong>plotly</strong> (hover your mouse over the plot, zoom in, or click items in the legend).</p>
<!-- ======================================================= -->
<div id="preparation-32" class="section level2" number="39.1">
<h2><span class="header-section-number">39.1</span> Preparation</h2>
<div id="load-packages-29" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code>library()</code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
</div>
<div id="start-with-a-ggplot" class="section level3 unnumbered">
<h3>Start with a <code>ggplot()</code></h3>
<p>In this page we assume that you are beginning with a <code>ggplot()</code> plot that you want to convert to be interactive. We will build several of these plots in this page, using the case <code>linelist</code> used in many pages of this handbook.</p>
</div>
<div id="import-data-25" class="section level3 unnumbered">
<h3>Import data</h3>
<p>To begin, we import the cleaned linelist of cases from a simulated Ebola epidemic. If you want to follow along, <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>click to download the “clean” linelist</a> (as .rds file). Import data with the <code>import()</code> function from the <strong>rio</strong> package (it handles many file types like .xlsx, .csv, .rds - see the <a href="import-and-export.html#import-and-export">Import and export</a> page for details).</p>
<p>The first 50 rows of the linelist are displayed below.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="plot-with-ggplotly" class="section level2" number="39.2">
<h2><span class="header-section-number">39.2</span> Plot with <code>ggplotly()</code></h2>
<p>The function <code>ggplotly()</code> from the <strong>plotly</strong> package makes it easy to convert a <code>ggplot()</code> to be interactive. Simply save your <code>ggplot()</code> and then pipe it to the <code>ggplotly()</code> function.</p>
<p>Below, we plot a simple line representing the proportion of cases who died in a given week:</p>
<p>We begin by creating a summary dataset of each epidemiological week, and the percent of cases with a known outcome that died.</p>
<p>Here is the first 50 rows of the <code>weekly_deaths</code> dataset.</p>
<p>Then we create the plot with <strong>ggplot2</strong>, using <code>geom_line()</code>.</p>
<p>We can make this interactive by simply passing this plot to <code>ggplotly()</code>, as below. Hover your mouse over the line to show the x and y values. You can zoom in on the plot, and drag it around. You can also see icons in the upper-right of the plot. In order, they allow you to:</p>
<ul>
<li>Download the current view as a PNG image<br />
</li>
<li>Zoom in with a select box<br />
</li>
<li>“Pan”, or move across the plot by clicking and dragging the plot<br />
</li>
<li>Zoom in, zoom out, or return to default zoom<br />
</li>
<li>Reset axes to defaults<br />
</li>
<li>Toggle on/off “spike lines” which are dotted lines from the interactive point extending to the x and y axes<br />
</li>
<li>Adjustments to whether data show when you are not hovering on the line</li>
</ul>
<p>Grouped data work with <code>ggplotly()</code> as well. Below, a weekly epicurve is made, grouped by outcome. The stacked bars are interactive. Try clicking on the different items in the legend (they will appear/disappear).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="interactive-plots.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot interactively  </span></span>
<span id="cb10-2"><a href="interactive-plots.html#cb10-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">%&gt;%</span> plotly<span class="sc">::</span><span class="fu">ggplotly</span>()</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="modifications" class="section level2" number="39.3">
<h2><span class="header-section-number">39.3</span> Modifications</h2>
<div id="file-size" class="section level3 unnumbered">
<h3>File size</h3>
<p>When exporting in an R Markdown generated HTML (like this book!) you want to make the plot as small data size as possible (with no negative side effects in most cases). For this, just pipe the interactive plot to <code>partial_bundle()</code>, also from <strong>plotly</strong>.</p>
</div>
<div id="buttons" class="section level3 unnumbered">
<h3>Buttons</h3>
<p>Some of the buttons on a standard plotly are superfluous and can be distracting, so you can remove them. You can do this simply by piping the output into <code>config()</code> from <strong>plotly</strong> and specifying which buttons to remove. In the below example we specify in advance the names of the buttons to remove, and provide them to the argument <code>modeBarButtonsToRemove =</code>. We also set <code>displaylogo = FALSE</code> to remove the plotly logo.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="heat-tiles" class="section level2" number="39.4">
<h2><span class="header-section-number">39.4</span> Heat tiles</h2>
<p>You can make almost any <code>ggplot()</code> plot interactive, including heat tiles. In the page on <a href="heat-plots.html#heat-plots">Heat plots</a> you can read about how to make the below plot, which displays the proportion of days per week that certain facilities reported data to their province.</p>
<p>Here is the code, although we will not describe it in depth here.</p>
<p>Below, we make it interactive and modify it for simple buttons and file size.</p>
<!-- ## Maps {.unnumbered}   -->
<!-- You can also make `ggplot()` GIS maps interactive, although it makes a bit more care.  -->
<!-- THIS SECTION IS UNDER CONSTRUCTION  -->
<!-- Although **plotly** works well with `ggplot2::geom_sf` in RStudio, when you try to include its outputs in R Markdown HTML files (like this book), it doesn't work well.   -->
<!-- So instead you can use {**plotly**}'s own mapping tools which can be tricky but are easy when you know how. Read on...   -->
<!-- We're going to use Covid-19 incidence across African countries for this example. The data used can be found on the [World Health Organisation website](https://covid19.who.int/table).   -->
<!-- You'll also need a new type of file, a GeoJSON, which is sort of similar to a shp file for those familiar with GIS. For this book, we used one from [here](https://geojson-maps.ash.ms).   -->
<!-- GeoJSON files are stored in R as complex lists and you'll need to maipulate them a little. -->
<!-- ```{r, echo=T,} -->
<!-- ## You need two new packages: {rjson} and {purrr} -->
<!-- pacman::p_load(plotly, rjson, purrr) -->
<!-- ## This is a simplified version of the WHO data -->
<!-- df <- rio::import(here::here("data", "gis", "covid_incidence.csv")) -->
<!-- ## Load your geojson file -->
<!-- geoJSON <- rjson::fromJSON(file=here::here("data", "gis", "africa_countries.geo.json")) -->
<!-- ## Here are some of the properties for each element of the object -->
<!-- head(geoJSON$features[[1]]$properties) -->
<!-- ``` -->
<!-- This is the tricky part. For {**plotly**} to match your incidence data to GeoJSON, the countries in the geoJSON need an id in a specific place in the list of lists. For this we need to build a basic function: -->
<!-- ```{r} -->
<!-- ## The property column we need to choose here is "sovereignt" as it is the names for each country -->
<!-- give_id <- function(x){ -->
<!--   x$id <- x$properties$sovereignt  ## Take sovereignt from properties and set it as the id -->
<!--   return(x) -->
<!-- } -->
<!-- ## Use {purrr} to apply this function to every element of the features list of the geoJSON object -->
<!-- geoJSON$features <- purrr::map(.x = geoJSON$features, give_id) -->
<!-- ``` -->
<!-- <!-- ======================================================= -->
<p>–&gt;
<!-- ### Maps - plot {  } --></p>
<!-- UNDER CONSTRUCTION -->
<!-- ```{r, echo=FALSE, eval=FALSE, out.width=c('95%'), out.height=c('500px'),warning=F} -->
<!-- plotly::plot_ly() %>%  -->
<!--   plotly::add_trace(                    #The main plot mapping functionn -->
<!--     type="choropleth", -->
<!--     geojson=geoJSON, -->
<!--     locations=df$Name,          #The column with the names (must match id) -->
<!--     z=df$Cumulative_incidence,  #The column with the incidence values -->
<!--     zmin=0, -->
<!--     zmax=57008, -->
<!--     colorscale="Viridis", -->
<!--     marker=list(line=list(width=0)) -->
<!--   ) %>% -->
<!--   colorbar(title = "Cases per million") %>% -->
<!--   layout(title = "Covid-19 cumulative incidence", -->
<!--                  geo = list(scope = 'africa')) %>%  -->
<!--   config(displaylogo = FALSE, modeBarButtonsToRemove = plotly_buttons_remove) -->
<!-- ``` -->
<!-- ======================================================= -->
</div>
<div id="resources-32" class="section level2" number="39.5">
<h2><span class="header-section-number">39.5</span> Resources</h2>
<p>Plotly is not just for R, but also works well with Python (and really any data science language as it’s built in JavaScript). You can read more about it on the <a href="https://plotly.com/r/">plotly website</a></p>

</div>
</div>



</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-05-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
