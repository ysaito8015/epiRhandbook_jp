<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>25 Contact tracing | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="contact-tracing-1" class="section level1" number="25">
<h1><span class="header-section-number">25</span> Contact tracing</h1>
<p>This page demonstrates descriptive analysis of contact tracing data, addessing some key considerations and approaches unique to these kinds of data.</p>
<p>This page references many of the core R data management and visualisation competencies covered in other pages (e.g. data cleaning, pivoting, tables, time-series analyses), but we will highlight examples specific to contact tracing that have been useful for operational decision making. For example, this includes visualizing contact tracing follow-up data over time or across geographic areas, or producing clean Key Performance Indicator (KPI) tables for contact tracing supervisors.</p>
<p>For demonstration purposes we will use sample contact tracing data from the <a href="https://www.who.int/tools/godata">Go.Data</a> platform. The principles covered here will apply for contact tracing data from other platforms - you may just need to undergo different data pre-processing steps depending on the structure of your data.</p>
<p>You can read more about the Go.Data project on the <a href="https://worldhealthorganization.github.io/godata/">Github Documentation site</a> or <a href="https://community-godata.who.int/">Community of Practice</a>.</p>
<div id="preparation-16" class="section level2" number="25.1">
<h2><span class="header-section-number">25.1</span> Preparation</h2>
<div id="load-packages-16" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code>library()</code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
</div>
<div id="import-data-15" class="section level3 unnumbered">
<h3>Import data</h3>
<p>We will import sample datasets of contacts, and of their “follow-up”. These data have been retrieved and un-nested from the Go.Data API and stored as “.rds” files.</p>
<p>You can download all the example data for this handbook from the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page.</p>
<p>If you want to download the example contact tracing data specific to this page, use the three download links below:</p>
<p><a href='https://github.com/WorldHealthOrganization/godata/blob/master/analytics/r-reporting/data/cases_clean.rds?raw=true' class='download-button'>
Click to download
<span>the case investigation data (.rds file)</span>
</a></p>
<p><a href='https://github.com/WorldHealthOrganization/godata/blob/master/analytics/r-reporting/data/contacts_clean.rds?raw=true' class='download-button'>
Click to download
<span>the contact registration data (.rds file)</span>
</a></p>
<p><a href='https://github.com/WorldHealthOrganization/godata/blob/master/analytics/r-reporting/data/followups_clean.rds?raw=true' class='download-button'>
Click to download
<span>the contact follow-up data (.rds file)</span>
</a></p>
<!-- ```{r out.width = "100%", fig.align = "center", echo=F} -->
<!-- knitr::include_graphics(here::here("images", "godata_api_github.png")) -->
<!-- ``` -->
<p>In their original form in the downloadable files, the data reflect data as provided by the Go.Data API (learn about <a href="import-and-export.html#import_api">APIs here</a>). For example purposes here, we will clean the data to make it easier to read on this page. If you are using a Go.Data instance, you can view complete instructions on how to retrieve your data <a href="https://github.com/WorldHealthOrganization/godata/tree/master/analytics/r-reporting">here</a>.</p>
<p>Below, the datasets are imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data. We use <code>here()</code> to specify the file path - you should provide the file path specific to your computer. We then use <code>select()</code> to select only certain columns of the data, to simplify for purposes of demonstration.</p>
<div id="case-data" class="section level4 unnumbered">
<h4>Case data</h4>
<p>These data are a table of the cases, and information about them.</p>
<p>Here are the <code>nrow(cases)</code> cases:</p>
</div>
<div id="contacts-data" class="section level4 unnumbered">
<h4>Contacts data</h4>
<p>These data are a table of all the contacts and information about them. Again, provide your own file path. After importing we perform a few preliminary data cleaning steps including:</p>
<ul>
<li>Set age_class as a factor and reverse the level order so that younger ages are first<br />
</li>
<li>Select only certain column, while re-naming a one of them<br />
</li>
<li>Artificially assign rows with missing admin level 2 to “Djembe”, to improve clarity of some example visualisations</li>
</ul>
<p>Here are the <code>nrow(contacts)</code> rows of the <code>contacts</code> dataset:</p>
</div>
<div id="follow-up-data" class="section level4 unnumbered">
<h4>Follow-up data</h4>
<p>These data are records of the “follow-up” interactions with the contacts. Each contact is supposed to have an encounter each day for 14 days after their exposure.</p>
<p>We import and perform a few cleaning steps. We select certain columns, and also convert a character column to all lowercase values.</p>
<p>Here are the first 50 rows of the <code>nrow(followups)</code>-row <code>followups</code> dataset (each row is a follow-up interaction, with outcome status in the <code>followup_status</code> column):</p>
</div>
<div id="relationships-data" class="section level4 unnumbered">
<h4>Relationships data</h4>
<p>Here we import data showing the relationship between cases and contacts. We select certain column to show.</p>
<p>Below are the first 50 rows of the <code>relationships</code> dataset, which records all relationships between cases and contacts.</p>
</div>
</div>
</div>
<div id="descriptive-analyses" class="section level2" number="25.2">
<h2><span class="header-section-number">25.2</span> Descriptive analyses</h2>
<p>You can use the techniques covered in other pages of this handbook to conduct descriptive analyses of your cases, contacts, and their relationships. Below are some examples.</p>
<div id="demographics" class="section level3 unnumbered">
<h3>Demographics</h3>
<p>As demonstrated in the page covering <a href="demographic-pyramids-and-likert-scales.html#demographic-pyramids-and-likert-scales">Demographic pyramids</a>, you can visualise the age and gender distribution (here we use the <strong>apyramid</strong> package).</p>
<div id="age-and-gender-of-contacts" class="section level4 unnumbered">
<h4>Age and Gender of contacts</h4>
<p>The pyramid below compares the age distribution of contacts, by gender. Note that contacts missing age are included in their own bar at the top. You can change this default behavior, but then consider listing the number missing in a caption.</p>
<p>With the Go.Data data structure, the <code>relationships</code> dataset contains the ages of both cases and contacts, so you could use that dataset and create an age pyramid showing the differences between these two groups of people. The <code>relationships</code> data frame will be mutated to transform the numberic age columns into categories (see the <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Cleaning data and core functions</a> page). We also pivot the dataframe longer to facilitate easy plotting with <strong>ggplot2</strong> (see <a href="pivoting-data.html#pivoting-data">Pivoting data</a>).</p>
<p>Now we can plot this transformed dataset with <code>age_pyramid()</code> as before, but replacing <code>gender</code> with <code>category</code> (contact, or case).</p>
<p>We can also view other characteristics such as occupational breakdown (e.g. in form of a pie chart).</p>
</div>
</div>
<div id="contacts-per-case" class="section level3 unnumbered">
<h3>Contacts per case</h3>
<p>The number of contacts per case can be an important metric to assess quality of contact enumeration and the compliance of the population toward public health response.</p>
<p>Depending on your data structure, this can be assessed with a dataset that contains all cases and contacts. In the Go.Data datasets, the links between cases (“sources”) and contacts (“targets”) is stored in the <code>relationships</code> dataset.</p>
<p>In this dataset, each row is a contact, and the source case is listed in the row. There are no contacts who have relationships with multiple cases, but if this exists you may need to account for those before plotting (and explore them too!).</p>
<p>We begin by counting the number of rows (contacts) per source case. This is saved as a data frame.</p>
<p>We use <code>geom_histogram()</code> to plot these data as a histogram.</p>
</div>
</div>
<div id="contact-follow-up" class="section level2" number="25.3">
<h2><span class="header-section-number">25.3</span> Contact Follow Up</h2>
<p>Contact tracing data often contain “follow-up” data, which record outcomes of daily symptom checks of persons in quarantine. Analysis of this data can inform response strategy, identify contacts at-risk of loss-to-follow-up or at-risk of developing disease.</p>
<div id="data-cleaning" class="section level3 unnumbered">
<h3>Data cleaning</h3>
<p>These data can exist in a variety of formats. They may exist as a “wide” format Excel sheet with one row per contact, and one column per follow-up “day”. See <a href="pivoting-data.html#pivoting-data">Pivoting data</a> for descriptions of “long” and “wide” data and how to pivot data wider or longer.</p>
<p>In our Go.Data example, these data are stored in the <code>followups</code> data frame, which is in a “long” format with one row per follow-up interaction. The first 50 rows look like this:</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Beware of duplicates when dealing with followup data; as there could be several erroneous followups on the same day for a given contact. Perhaps it seems to be an error but reflects reality - e.g. a contact tracer could submit a follow-up form early in the day when they could not reach the contact, and submit a second form when they were later reached. It will depend on the operational context for how you want to handle duplicates - just make sure to document your approach clearly. </span></p>
<p>Let’s <em>see</em> how many instances of “duplicate” rows we have:</p>
<p>In our example data, the only records that this applies to are ones missing an ID! We can remove those. But, for purposes of demonstration we will go show the steps for de-duplication so there is only one follow-up encoutner per person per day. See the page on <a href="de-duplication.html#de-duplication">De-duplication</a> for more detail. We will assume that the most recent encounter record is the correct one. We also take the opportunity to clean the <code>followup_number</code> column (the “day” of follow-up which should range 1 - 14).</p>
<p>For each follow-up encounter, we have a follow-up status (such as whether the encounter occurred and if so, did the contact have symptoms or not). To see all the values we can run a quick <code>tabyl()</code> (from <strong>janitor</strong>) or <code>table()</code> (from <strong>base</strong> R) (see <a href="descriptive-tables.html#descriptive-tables">Descriptive tables</a>) by <code>followup_status</code> to see the frequency of each of the outcomes.</p>
<p>In this dataset, “seen_not_ok” means “seen with symptoms”, and “seen_ok” means “seen without symptoms”.</p>
</div>
<div id="plot-over-time" class="section level3 unnumbered">
<h3>Plot over time</h3>
<p>As the dates data are continuous, we will use a histogram to plot them with <code>date_of_followup</code> assigned to the x-axis. We can achieve a “stacked” histogram by specifying a <code>fill =</code> argument within <code>aes()</code>, which we assign to the column <code>followup_status</code>. Consequently, you can set the legend title using the <code>fill =</code> argument of <code>labs()</code>.</p>
<p>We can see that the contacts were identified in waves (presumably corresponding with epidemic waves of cases), and that follow-up completion did not seemingly improve over the course of the epidemic.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If you are preparing many plots (e.g. for multiple jurisdictions) you will want the legends to appear identically even with varying levels of data completion or data composition. There may be plots for which not all follow-up statuses are present in the data, but you still want those categories to appear the legends. In ggplots (like above), you can specify the <code>drop = FALSE</code> argument of the <code>scale_fill_discrete()</code>. In tables, use <code>tabyl()</code> which shows counts for all factor levels, or if using <code>count()</code> from <strong>dplyr</strong> add the argument <code>.drop = FALSE</code> to include counts for all factor levels.</span></p>
</div>
<div id="daily-individual-tracking" class="section level3 unnumbered">
<h3>Daily individual tracking</h3>
<p>If your outbreak is small enough, you may want to look at each contact individually and see their status over the course of their follow-up. Fortunately, this <code>followups</code> dataset already contains a column with the day “number” of follow-up (1-14). If this does not exist in your data, you could create it by calculating the difference between the encounter date and the date follow-up was intended to begin for the contact.</p>
<p>A convenient visualisation mechanism (if the number of cases is not too large) can be a heat plot, made with <code>geom_tile()</code>. See more details in the [heat plot] page.</p>
</div>
<div id="analyse-by-group" class="section level3 unnumbered">
<h3>Analyse by group</h3>
<p>Perhaps these follow-up data are being viewed on a daily or weekly basis for operational decision-making. You may want more meaningful disaggregations by geographic area or by contact-tracing team. We can do this by adjusting the columns provided to <code>group_by()</code>.</p>
<!-- If this was disaggregated by contact tracer, perhaps we would want to add a threshold line to display total # contacts that normally one person or area/team can handle, and how the current workload compares. We just do this by using `geom_hline()` function. -->
<!-- ```{r, warning=F, message=F} -->
<!-- plot_by_region +  -->
<!--      geom_hline(aes(yintercept=25), color="#C70039", linetype = "dashed") # fictitious threshold at 25 contacts -->
<!-- ``` -->
</div>
</div>
<div id="kpi-tables" class="section level2" number="25.4">
<h2><span class="header-section-number">25.4</span> KPI Tables</h2>
<p>There are a number of different Key Performance Indicators (KPIs) that can be calculated and tracked at varying levels of disaggregations and across different time periods to monitor contact tracing performance. Once you have the calculations down and the basic table format; it is fairly easy to swap in and out different KPIs.</p>
<p>There are numerous sources of contact tracing KPIs, such as this one from <a href="https://contacttracingplaybook.resolvetosavelives.org/checklists/metrics">ResolveToSaveLives.org</a>. The majority of the work will be walking through your data structure and thinking through all of the inclusion/exclusion criteria. We show a few examples below; using Go.Data metadata structure:</p>
<table style="width:100%;">
<colgroup>
<col width="19%" />
<col width="28%" />
<col width="29%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th>Category</th>
<th>Indicator</th>
<th>Go.Data Numerator</th>
<th>Go.Data Denominator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Process Indicator - Speed of Contact Tracing</td>
<td>% cases interviewed and isolated within 24h of case report</td>
<td>COUNT OF <code>case_id</code> WHERE (<code>date_of_reporting</code> - <code>date_of_data_entry</code>) &lt; 1 day AND (<code>isolation_startdate</code> - <code>date_of_data_entry</code>) &lt; 1 day</td>
<td>COUNT OF <code>case_id</code></td>
</tr>
<tr class="even">
<td>Process Indicator - Speed of Contact Tracing</td>
<td>% contacts notified and quarantined within 24h of elicitation</td>
<td>COUNT OF <code>contact_id</code> WHERE <code>followup_status</code> == “SEEN_NOT_OK” OR “SEEN_OK” AND <code>date_of_followup</code> - <code>date_of_reporting</code> &lt; 1 day</td>
<td>COUNT OF <code>contact_id</code></td>
</tr>
<tr class="odd">
<td>Process Indicator - Completeness of Testing</td>
<td>% new symptomatic cases tested and interviewed within 3 days of onset of symptoms</td>
<td>COUNT OF <code>case_id</code> WHERE (<code>date_of_reporting</code> - <code>date_of_onset</code>) &lt; =3 days</td>
<td>COUNT OF <code>case_id</code></td>
</tr>
<tr class="even">
<td>Outcome Indicator - Overall</td>
<td>% new cases among existing contact list</td>
<td>COUNT OF <code>case_id</code> WHERE <code>was_contact</code> == “TRUE”</td>
<td>COUNT OF <code>case_id</code></td>
</tr>
</tbody>
</table>
<p>Below we will walk through a sample exercise of creating a nice table visual to show contact follow-up across admin areas. At the end, we will make it fit for presentation with the <strong>formattable</strong> package (but you could use other packages like <strong>flextable</strong> - see <a href="tables-for-presentation.html#tables-for-presentation">Tables for presentation</a>).</p>
<p>How you create a table like this will depend on the structure of your contact tracing data. Use the <a href="descriptive-tables.html#descriptive-tables">Descriptive tables</a> page to learn how to summarise data using <strong>dplyr</strong> functions.</p>
<p>We will create a table that will be dynamic and change as the data change. To make the results interesting, we will set a <code>report_date</code> to allow us to simulate running the table on a certain day (we pick 10th June 2020). The data are filtered to that date.</p>
<p>Now, based on our data structure, we will do the following:</p>
<ol style="list-style-type: decimal">
<li>Begin with the <code>followups</code> data and summarise it to contain, for each unique contact:<br />
</li>
</ol>
<ul>
<li>The date of latest record (no matter the status of the encounter)<br />
</li>
<li>The date of latest encounter where the contact was “seen”<br />
</li>
<li>The encounter status at that final “seen” encounter (e.g. with symptoms, without symptoms)<br />
</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Join these data to the contacts data, which contains other information such as the overall contact status, date of last exposure to a case, etc. Also we will calculate metrics of interest for each contact such as days since last exposure<br />
</li>
<li>We group the enhanced contact data by geographic region (<code>admin_2_name</code>) and calculate summary statistics per region<br />
</li>
<li>Finally, we format the table nicely for presentation</li>
</ol>
<p>First we summarise the follow-up data to get the information of interest:</p>
<p>Here is how these data look:</p>
<p>Now we will add this information to the <code>contacts</code> dataset, and calculate some additional columns.</p>
<p>Here is how these data look. Note <code>contacts</code> column to the right, and new calculated column at the far right.</p>
<p>Next we summarise the contacts data by region, to achieve a concise data frame of summary statistic columns.</p>
<p>And now we apply styling from the <strong>formattable</strong> and <strong>knitr</strong> packages, including a footnote that shows the “as of” date.</p>
</div>
<div id="transmission-matrices" class="section level2" number="25.5">
<h2><span class="header-section-number">25.5</span> Transmission Matrices</h2>
<p>As discussed in the <a href="heat-plots.html#heat-plots">Heat plots</a> page, you can create a matrix of “who infected whom” using <code>geom_tile()</code>.</p>
<p>When new contacts are created, Go.Data stores this relationship information in the <code>relationships</code> API endpoint; and we can see the first 50 rows of this dataset below. This means that we can create a heat plot with relatively few steps given each contact is already joined to it’s source case.</p>
<p>As done above for the age pyramid comparing cases and contacts, we can select the few variables we need and create columns with categorical age groupings for both sources (cases) and targets (contacts).</p>
<p>As described previously, we create cross-tabulation;</p>
<p>convert into long format with proportions;</p>
<p>and create a heat-map for age.</p>
</div>
<div id="resources-18" class="section level2" number="25.6">
<h2><span class="header-section-number">25.6</span> Resources</h2>
<p><a href="https://github.com/WorldHealthOrganization/godata/tree/master/analytics/r-reporting" class="uri">https://github.com/WorldHealthOrganization/godata/tree/master/analytics/r-reporting</a></p>
<p><a href="https://worldhealthorganization.github.io/godata/" class="uri">https://worldhealthorganization.github.io/godata/</a></p>
<p><a href="https://community-godata.who.int/" class="uri">https://community-godata.who.int/</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-05-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
