
[{"path":"index.html","id":"section","chapter":"","heading":"","text":"DRAFT.REVIEWING BOOK, PLEASE PROVIDE FEEDBACK PAGE LINK","code":""},{"path":"index.html","id":"about-this-handbook","chapter":"","heading":"About this handbook","text":"free open-access R reference manual applied epidemiologists public health practitioners.book strives :Serve quick reference manual - textbook comprehensive R trainingAddress common epidemiological problems via task-centered examplesBe accessible settings low internet-connectivity via offline version (instructions )challenges book try address?Many epidemiologists transitioning R SAS, STATA, SPSS, Excel, softwareEpidemiologists need spend hours searching online code relevant common epi userEpidemiologists sometimes work low internet-connectivity environments limited supportHow different R books?written epidemiologists, epidemiologists - leveraging experience local, national, academic, emergency settingsIt provides examples epidemic curves, transmission chains, epidemic modeling projections, age sex pyramids standardization, record matching, outbreak detection, survey analysis, causal diagrams, survival analysis, GIS basics, phylogenetic trees, automated reports, etc…","code":""},{"path":"index.html","id":"how-to-read-this-handbook","chapter":"","heading":"How to read this handbook","text":"Online versionSearch via search box Table ContentsClick “copy” icons copy codeSee “Resources” section page resourcesTo download data “follow-along”, see “Datasets used” pageTo download offline version follow steps:Click html file Github repositoryClick “Download” button. window open HTML source code.“Save ” webpage, via right-click (windows) Cmd-s (mac) - ensure file type “Webpage, Complete”file large (>40MB) content may take time appear. displays one long page, search Ctrl+f (Cmd-f).","code":""},{"path":"index.html","id":"edit-or-contribute","chapter":"","heading":"Edit or contribute","text":"welcome comments suggestions. can submit issue pull request Github repository, provide feedback via Google survey.","code":""},{"path":"index.html","id":"acknowledgements","chapter":"","heading":"Acknowledgements","text":"","code":""},{"path":"index.html","id":"contributors","chapter":"","heading":"Contributors","text":"book produced collaboration epidemiologists around world, drawing upon experiences organizations including local/state/provincial/national health departments ministries, World Health Organization (), MSF (Medecins sans frontiers / Doctors without Borders), hospital systems, academic institutions.Editor--Chief: Neale BatraCore team: Neale Batra, Alex Spina, Amrish Baidjoe, Pat Keating, Henry Laurenson-Schafer, Finlay CampbellAuthors: Neale Batra, Alex Spina, Paula Blomquist, Finlay Campbell, Henry Laurenson-Schafer, Isaac Florence, Natalie Fischer, Aminata Ndiaye, Liza Coyer, Jonny Polonski, Yurie Izawa, Daniel Molling, Sara Hollis, Isha BerryReviewers:Advisers:","code":""},{"path":"index.html","id":"funding-and-programmatic-support","chapter":"","heading":"Funding and programmatic support","text":"handbook approved product specific organization. Although strive accuracy, provide guarantee content book.handbook project received funding via COVID-19 emergency capacity-building grant Training Programs Epidemiology Public Health Interventions Network (TEPHINET) (details ).handbook supported Cooperative Agreement number NU2GGH001873, funded Centers Disease Control Prevention TEPHINET, program Task Force Global Health. contents solely responsibility authors necessarily represent official views Centers Disease Control Prevention, Department Health Human Services, Task Force Global Health, Inc. TEPHINET.Programmatic support provided EPIET Alumni Network (EAN) also MSF’s Manson Unit.","code":""},{"path":"index.html","id":"inspiration","chapter":"","heading":"Inspiration","text":"multitude tutorials vignettes provided knowledge development handbook content credited within respective pages.generally, following sources provided inspiration laid groundwork handbook:“R4Epis” project (collaboration MSF RECON)R Epidemics Consortium (RECON)R Data Science book (R4DS)bookdown: Authoring Books Technical Documents R MarkdownNetlify hosts website","code":""},{"path":"index.html","id":"image-credits","chapter":"","heading":"Image credits","text":"Logo (US CDC Public Health Image Library):2013 Yemen looking mosquito breeding sitesEbola virusSurvey Rajasthan","code":""},{"path":"index.html","id":"terms-of-use-and-license","chapter":"","heading":"Terms of Use and License","text":"work licensed Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.","code":""},{"path":"standardization.html","id":"standardization","chapter":"1 Standardization","heading":"1 Standardization","text":"page show two ways standardize outcome, hospitalizations mortality, characteristics age sex.Using dsr packageUsing PHEindicatormethods packageWe begin extensively demonstrating processes data preparation/cleaning/joining, common combining population data multiple countries, standard population data, deaths, etc.","code":""},{"path":"standardization.html","id":"overview","chapter":"1 Standardization","heading":"1.1 Overview","text":"two main ways standardize: direct indirect standardization.\r\nLet’s say like standardize mortality age sex country country B, compare standardized rates countries.direct standardization, know number -risk population number deaths stratum age sex, country country B. One stratum example females ages 15-44.indirect standardization, need know total number deaths age- sex structure country. option therefore feasible age- sex-specific mortality rates population numbers available. Indirect standardization furthermore preferable case small numbers per stratum, estimates direct standardization influenced substantial sampling variation.","code":""},{"path":"standardization.html","id":"preparation","chapter":"1 Standardization","heading":"1.2 Preparation","text":"show standardization done, use fictitious population counts death counts country country B, age (5 year categories) sex (female, male). make datasets ready use, perform following preparation steps:Load packagesLoad datasetsJoin populaton death data two countriesPivot longer one row per age-sex stratumClean reference population (world standard population) join country dataIn scenario, data may come different format. Perhaps data province, city, catchment area. may one row death information age sex (significant proportion) deaths. case, see pages [Grouping data] [Pivoting data] create dataset event population counts per age-sex stratum.also need reference population, standard population. several standard populations available, purpose exercise use world_standard_population_by_sex. World standard population based populations 46 countries developed 1960. many “standard” populations - one example, website NHS Scotland quite informative European Standard Population, World Standard Population Scotland Standard Population.","code":""},{"path":"standardization.html","id":"load-packages","chapter":"1 Standardization","heading":"Load packages","text":"code chunk shows loading packages required analyses. handbook emphasize p_load() pacman, installs package necessary loads use. can also load packages library() base R. See page [R basics] information R packages.CAUTION: newer version R, dsr package directly downloaded CRAN. However, still available CRAN archive. can install use one. non-Mac users:Mac users:","code":"\npacman::p_load(\n     rio,         # to import data\n     here,        # to locate files\n     tidyverse,   # to clean, handle, and plot the data (includes ggplot2 package)\n     stringr,     # cleaning characters and strings\n     frailtypack, # needed for dsr, for frailty models\n     dsr,  \n     PHEindicatormethods)\nrequire(Rtools)\npackageurl <- \"https://cran.r-project.org/src/contrib/Archive/dsr/dsr_0.2.2.tar.gz\"\ninstall.packages(packageurl, repos=NULL, type=\"source\")\n# Other solution that may work\nrequire(devtools)\ndevtools::install_version(\"dsr\", version=\"0.2.2\", repos=\"http:/cran.us.r.project.org\")\nrequire(devtools)\ndevtools::install_version(\"dsr\", version=\"0.2.2\", repos=\"https://mac.R-project.org\")"},{"path":"standardization.html","id":"load-population-data","chapter":"1 Standardization","heading":"Load population data","text":"First load demographic data (counts males females 5-year age category) two countries comparing, “Country ” “Country B”.","code":"\n# Country A\ncountryA_demo <- import(\"country_demographics.csv\")\n# Country B\ncountryB_demo <- import(\"country_demographics_2.csv\")"},{"path":"standardization.html","id":"load-death-counts","chapter":"1 Standardization","heading":"Load death counts","text":"Conveniently, also counts deaths time period interest, age sex. country’s counts separate file, shown .Deaths Country ADeaths Country B","code":""},{"path":"standardization.html","id":"clean-populations-and-deaths","chapter":"1 Standardization","heading":"Clean populations and deaths","text":"need join transform data following ways:Combine country populations one dataset pivot “long” age-sex stratum one rowCombine country death counts one dataset pivot “long” age-sex stratum one rowJoin deaths populationsFirst, combine country populations datasets, pivot longer, minor cleaning. See page [Pivoting data] detail.population data now look like :now perform similar operations two deaths datasets.deaths data now look like , contains data countries:now join deaths population data based common columns age_cat5, Sex, Country.can now classify Sex, age_cat5, Country factors ordering specified correctly. use as_factor() function forcats package, described page [Factors]. Note, classifying factor levels doesn’t visibly change data, arrange() command sort Country, age category, sex.CAUTION: NB. deaths per stratum, use 10-, 15-year categories, instead 5-year categories age, combine categories","code":"\npop_countries <- countryA_demo %>%  # begin with country A dataset\n     bind_rows(countryB_demo) %>%        # bind rows, because cols are identically named\n     pivot_longer(                       # pivot longer\n          cols = c(m, f),                   # column to transform into one\n          names_to = \"Sex\",                 # name for new column containing the category (\"m\" or \"f\") \n          values_to = \"Population\") %>%     # name for new column containing the numeric values pivoted\n     mutate(Sex = recode(                # recode values for clarity\n          Sex,\n          \"m\" = \"Male\",\n          \"f\" = \"Female\"))\ndeaths_countries <- A_deaths %>%    # begin with country A deaths dataset\n     bind_rows(B_deaths) %>%        # bind rows with B dataset, because cols are identically named\n     pivot_longer(                  # pivot longer\n          cols = c(Male, Female),        # column to transform into one\n          names_to = \"Sex\",              # name for new column containing the category (\"m\" or \"f\") \n          values_to = \"Deaths\") %>%      # name for new column containing the numeric values pivoted\n     rename(age_cat5 = AgeCat)    # rename for clarity\ncountry_data <- pop_countries %>% \n     left_join(deaths_countries, by = c(\"Country\", \"Sex\", \"age_cat5\"))\ncountry_data <- country_data %>% \n     mutate(\n          Country = as_factor(Country),\n          Country = fct_relevel(Country, \"A\", \"B\"),\n          \n          Sex = as_factor(Sex),\n          Sex = fct_relevel(Sex, \"Male\", \"Female\"),\n          \n          age_cat5 = as_factor(age_cat5),\n          age_cat5 = fct_relevel(age_cat5,\n                                 \"0-4\", \"5-9\", \"10-14\", \"15-19\",\n                                 \"20-24\", \"25-29\",  \"30-34\", \"35-39\",\n                                 \"40-44\", \"45-49\", \"50-54\", \"55-59\",\n                                 \"60-64\", \"65-69\", \"70-74\",\n                                 \"75-79\", \"80-84\", \"85\")) %>% \n          arrange(Country, age_cat5, Sex)"},{"path":"standardization.html","id":"load-reference-population","chapter":"1 Standardization","heading":"Load reference population","text":"Lastly, import reference population (world “standard population” sex)","code":"\n# Reference population\nstandard_pop_data <- import(\"world_standard_population_by_sex.csv\")"},{"path":"standardization.html","id":"clean-reference-population","chapter":"1 Standardization","heading":"Clean reference population","text":"values column age_cat5 standard_pop_data contain word “years” “plus”, country_data . remove string make age category values match. use str_replace_all() stringr package, described page [Characters strings].Furthermore, package dsr expects standard population, column containing counts called \"pop\". rename column accordingly.CAUTION: try use str_replace_all() remove plus symbol, won’t work special symbol. “Escape” specialnes putting two back slashes front, str_replace_call(column, \"\\\\+\", \"\"). Finally, package PHEindicatormethods, detailed , expects standard populations joined country event population counts. , create dataset all_data purpose.complete dataset looks like :","code":"\n# Remove specific string from column values\nstandard_pop_clean <- standard_pop_data %>%\n     mutate(\n          age_cat5 = str_replace_all(age_cat5, \"years\", \"\"),   # remove \"year\"\n          age_cat5 = str_replace_all(age_cat5, \"plus\", \"\"),    # remove \"plus\"\n          age_cat5 = str_replace_all(age_cat5, \" \", \"\")) %>%   # remove \" \" space\n     \n     rename(pop = WorldStandardPopulation)   # change col name to \"pop\", as this is expected by dsr package\nall_data <- left_join(country_data, standard_pop_clean, by=c(\"age_cat5\", \"Sex\"))"},{"path":"standardization.html","id":"dsr-package","chapter":"1 Standardization","heading":"1.3 dsr package","text":"demonstrate calculating comparing directly standardized rates using dsr package. dsr package allows calculate compare directly standardized rates (indirectly standardized rates!).data Preparation section, made separate datasets country counts standard population:country_data object, population table number population number deaths per stratum per countrythe standard_pop_clean object, containing number population per stratum reference population, World Standard PopulationWe use separate datasets dsr approach.","code":""},{"path":"standardization.html","id":"standardized-rates","chapter":"1 Standardization","heading":"Standardized rates","text":", calculate rates per country directly standardized age sex. use dsr() function.note - dsr() expects one data frame country populations event counts (deaths), separate data frame reference population. also expects reference population dataset unit-time column name “pop” (assured data Preparation section).many arguments, annotated code . Notably, event = set column Deaths, fu = (“follow-”) set Population column. set subgroups comparison column Country standardize based age_cat5 Sex. last two columns assigned particular named argument. See ?dsr details., see country lower crude mortality rate country B, higher standardized rate direct age sex standardization.","code":"\n# Calculate rates per country directly standardized for age and sex\nmortality_rate <- dsr::dsr(\n     data = country_data,  # specify object containing number of deaths per stratum\n     event = Deaths,       # column containing number of deaths per stratum \n     fu = Population,      # column containing number of population per stratum\n     subgroup = Country,   # units we would like to compare\n     age_cat5,             # other columns - rates will be standardized by these\n     Sex,\n     refdata = standard_pop_clean, # reference population data frame, with column called pop\n     method = \"gamma\",      # method to calculate 95% CI\n     sig = 0.95,            # significance level\n     mp = 100000,           # we want rates per 100.000 population\n     decimals = 2)          # number of decimals)\n\n\n# Print output as nice-looking HTML table\nknitr::kable(mortality_rate) # show mortality rate before and after direct standardization"},{"path":"standardization.html","id":"standardized-rate-ratios","chapter":"1 Standardization","heading":"Standardized rate ratios","text":"standardized mortality rate 1.22 times higher country compared country B (95% CI 1.17-1.27).","code":"\n# Calculate RR\nmortality_rr <- dsr::dsrr(\n     data = country_data, # specify object containing number of deaths per stratum\n     event = Deaths,      # column containing number of deaths per stratum \n     fu = Population,     # column containing number of population per stratum\n     subgroup = Country,  # units we would like to compare\n     age_cat5,\n     Sex,                 # characteristics to which we would like to standardize \n     refdata = standard_pop_clean, # reference population, with numbers in column called pop\n     refgroup = \"B\",      # reference for comparison\n     estimate = \"ratio\",  # type of estimate\n     sig = 0.95,          # significance level\n     mp = 100000,         # we want rates per 100.000 population\n     decimals = 2)        # number of decimals\n\n# Print table\nknitr::kable(mortality_rr) "},{"path":"standardization.html","id":"standardized-rate-difference","chapter":"1 Standardization","heading":"Standardized rate difference","text":"Country 4.24 additional deaths per 100.000 population (95% CI 3.24-5.24) compared country .","code":"\n# Calculate RD\nmortality_rd <- dsr::dsrr(\n     data = country_data,       # specify object containing number of deaths per stratum\n     event = Deaths,            # column containing number of deaths per stratum \n     fu = Population,           # column containing number of population per stratum\n     subgroup = Country,        # units we would like to compare\n     age_cat5,                  # characteristics to which we would like to standardize\n     Sex,                        \n     refdata = standard_pop_clean, # reference population, with numbers in column called pop\n     refgroup = \"B\",            # reference for comparison\n     estimate = \"difference\",   # type of estimate\n     sig = 0.95,                # significance level\n     mp = 100000,               # we want rates per 100.000 population\n     decimals = 2)              # number of decimals\n\n# Print table\nknitr::kable(mortality_rd) "},{"path":"standardization.html","id":"pheindicatormethods-package","chapter":"1 Standardization","heading":"1.4 PHEindicatormethods package","text":"Another way calculating standardized rates PHEindicatormethods package. package allows calculate directly well indirectly standardized rates. show .","code":""},{"path":"standardization.html","id":"directly-standardized-rates","chapter":"1 Standardization","heading":"Directly standardized rates","text":", first group data Country pass function phe_dsr() get directly standardized rates per country.note - reference (standard) population can provided column within country-specific data frame separate vector. provided within country-specific data frame, set stdpoptype = \"field\". provided vector, set stdpoptype = \"vector\". latter case, make sure ordering rows strata similar country-specific data frame reference population, records matched position. example , provided reference population column within country-specific data frame.See help ?phr_dsr links References section information.","code":"\n# Calculate rates per country directly standardized for age and sex\nmortality_ds_rate_phe <- all_data %>%\n     group_by(Country) %>%\n     PHEindicatormethods::phe_dsr(\n          x = Deaths,                 # column with observed number of events\n          n = Population,             # column with non-standard pops for each stratum\n          stdpop = pop,               # standard populations for each stratum\n          stdpoptype = \"field\")       # either \"vector\" for a standalone vector or \"field\" meaning std populations are in the data  \n\n# Print table\nknitr::kable(mortality_ds_rate_phe)"},{"path":"standardization.html","id":"indirectly-standardized-rates","chapter":"1 Standardization","heading":"Indirectly standardized rates","text":"indirect standardization, need reference population number deaths number population per stratum. example, calculating rates country using country B reference population, previous standard_pop_clean reference population include number deaths per stratum., first create reference population country B. , pass mortality population data country , combine reference population, pass function phe_isr(), get indirectly standardized rates. course, can also vice versa.note - example , reference population provided separate data frame. case, make sure x =, n =, x_ref = n_ref = vectors ordered standardization category (stratum) values country-specific data frame, records matched position.See help ?phr_isr links References section information.","code":"\n# Create reference population\nrefpopCountryB <- country_data %>% \n  filter(Country==\"B\") \n\n# Calculate rates for country A indirectly standardized by age and sex\nmortality_is_rate_phe_A <- country_data %>%\n     filter(Country==\"A\") %>%\n     PHEindicatormethods::phe_isr(\n          x = Deaths,                 # column with observed number of events\n          n = Population,             # column with non-standard pops for each stratum\n          x_ref = refpopCountryB$Deaths,  # reference number of deaths for each stratum\n          n_ref = refpopCountryB$Population)  # reference population for each stratum\n\n# Print table\nknitr::kable(mortality_is_rate_phe_A)"},{"path":"standardization.html","id":"resources","chapter":"1 Standardization","heading":"1.5 Resources","text":"TIP: like see another reproducible example using dsr listed Handbook, please go https://mran.microsoft.com/snapshot/2020-02-12/web/packages/dsr/vignettes/dsr.html.TIP: another example using PHEindicatormethods, please go https://mran.microsoft.com/snapshot/2018-10-22/web/packages/PHEindicatormethods/vignettes/IntroductiontoPHEindicatormethods.htmlPHEindicatormethods reference file: https://cran.r-project.org/web/packages/PHEindicatormethods/PHEindicatormethods.pdf","code":""}]
