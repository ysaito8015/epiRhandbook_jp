<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1 Standardization | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">The Epidemiologist R Handbook</a></li>
<li class="book-part">Preview pages</li>
<li><a class="active" href="standardization.html"><span class="header-section-number">1</span> Standardization</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="standardization" class="section level1" number="1">
<h1>
<span class="header-section-number">1</span> Standardization<a class="anchor" aria-label="anchor" href="#standardization"><i class="fas fa-link"></i></a>
</h1>
<p>This page will show you two ways to standardize an outcome, such as hospitalizations or mortality, by characteristics such as age and sex.</p>
<ul>
<li>Using <strong>dsr</strong> package</li>
<li>Using <strong>PHEindicatormethods</strong> package</li>
</ul>
<p>We begin by extensively demonstrating the processes of data preparation/cleaning/joining, as this is common when combining population data from multiple countries, standard population data, deaths, etc.</p>
<!-- ======================================================= -->
<div id="overview" class="section level2" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"><i class="fas fa-link"></i></a>
</h2>
<p>There are two main ways to standardize: direct and indirect standardization.
Let’s say we would like to standardize mortality by age and sex for country A and country B, and compare the standardized rates between these countries.</p>
<ul>
<li>For direct standardization, you will have to know the number of the at-risk population and the number of deaths for each stratum of age and sex, for country A and country B. One stratum in our example could be females between ages 15-44.<br>
</li>
<li>For indirect standardization, you only need to know the total number of deaths and the age- and sex structure of each country. This option is therefore feasible if age- and sex-specific mortality rates or population numbers are not available. Indirect standardization is furthermore preferable in case of small numbers per stratum, as estimates in direct standardization would be influenced by substantial sampling variation.</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="preparation" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation"><i class="fas fa-link"></i></a>
</h2>
<p>To show how standardization is done, we will use the <code>country_demographics</code> (country A) and <code>country_demographics_2</code> (country B) datasets, by age (in 5 year categories) and sex (female, male). We will add our own fictitious mortality data to these datasets. To make the dataset ready for use, we will perform the following steps:</p>
<ol style="list-style-type: decimal">
<li>Load packages<br>
</li>
<li>Load datasets<br>
</li>
<li>Create one row per stratum of age and sex<br>
</li>
<li>Add number of deaths per stratum<br>
</li>
<li>Prepare reference population (standard population)</li>
</ol>
<p>Alternatively, instead of just adding mortality numbers per stratum, you may have a dataset per country (or per group within a country, province, city, or other catchment area) with one row for each death and information on age and sex for each (or a significant proportion) of these deaths. In this case, you can aggregate by age and sex to create a dataset with numbers per stratum, and then add this to the dataset with population numbers per stratum.</p>
<p>We also need a reference population, the standard population. There are several standard populations available, for the purpose of this exercise we will use the <code>world_standard_population_by_sex</code>. The World standard population is based on the populations of 46 countries and was developed in 1960. I found the website of the NHS Schotland quite informative on the European Standard Population, World Standard Population and Scotland Standard Population: <a href="https://www.opendata.nhs.scot/dataset/standard-populations" class="uri">https://www.opendata.nhs.scot/dataset/standard-populations</a></p>
<!-- ======================================================= -->
<div id="load-packages" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages"><i class="fas fa-link"></i></a>
</h3>
<p>Load the packages required for this analysis:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
     <span class="va">rio</span>,         <span class="co"># to import data</span>
     <span class="va">here</span>,        <span class="co"># to locate files</span>
     <span class="va">tidyverse</span>,   <span class="co"># to clean, handle, and plot the data (includes ggplot2 package)</span>
     <span class="va">stringr</span>,     <span class="co"># cleaning characters and strings</span>
     <span class="va">frailtypack</span>, <span class="co"># needed for dsr, for frailty models</span>
     <span class="va">dsr</span>,  
     <span class="va">PHEindicatormethods</span><span class="op">)</span></code></pre></div>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If you have a newer version of R, the <strong>dsr</strong> package cannot be directly downloaded as it is archived. However, it is still available from the CRAN archive. You can install and use this one. </span></p>
<p>For non-Mac users:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">Rtools</span><span class="op">)</span>
<span class="va">packageurl</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/src/contrib/Archive/dsr/dsr_0.2.2.tar.gz"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">packageurl</span>, repos<span class="op">=</span><span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Other solution that may work</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_version</a></span><span class="op">(</span><span class="st">"dsr"</span>, version<span class="op">=</span><span class="st">"0.2.2"</span>, repos<span class="op">=</span><span class="st">"http:/cran.us.r.project.org"</span><span class="op">)</span></code></pre></div>
<p>For Mac users:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_version</a></span><span class="op">(</span><span class="st">"dsr"</span>, version<span class="op">=</span><span class="st">"0.2.2"</span>, repos<span class="op">=</span><span class="st">"https://mac.R-project.org"</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-population-data" class="section level3 unnumbered">
<h3>Load population data<a class="anchor" aria-label="anchor" href="#load-population-data"><i class="fas fa-link"></i></a>
</h3>
<p>First we load the demographic data (counts of males and females by 5-year age category) for the two countries that we will be comparing, “Country A” and “Country B”.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Country A</span>
<span class="va">countryA_demo</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"country_demographics.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-3eafc7c915489f794563" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3eafc7c915489f794563">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[7828087,6705882,5601230,4576430,3734111,3111651,2571215,2121247,1735468,1418749,1145345,900239,685141,500248,347093,202240,94325,40402],[7674675,6592449,5522555,4533885,3726537,3118040,2592416,2150490,1771213,1459439,1193903,956070,745682,563894,416543,258538,130479,64656]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Country B</span>
<span class="va">countryB_demo</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"country_demographics_2.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-b08437c8a0657f6bdf25" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b08437c8a0657f6bdf25">{"x":{"filter":"none","data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[513458,508728,673522,844532,965423,1243552,1400065,1428773,1546221,1562880,2355220,2324555,2988200,2527110,1552200,1466902,876251,1073611],[503262,559249,652455,145453,965237,1238640,1392676,1505040,1671213,1459439,2218733,3528103,3204770,2500130,1683925,1683828,987362,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="load-death-counts" class="section level3 unnumbered">
<h3>Load death counts<a class="anchor" aria-label="anchor" href="#load-death-counts"><i class="fas fa-link"></i></a>
</h3>
<p>Conveniently, we also have the counts of deaths during the time period of interest, by age and sex. Each country’s counts are in a separate file, shown below.</p>
<p>Deaths in Country A</p>
<div id="htmlwidget-b896a11efb246df517fa" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b896a11efb246df517fa">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[224,257,251,245,334,245,154,189,334,342,565,432,543,432,245,543,234,354],[194,254,232,214,316,224,163,167,354,354,463,574,493,295,175,380,177,392]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Deaths in Country B</p>
<div id="htmlwidget-9ea57d090ea4c5b66d67" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9ea57d090ea4c5b66d67">{"x":{"filter":"none","data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[34,37,51,145,434,120,100,143,307,354,463,639,706,232,275,543,234,274],[54,24,32,154,276,254,123,164,254,354,453,654,435,354,165,432,287,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="clean-populations-and-deaths" class="section level3 unnumbered">
<h3>Clean populations and deaths<a class="anchor" aria-label="anchor" href="#clean-populations-and-deaths"><i class="fas fa-link"></i></a>
</h3>
<p>We need to join and transform these data in the following ways:</p>
<ul>
<li>Combine country populations into one dataset and pivot “long” so that each age-sex stratum is one row<br>
</li>
<li>Combine country death counts into one dataset and pivot “long” so each age-sex stratum is one row<br>
</li>
<li>Join the deaths to the populations</li>
</ul>
<p>First, we combine the country populations datasets, pivot longer, and do minor cleaning. See the page on [Pivoting data] for more detail.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pop_countries</span> <span class="op">&lt;-</span> <span class="va">countryA_demo</span> <span class="op">%&gt;%</span>  <span class="co"># begin with country A dataset</span>
     <span class="fu">bind_rows</span><span class="op">(</span><span class="va">countryB_demo</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># bind rows, because cols are identically named</span>
     <span class="fu">pivot_longer</span><span class="op">(</span>                       <span class="co"># pivot longer</span>
          cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">f</span><span class="op">)</span>,                   <span class="co"># column to transform into one</span>
          names_to <span class="op">=</span> <span class="st">"Sex"</span>,                 <span class="co"># name for new column containing the category ("m" or "f") </span>
          values_to <span class="op">=</span> <span class="st">"Population"</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># name for new column containing the numeric values pivoted</span>
     <span class="fu">mutate</span><span class="op">(</span>Sex <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span>                <span class="co"># recode values for clarity</span>
          <span class="va">Sex</span>,
          <span class="st">"m"</span> <span class="op">=</span> <span class="st">"Male"</span>,
          <span class="st">"f"</span> <span class="op">=</span> <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The population data now look like this:</p>
<div id="htmlwidget-c436ce9bd3d19a7ac135" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c436ce9bd3d19a7ac135">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>And now we perform similar operations on the two deaths datasets.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deaths_countries</span> <span class="op">&lt;-</span> <span class="va">A_deaths</span> <span class="op">%&gt;%</span>    <span class="co"># begin with country A deaths dataset</span>
     <span class="fu">bind_rows</span><span class="op">(</span><span class="va">B_deaths</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># bind rows with B dataset, because cols are identically named</span>
     <span class="fu">pivot_longer</span><span class="op">(</span>                  <span class="co"># pivot longer</span>
          cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Male</span>, <span class="va">Female</span><span class="op">)</span>,        <span class="co"># column to transform into one</span>
          names_to <span class="op">=</span> <span class="st">"Sex"</span>,              <span class="co"># name for new column containing the category ("m" or "f") </span>
          values_to <span class="op">=</span> <span class="st">"Deaths"</span><span class="op">)</span> <span class="op">%&gt;%</span>      <span class="co"># name for new column containing the numeric values pivoted</span>
     <span class="fu">rename</span><span class="op">(</span>age_cat5 <span class="op">=</span> <span class="va">AgeCat</span><span class="op">)</span>    <span class="co"># rename for clarity</span></code></pre></div>
<p>The deaths data now look like this, and contains data from both countries:</p>
<div id="htmlwidget-a350c25b0a47933daa65" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a350c25b0a47933daa65">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>We now join the deaths and population data based on common columns <code>age_cat5</code>, <code>Sex</code>, and <code>Country</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_data</span> <span class="op">&lt;-</span> <span class="va">pop_countries</span> <span class="op">%&gt;%</span> 
     <span class="fu">left_join</span><span class="op">(</span><span class="va">deaths_countries</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Sex"</span>, <span class="st">"age_cat5"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can now classify <code>Sex</code>, <code>age_cat5</code>, and <code>Country</code> as factors so their ordering is specified correctly. We use the <code>as_factor()</code> function from the <strong>forcats</strong> package, as described in the page on [Factors].</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_data</span> <span class="op">&lt;-</span> <span class="va">country_data</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span>
          Country <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>,
          Country <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">Country</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,
          
          Sex <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span>,
          Sex <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">Sex</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>,
          
          age_cat5 <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">age_cat5</span><span class="op">)</span>,
          age_cat5 <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">age_cat5</span>,
                                 <span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>,
                                 <span class="st">"20-24"</span>, <span class="st">"25-29"</span>,  <span class="st">"30-34"</span>, <span class="st">"35-39"</span>,
                                 <span class="st">"40-44"</span>, <span class="st">"45-49"</span>, <span class="st">"50-54"</span>, <span class="st">"55-59"</span>,
                                 <span class="st">"60-64"</span>, <span class="st">"65-69"</span>, <span class="st">"70-74"</span>,
                                 <span class="st">"75-79"</span>, <span class="st">"80-84"</span>, <span class="st">"85"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
          <span class="fu">arrange</span><span class="op">(</span><span class="va">Country</span>, <span class="va">age_cat5</span>, <span class="va">Sex</span><span class="op">)</span></code></pre></div>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> NB. If you have few deaths per stratum, use 10-, or 15-year categories, instead of 5-year categories for age, or combine categories</span></p>
</div>
<div id="load-reference-population" class="section level3 unnumbered">
<h3>Load reference population<a class="anchor" aria-label="anchor" href="#load-reference-population"><i class="fas fa-link"></i></a>
</h3>
<p>Lastly, we import the reference population (world “standard population” by sex)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Reference population</span>
<span class="va">standard_pop_data</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"world_standard_population_by_sex.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-dbc601d8c79873dbcaab" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dbc601d8c79873dbcaab">{"x":{"filter":"none","data":[["0-4 years","0-4 years","5-9 years","5-9 years","10-14 years","10-14 years","15-19 years","15-19 years","20-24 years","20-24 years","25-29 years","25-29 years","30-34 years","30-34 years","35-39 years","35-39 years","40-44 years","40-44 years","45-49 years","45-49 years","50-54 years","50-54 years","55-59 years","55-59 years","60-64 years","60-64 years","65-69 years","65-69 years","70-74 years","70-74 years","75-79 years","75-79 years","80-84 years","80-84 years","85plus years","85plus years"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>WorldStandardPopulation<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="clean-reference-population" class="section level3 unnumbered">
<h3>Clean reference population<a class="anchor" aria-label="anchor" href="#clean-reference-population"><i class="fas fa-link"></i></a>
</h3>
<p>The values of the column <code>age_cat5</code> from the <code>standard_pop_data</code> contain the word “years” and “plus”, while those of the <code>country_data</code> do not. We will have to remove this string to make the age category values match. We use <code>str_replace_all()</code> from the <strong>stringr</strong> package, as descirbed in the page on [Characters and strings].</p>
<p>Furthermore, the package <strong>dsr</strong> expects that in the standard population, the column containing counts will be called <code>"pop"</code>. So we rename that column accordingly.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove specific string from column values</span>
<span class="va">standard_pop_clean</span> <span class="op">&lt;-</span> <span class="va">standard_pop_data</span> <span class="op">%&gt;%</span>
     <span class="fu">mutate</span><span class="op">(</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"years"</span>, <span class="st">""</span><span class="op">)</span>,   <span class="co"># remove "year"</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"plus"</span>, <span class="st">""</span><span class="op">)</span>,    <span class="co"># remove "plus"</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">" "</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># remove " " space</span>
     
     <span class="fu">rename</span><span class="op">(</span>pop <span class="op">=</span> <span class="va">WorldStandardPopulation</span><span class="op">)</span>   <span class="co"># change col name to "pop", as this is expected by dsr package</span></code></pre></div>
<p>Finally, we join the standard populations by age group to the country data. We use these in one step below (using <strong>PHEindicatormethods</strong>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">country_data</span>, <span class="va">standard_pop_clean</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age_cat5"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And the final dataset looks like this:</p>
<div id="htmlwidget-c6f08640f18ac38b3ff9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c6f08640f18ac38b3ff9">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500,12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n      <th>Deaths<\/th>\n      <th>pop<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="dsr-package" class="section level2" number="1.3">
<h2>
<span class="header-section-number">1.3</span> <strong>dsr</strong> package<a class="anchor" aria-label="anchor" href="#dsr-package"><i class="fas fa-link"></i></a>
</h2>
<p>Below we demonstrate calculating and comparing directly standardized rates using the <strong>dsr</strong> package. The <strong>dsr</strong> package allows you to calculate and compare directly standardized rates (no indirectly standardized rates!).</p>
<p>In the data Preparation section, we made:</p>
<ol style="list-style-type: decimal">
<li>the <code>country_data</code> object, which is a population table with the number of population and number of deaths per stratum per country<br>
</li>
<li>the <code>standard_pop_clean</code> object, containing the number of population per stratum for our reference population, the World Standard Population</li>
</ol>
<!-- ======================================================= --><div id="standardized-rates" class="section level3 unnumbered">
<h3>Standardized rates<a class="anchor" aria-label="anchor" href="#standardized-rates"><i class="fas fa-link"></i></a>
</h3>
<p>Below, we calculate rates per country directly standardized for age and sex. We use the <code>dsr()</code> function.</p>
<p>Of note - <code>dsr()</code> expects one data frame for the country populations and event counts (deaths), <em>and a <strong>separate</strong> data frame with the reference population</em>. It also expects that in this reference population dataset the unit-time column name is “pop” (we assured this in the data Preparation section).</p>
<p>There are many arguments, as annotated in the code below. Notably, <code>event =</code> is set to the column <code>Deaths</code>, and the <code>fu =</code> (“follow-up”) is set to the <code>Population</code> column. We set the subgroups of comparison as the column <code>Country</code> and we standardize based on <code>age_cat5</code> and <code>Sex</code>. These last two columns are not assigned a particular named argument. See <code>?dsr</code> for details.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate rates per country directly standardized for age and sex</span>
<span class="va">mortality_rate</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsr.html">dsr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>,  <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,       <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,      <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,   <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,             <span class="co"># other columns - rates will be standardized by these</span>
     <span class="va">Sex</span>,
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population data frame, with column called pop</span>
     method <span class="op">=</span> <span class="st">"gamma"</span>,      <span class="co"># method to calculate 95% CI</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,            <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,           <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>          <span class="co"># number of decimals)</span>


<span class="co"># Print output as nice-looking HTML table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rate</span><span class="op">)</span> <span class="co"># show mortality rate before and after direct standardization</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Subgroup
</th>
<th style="text-align:right;">
Numerator
</th>
<th style="text-align:right;">
Denominator
</th>
<th style="text-align:right;">
Crude Rate (per 1e+05)
</th>
<th style="text-align:right;">
95% LCL (Crude)
</th>
<th style="text-align:right;">
95% UCL (Crude)
</th>
<th style="text-align:right;">
Std Rate (per 1e+05)
</th>
<th style="text-align:right;">
95% LCL (Std)
</th>
<th style="text-align:right;">
95% UCL (Std)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
13.07
</td>
<td style="text-align:right;">
12.83
</td>
<td style="text-align:right;">
13.31
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
23.08
</td>
<td style="text-align:right;">
24.06
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
18.82
</td>
<td style="text-align:right;">
18.45
</td>
<td style="text-align:right;">
19.19
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
18.46
</td>
<td style="text-align:right;">
20.22
</td>
</tr>
</tbody>
</table></div>
<p>Above, we see that while country A had a lower crude mortality rate than country B, it has a higher standardized rate after direct age and sex standardization.</p>
<!-- ======================================================= -->
</div>
<div id="standardized-rate-ratios" class="section level3 unnumbered">
<h3>Standardized rate ratios<a class="anchor" aria-label="anchor" href="#standardized-rate-ratios"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate RR</span>
<span class="va">mortality_rr</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsrr.html">dsrr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>, <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,      <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,     <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,  <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,
     <span class="va">Sex</span>,                 <span class="co"># characteristics to which we would like to standardize </span>
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population, with numbers in column called pop</span>
     refgroup <span class="op">=</span> <span class="st">"B"</span>,      <span class="co"># reference for comparison</span>
     estimate <span class="op">=</span> <span class="st">"ratio"</span>,  <span class="co"># type of estimate</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,          <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,         <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>        <span class="co"># number of decimals</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rr</span><span class="op">)</span> </code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 1e+05)
</th>
<th style="text-align:right;">
Rate Ratio (RR)
</th>
<th style="text-align:right;">
95% LCL (RR)
</th>
<th style="text-align:right;">
95% UCL (RR)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
1.22
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
1.27
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
1.06
</td>
</tr>
</tbody>
</table></div>
<p>The standardized mortality rate is 1.22 times higher in country A compared to country B (95% CI 1.17-1.27).</p>
<!-- ======================================================= -->
</div>
<div id="standardized-rate-difference" class="section level3 unnumbered">
<h3>Standardized rate difference<a class="anchor" aria-label="anchor" href="#standardized-rate-difference"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate RD</span>
<span class="va">mortality_rd</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsrr.html">dsrr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>,       <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,            <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,           <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,        <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,                  <span class="co"># characteristics to which we would like to standardize</span>
     <span class="va">Sex</span>,                        
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population, with numbers in column called pop</span>
     refgroup <span class="op">=</span> <span class="st">"B"</span>,            <span class="co"># reference for comparison</span>
     estimate <span class="op">=</span> <span class="st">"difference"</span>,   <span class="co"># type of estimate</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,                <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,               <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>              <span class="co"># number of decimals</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rd</span><span class="op">)</span> </code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 1e+05)
</th>
<th style="text-align:right;">
Rate Difference (RD)
</th>
<th style="text-align:right;">
95% LCL (RD)
</th>
<th style="text-align:right;">
95% UCL (RD)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
4.24
</td>
<td style="text-align:right;">
3.24
</td>
<td style="text-align:right;">
5.24
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-1.24
</td>
<td style="text-align:right;">
1.24
</td>
</tr>
</tbody>
</table></div>
<p>Country A has 4.24 additional deaths per 100.000 population (95% CI 3.24-5.24) compared to country A.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="pheindicatormethods-package" class="section level2" number="1.4">
<h2>
<span class="header-section-number">1.4</span> <strong>PHEindicatormethods</strong> package<a class="anchor" aria-label="anchor" href="#pheindicatormethods-package"><i class="fas fa-link"></i></a>
</h2>
<p>Another way of calculating standardized rates is with the <strong>PHEindicatormethods</strong> package. This package allows you to calculate directly as well as indirectly standardized rates.</p>
<p>This package expects the reference (standard) population and the country-specific mortality and population data in <strong>one data frame</strong>, which we have made earlier: <code>all_data</code>.</p>
<!-- ======================================================= -->
<div id="directly-standardized-rates" class="section level3 unnumbered">
<h3>Directly standardized rates<a class="anchor" aria-label="anchor" href="#directly-standardized-rates"><i class="fas fa-link"></i></a>
</h3>
<p>Below, we first group the data by Country and then pass it to the function <code>phe_dsr()</code> to get directly standardized rates.<br>
See the help with <code>?phr_dsr</code> or the links in the References section for more information.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate rates per country directly standardized for age and sex</span>
<span class="va">mortality_rate_phe</span> <span class="op">&lt;-</span> <span class="va">all_data</span> <span class="op">%&gt;%</span>
     <span class="fu">group_by</span><span class="op">(</span><span class="va">Country</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">PHEindicatormethods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PHEindicatormethods/man/phe_dsr.html">phe_dsr</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">Deaths</span>,                 <span class="co"># column with observed number of events</span>
          n <span class="op">=</span> <span class="va">Population</span>,             <span class="co"># Column with non-standard pops for each category</span>
          stdpop <span class="op">=</span> <span class="va">pop</span>,               <span class="co"># standard populations for each stratum</span>
          stdpoptype <span class="op">=</span> <span class="st">"field"</span><span class="op">)</span>       <span class="co"># either "vector" for a standalone vector or "field" meaning std populations are in the data  </span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rate_phe</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Country
</th>
<th style="text-align:right;">
total_count
</th>
<th style="text-align:right;">
total_pop
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
lowercl
</th>
<th style="text-align:right;">
uppercl
</th>
<th style="text-align:left;">
confidence
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
23.56686
</td>
<td style="text-align:right;">
23.08107
</td>
<td style="text-align:right;">
24.05944
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
19.32549
</td>
<td style="text-align:right;">
18.45516
</td>
<td style="text-align:right;">
20.20882
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
</tbody>
</table></div>
<!-- ======================================================= -->
</div>
</div>
<div id="resources" class="section level2" number="1.5">
<h2>
<span class="header-section-number">1.5</span> Resources<a class="anchor" aria-label="anchor" href="#resources"><i class="fas fa-link"></i></a>
</h2>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> If you would like to see another reproducible example than listed in this Handbook, please go to <a href="https://mran.microsoft.com/snapshot/2020-02-12/web/packages/dsr/vignettes/dsr.html" class="uri">https://mran.microsoft.com/snapshot/2020-02-12/web/packages/dsr/vignettes/dsr.html</a>.</span></p>
<p><strong>PHEindicatormethods</strong> reference file: <a href="https://cran.r-project.org/web/packages/PHEindicatormethods/PHEindicatormethods.pdf" class="uri">https://cran.r-project.org/web/packages/PHEindicatormethods/PHEindicatormethods.pdf</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html">The Epidemiologist R Handbook</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#standardization"><span class="header-section-number">1</span> Standardization</a></li>
<li><a class="nav-link" href="#overview"><span class="header-section-number">1.1</span> Overview</a></li>
<li>
<a class="nav-link" href="#preparation"><span class="header-section-number">1.2</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-packages">Load packages</a></li>
<li><a class="nav-link" href="#load-population-data">Load population data</a></li>
<li><a class="nav-link" href="#load-death-counts">Load death counts</a></li>
<li><a class="nav-link" href="#clean-populations-and-deaths">Clean populations and deaths</a></li>
<li><a class="nav-link" href="#load-reference-population">Load reference population</a></li>
<li><a class="nav-link" href="#clean-reference-population">Clean reference population</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dsr-package"><span class="header-section-number">1.3</span> dsr package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#standardized-rates">Standardized rates</a></li>
<li><a class="nav-link" href="#standardized-rate-ratios">Standardized rate ratios</a></li>
<li><a class="nav-link" href="#standardized-rate-difference">Standardized rate difference</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#pheindicatormethods-package"><span class="header-section-number">1.4</span> PHEindicatormethods package</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#directly-standardized-rates">Directly standardized rates</a></li></ul>
</li>
<li><a class="nav-link" href="#resources"><span class="header-section-number">1.5</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-03-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
