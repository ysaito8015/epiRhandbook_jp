<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1 Epidemic curves | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Preview pages</li>
<li><a class="active" href="epidemic-curves.html"><span class="header-section-number">1</span> Epidemic curves</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="epidemic-curves" class="section level1" number="1">
<h1>
<span class="header-section-number">1</span> Epidemic curves<a class="anchor" aria-label="anchor" href="#epidemic-curves"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-75-1.png" width="75%"></div>
<p>An epidemic curve (also known as an â€œepi curveâ€) is a core epidemiological chart typically used to visualize the temporal pattern of illness onset among a cluster or epidemic of cases.</p>
<p>Analysis of the epicurve can reveal temporal trends, outliers, the magnitude of the outbreak, the most likely time period of exposure, time intervals between case generations, and can even help identify the mode of transmission of an unidentified disease (e.g.Â point source, continuous common source, person-to-person propagation). One online lesson on interpretation of epi curves can be found at the website of the <a href="https://www.cdc.gov/training/quicklearns/epimode/index.html">US CDC</a>.</p>
<p>In this page we demonstrate two approaches to producing epicurves in R:</p>
<ul>
<li>The <strong>incidence2</strong> package, which can produce an epi curve with simple commands<br>
</li>
<li>The <strong>ggplot2</strong> package, which allows for advanced customizability via more complex commands</li>
</ul>
<p>Also addressed are specific use-cases such as:</p>
<ul>
<li>Plotting aggregated count data<br>
</li>
<li>Faceting or producing small-multiples<br>
</li>
<li>Applying moving averages<br>
</li>
<li>Showing which data are â€œtentativeâ€ or subject to reporting delays<br>
</li>
<li>Overlaying cumulative case incidence using a second axis</li>
</ul>
<!-- ======================================================= --><div id="preparation" class="section level2" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation"><i class="fas fa-link"></i></a>
</h2>
<div id="packages" class="section level3 unnumbered">
<h3>Packages<a class="anchor" aria-label="anchor" href="#packages"><i class="fas fa-link"></i></a>
</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary and loads it for use. You can also load packages with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> from <strong>base</strong> R. See the page on [R basics] for more information on R packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,          <span class="co"># file import/export</span>
  <span class="va">here</span>,         <span class="co"># relative filepaths </span>
  <span class="va">lubridate</span>,    <span class="co"># working with dates/epiweeks</span>
  <span class="va">aweek</span>,        <span class="co"># alternative package for working with dates/epiweeks</span>
  <span class="va">incidence2</span>,   <span class="co"># epicurves of linelist data</span>
  <span class="va">i2extras</span>,     <span class="co"># supplement to incidence2</span>
  <span class="va">stringr</span>,      <span class="co"># search and manipulate character strings</span>
  <span class="va">forcats</span>,      <span class="co"># working with factors</span>
  <span class="va">RColorBrewer</span>, <span class="co"># Color palettes from colorbrewer2.org</span>
  <span class="va">tidyverse</span>     <span class="co"># data management + ggplot2 graphics</span>
<span class="op">)</span> </code></pre></div>
</div>
<div id="import-data" class="section level3 unnumbered">
<h3>Import data<a class="anchor" aria-label="anchor" href="#import-data"><i class="fas fa-link"></i></a>
</h3>
<p>Two example datasets are used in this section:</p>
<ul>
<li>Linelist of individual cases from a simulated epidemic<br>
</li>
<li>Aggregated counts by hospital from the same simulated epidemic</li>
</ul>
<p>The datasets are imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on [Import and export] for various ways to import data.</p>
<p><strong>Case linelist</strong></p>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instruction in the [Datasets used] page.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p>The first 50 rows are displayed below.</p>
<div id="htmlwidget-01f7b9c6b4e8800624c0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-01f7b9c6b4e8800624c0">{"x":{"filter":"none","data":[["a3c8b8","d8a13d","5fe599","8689b7","11f8ea","893f25","be99c8","d0523a","ce9c02","275cc7","07e3e8","8a4580","2b8773","057e7a","be502d","4cff96","bab455","a6c614","c15f36","2eaa9a","2ebf95","c36eb4","02d8fd","af9f9a","88eff2","f50e8a","bc648d","567136","b799eb","67184b","170473","42e1a9","64c8ef","8ebf6e","e56412","0b46a0","188619","62a2ef","da8ecb","148f18","a9feb3","92ab68","58b968","f81362","6670a5","92ddf7","386dfb","3ad520","ae50c8","2ed605"],[4,4,4,4,2,3,3,7,5,5,4,4,5,7,5,6,5,5,5,5,6,8,9,6,5,10,9,6,5,6,7,12,6,7,9,9,7,9,5,6,6,8,10,8,9,9,9,7,9,9],["2014-05-07","2014-05-06","2014-05-08",null,null,"2014-05-18","2014-05-03","2014-05-20","2014-05-27","2014-05-24","2014-05-22",null,"2014-05-31","2014-06-04","2014-06-09","2014-06-05",null,"2014-06-05",null,"2014-06-07",null,"2014-06-15","2014-06-14",null,null,null,null,null,"2014-06-27",null,"2014-07-05",null,null,"2014-07-02","2014-07-12","2014-07-12","2014-07-05","2014-07-02","2014-06-20",null,"2014-06-29",null,"2014-07-18",null,"2014-07-18","2014-07-19","2014-07-19","2014-07-12","2014-07-20","2014-07-27"],["2014-05-08","2014-05-08","2014-05-13","2014-05-13","2014-05-16","2014-05-21","2014-05-22","2014-05-24","2014-05-27","2014-05-27","2014-05-27","2014-06-02","2014-06-06","2014-06-14","2014-06-15","2014-06-15","2014-06-15","2014-06-16","2014-06-17","2014-06-17","2014-06-19","2014-06-20","2014-06-20","2014-06-20","2014-06-20","2014-06-22","2014-06-30","2014-07-02","2014-07-03","2014-07-04","2014-07-09","2014-07-12","2014-07-14","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-19","2014-07-19","2014-07-20","2014-07-20","2014-07-20","2014-07-23","2014-07-23","2014-07-24","2014-07-25","2014-07-28"],["2014-05-10","2014-05-10","2014-05-15","2014-05-14","2014-05-18","2014-05-22","2014-05-23","2014-05-26","2014-05-29","2014-05-28","2014-05-29","2014-06-02","2014-06-07","2014-06-15","2014-06-16","2014-06-16","2014-06-16","2014-06-18","2014-06-19","2014-06-17","2014-06-21","2014-06-21","2014-06-20","2014-06-20","2014-06-21","2014-06-23","2014-07-02","2014-07-03","2014-07-05","2014-07-06","2014-07-10","2014-07-14","2014-07-15","2014-07-14","2014-07-17","2014-07-16","2014-07-19","2014-07-19","2014-07-20","2014-07-20","2014-07-21","2014-07-20","2014-07-21","2014-07-21","2014-07-22","2014-07-25","2014-07-23","2014-07-24","2014-07-27","2014-07-30"],["2014-05-14",null,null,"2014-05-18","2014-05-30","2014-05-29","2014-05-24","2014-06-05","2014-06-17","2014-06-07","2014-06-01",null,"2014-06-16",null,"2014-06-19","2014-06-25","2014-06-18","2014-06-26","2014-06-28",null,"2014-06-23","2014-06-24","2014-07-01","2014-07-13","2014-06-24","2014-07-01","2014-07-14","2014-07-07","2014-07-12","2014-07-09","2014-08-09","2014-07-20","2014-07-25","2014-07-27","2014-07-19","2014-08-11","2014-07-24","2014-07-23","2014-08-01","2014-07-23","2014-08-03","2014-08-05","2014-07-28","2014-08-07","2014-08-01",null,null,null,"2014-08-08","2014-08-09"],["Recover",null,null,"Recover","Recover","Recover","Recover",null,"Death","Death","Recover","Death",null,"Recover","Death",null,"Death","Recover","Recover","Recover","Death","Death","Death",null,"Death",null,"Recover",null,"Recover","Death","Recover","Death","Recover","Recover","Death","Recover","Death","Death",null,"Death","Death",null,null,"Death","Death","Recover","Recover",null,"Death",null],["m","f","m","f","m","m","f","f","m","f","f","m","f","f","m","m","f","f","f","f","m","m","m","f","f","f","m","m","m","m","f","f","m","f","f","f","m","f","m","f","f","f","m","m","f","m","f","f","f","f"],[1,4,21,2,27,25,18,2,20,4,22,7,7,18,33,34,12,31,0,3,3,51,51,9,15,8,35,37,34,15,35,9,30,9,23,13,25,14,39,1,14,12,14,28,13,6,42,10,6,10],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,4,21,2,27,25,18,2,20,4,22,7,7,18,33,34,12,31,0,3,3,51,51,9,15,8,35,37,34,15,35,9,30,9,23,13,25,14,39,1,14,12,14,28,13,6,42,10,6,10],["0-4","0-4","20-29","0-4","20-29","20-29","15-19","0-4","20-29","0-4","20-29","5-9","5-9","15-19","30-49","30-49","10-14","30-49","0-4","0-4","0-4","50-69","50-69","5-9","15-19","5-9","30-49","30-49","30-49","15-19","30-49","5-9","30-49","5-9","20-29","10-14","20-29","10-14","30-49","0-4","10-14","10-14","10-14","20-29","10-14","5-9","30-49","10-14","5-9","10-14"],["0-4","0-4","20-24","0-4","25-29","25-29","15-19","0-4","20-24","0-4","20-24","5-9","5-9","15-19","30-34","30-34","10-14","30-34","0-4","0-4","0-4","50-54","50-54","5-9","15-19","5-9","35-39","35-39","30-34","15-19","35-39","5-9","30-34","5-9","20-24","10-14","25-29","10-14","35-39","0-4","10-14","10-14","10-14","25-29","10-14","5-9","40-44","10-14","5-9","10-14"],["Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Missing","Port Hospital","Central Hospital","Missing","Military Hospital","Missing","Missing","Military Hospital","Port Hospital","Port Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Military Hospital","Military Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Central Hospital","Missing","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Other","Military Hospital","Missing","Military Hospital","Missing","Port Hospital","Military Hospital"],[-13.2231931914572,-13.2354719577436,-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2228638912441,-13.222625321098,-13.2565628977111,-13.2243703238737,-13.2369393782451,-13.2331547837254,-13.2222002700958,-13.2149474159902,-13.2180326141688,-13.2535215623253,-13.217651519706,-13.2372027220014,-13.2190654487695,-13.2189533374241,-13.209391925612,-13.2265780018024,-13.2619688324425,-13.2124311244169,-13.2371313571269,-13.2195578885261,-13.2336087079551,-13.2130045468176,-13.2160657166043,-13.2162953240809,-13.2355883289789,-13.247814368147,-13.2142410663192,-13.2614705796373,-13.2630592726116,-13.2343341712241,-13.2087039682346,-13.2581175859281,-13.2379376608352,-13.218781651651,-13.2483677722899,-13.2155668757305,-13.2333516655879,-13.238964614443,-13.2163318124535,-13.2217866965605,-13.2221173306518,-13.2510797882678,-13.262635786914,-13.2472895700622,-13.2597714344876],[8.47325128269697,8.4627682729487,8.46897295100924,8.45171855856465,8.46481700596819,8.46082377490923,8.46183062600728,8.48379248016347,8.47024789713924,8.46916113869591,8.46272931462646,8.46388925014565,8.45192988292173,8.47155535608018,8.45884880725177,8.46236804334872,8.46956119136946,8.47737640975659,8.45136291368722,8.47570184950483,8.48676680560442,8.48475855218221,8.45344099552146,8.48777544809491,8.46210832824745,8.47804840685363,8.47135450705077,8.48802917129884,8.46395131808455,8.4728562695215,8.47038713612408,8.4641347894342,8.45750552360835,8.47493999153642,8.47832062438022,8.4763997148275,8.45535258467199,8.4697737543226,8.48438437371817,8.48466158574339,8.4627846208641,8.46517148129756,8.48776686246878,8.4630635336683,8.4623972994508,8.46420961833913,8.47178418137766,8.4632880274758,8.48450777619227,8.45925216791802],["2ae019","20b688","f547d6",null,null,"11f8ea","aec8ec","4b38b7","53da57","e02f66","893f25",null,"5387a2","cbbe78","a2086d","ba7326",null,"3ff1bc",null,"9f6884",null,"057e7a","e61cb9",null,null,null,null,null,"ea3740",null,"71577a",null,null,"567136","894024","894024","71577a","b0c500","eb2277",null,"af1c1f",null,"62a2ef",null,"67be4e","d15be5","f36522","312ecf","26c588","e26da6"],["other","other","other",null,null,"other","other","other","other","other","other",null,"other","funeral","other","other",null,"funeral",null,"other",null,"other","other",null,null,null,null,null,"other",null,"other",null,null,"other","funeral","funeral","other","other","funeral",null,"other",null,"other",null,"other","other","other","other","other","other"],[18,35,78,18,68,66,57,25,64,41,72,45,29,53,71,77,52,71,0,35,45,82,92,34,40,42,67,75,66,52,84,39,66,52,55,60,67,59,75,28,61,55,77,68,51,44,88,46,33,53],[50,74,148,61,198,161,116,48,156,75,144,109,99,140,157,146,118,162,22,62,58,195,257,114,144,96,206,172,176,125,229,88,177,88,150,151,169,136,186,24,124,147,163,167,152,89,188,112,72,139],[22,21,22,23,21,21,22,20,22,23,22,20,22,22,21,22,22,23,23,21,23,20,22,22,22,22,22,22,22,22,23,23,23,22,23,23,20,22,21,22,23,23,23,20,21,21,22,21,22,23],[null,"no","no",null,null,"no",null,"no","no","no","no","no","no","no",null,null,null,"no","no",null,"no","no","no","no","no",null,"no",null,null,"no",null,null,"no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no"],[null,"no","yes",null,null,"no",null,"yes","no","no","no","no","yes","yes",null,null,null,"no","no",null,"no","no","no","no","no",null,"no",null,null,"no",null,null,"yes",null,"no","no","no","yes","no","no","no","yes","yes","yes","no","no",null,"no","no","yes"],[null,"yes","yes",null,null,"yes",null,"no","yes","yes","yes","no","yes","yes",null,null,null,"yes","yes",null,"yes","no","yes","yes","yes",null,"yes",null,null,"yes",null,null,"yes",null,"no","yes","yes","yes","yes","no","yes","yes","no","yes","yes","yes",null,"yes","yes","yes"],[null,"no","yes",null,null,"no",null,"no","no","no","no","no","no","no",null,null,null,"no","no",null,"no","no","no","no","no",null,"no",null,null,"no",null,null,"no",null,"no","no","no","no","no","no","no","no","yes","no","no","yes",null,"no","no","no"],[null,"yes","yes",null,null,"yes",null,"yes","yes","no","yes","no","yes","yes",null,null,null,"no","yes",null,"no","yes","yes","no","yes",null,"yes",null,null,"yes",null,null,"no",null,"yes","yes","no","no","no","no","yes","yes","no","yes","no","no",null,"no","yes","no"],[37.3,37.4,37,36,36.7,37.3,36.8,37,36.4,37.2,37.3,36.9,37,36.9,37.3,37.1,36.7,36.6,37.7,37.6,36.8,36.9,36.6,37.7,37,36.4,36.4,37.4,36.3,37,37.5,37.8,36.8,37.5,37.4,36.5,37.2,36.6,37.3,36.3,37.2,36.9,36.4,36.4,36.2,37,37.2,37.3,36.4,37.5],["20:35","14:16","09:17","11:32","18:52","16:51",null,"14:29","11:57","09:21","13:08","23:20","17:29",null,"18:39",null,"14:16",null,"08:00","11:43","11:10","15:10","11:53","19:11",null,"14:26","04:17","17:32",null,null,"12:28",null,"10:12","10:39","16:46","19:50","16:06","13:52","11:28","07:40","12:60","15:24","06:27","06:17","09:36","14:01","17:06","12:57","13:07",null],[72,63.9152666179693,35.6099342585829,48.3740929857565,17.3451688603204,25.4619806334632,42.3602853745541,108.506944444444,26.2984878369494,72.8888888888889,34.7222222222222,37.8755996969952,29.5888174676053,27.0408163265306,28.8044139721693,36.1231000187652,37.3455903476013,27.0538027739674,0,91.05098855359,133.769322235434,21.5647600262985,13.9290526730155,26.1618959679902,19.2901234567901,45.5729166666667,15.7884814779904,25.3515413737155,21.3068181818182,33.28,16.018001182281,50.3615702479339,21.0667432730058,67.1487603305785,24.4444444444444,26.3146353230121,23.458562375267,31.8987889273356,21.6788067984738,486.111111111111,39.6722164412071,25.4523578138738,28.9811434378411,24.3823729785937,22.0740997229917,55.5485418507764,24.8981439565414,36.6709183673469,63.6574074074074,27.431292376171],[2,2,2,1,2,1,1,2,2,1,2,0,1,1,1,1,1,2,2,0,2,1,0,0,1,1,2,1,2,2,1,2,1,0,2,0,2,2,2,1,2,1,1,1,2,2,0,0,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Case counts aggregated by hospital</strong></p>
<p>For the purposes of the handbook, the dataset of weekly aggregated counts by hospital is created from the <code>linelist</code> with the following code.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the counts data into R</span>
<span class="va">count_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The first 50 rows are displayed below:</p>
<div id="htmlwidget-ad58ec60c3d64d365a1c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ad58ec60c3d64d365a1c">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="set-parameters" class="section level3 unnumbered">
<h3>Set parameters<a class="anchor" aria-label="anchor" href="#set-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>For production of a report, you may want to set editable parameters such as the date for which the data is current (the â€œdata dateâ€).
You can then reference the object <code>data_date</code> in your code when applying filters or in dynamic captions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set the report date for the report</span>
<span class="co">## note: can be set to Sys.Date() for the current date</span>
<span class="va">data_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-05-15"</span><span class="op">)</span></code></pre></div>
</div>
<div id="verify-dates" class="section level3 unnumbered">
<h3>Verify dates<a class="anchor" aria-label="anchor" href="#verify-dates"><i class="fas fa-link"></i></a>
</h3>
<p>Verify that each relevant date column is class Date and has an appropriate range of values. You can do this simply using <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code> for histograms, or <code><a href="https://rdrr.io/r/base/range.html">range()</a></code> with <code>na.rm=TRUE</code>, or with <code>ggplot()</code> as below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># check range of onset dates</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="50%"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurves-with-incidence2-package" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> Epicurves with <code>incidence2</code> package<a class="anchor" aria-label="anchor" href="#epicurves-with-incidence2-package"><i class="fas fa-link"></i></a>
</h2>
<p>Below we demonstrate how to make epicurves using the <strong>incidence2</strong> package. The authors of this package have tried to allow the user to create and modify epicurves without needing to know <strong>ggplot2</strong> syntax. Much of this page is adapted from the package vignettes, which can be found at the <strong>incidence2</strong> <a href="https://github.com/reconhub/incidence2">github page</a>.</p>
<!-- ======================================================= -->
<div id="simple-example" class="section level3 unnumbered">
<h3>Simple example<a class="anchor" aria-label="anchor" href="#simple-example"><i class="fas fa-link"></i></a>
</h3>
<p><strong>2 steps are required to plot an epidemic curve with the <em>incidence2</em> package:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Create</strong> an <em>incidence object</em> (using the function <code>incidence()</code>)
<ul>
<li>Provide the data<br>
</li>
<li>Specify the date column to <code>date_index =</code><br>
</li>
<li>Specify the <code>interval =</code> into which the cases should be aggregated (daily, weekly, monthly..)<br>
</li>
<li>Specify any grouping columns (e.g.Â gender, hospital, outcome)<br>
</li>
</ul>
</li>
<li>
<strong>Plot</strong> the incidence object
<ul>
<li>Specify labels, colors, titles, etc.</li>
</ul>
</li>
</ol>
<p>Below, we load the <strong>incidence2</strong> package, create the incidence object from the <code>linelist</code> on column <code>date_onset</code> and aggregated cases by day. We then print a summary of the incidence object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load incidence2 package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">incidence2</span><span class="op">)</span>

<span class="co"># create the incidence object, aggregating cases by day</span>
<span class="va">epi_day</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>       <span class="co"># create incidence object</span>
  x <span class="op">=</span> <span class="va">linelist</span>,             <span class="co"># dataset</span>
  date_index <span class="op">=</span> <span class="va">date_onset</span>,  <span class="co"># date column</span>
  interval <span class="op">=</span> <span class="st">"day"</span>          <span class="co"># date grouping interval</span>
  <span class="op">)</span>

<span class="co"># print summary of the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">epi_day</span><span class="op">)</span></code></pre></div>
<pre><code>##  [38;5;246mAn incidence2 object: 389 x 2
##  [39m5888 cases from days 2014-04-07 to 2015-04-30
## interval: 1 day
## cumulative: FALSE
## timespan: 389 days</code></pre>
<p>To plot the <em>incidence</em> object, use <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> on the <em>name of the incidence object</em>. In the background, the function <code>plot.incidence2()</code> is called, so to read the <strong>incidence2</strong>-specific documentation you would run <code>?plot.incidence2</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_day</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-84-1.png" width="672"></div>
</div>
<div id="change-time-interval-of-case-aggregation" class="section level3 unnumbered">
<h3>Change time interval of case aggregation<a class="anchor" aria-label="anchor" href="#change-time-interval-of-case-aggregation"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>interval</code> argument of <code>incidence()</code> defines how the observations are grouped into vertical bars.</p>
<p><strong>Specify interval</strong></p>
<p><strong>incidence2</strong> provides flexibility and understandable syntax for specifying how you want to aggregate your cases into epicurve bars. Provide a value like the ones below to the <code>interval =</code> argument:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Argument option</th>
<th>Further explanation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Number (1, 7, 13, 14, etc.)</td>
<td>Number of days</td>
</tr>
<tr class="even">
<td>â€œweekâ€</td>
<td>note: Monday start day is default</td>
</tr>
<tr class="odd">
<td>â€œ2 weeksâ€</td>
<td>or 3, 4, 5â€¦</td>
</tr>
<tr class="even">
<td>â€œSunday weekâ€</td>
<td>weeks beginning on Sundays (could also use Thursday, etc.)</td>
</tr>
<tr class="odd">
<td>â€œ2 Sunday weeksâ€</td>
<td>or 3, 4, 5â€¦</td>
</tr>
<tr class="even">
<td>â€œMMWRweekâ€</td>
<td>week starts on Sundays - see US CDC</td>
</tr>
<tr class="odd">
<td>â€œmonthâ€</td>
<td>1st of month</td>
</tr>
<tr class="even">
<td>â€œquarterâ€</td>
<td>1st of month of quarter</td>
</tr>
<tr class="odd">
<td>â€œ2 monthsâ€</td>
<td>or 3, 4, 5â€¦</td>
</tr>
<tr class="even">
<td>â€œyearâ€</td>
<td>1st day of calendar year</td>
</tr>
</tbody>
</table></div>
<p>Below are examples of how different intervals look when applied to the linelist. Note how the default format and frequency of the date <em>labels</em> on the x-axis change as the date interval changes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create the incidence objects (with different intervals)</span>
<span class="co">##############################</span>
<span class="co"># Weekly (Monday week by default)</span>
<span class="va">epi_wk</span>      <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span>

<span class="co"># Sunday week</span>
<span class="va">epi_Sun_wk</span>  <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span>

<span class="co"># Three weeks (Monday weeks by default)</span>
<span class="va">epi_2wk</span>     <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"2 weeks"</span><span class="op">)</span>

<span class="co"># Monthly</span>
<span class="va">epi_month</span>   <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span>

<span class="co"># Quarterly</span>
<span class="va">epi_quarter</span>   <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span>

<span class="co"># Years</span>
<span class="va">epi_year</span>   <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>


<span class="co"># Plot the incidence objects (+ titles for clarity)</span>
<span class="co">############################</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_wk</span><span class="op">)</span><span class="op">+</span>      <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Monday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_Sun_wk</span><span class="op">)</span><span class="op">+</span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sunday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_2wk</span><span class="op">)</span><span class="op">+</span>     <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"2 (Monday) weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_month</span><span class="op">)</span><span class="op">+</span>   <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Months"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_quarter</span><span class="op">)</span><span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Quarters"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_year</span><span class="op">)</span><span class="op">+</span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Years"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/incidence-1.png" width="50%"><img src="_main_files/figure-html/incidence-2.png" width="50%"><img src="_main_files/figure-html/incidence-3.png" width="50%"><img src="_main_files/figure-html/incidence-4.png" width="50%"><img src="_main_files/figure-html/incidence-5.png" width="50%"><img src="_main_files/figure-html/incidence-6.png" width="50%"></p>
<p><strong>Begin at first case</strong></p>
<p>If you want the intervals to begin at the first case, you can add the argument <code>standard = TRUE</code> to the <code>incidence()</code> command. This only works if the interval is either â€œweekâ€, â€œmonthâ€, â€œquarterâ€ or â€œyearâ€.</p>
<p><strong>First and late date</strong></p>
<p>You can optionally specify the <code>first_date =</code> and <code>last_date =</code> in the <code>incidence()</code> command. If given, the data will be trimmed to this range.</p>
</div>
<div id="groups" class="section level3 unnumbered">
<h3>Groups<a class="anchor" aria-label="anchor" href="#groups"><i class="fas fa-link"></i></a>
</h3>
<p>Groups are specified in the <code>incidence()</code> command, and can be used to color the bars or to facet the data. To specify groups in your data provide the column name(s) to the <code>groups =</code> argument in the <code>incidence()</code> command (no quotes). If specifying multiple columns, put their names within <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>.</p>
<p>You can specify that cases with missing values in the grouping columns be listed as a distinct <code>NA</code> group by setting <code>na_as_group = TRUE</code>. Otherwise, they will be excluded from the plot.</p>
<p><em>To color the bars by a grouping column</em>, you must again provide the column name to <code>fill =</code> in the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> command.<br><em>To facet based on a grouping column</em>, see the section below on facets with <strong>incidence2</strong>.</p>
<p>In the example below, the cases in the whole outbreak are grouped by their age category. Missing values are included as a group. The epicurve interval is weeks.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category</span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,                <span class="co"># dataset</span>
  date_index <span class="op">=</span> <span class="va">date_onset</span>, <span class="co"># date column</span>
  interval <span class="op">=</span> <span class="st">"week"</span>,       <span class="co"># Monday weekly aggregation of cases</span>
  groups <span class="op">=</span> <span class="va">age_cat</span>,        <span class="co"># age_cat is set as a group</span>
  na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      <span class="co"># missing values assigned their own group</span>

<span class="co"># plot the grouped incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">age_outbreak</span>,             <span class="co"># incidence object with age_cat as group</span>
  fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">+</span>          <span class="co"># age_cat is used for bar fill color (must have been set as a groups column above)</span>
<span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Age Category"</span><span class="op">)</span> <span class="co"># change legend title from default "age_cat" (this is a ggplot2 modification)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.png" width="672"><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Change the title of the legend by adding <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> the <strong>ggplot2</strong> command <code>labs(fill = "your title")</code> to your <strong>incidence2</strong> plot.</span></p>
<p>You can also have the grouped bars display side-by-side by setting <code>stack = FALSE</code> in <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, as shown below:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make incidence object of monthly counts. </span>
<span class="va">monthly_gender</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
 <span class="va">linelist</span>,
 date_index <span class="op">=</span> <span class="va">date_onset</span>,
 interval <span class="op">=</span> <span class="st">"month"</span>,
 groups <span class="op">=</span> <span class="va">gender</span>            <span class="co"># set gender as grouping column</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">monthly_gender</span>,   <span class="co"># incidence object</span>
  fill <span class="op">=</span> <span class="va">gender</span>,    <span class="co"># display bars colored by gender</span>
  stack <span class="op">=</span> <span class="cn">FALSE</span>,    <span class="co"># side-by-side (not stacked)</span>
  col_pal <span class="op">=</span> <span class="va">muted</span><span class="op">)</span>  <span class="co"># incidence2 color palette</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-86-1.png" width="672"></div>
</div>
<div id="filtered-data" class="section level3 unnumbered">
<h3>Filtered data<a class="anchor" aria-label="anchor" href="#filtered-data"><i class="fas fa-link"></i></a>
</h3>
<p>To plot the epicurve of a subset of data:</p>
<ol style="list-style-type: decimal">
<li>Filter the linelist data<br>
</li>
<li>Provide the filtered data to the <code>incidence()</code> command<br>
</li>
<li>Plot the incidence object</li>
</ol>
<p>The example below uses data filtered to show only cases at Central Hospital.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span>, date_index <span class="op">=</span> <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>

<span class="co"># plot the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weekly case incidence at Central Hospital"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-87-1.png" width="672"></div>
</div>
<div id="aggregated-counts" class="section level3 unnumbered">
<h3>Aggregated counts<a class="anchor" aria-label="anchor" href="#aggregated-counts"><i class="fas fa-link"></i></a>
</h3>
<p>If your original data are aggregated (counts), provide the name of the column that contains the case counts to the <code>count =</code> argument when creating the incidence object.</p>
<p>For example, this data frame <code>count_data</code> is the linelist aggregated into daily counts by hospital. The first 50 rows look like this:</p>
<div id="htmlwidget-cab1163cf34aece0a89e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-cab1163cf34aece0a89e">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>If you are beginning your analysis with daily count data like the dataset above, your <code>incidence()</code> command to convert this to a weekly epicurve by hospital would look like this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epi_counts</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">count_data</span>,                         <span class="co"># dataset with counts aggregated by day</span>
  date_index <span class="op">=</span> <span class="va">date_hospitalisation</span>,  <span class="co"># column with dates</span>
  count <span class="op">=</span> <span class="va">n_cases</span>,                    <span class="co"># column with counts</span>
  interval <span class="op">=</span> <span class="st">"week"</span>,                  <span class="co"># aggregate daily counts up to weeks</span>
  groups <span class="op">=</span> <span class="va">hospital</span>                   <span class="co"># group by hospital</span>
  <span class="op">)</span>

<span class="co"># plot the weekly incidence epi curve, with stacked bars by hospital</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_counts</span>,                      <span class="co"># incidence object</span>
     fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>                 <span class="co"># color the bars by hospital</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-89-1.png" width="672"></div>
</div>
<div id="facetssmall-multiples" class="section level3 unnumbered">
<h3>Facets/small multiples<a class="anchor" aria-label="anchor" href="#facetssmall-multiples"><i class="fas fa-link"></i></a>
</h3>
<p>To facet the data by group (i.e.Â produce â€œsmall multiplesâ€):</p>
<ol style="list-style-type: decimal">
<li>Specify the faceting column to <code>groups =</code> when you create the incidence object<br>
</li>
<li>Use the <code>facet_plot()</code> command instead of <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code><br>
</li>
<li>Specify which grouping columns to use as <code>fill =</code> and which to use as <code>facets =</code>
</li>
</ol>
<p>Below, we set both columns <code>hospital</code> and <code>outcome</code> as grouping columns in the <code>incidence()</code> command. Then, in <code>facet_plot()</code> we plot the epicurve, specifying that we want a different epicurve for each hospital and that within each epicurve the bars should be stacked and colored by outcome.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epi_wks_hosp_out</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,                      <span class="co"># dataset</span>
  date_index <span class="op">=</span> <span class="va">date_onset</span>,       <span class="co"># date column</span>
  interval <span class="op">=</span> <span class="st">"month"</span>,            <span class="co"># monthly bars  </span>
  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">hospital</span><span class="op">)</span>  <span class="co"># both outcome and hospital are given as grouping columns</span>
  <span class="op">)</span>

<span class="co"># plot</span>
<span class="fu">facet_plot</span><span class="op">(</span>
  <span class="va">epi_wks_hosp_out</span>,    <span class="co"># incidence object</span>
  facets <span class="op">=</span> <span class="va">hospital</span>,   <span class="co"># facet column</span>
  fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>      <span class="co"># fill column</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-90-1.png" width="672"></div>
</div>
<div id="modifications-with-plot" class="section level3 unnumbered">
<h3>Modifications with <code>plot()</code><a class="anchor" aria-label="anchor" href="#modifications-with-plot"><i class="fas fa-link"></i></a>
</h3>
<p>An epicurve produced by <strong>incidence2</strong> can be modified via these arguments <em>within the <strong>incidence2</strong> <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function</em>.</p>
<p><strong>Here are <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> arguments relating to the bars:</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="23%">
<col width="51%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>Argument</th>
<th>Description</th>
<th>Examples</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>fill =</code></td>
<td>Bar color. Either a color name or a column name previously specified to <code>groups =</code> in <code>incidence()</code> command</td>
<td>
<code>fill = "red"</code>, or <code>fill = gender</code>
</td>
</tr>
<tr class="even">
<td><code>na_as_group =</code></td>
<td>If FALSE, missing values of a grouping column are excluded from plot</td>
<td><code>na_as_group = FALSE</code></td>
</tr>
<tr class="odd">
<td><code>border =</code></td>
<td>Color around each bar/box, or grouping within a bar</td>
<td><code>border = "white"</code></td>
</tr>
<tr class="even">
<td><code>legend =</code></td>
<td>Location of legend</td>
<td>One of â€œbottomâ€, â€œtopâ€, â€œleftâ€, â€œrightâ€, or â€œnoneâ€</td>
</tr>
<tr class="odd">
<td><code>alpha =</code></td>
<td>Transparency of bars/boxes</td>
<td>1 is fully opaque, 0 is fully transparent</td>
</tr>
<tr class="even">
<td><code>show_cases =</code></td>
<td>Logical; if TRUE, each case shows as a box. Displays best on smaller outbreaks. Can be used with <code>coord_equal = T</code> to ensure squares.</td>
<td><code>show_cases = TRUE</code></td>
</tr>
<tr class="odd">
<td><code>coord_equal =</code></td>
<td>For use if <code>show_cases = TRUE</code>; if TRUE the x and y axes display with equal ratio</td>
<td><code>coord_equal = TRUE</code></td>
</tr>
</tbody>
</table></div>
<p><strong>Here are <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> arguments relating to the date axis:</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="29%">
<col width="70%">
</colgroup>
<thead><tr class="header">
<th>Argument(s)</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>n_breaks =</code></td>
<td>Number of x-axis label breaks, absent other modifications. These will start counting from the interval of the first case.</td>
</tr>
<tr class="even">
<td><code>format =</code></td>
<td>Accepts character string of desired format. See <code><a href="https://rdrr.io/r/base/strptime.html">?strptime</a></code> or Handbook page on [Working with dates]. For example â€œ%d %bâ€ for â€œ02 Febâ€.</td>
</tr>
<tr class="odd">
<td><code>angle =</code></td>
<td>Angle of x-axis date labels</td>
</tr>
<tr class="even">
<td><code>centre_ticks =</code></td>
<td>If TRUE, date labels are centered within bars. Only works if interval is singular (one week, month, quarter, or year)</td>
</tr>
<tr class="odd">
<td><code>group_labels =</code></td>
<td>Used if plotting weekly interval. If FALSE labels will appear YYYY-MM-DD, else YYYY-Www (absent other modifications)</td>
</tr>
</tbody>
</table></div>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> For breaks every â€œnthâ€ interval (e.g.Â every 4th), use <code>n_breaks = nrow(i)/n</code> (where â€œiâ€ is your incidence object name and â€œnâ€ is a number). If your data are grouped, you will need to multiply â€œnâ€ by the number of unique groups.</span></p>
<p><strong>Here are <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> arguments relating to labels:</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="29%">
<col width="70%">
</colgroup>
<thead><tr class="header">
<th>Argument(s)</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>title =</code></td>
<td>Title of plot</td>
</tr>
<tr class="even">
<td><code>xlab =</code></td>
<td>Title of x-axis</td>
</tr>
<tr class="odd">
<td><code>ylab =</code></td>
<td>Title of y-axis</td>
</tr>
<tr class="even">
<td><code>size =</code></td>
<td>Size of x-axis text in pts (use ggplotâ€™s theme() to adjust other sizes etc.)</td>
</tr>
</tbody>
</table></div>
<p>An example using many of the above arguments:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">central_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"week"</span>,
  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">central_outbreak</span>,
  fill <span class="op">=</span> <span class="va">outcome</span>,                       <span class="co"># box/bar color</span>
  legend <span class="op">=</span> <span class="st">"top"</span>,                       <span class="co"># legend on top</span>
  title <span class="op">=</span> <span class="st">"Cases at Central Hospital"</span>,  <span class="co"># title</span>
  xlab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># x-axis label</span>
  ylab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># y-axis label</span>
  show_cases <span class="op">=</span> <span class="cn">TRUE</span>,                    <span class="co"># show each case as an individual box</span>
  centre_ticks <span class="op">=</span> <span class="cn">TRUE</span>,                  <span class="co"># ticks appear in center of interval</span>
  alpha <span class="op">=</span> <span class="fl">0.7</span>,                          <span class="co"># transparency </span>
  border <span class="op">=</span> <span class="st">"grey"</span>,                      <span class="co"># box border</span>
  format <span class="op">=</span> <span class="st">"%a %d %B\n%Y (Week %W)"</span>,    <span class="co"># adjust date label format - see dates Handbook page</span>
  n_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">central_outbreak</span><span class="op">)</span><span class="op">/</span><span class="fl">15</span>, <span class="co"># date labels every X weeks</span>
  angle <span class="op">=</span> <span class="fl">45</span>,                           <span class="co"># angle of date labels</span>
  col_pal <span class="op">=</span> <span class="va">muted</span>                       <span class="co"># apply one of the incidence2 pre-defined color palettes</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-91-1.png" width="672"></div>
<p>To further adjust plot appearance, see the section below on applying <code>ggplot()</code> to the <strong>incidence</strong> plot.</p>
</div>
<div id="modifications-with-ggplot2" class="section level3 unnumbered">
<h3>Modifications with ggplot2<a class="anchor" aria-label="anchor" href="#modifications-with-ggplot2"><i class="fas fa-link"></i></a>
</h3>
<p>You can further modify an <strong>incidence2</strong> plot by adding <strong>ggplot2</strong> modifications with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> after the close of the incidence <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, as demonstrated below.</p>
<p>Below, the <strong>incidence2</strong> plot finishes and then <strong>ggplot2</strong> commands are used to modify the axes, add a caption, and adjust the bold font and text size.</p>
<p>Note that if you add <code>scale_x_date()</code>, most date formatting from <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> will be overwritten. See the <code>ggplot()</code> epicurves section and the Handbook page [ggplot tips] for more options.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">central_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"week"</span>,
  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">central_outbreak</span>,
  fill <span class="op">=</span> <span class="va">outcome</span>,                       <span class="co"># box/bar color</span>
  legend <span class="op">=</span> <span class="st">"top"</span>,                       <span class="co"># legend on top</span>
  title <span class="op">=</span> <span class="st">"Cases at Central Hospital"</span>,  <span class="co"># title</span>
  xlab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># x-axis label</span>
  ylab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># y-axis label</span>
  show_cases <span class="op">=</span> <span class="cn">TRUE</span>,                    <span class="co"># show each case as an individual box</span>
  centre_ticks <span class="op">=</span> <span class="cn">TRUE</span>,                  <span class="co"># ticks appear in center of interval</span>
  alpha <span class="op">=</span> <span class="fl">0.7</span>,                          <span class="co"># transparency </span>
  border <span class="op">=</span> <span class="st">"grey"</span>,                      <span class="co"># box border</span>
  <span class="co">#format = "%a %d %B\n%Y (Week %W)",    # overwritten below</span>
  <span class="co">#n_breaks = nrow(central_outbreak)/15, # overwritten below</span>
  angle <span class="op">=</span> <span class="fl">45</span>,                           <span class="co"># angle of date labels</span>
  col_pal <span class="op">=</span> <span class="va">muted</span>                       <span class="co"># apply one of the incidence2 pre-defined color palettes</span>
  <span class="op">)</span><span class="op">+</span>
  
  <span class="co"># Add modifications using ggplot() functions</span>
  <span class="co">############################################</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>                              <span class="co"># converts to ggplot date scale (changes default label format)</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                         <span class="co"># remove excess space on left and right</span>
    date_labels <span class="op">=</span> <span class="st">"%a %d %B\n%Y (Week %W)"</span>,  <span class="co"># set how dates appear</span>
    date_breaks <span class="op">=</span> <span class="st">"6 weeks"</span>                  <span class="co"># set how often dates appear</span>
    <span class="op">)</span><span class="op">+</span>      
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,  <span class="co"># specify y-axis increments by 5</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                         <span class="co"># remove excess space below 0 on y-axis</span>
  
  <span class="co"># add dynamic caption</span>
  <span class="fu">labs</span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">"Patient outcome"</span>,                               <span class="co"># Legend title</span>
    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span>                            <span class="co"># dynamic caption - see page on characters and strings for details</span>
      <span class="st">"n = {central_cases} from Central Hospital
      Case onsets range from {earliest_date} to {latest_date}. {missing_onset} cases are missing date of onset and not shown"</span>,
      central_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span>,
      earliest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">'%a %d %b %Y'</span><span class="op">)</span>,
      latest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">'%a %d %b %Y'</span><span class="op">)</span>,      
      missing_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">central_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># adjust bold face, and caption position</span>
  <span class="fu">theme</span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,    <span class="co"># axis titles larger and bold</span>
    axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,     <span class="co"># axis text size and bold</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> <span class="co"># move caption to left</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-92-1.png" width="672"></div>
</div>
<div id="change-colors" class="section level3 unnumbered">
<h3>Change colors<a class="anchor" aria-label="anchor" href="#change-colors"><i class="fas fa-link"></i></a>
</h3>
<div id="specify-a-palette" class="section level4 unnumbered">
<h4>Specify a palette<a class="anchor" aria-label="anchor" href="#specify-a-palette"><i class="fas fa-link"></i></a>
</h4>
<p>Provide the name of a pre-defined palette to the <code>col_pal =</code> argument in <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>. The <strong>incidence2</strong> package comes with 2 pre-defined paletted: â€œvibrantâ€ and â€œmutedâ€. In â€œvibrantâ€ the first 6 colors and distinct and in â€œmutedâ€ the first 9 colors are distinct. After these numbers, the colors are interpolations/intermediaries of other colors. These pre-defined palettes can be found at <a href="https://personal.sron.nl/~pault/#sec:qualitative">this website</a>. The palettes exclude grey, which is reserved for missing data (use <code>na_color =</code> to change this default).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category  </span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,            <span class="co"># date of onset for x-axis</span>
  interval <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># weekly aggregation of cases</span>
  groups <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>

<span class="co"># plot the epicurve with default palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"'vibrant' default incidence2 palette"</span><span class="op">)</span>

<span class="co"># plot with different color palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, col_pal <span class="op">=</span> <span class="va">muted</span>, title <span class="op">=</span> <span class="st">"'muted' incidence2 palette"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-93-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-93-2.png" width="50%"></p>
<p>You can also use one of the <strong>base</strong> R palettes (put the name of the palette <em>without</em> quotes).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with base R palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, col_pal <span class="op">=</span> <span class="va">heat.colors</span>, title <span class="op">=</span> <span class="st">"base R heat.colors palette"</span><span class="op">)</span>

<span class="co"># plot with base R palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, col_pal <span class="op">=</span> <span class="va">rainbow</span>, title <span class="op">=</span> <span class="st">"base R rainbow palette"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-94-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-94-2.png" width="50%"></p>
<p>You can also add a color palette from the <strong>viridis</strong> package or <strong>RColorBrewer</strong> package. First those packages must be loaded, then add their respective <code>scale_fill_*()</code> functions with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, as shown below.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">RColorBrewer</span>, <span class="va">viridis</span><span class="op">)</span>

<span class="co"># plot with color palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"Viridis palette"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>
    option <span class="op">=</span> <span class="st">"inferno"</span>,     <span class="co"># color scheme, try also "plasma" or the default</span>
    name <span class="op">=</span> <span class="st">"Age Category"</span>,  <span class="co"># legend name</span>
    na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>      <span class="co"># for missing values</span>

<span class="co"># plot with color palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"RColorBrewer palette"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>
    palette <span class="op">=</span> <span class="st">"Dark2"</span>,      <span class="co"># color palette, try also Accent, Dark2, Paired, Pastel1, Pastel2, Set1, Set2, Set3</span>
    name <span class="op">=</span> <span class="st">"Age Category"</span>,  <span class="co"># legend name</span>
    na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>      <span class="co"># for missing values</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-95-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-95-2.png" width="50%"></p>
</div>
<div id="specify-manually" class="section level4 unnumbered">
<h4>Specify manually<a class="anchor" aria-label="anchor" href="#specify-manually"><i class="fas fa-link"></i></a>
</h4>
<p>To specify colors manually, add the <strong>ggplot2</strong> function <code>scale_fill_manual()</code> to the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> and provide the vector of colors names or HEX codes to the argument <code>values =</code>. The number of colors listed must equal the number of groups. Be aware of whether missing values are a group - they can be converted to a character value like â€œMissingâ€ during your data preparation with the function <code>fct_explicit_na()</code> as explained in the page on [Factors].</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># manual colors</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"Manually-specified colors"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"darkblue"</span>, <span class="st">"purple"</span>, <span class="st">"grey"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"lightblue"</span><span class="op">)</span>,  <span class="co"># colors</span>
    name <span class="op">=</span> <span class="st">"Age Category"</span><span class="op">)</span>      <span class="co"># Name for legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-96-1.png" width="50%"></div>
<p>As mentioned in the [ggplot tips] page, you can create your own palettes using <code><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette()</a></code> on a vector of colors and specifying the number of colors you want in return. This is a good way to get many colors in a ramp by specifying a few.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"darkblue"</span>, <span class="st">"purple"</span>, <span class="st">"grey"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span><span class="op">)</span>
<span class="va">my_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="va">my_cols</span><span class="op">)</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>  <span class="co"># expand the 6 colors above to 12 colors</span>
<span class="va">my_palette</span></code></pre></div>
<pre><code>##  [1] "#006400" "#00363F" "#00097E" "#3A0BAF" "#821ADD" "#A84BE2" "#B592CB" "#C9C99B" "#E7E745" "#FFF600" "#FFCD00" "#FFA500"</code></pre>
</div>
</div>
<div id="adjust-level-order" class="section level3 unnumbered">
<h3>Adjust level order<a class="anchor" aria-label="anchor" href="#adjust-level-order"><i class="fas fa-link"></i></a>
</h3>
<p>To adjust the order of group appearance (on plot and in legend), the grouping column must be class Factor. See the page on [Factors] for more information.</p>
<p>First, letâ€™s see a weekly epicurve by hospital with the default ordering:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ORIGINAL - hospital NOT as factor</span>
<span class="co">###################################</span>

<span class="co"># create weekly incidence object, rows grouped by hospital and week</span>
<span class="va">hospital_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>, 
  interval <span class="op">=</span> <span class="st">"week"</span>, 
  groups <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hospital_outbreak</span>, fill <span class="op">=</span> <span class="va">hospital</span>, title <span class="op">=</span> <span class="st">"ORIGINAL - hospital not a factor"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-98-1.png" width="672"></div>
<p>Now, to adjust the order so that â€œMissingâ€ and â€œOtherâ€ are at the top of the epicurve we can do the following:</p>
<ul>
<li>Load the package <strong>forcats</strong>, to work with factors<br>
</li>
<li>Adjust the dataset - in this case weâ€™ll define a new dataset (<code>plot_data</code>) in which:
<ul>
<li>the <code>gender</code> column is defined as a factor with <code>as_factor()</code><br>
</li>
<li>the order of levels are defined with <code>fct_relevel()</code> so that â€œOtherâ€ and â€œMissingâ€ are first so they appear at the top of the bars<br>
</li>
</ul>
</li>
<li>The incidence object is created and plotted as before<br>
</li>
<li>We add <strong>ggplot2</strong> modifications
<ul>
<li>
<code>scale_fill_manual()</code> to manually assign colors so that â€œMissingâ€ is grey and â€œOtherâ€ is beige</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># MODIFIED - hospital as factor</span>
<span class="co">###############################</span>

<span class="co"># load forcats package for working with factors</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span>

<span class="co"># Convert hospital column to factor and adjust levels</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                      <span class="co"># define as factor</span>
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Set "Missing" and "Other" as top levels</span>


<span class="co"># Create weekly incidence object, grouped by hospital and week</span>
<span class="va">hospital_outbreak_mod</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">plot_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>, 
  interval <span class="op">=</span> <span class="st">"week"</span>, 
  groups <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hospital_outbreak_mod</span>, fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># manual specify colors</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"darkgreen"</span>, <span class="st">"green2"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"pink"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                      

  <span class="co"># labels added via ggplot</span>
  <span class="fu">labs</span><span class="op">(</span>
      title <span class="op">=</span> <span class="st">"MODIFIED - hospital as factor"</span>,   <span class="co"># plot title</span>
      subtitle <span class="op">=</span> <span class="st">"Other &amp; Missing at top of epicurve"</span>,
      y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,               <span class="co"># y axis title  </span>
      x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,               <span class="co"># x axis title</span>
      fill <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>                         <span class="co"># title of legend     </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-99-1.png" width="672"></div>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> If you want to reverse the order of the legend only, add this <strong>ggplot2</strong> command <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="vertical-gridlines" class="section level3 unnumbered">
<h3>Vertical gridlines<a class="anchor" aria-label="anchor" href="#vertical-gridlines"><i class="fas fa-link"></i></a>
</h3>
<p>If you plot with default <strong>incidence2</strong> settings, you may notice that the vertical gridlines appear at each date label and once between each date label. This can result in gridlines intersecting with the top of some bars.</p>
<p>You can specify the interval for the gridlines by adding <strong>ggplot2</strong>â€™s <code>scale_x_date()</code> command to your <strong>incidence2</strong> plot. Within it, specify the intervals for <code>date_breaks =</code> and <code>date_minor_breaks =</code> (e.g.Â â€œweeksâ€ or â€œ3 weeksâ€ or â€œmonthsâ€). Note that use of <code>scale_x_date()</code> will over-ride any formatting of the date labels in <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, so you will need to specify any string format to <code>date_labels =</code> as below.</p>
<p>You can also remove all gridlines by adding the <strong>ggplot2</strong> command <code>theme_classic()</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make incidence object</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">central_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"Monday weeks"</span>
<span class="op">)</span>

<span class="co"># Default gridlines</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">a</span>, title <span class="op">=</span> <span class="st">"Default lines"</span><span class="op">)</span>

<span class="co"># Specified gridline intervals</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">a</span>, title <span class="op">=</span> <span class="st">"Weekly lines"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    date_breaks <span class="op">=</span> <span class="st">"4 weeks"</span>,      <span class="co"># major vertical lines align on weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"weeks"</span>,  <span class="co"># minor vertical lines every week</span>
    date_labels <span class="op">=</span> <span class="st">"%a\n%d\n%b"</span><span class="op">)</span>   <span class="co"># format of date labels</span>

<span class="co"># No gridlines</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">a</span>, title <span class="op">=</span> <span class="st">"No lines"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span>                 <span class="co"># remove all gridlines</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-100-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-100-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-100-3.png" width="50%"></p>
<p>Note however, that if using weeks, the <code>date_breaks</code> and <code>date_minor_breaks</code> arguments only work for <em>Monday</em> weeks. If your weeks are by another day of the week you will need to manually provide a vector of dates to the <code>breaks =</code> and <code>minor_breaks =</code> arguments instead. See the <strong>ggplot2</strong> section for examples of this using <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>.</p>
</div>
<div id="cumulative-incidence" class="section level3 unnumbered">
<h3>Cumulative incidence<a class="anchor" aria-label="anchor" href="#cumulative-incidence"><i class="fas fa-link"></i></a>
</h3>
<p>You can easily produce a plot of cumulative incidence by passing the incidence object to the <strong>incidence2</strong> command <code>cumulate()</code> and then to <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>. This also works with <code>facet_plot()</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make weekly incidence object</span>
<span class="va">wkly_inci</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"week"</span>
<span class="op">)</span>

<span class="co"># plot cumulative incidence</span>
<span class="va">wkly_inci</span> <span class="op">%&gt;%</span> 
  <span class="fu">cumulate</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-101-1.png" width="672"></div>
<p>See the section farther down on this page for alternative method to plot cumulative incidence with <strong>ggplot2</strong> - for example to overlay a cumulative incidence line over an epicurve.</p>
</div>
<div id="rolling-average" class="section level3 unnumbered">
<h3>Rolling average<a class="anchor" aria-label="anchor" href="#rolling-average"><i class="fas fa-link"></i></a>
</h3>
<p>You can add a rolling average to an <strong>incidence2</strong> plot easily with <code>add_rolling_average()</code> from the <strong>i2extras</strong> package. Pass your incidence2 object to this function, and then to <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>. Set <code>before =</code> as the number of previous days you want included in the rolling average (default is 2). If your data are grouped, the rolling average will be calculated per group.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rolling_avg</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>                    <span class="co"># make incidence object</span>
  <span class="va">linelist</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"week"</span>,
  groups <span class="op">=</span> <span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">i2extras</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/i2extras/reference/add_rolling_average.html">add_rolling_average</a></span><span class="op">(</span>before <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>  <span class="co"># add rolling averages (in this case, by gender)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rolling_avg</span>, n_breaks <span class="op">=</span> <span class="fl">3</span>, format <span class="op">=</span> <span class="st">"%d %b\n%Y"</span><span class="op">)</span> <span class="co"># faceted automatically because rolling average on groups</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-102-1.png" width="672"></div>
<p>To learn how to apply rolling averages more generally on data, see the Handbook page on [Rolling averages].</p>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurves-with-ggplot2" class="section level2" number="1.3">
<h2>
<span class="header-section-number">1.3</span> Epicurves with ggplot2<a class="anchor" aria-label="anchor" href="#epicurves-with-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Using <code>ggplot()</code> to build your epicurve allows for more flexibility, but requires more effort and understanding of how <code>ggplot()</code> works. It is also easier to accidentally make mistakes.</p>
<p>Unlike using the <strong>incidence2</strong> package, you must <em>manually</em> control the aggregation of the cases by time (into weeks, months, etc) <em>and</em> the intervals of the labels on the date axis. This must be carefully managed.</p>
<p>One advantage of using <strong>ggplot2</strong> is that you can create a histogram without any lines between the bars. This is a more traditional epidemic curve.</p>
<p>These examples use a subset of the <code>linelist</code> dataset - only the cases from Central Hospital.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span></code></pre></div>
<p>To produce an epicurve with <code>ggplot()</code> there are three main elements:</p>
<ul>
<li>A histogram, with linelist cases aggregated into â€œbinsâ€ distinguished by specific â€œbreakâ€ points<br>
</li>
<li>Scales for the axes and their labels<br>
</li>
<li>Themes for the plot appearance, including titles, labels, captions, etc.</li>
</ul>
<div id="specify-case-bins" class="section level3 unnumbered">
<h3>Specify case bins<a class="anchor" aria-label="anchor" href="#specify-case-bins"><i class="fas fa-link"></i></a>
</h3>
<p>Here we show how to specify how cases will be aggregated into histogram bins (â€œbarsâ€). It is important to recognize that the aggregation of cases into histogram bins is <strong>not</strong> necessarily the same intervals as the dates that will appear on the x-axis.</p>
<p>Below is perhaps the most simple code to produce daily and weekly epicurves.</p>
<p>In the over-arching <code>ggplot()</code> command the dataset is provided to <code>data =</code>. Onto this foundation, the geometry of a histogram is added with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>. Within the <code>geom_histogram()</code>, we map the aesthetics such that the column <code>date_onset</code> is mapped to the x-axis. Also within the <code>geom_histogram()</code> but <em>not</em> within <code>aes()</code> we set the <code>binwidth =</code> of the histogram bins, in days. If this <strong>ggplot2</strong> syntax is confusing, review the page on [ggplot tips].</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Plotting weekly cases by using <code>binwidth = 7</code> starts the first 7-day bin at the first case, which could be any day of the week! To create specific weeks, see section below .</span></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># daily </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>          <span class="co"># set data</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>                      <span class="co"># add histogram</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,     <span class="co"># map date column to x-axis</span>
    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># cases binned by 1 day </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Central Hospital - Daily"</span><span class="op">)</span>                <span class="co"># title</span>

<span class="co"># weekly</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>          <span class="co"># set data </span>
  <span class="fu">geom_histogram</span><span class="op">(</span>                      <span class="co"># add histogram</span>
      mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,   <span class="co"># map date column to x-axis</span>
      binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># cases binned every 7 days, starting from first case (!) </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Central Hospital - 7-day bins, starting at first case"</span><span class="op">)</span> <span class="co"># title</span></code></pre></div>
<p><img src="_main_files/figure-html/ggplot_simple-1.png" width="50%"><img src="_main_files/figure-html/ggplot_simple-2.png" width="50%"></p>
<p>Let us note that the first case in this Central Hospital dataset had symptom onset on:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"%A %d %b, %Y"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Thursday 01 May, 2014"</code></pre>
<p><strong>To manually specify the histogram bin breaks, do <em>not</em> use the <code>binwidth =</code> argument, and instead supply a vector of dates to <code>breaks =</code>.</strong></p>
<p>Create the vector of dates with the <strong>base</strong> R function <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>. This function expects arguments <code>to =</code>, <code>from =</code>, and <code>by =</code>. For example, the command below returns monthly dates starting at Jan 15 and ending by June 28.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span>

<span class="va">monthly_breaks</span>   <span class="co"># print</span></code></pre></div>
<pre><code>##  [1] "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01" "2014-07-01" "2014-08-01" "2014-09-01" "2014-10-01" "2014-11-01" "2014-12-01" "2015-01-01"
## [13] "2015-02-01" "2015-03-01" "2015-04-01" "2015-05-01" "2015-06-01" "2015-07-01"</code></pre>
<p>This vector can be provided to <code>geom_histogram()</code> as <code>breaks =</code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># monthly </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    breaks <span class="op">=</span> <span class="va">monthly_breaks</span><span class="op">)</span><span class="op">+</span>         <span class="co"># provide the pre-defined vector of breaks                    </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Monthly case bins"</span><span class="op">)</span>   <span class="co"># title</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-108-1.png" width="672"></div>
<p>A weekly date sequence can be returned by setting <code>by = "week"</code>. For example:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weekly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></code></pre></div>
<p>An alternative to supplying specific start and end dates is to write <em>dynamic</em> code so that weekly bins begin <em>the Monday before the first case</em>. We will use these throughout the examples below.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sequence of weekly Monday dates for CENTRAL HOSPITAL</span>
<span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="co"># monday before first case</span>
  to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="co"># monday after last case</span>
  by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>

<span class="co"># Sequence for the entire outbreak</span>
<span class="va">weekly_breaks_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="co"># monday before first case</span>
  to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="co"># monday after last case</span>
  by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></code></pre></div>
<p>Letâ€™s unpack the rather daunting code above:</p>
<ul>
<li>The â€œfromâ€ value (earliest date of the sequence) is created as follows: the minimum date value (<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> with <code>na.rm=TRUE</code>) in the column <code>date_onset</code> is fed to <code>floor_date()</code> from the <strong>lubridate</strong> package. <code>floor_date()</code> set to â€œweekâ€ returns the start date of that casesâ€™s â€œweekâ€, given that the start day of each week is a Monday (<code>week_start = 1</code>).<br>
</li>
<li>Likewise, the â€œtoâ€ value (end date of the sequence) is created using the inverse function <code>ceiling_date()</code> to return the Monday <em>after</em> the last case.<br>
</li>
<li>The â€œbyâ€ argument of <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> can be set to any number of days, weeks, or months.<br>
</li>
<li>Use <code>week_start = 7</code> for Sunday weeks</li>
</ul>
<p>These <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> outputs can be used to create histogram bin breaks, but also the breaks for the date labels, which may be independent from the bins. Read more about the date labels in later sections.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> For a more simple <code>ggplot()</code> command, save the bin breaks and date label breaks as named vectors in advance, and simply provide their names to <code>breaks =</code>.</span></p>
</div>
<div id="weekly-epicurve-example" class="section level3 unnumbered">
<h3>Weekly epicurve example<a class="anchor" aria-label="anchor" href="#weekly-epicurve-example"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Below is detailed example code to produce a weekly epicurves for Monday weeks, with aligned bars, date labels, and vertical gridlines.</strong> This section is for the user who needs code quickly. To understand each aspect (themes, date labels, etc.) in-depth, continue to the subsequent sections. Of note:</p>
<ul>
<li>The <em>histogram bin breaks</em> are defined with <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> as explained above to begin the Monday before the earliest case and to end the Monday after the last case<br>
</li>
<li>The interval of <em>date labels</em> is specified by <code>date_breaks =</code> within <code>scale_x_date()</code><br>
</li>
<li>The interval of the minor vertical gridlines between the date labels is specified to <code>date_minor_breaks =</code><br>
</li>
<li>
<code>expand = c(0,0)</code> in the x and y scales removes excess space on each side of the axes, which also ensures the date labels begin from the first bar.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL MONDAY WEEK ALIGNMENT</span>
<span class="co">#############################</span>
<span class="co"># Define sequence of weekly breaks</span>
<span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Monday before first case</span>
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Monday after last case</span>
      by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>    <span class="co"># bins are 7-days </span>


<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    
    <span class="co"># mapping aesthetics</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># date column mapped to x-axis</span>
    
    <span class="co"># histogram bin breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># histogram bin breaks defined previously</span>
    
    <span class="co"># bars</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,     <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span>      <span class="co"># color of fill within bars</span>
  <span class="op">)</span><span class="op">+</span> 
    
  <span class="co"># x-axis labels</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,           <span class="co"># remove excess x-axis space before and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"4 weeks"</span>,        <span class="co"># date labels and major vertical gridlines appear every 3 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,           <span class="co"># minor vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%a\n%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># remove excess y-axis space below 0 (align histogram flush with x-axis)</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                <span class="co"># simplify plot background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>,        <span class="co"># caption on left side</span>
                                face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># caption in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>    <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels including dynamic caption</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases (Monday weeks)"</span>,
    subtitle <span class="op">=</span> <span class="st">"Note alignment of bars, vertical gridlines, and axis labels on Monday weeks"</span>,
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-111-1.png" width="672"></div>
<div id="sunday-weeks" class="section level4 unnumbered">
<h4>Sunday weeks<a class="anchor" aria-label="anchor" href="#sunday-weeks"><i class="fas fa-link"></i></a>
</h4>
<p>To achieve the above plot for Sunday weeks a few modifications are needed, because the <code>date_breaks = "weeks"</code> only work for Monday weeks.</p>
<ul>
<li>The break points of the <em>histogram bins</em> must be set to Sundays (<code>week_start = 7</code>)<br>
</li>
<li>Within <code>scale_x_date()</code>, the similar date breaks should be provided to <code>breaks =</code> and <code>minor_breaks =</code> to ensure the date labels and vertical gridlines align on Sundays.</li>
</ul>
<p>For example, the <code>scale_x_date()</code> command for Sunday weeks could look like this:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="epidemic-curves.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_date</span>(</span>
<span id="cb38-2"><a href="epidemic-curves.html#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb38-3"><a href="epidemic-curves.html#cb38-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-4"><a href="epidemic-curves.html#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specify interval of date labels and major vertical gridlines</span></span>
<span id="cb38-5"><a href="epidemic-curves.html#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb38-6"><a href="epidemic-curves.html#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">as.Date</span>(<span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>)), <span class="co"># Sunday before first case</span></span>
<span id="cb38-7"><a href="epidemic-curves.html#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">as.Date</span>(<span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>)), <span class="co"># Sunday after last case</span></span>
<span id="cb38-8"><a href="epidemic-curves.html#cb38-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">"4 weeks"</span>),</span>
<span id="cb38-9"><a href="epidemic-curves.html#cb38-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-10"><a href="epidemic-curves.html#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specify interval of minor vertical gridline </span></span>
<span id="cb38-11"><a href="epidemic-curves.html#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb38-12"><a href="epidemic-curves.html#cb38-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">as.Date</span>(<span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>)), <span class="co"># Sunday before first case</span></span>
<span id="cb38-13"><a href="epidemic-curves.html#cb38-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">as.Date</span>(<span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>)), <span class="co"># Sunday after last case</span></span>
<span id="cb38-14"><a href="epidemic-curves.html#cb38-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">"week"</span>),</span>
<span id="cb38-15"><a href="epidemic-curves.html#cb38-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb38-16"><a href="epidemic-curves.html#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># date label format</span></span>
<span id="cb38-17"><a href="epidemic-curves.html#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%a</span><span class="sc">\n</span><span class="st">%d %b</span><span class="sc">\n</span><span class="st">%Y"</span>)<span class="sc">+</span>         <span class="co"># day, above month abbrev., above 2-digit year</span></span></code></pre></div>
</div>
</div>
<div id="groupcolor-by-value" class="section level3 unnumbered">
<h3>Group/color by value<a class="anchor" aria-label="anchor" href="#groupcolor-by-value"><i class="fas fa-link"></i></a>
</h3>
<p>The histogram bars can be colored by group and â€œstackedâ€. To designate the grouping column, make the following changes. See the [ggplot tips] page for details.</p>
<ul>
<li>Within the histogram aesthetic mapping <code>aes()</code>, map the column name to the <code>group =</code> and <code>fill =</code> arguments<br>
</li>
<li>Remove any <code>fill =</code> argument <em>outside</em> of <code>aes()</code>, as it will override the one inside<br>
</li>
<li>Arguments <em>inside</em> <code>aes()</code> will apply <em>by group</em>, whereas any <em>outside</em> will apply to all bars (e.g.Â you may still want <code>color =</code> outside, so each bar has the same border)</li>
</ul>
<p>Here is what the <code>aes()</code> command would look like to group and color the bars by gender:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, group <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span></code></pre></div>
<p>Here it is applied:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># begin with linelist (many hospitals)</span>
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date_onset</span>,
      group <span class="op">=</span> <span class="va">hospital</span>,       <span class="co"># set data to be grouped by hospital</span>
      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,       <span class="co"># bar fill (inside color) by hospital</span>
    
    <span class="co"># bin breaks are Monday weeks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,   <span class="co"># sequence of weekly Monday bin breaks for whole outbreak, defined in previous code       </span>
    
    <span class="co"># Color around bars</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-114-1.png" width="672"></div>
</div>
<div id="adjust-colors" class="section level3 unnumbered">
<h3>Adjust colors<a class="anchor" aria-label="anchor" href="#adjust-colors"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>To <em>manually</em> set the fill for each group, use <code>scale_fill_manual()</code> (note: <code>scale_color_manual()</code> is different!).
<ul>
<li>Use the <code>values =</code> argument to apply a vector of colors.<br>
</li>
<li>Use <code>na.value =</code> to specify a color for <code>NA</code> values.<br>
</li>
<li>To change the text of legend labels you <em>can</em> use the <code>labels =</code> argument in <code>scale_fill_manual()</code>, but it is dangerously easy to accidentally give colors incorrect legend text! Instead, it is recommended to change legend text by converting the grouping column to class Factor and adjusting its labels as described in the [Factors] page and briefly below.<br>
</li>
</ul>
</li>
<li>To adjust the colors via a pre-defined color scale, see the page on [ggplot tips].</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>           <span class="co"># begin with linelist (many hospitals)</span>
  
  <span class="co"># make histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,
        group <span class="op">=</span> <span class="va">hospital</span>,          <span class="co"># cases grouped by hospital</span>
        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,          <span class="co"># bar fill by hospital</span>
    
    <span class="co"># bin breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,        <span class="co"># sequence of weekly Monday bin breaks, defined in previous code</span>
    
    <span class="co"># Color around bars</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>              <span class="co"># border color of each bar</span>
  
  <span class="co"># manual specification of colors</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span><span class="op">)</span> <span class="co"># specify fill colors ("values") - attention to order!</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-115-1.png" width="672"></div>
</div>
<div id="adjust-level-order-1" class="section level3 unnumbered">
<h3>Adjust level order<a class="anchor" aria-label="anchor" href="#adjust-level-order-1"><i class="fas fa-link"></i></a>
</h3>
<p>The order in which grouped bars are stacked is best adjusted by classifying the grouping column as class Factor. You can then designate the factor level order (and their display labels). See the page on [Factors] or [ggplot tips] for details.</p>
<p>Before making the plot, convert the grouping column to class Factor using <code>as_factor()</code> from the <strong>forcats</strong> package. Then you can make other adjustments to the levels, as detailed in the page on [Factors].</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load forcats package for working with factors</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span>

<span class="co"># Define new dataset with hospital as factor</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                      <span class="co"># define hospital as factor</span>
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Set "Missing" and "Other" as top levels to appear on epicurve top</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span> <span class="co"># print levels in order</span></code></pre></div>
<pre><code>## [1] "Missing"                              "Other"                                "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"
## [5] "Military Hospital"                    "Central Hospital"</code></pre>
<p>In the below plot, the only differences from previous is that column <code>hospital</code> has been consolidated as above, and we use <code>guides()</code> to reverse the legend order, so that â€œMissingâ€ is on the bottom of the legend.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span>                     <span class="co"># Use NEW dataset with hospital as re-ordered factor</span>
  
  <span class="co"># make histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,
        group <span class="op">=</span> <span class="va">hospital</span>,               <span class="co"># cases grouped by hospital</span>
        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,               <span class="co"># bar fill (color) by hospital</span>
    
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,         <span class="co"># sequence of weekly Monday bin breaks for whole outbreak, defined at top of ggplot section</span>
    
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># border color around each bar</span>
    
  <span class="co"># x-axis labels</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space before and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># remove excess y-axis space below 0</span>
  
  <span class="co"># manual specification of colors, ! attention to order</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># simplify plot background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, <span class="co"># caption on left side in italics</span>
                                hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, 
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases by hospital"</span>,
    subtitle <span class="op">=</span> <span class="st">"Hospital as re-ordered factor"</span>,
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly cases"</span>,
    fill     <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>                        <span class="co"># title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-117-1.png" width="672"></div>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> To reverse the order of the legend only, add this <strong>ggplot2</strong> command: <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="adjust-legend" class="section level3 unnumbered">
<h3>Adjust legend<a class="anchor" aria-label="anchor" href="#adjust-legend"><i class="fas fa-link"></i></a>
</h3>
<p>Read more about legends in the [ggplot tips] page. Here are a few highlights:</p>
<ul>
<li>
<code>labs(fill = "Legend title")</code> to edit the legend title (this is because the grouping column is set to <code>fill =</code> in <code>aes()</code>)<br>
</li>
<li>
<code>theme(legend.title = element_blank())</code> to have no title<br>
</li>
<li>
<code>theme(legend.position = "top")</code> (or â€œbottomâ€, â€œleftâ€, â€œrightâ€, â€œnoneâ€)</li>
<li>
<code>theme(legend.direction = "horizontal")</code> horizontal legend</li>
<li>
<code>guides(fill = guide_legend(reverse = TRUE))</code> to reverse order of the legend</li>
</ul>
</div>
<div id="bars-side-by-side" class="section level3 unnumbered">
<h3>Bars side-by-side<a class="anchor" aria-label="anchor" href="#bars-side-by-side"><i class="fas fa-link"></i></a>
</h3>
<p>Side-by-side display of group bars (as opposed to stacked) is specified within <code>geom_histogram()</code> with <code>position = "dodge"</code> (place this outside of <code>aes()</code>).</p>
<p>If there are more than two value groups, these can become difficult to read. Consider instead using a faceted plot (small multiples). To improve readability in this example, missing gender values could be removed.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span><span class="op">+</span>             <span class="co"># begin with Central Hospital cases</span>
    <span class="fu">geom_histogram</span><span class="op">(</span>
        mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">date_onset</span>,
          group <span class="op">=</span> <span class="va">gender</span>,         <span class="co"># cases grouped by gender</span>
          fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,         <span class="co"># bars filled by gender</span>
        
        <span class="co"># histogram bin breaks</span>
        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># sequence of weekly dates for Central outbreak - defined at top of ggplot section</span>
        
        color <span class="op">=</span> <span class="st">"black"</span>,          <span class="co"># bar edge color</span>
        
        position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># SIDE-BY-SIDE bars</span>
                      
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
               date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co">#scale of colors and legend labels</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"orange"</span><span class="op">)</span>,  <span class="co"># specify fill colors ("values") - attention to order!</span>
                    na.value <span class="op">=</span> <span class="st">"grey"</span> <span class="op">)</span><span class="op">+</span>     

  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by gender"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Gender"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-118-1.png" width="672"></div>
</div>
<div id="axis-limits" class="section level3 unnumbered">
<h3>Axis limits<a class="anchor" aria-label="anchor" href="#axis-limits"><i class="fas fa-link"></i></a>
</h3>
<p>You can set maximum and minimum date values using <code>limits = c()</code> within <code>scale_x_date()</code>. For example:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scale_x_date</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-04-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># sets a minimum date but leaves the maximum open.  </span></code></pre></div>
<p>Likewise, if you want to the x-axis to extend to a specific date (e.g.Â current date), even if no new cases have been reported, you can use:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="epidemic-curves.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">Sys.Date</span>()) <span class="co"># ensures date axis will extend until current date  </span></span></code></pre></div>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Caution using limits! They remove all data outside the limits, which can impact y-axis max/min, modeling, and other statistics. Strongly consider instead using limits by adding <code>coord_cartesian( xlim= c(), ylim=c() )</code> to your plot, which acts as a â€œzoomâ€ without removing data. </span></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Be cautious setting the y-axis scale breaks or limits (e.g.Â 0 to 30 by 5: <code><a href="https://rdrr.io/r/base/seq.html">seq(0, 30, 5)</a></code>). Such static numbers can cut-off your plot too short if the data changes to exceed the limit!.</span></p>
</div>
<div id="date-axis-labelsgridlines" class="section level3 unnumbered">
<h3>Date-axis labels/gridlines<a class="anchor" aria-label="anchor" href="#date-axis-labelsgridlines"><i class="fas fa-link"></i></a>
</h3>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Remember that date-axis <strong>labels</strong> are independent from the aggregation of the data into bars, but visually it can be important to align bins, date labels, and vertical grid lines.</span></p>
<p>To <strong>modify the date labels and grid lines</strong>, use <code>scale_x_date()</code> in one of these ways:</p>
<ul>
<li>
<strong>If your histogram bins are days, Monday weeks, months, or years</strong>:
<ul>
<li>Use <code>date_breaks =</code> to specify the interval of labels and major gridlines (e.g.Â â€œdayâ€, â€œweekâ€, â€œ3 weeksâ€, â€œmonthâ€, or â€œyearâ€)</li>
<li>Use <code>date_minor_breaks =</code> to specify interval of minor vertical gridlines (between date labels)<br>
</li>
<li>Add <code>expand = c(0,0)</code> to begin the labels at the first bar<br>
</li>
<li>Use <code>date_labels =</code> to specify format of date labels - see the Dates page for tips (use <code>\n</code> for a new line)<br>
</li>
</ul>
</li>
<li>
<strong>If your histogram bins are Sunday weeks</strong>:
<ul>
<li>Use <code>breaks =</code> and <code>minor_breaks =</code> by providing a sequence of date breaks for each</li>
<li>You can still use <code>date_labels =</code> and <code>expand =</code> for formatting as described above</li>
</ul>
</li>
</ul>
<p>Some notes:</p>
<ul>
<li>See the opening ggplot section for instructions on how to create a sequence of dates using <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>.<br>
</li>
<li>See <a href="https://rdrr.io/r/base/strptime.html">this page</a> or the [Working with dates] page for tips on creating date labels.</li>
</ul>
<div id="demonstrations" class="section level4 unnumbered">
<h4>Demonstrations<a class="anchor" aria-label="anchor" href="#demonstrations"><i class="fas fa-link"></i></a>
</h4>
<p>Below is a demonstration of plots where the bins and the plot labels/grid lines are aligned and not aligned:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7-day bins + Monday labels</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    binwidth <span class="op">=</span> <span class="fl">7</span>,                 <span class="co"># 7-day bins with start at first case</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,               <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,       <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,    <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%a\n%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>              <span class="co"># remove excess space under x-axis, make flush with labels</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays at first case\nDate labels and gridlines on Mondays\nNote how ticks don't align with bars"</span><span class="op">)</span>



<span class="co"># 7-day bins + Months</span>
<span class="co">#####################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    binwidth <span class="op">=</span> <span class="fl">7</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                  <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"months"</span>,           <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,       <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%a\n%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span>    <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remove excess space under x-axis, make flush with labels</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays with first case\nMajor gridlines and date labels at 1st of each month\nMinor gridlines weekly on Mondays\nNote uneven spacing of some gridlines and ticks unaligned with bars"</span><span class="op">)</span>


<span class="co"># TOTAL MONDAY ALIGNMENT: specify manual bin breaks to be mondays</span>
<span class="co">#################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,    <span class="co"># defined earlier in this page</span>
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"4 weeks"</span>,           <span class="co"># Monday every 4 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%a\n%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"ALIGNED Mondays"</span>,
    subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Monday before first case (28 Apr)\nDate labels and gridlines on Mondays as well"</span><span class="op">)</span>


<span class="co"># TOTAL MONDAY ALIGNMENT WITH MONTHS LABELS:</span>
<span class="co">############################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,            <span class="co"># defined earlier in this page</span>
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"months"</span>,            <span class="co"># Monday every 4 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%b\n%Y"</span><span class="op">)</span><span class="op">+</span>          <span class="co"># label format</span>
  
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># Remove major gridlines (fall on 1st of month)</span>
          
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"ALIGNED Mondays with MONTHLY labels"</span>,
    subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Monday before first case (28 Apr)\nDate labels on 1st of Month\nMonthly major gridlines removed"</span><span class="op">)</span>


<span class="co"># TOTAL SUNDAY ALIGNMENT: specify manual bin breaks AND labels to be Sundays</span>
<span class="co">############################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># histogram breaks set to 7 days beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
    <span class="co"># date label breaks and major gridlines set to every 3 weeks beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
    
    <span class="co"># minor gridlines set to weekly beginning Sunday before first case</span>
    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    
    date_labels <span class="op">=</span> <span class="st">"%a\n%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ALIGNED Sundays"</span>,
       subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Sunday before first case (27 Apr)\nDate labels and gridlines manually set to Sundays as well"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-121-1.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-121-2.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-121-3.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-121-4.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-121-5.png" width="672"></p>
</div>
</div>
<div id="aggregated-data" class="section level3" number="1.3.1">
<h3>
<span class="header-section-number">1.3.1</span> Aggregated data<a class="anchor" aria-label="anchor" href="#aggregated-data"><i class="fas fa-link"></i></a>
</h3>
<p>Often instead of a linelist, you begin with aggregated counts from facilities, districts, etc. You can make an epicurve with <code>ggplot()</code> but the code will be slightly different. This section will utilize the <code>count_data</code> dataset that was imported earlier, in the data preparation section. This dataset is the <code>linelist</code> aggregated to day-hospital counts. The first 50 rows are displayed below.</p>
<div id="htmlwidget-06bc58e42973ea4a5b60" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-06bc58e42973ea4a5b60">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1410307200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="plotting-daily-counts" class="section level4 unnumbered">
<h4>Plotting daily counts<a class="anchor" aria-label="anchor" href="#plotting-daily-counts"><i class="fas fa-link"></i></a>
</h4>
<p>We can plot a daily epicurve from these <em>daily counts</em>. Here are the differences to the code:</p>
<ul>
<li>Within the aesthetic mapping <code>aes()</code>, specify <code>y =</code> as the counts column (in this case, the column name is <code>n_cases</code>)</li>
<li>Add the argument <code>stat = "identity"</code> within <code>geom_histogram()</code>, which specifies that bar height should be the <code>y =</code> value, not the number of rows as is the default</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">geom_histogram</span><span class="op">(</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_hospitalisation</span>, y <span class="op">=</span> <span class="va">n_cases</span><span class="op">)</span>,
       stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date of report"</span>, 
          y <span class="op">=</span> <span class="st">"Number of cases"</span>,
          Title <span class="op">=</span> <span class="st">"Daily case incidence, from daily count data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-123-1.png" width="672"></div>
</div>
<div id="plotting-weekly-counts" class="section level4 unnumbered">
<h4>Plotting weekly counts<a class="anchor" aria-label="anchor" href="#plotting-weekly-counts"><i class="fas fa-link"></i></a>
</h4>
<p>If your data are already case counts by week, they might look like this dataset (called <code>count_data_weekly</code>):</p>
<p>The first 50 rows of <code>count_data_weekly</code> are displayed below. You can see that the counts have been aggregated into weeks. Each week is displayed by the first day of the week (Monday by default).</p>
<div id="htmlwidget-5ea23c4bdc59c499644e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5ea23c4bdc59c499644e">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)"],["2014-05-04","2014-05-11","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-07-06","2014-07-13","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-13","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-15","2014-06-22","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[2,1,2,1,2,1,3,7,5,6,6,13,9,15,12,23,24,23,25,26,23,19,25,19,14,9,10,9,8,12,5,10,5,6,6,4,8,9,8,2,5,3,4,5,6,3,6,5,1,6,3,4,2,3,3,2,3,4,6,13,11,17,18,16,18,31,33,46,44,43,42,39,36,39,51,22,15,31,27,23,24,12,15,22,22,20,17,16,8,13,9,15,13,6,10,4,5,4,5,4,2,1,4,2,5,8,5,9,11,7,12,8,10,12,27,21,34,40,48,53,75,79,85,84,80,77,54,43,41,31,33,37,26,39,30,31,24,33,20,21,21,22,19,20,23,10,13,19,18,10,12,12,8,1,1,1,3,3,3,2,4,2,5,3,8,10,8,11,16,11,15,25,23,39,46,50,49,40,53,44,38,29,29,23,26,26,19,17,19,14,18,16,15,14,17,6,6,9,11,8,11,12,5,5,7,6,3,1,4,3,8,6,3,9,9,9,11,14,15,21,25,22,37,59,53,70,93,107,103,87,64,77,74,75,59,56,58,49,46,34,40,24,20,27,27,28,24,22,15,28,24,18,23,13,22,11,10,12,13,2,3,1,3,1,2,5,3,6,5,7,4,8,7,12,20,27,19,22,23,15,18,13,16,20,10,17,6,13,8,8,8,9,1,8,7,6,6,8,6,4,13,5,2,3,5,2,3,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>epiweek<\/th>\n      <th>n_cases_weekly<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Now plot so that <code>x =</code> the epiweek column. Remember to add <code>y =</code> the counts column to the aesthetic mapping, and add <code>stat = "identity"</code> as explained above.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data_weekly</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">epiweek</span>,           <span class="co"># x-axis is epiweek (as class Date)</span>
      y <span class="op">=</span> <span class="va">n_cases_weekly</span>,    <span class="co"># y-axis height in the weekly case counts</span>
      group <span class="op">=</span> <span class="va">hospital</span>,      <span class="co"># we are grouping the bars and coloring by hospital</span>
      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,
    stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># this is also required when plotting count data</span>
     
  <span class="co"># labels for x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,      <span class="co"># labels every 2 months </span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># gridlines every month</span>
    date_labels <span class="op">=</span> <span class="st">'%b\n%Y'</span><span class="op">)</span><span class="op">+</span>       <span class="co">#labeled by month with year below</span>
     
  <span class="co"># Choose color palette (uses RColorBrewer package)</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Pastel2"</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Week of onset"</span>, 
    y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,
    fill <span class="op">=</span> <span class="st">"Hospital"</span>,
    title <span class="op">=</span> <span class="st">"Weekly case incidence, from aggregated count data by hospital"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-126-1.png" width="672"></div>
</div>
</div>
<div id="moving-averages" class="section level3" number="1.3.2">
<h3>
<span class="header-section-number">1.3.2</span> Moving averages<a class="anchor" aria-label="anchor" href="#moving-averages"><i class="fas fa-link"></i></a>
</h3>
<p>See the page on <a href="epidemic-curves.html#moving-averages">Moving averages</a> for a detailed description and several options. Below is one option for calculating moving averages with the package <strong>slider</strong>. In this approach, <em>the moving average is calculated in the dataset prior to plotting</em>:</p>
<ol style="list-style-type: decimal">
<li>Aggregate the data into counts as necessary (daily, weekly, etc.) (see [Grouping data] page)<br>
</li>
<li>Create a new column to hold the moving average, created with <code>slide_index()</code> from <strong>slider</strong> package<br>
</li>
<li>Plot the moving average as a <code>geom_line()</code> on top of (after) the epicurve histogram</li>
</ol>
<p>See the helpful online <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">vignette for the <strong>slider</strong> package</a></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">slider</span><span class="op">)</span>  <span class="co"># slider used to calculate rolling averages</span>

<span class="co"># make dataset of daily counts and 7-day moving average</span>
<span class="co">#######################################################</span>
<span class="va">ll_counts_7day</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>    <span class="co"># begin with linelist</span>
  
  <span class="co">## count cases by date</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span>, name <span class="op">=</span> <span class="st">"new_cases"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># name new column with counts as "new_cases"</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>              <span class="co"># remove cases with missing date_onset</span>
  
  <span class="co">## calculate the average number of cases in 7-day window</span>
  <span class="fu">mutate</span><span class="op">(</span>
    avg_7day <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/slider/man/slide_index.html">slide_index</a></span><span class="op">(</span>    <span class="co"># create new column</span>
      <span class="va">new_cases</span>,                       <span class="co"># calculate based on value in new_cases column</span>
      .i <span class="op">=</span> <span class="va">date_onset</span>,                 <span class="co"># index is date_onset col, so non-present dates are included in window </span>
      .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,    <span class="co"># function is mean() with missing values removed</span>
      .before <span class="op">=</span> <span class="fl">6</span>,                     <span class="co"># window is the day and 6-days before</span>
      .complete <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,              <span class="co"># must be FALSE for unlist() to work in next step</span>
    avg_7day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">avg_7day</span><span class="op">)</span><span class="op">)</span>       <span class="co"># convert class list to class numeric</span>


<span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ll_counts_7day</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># begin with new dataset defined above </span>
    <span class="fu">geom_histogram</span><span class="op">(</span>              <span class="co"># create epicurve histogram</span>
      mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
        x <span class="op">=</span> <span class="va">date_onset</span>,          <span class="co"># date column as x-axis</span>
        y <span class="op">=</span> <span class="va">new_cases</span><span class="op">)</span>,          <span class="co"># height is number of daily new cases</span>
        stat <span class="op">=</span> <span class="st">"identity"</span>,       <span class="co"># height is y value</span>
        fill<span class="op">=</span><span class="st">"#92a8d1"</span>,          <span class="co"># cool color for bars</span>
        colour <span class="op">=</span> <span class="st">"#92a8d1"</span>,      <span class="co"># same color for bar border</span>
        <span class="op">)</span><span class="op">+</span> 
    <span class="fu">geom_line</span><span class="op">(</span>                   <span class="co"># make line for rolling average</span>
      mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
        x <span class="op">=</span> <span class="va">date_onset</span>,          <span class="co"># date column for x-axis</span>
        y <span class="op">=</span> <span class="va">avg_7day</span>,            <span class="co"># y-value set to rolling average column</span>
        lty <span class="op">=</span> <span class="st">"7-day \nrolling avg"</span><span class="op">)</span>, <span class="co"># name of line in legend</span>
      color<span class="op">=</span><span class="st">"red"</span>,               <span class="co"># color of line</span>
      size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>                <span class="co"># width of line</span>
    <span class="fu">scale_x_date</span><span class="op">(</span>                <span class="co"># date scale</span>
      date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,
      date_labels <span class="op">=</span> <span class="st">'%d/%m'</span>,
      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_continuous</span><span class="op">(</span>          <span class="co"># y-axis scale</span>
      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>       
    <span class="fu">labs</span><span class="op">(</span>
      x<span class="op">=</span><span class="st">""</span>,
      y <span class="op">=</span><span class="st">"Number of confirmed cases"</span>,
      fill <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span><span class="op">+</span> 
    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># removes title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-127-1.png" width="672"></div>
</div>
<div id="facetingsmall-multiples" class="section level3" number="1.3.3">
<h3>
<span class="header-section-number">1.3.3</span> Faceting/small-multiples<a class="anchor" aria-label="anchor" href="#facetingsmall-multiples"><i class="fas fa-link"></i></a>
</h3>
<p>As with other ggplots, you can create facetted plots (â€œsmall multiplesâ€). As explained in the [ggplot tips] page of this handbook, you can use either <code>facet_wrap()</code> or <code>facet_grid()</code>. Here we demonstrate with <code>facet_wrap()</code>. For epicurves, <code>facet_wrap()</code> is typically easier as it is likely that you only need to facet on one column.</p>
<p>The general syntax is <code>facet_wrap(rows ~ cols)</code>, where to the left of the tilde (~) is the name of a column to be spread across the â€œrowsâ€ of the facetted plot, and to the right of the tilde is the name of a column to be spread across the â€œcolumnsâ€ of the facetted plot. Most simply, just use one column name, to the right of the tilde: <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Free axes</strong><br>
You will need to decide whether the scales of the axes for each facet are â€œfixedâ€ to the same dimensions (default), or â€œfreeâ€ (meaning they will change based on the data within the facet). Do this with the <code>scales =</code> argument within <code>facet_wrap()</code> by specifying â€œfree_xâ€ or â€œfree_yâ€, or â€œfreeâ€.</p>
<p><strong>Number of cols and rows of facets</strong><br>
This can be specified with <code>ncol =</code> and <code>nrow =</code> within <code>facet_wrap()</code>.</p>
<p><strong>Order of panels</strong><br>
To change the order of appearance, change the underlying order of the levels of the factor column used to create the facets.</p>
<p><strong>Aesthetics</strong><br>
Font size and face, strip color, etc. can be modified through <code>theme()</code> with arguments like:</p>
<ul>
<li>
<code>strip.text = element_text()</code> (size, colour, face, angleâ€¦)</li>
<li>
<code>strip.background = element_rect()</code> (e.g.Â element_rect(fill=â€œgreyâ€))<br>
</li>
<li>
<code>strip.position =</code> (position of the strip â€œbottomâ€, â€œtopâ€, â€œleftâ€, or â€œrightâ€)</li>
</ul>
<p><strong>Strip labels</strong><br>
Labels of the facet plots can be modified through the â€œlabelsâ€ of the column as a factor, or by the use of a â€œlabellerâ€.</p>
<p>Make a labeller like this, using the function <code>as_labeller()</code> from <strong>ggplot2</strong>. Then provide the labeller to the <code>labeller =</code> argument of <code>facet_wrap()</code> as shown below.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
     <span class="st">"0-4"</span>   <span class="op">=</span> <span class="st">"Ages 0-4"</span>,
     <span class="st">"5-9"</span>   <span class="op">=</span> <span class="st">"Ages 5-9"</span>,
     <span class="st">"10-14"</span> <span class="op">=</span> <span class="st">"Ages 10-14"</span>,
     <span class="st">"15-19"</span> <span class="op">=</span> <span class="st">"Ages 15-19"</span>,
     <span class="st">"20-29"</span> <span class="op">=</span> <span class="st">"Ages 20-29"</span>,
     <span class="st">"30-49"</span> <span class="op">=</span> <span class="st">"Ages 30-49"</span>,
     <span class="st">"50-69"</span> <span class="op">=</span> <span class="st">"Ages 50-69"</span>,
     <span class="st">"70+"</span>   <span class="op">=</span> <span class="st">"Over age 70"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>An example facetted plot</strong> - facetted by column <code>age_cat</code>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make plot</span>
<span class="co">###########</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date_onset</span>,
      group <span class="op">=</span> <span class="va">age_cat</span>,
      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,    <span class="co"># arguments inside aes() apply by group</span>
      
    color <span class="op">=</span> <span class="st">"black"</span>,      <span class="co"># arguments outside aes() apply to all data</span>
        
    <span class="co"># histogram breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>  <span class="co"># pre-defined date vector (see earlier in this page)</span>
                      
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
    date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>         <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span>
    <span class="op">~</span><span class="va">age_cat</span>,
    ncol <span class="op">=</span> <span class="fl">4</span>,
    strip.position <span class="op">=</span> <span class="st">"top"</span>,
    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
    subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
    fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-129-1.png" width="672"></div>
<p>See this <a href="https://ggplot2.tidyverse.org/reference/labellers.html">link</a> for more information on labellers.</p>
<div id="total-epidemic-in-facet-background" class="section level4 unnumbered">
<h4>Total epidemic in facet background<a class="anchor" aria-label="anchor" href="#total-epidemic-in-facet-background"><i class="fas fa-link"></i></a>
</h4>
<p>To show the total epidemic in the background of each facet, add the function <code>gghighlight()</code> with empty parentheses to the ggplot. This is from the package <strong>gghighlight</strong>. Note that the y-axis maximum in all facets is now based on the peak of the entire epidemic.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date_onset</span>,
      group <span class="op">=</span> <span class="va">age_cat</span>,
      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
    
    color <span class="op">=</span> <span class="st">"black"</span>,    <span class="co"># arguments outside aes() apply to all data</span>
    
    <span class="co"># histogram breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>     <span class="co"># pre-defined date vector (see top of ggplot section)                </span>
  
  <span class="co"># add grey epidemic in background to each facet</span>
  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
    date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># removes excess y-axis space below 0</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>        <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span>
    <span class="op">~</span><span class="va">age_cat</span>,                          <span class="co"># each plot is one value of age_cat</span>
    ncol <span class="op">=</span> <span class="fl">4</span>,                          <span class="co"># number of columns</span>
    strip.position <span class="op">=</span> <span class="st">"top"</span>,            <span class="co"># position of the facet title/strip</span>
    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             <span class="co"># labeller defines above</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
    subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
    fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-130-1.png" width="672"></div>
</div>
<div id="one-facet-with-data" class="section level4 unnumbered">
<h4>One facet with data<a class="anchor" aria-label="anchor" href="#one-facet-with-data"><i class="fas fa-link"></i></a>
</h4>
<p>If you want to have one facet box that contains all the data, duplicate the entire dataset and treat the duplicates as one faceting value. A â€œhelperâ€ function <code>CreateAllFacet()</code> below can assist with this (thanks to this <a href="https://stackoverflow.com/questions/18933575/easily-add-an-all-facet-to-facet-wrap-in-ggplot2">blog post</a>). When it is run, the number of rows doubles and there will be a new column called <code>facet</code> in which the duplicated rows will have the value â€œallâ€, and the original rows have the their original value of the faceting colum. Now you just have to facet on the <code>facet</code> column.</p>
<p>Here is the helper function. Run it so that it is available to you.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define helper function</span>
<span class="va">CreateAllFacet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span><span class="op">)</span><span class="op">{</span>
     <span class="va">df</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span>
     <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">df</span>
     <span class="va">temp</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"all"</span>
     <span class="va">merged</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">df</span><span class="op">)</span>
     
     <span class="co"># ensure the facet value is a factor</span>
     <span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
     
     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now apply the helper function to the dataset, on column <code>age_cat</code>:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create dataset that is duplicated and with new column "facet" to show "all" age categories as another facet level</span>
<span class="va">central_data2</span> <span class="op">&lt;-</span> <span class="fu">CreateAllFacet</span><span class="op">(</span><span class="va">central_data</span>, col <span class="op">=</span> <span class="st">"age_cat"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># set factor levels</span>
  <span class="fu">mutate</span><span class="op">(</span>facet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">facet</span>,
                        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"0-4"</span>, <span class="st">"5-9"</span>,
                             <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>,
                             <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># check levels</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">central_data2</span><span class="op">$</span><span class="va">facet</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   all   0-4   5-9 10-14 15-19 20-29 30-49 50-69   70+  &lt;NA&gt; 
##   454    74    82    63    55    99    59    10     3     9</code></pre>
<p>Notable changes to the <code>ggplot()</code> command are:</p>
<ul>
<li>The data used is now central_data2 (double the rows, with new column â€œfacetâ€)</li>
<li>Labeller will need to be updated, if used<br>
</li>
<li>Optional: to achieve vertically stacked facets: the facet column is moved to rows side of equation and on right is replaced by â€œ.â€ (<code>facet_wrap(facet~.)</code>), and <code>ncol = 1</code>. You may also need to adjust the width and height of the saved png plot image (see <code>ggsave()</code> in [ggplot tips]).</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data2</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># actual epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
        mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">date_onset</span>,
          group <span class="op">=</span> <span class="va">age_cat</span>,
          fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,    <span class="co"># arguments outside aes() apply to all data</span>
        
        <span class="co"># histogram breaks</span>
        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>    <span class="co"># pre-defined date vector (see top of ggplot section)</span>
                     
  <span class="co"># Labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
    date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>               
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">facet</span><span class="op">~</span><span class="va">.</span> ,                            <span class="co"># each plot is one value of facet</span>
             ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>            

  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-133-1.png" width="480"></div>
</div>
</div>
</div>
<div id="tentative-data" class="section level2" number="1.4">
<h2>
<span class="header-section-number">1.4</span> Tentative data<a class="anchor" aria-label="anchor" href="#tentative-data"><i class="fas fa-link"></i></a>
</h2>
<p>The most recent data shown in epicurves should often be marked as tentative, or subject to reporting delays. This can be done in by adding a vertical line and/or rectangle over a specified number of days. Here are two options:</p>
<ol style="list-style-type: decimal">
<li>Use <code>annotate()</code>:
<ul>
<li>For a line use <code>annotate(geom = "segment")</code>. Provide <code>x</code>, <code>xend</code>, <code>y</code>, and <code>yend</code>. Adjust size, linetype (<code>lty</code>), and color.<br>
</li>
<li>For a rectangle use <code>annotate(geom = "rect")</code>. Provide xmin/xmax/ymin/ymax. Adjust color and alpha.<br>
</li>
</ul>
</li>
<li>Group the data by tentative status and color those bars differently</li>
</ol>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> You might try <code>geom_rect()</code> to draw a rectangle, but adjusting the transparency does not work in a linelist context. This function overlays one rectangle for each observation/row!. Use either a very low alpha (e.g.Â 0.01), or another approach. </span></p>
<div id="using-annotate" class="section level3 unnumbered">
<h3>Using <code>annotate()</code><a class="anchor" aria-label="anchor" href="#using-annotate"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Within <code>annotate(geom = "rect")</code>, the <code>xmin</code> and <code>xmax</code> arguments must be given inputs of class Date.<br>
</li>
<li>Note that because these data are aggregated into weekly bars, and the last bar extends to the Monday after the last data point, the shaded region may appear to cover 4 weeks<br>
</li>
<li>Here is an <code>annotate()</code> <a href="https://ggplot2.tidyverse.org/reference/annotate.html">online example</a>
</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># pre-defined date vector - see top of ggplot section</span>
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,           <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,     <span class="co"># 1st of month</span>
    date_labels <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>          <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Using annotate()\nRectangle and line showing that data from last 21-days are tentative"</span>,
    x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y <span class="op">=</span> <span class="st">"Weekly case indicence"</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add semi-transparent red rectangle to tentative data</span>
  <span class="fu">annotate</span><span class="op">(</span>
    <span class="st">"rect"</span>,
    xmin  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># note must be wrapped in as.Date()</span>
    xmax  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>,                                          <span class="co"># note must be wrapped in as.Date()</span>
    ymin  <span class="op">=</span> <span class="fl">0</span>,
    ymax  <span class="op">=</span> <span class="cn">Inf</span>,
    alpha <span class="op">=</span> <span class="fl">0.2</span>,          <span class="co"># alpha easy and intuitive to adjust using annotate()</span>
    fill  <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add black vertical line on top of other layers</span>
  <span class="fu">annotate</span><span class="op">(</span>
    <span class="st">"segment"</span>,
    x     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, <span class="co"># 21 days before last data</span>
    xend  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, 
    y     <span class="op">=</span> <span class="fl">0</span>,         <span class="co"># line begins at y = 0</span>
    yend  <span class="op">=</span> <span class="cn">Inf</span>,       <span class="co"># line to top of plot</span>
    size  <span class="op">=</span> <span class="fl">2</span>,         <span class="co"># line size</span>
    color <span class="op">=</span> <span class="st">"black"</span>,
    lty   <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># linetype e.g. "solid", "dashed"</span>

  <span class="co"># add text in rectangle</span>
  <span class="fu">annotate</span><span class="op">(</span>
    <span class="st">"text"</span>,
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">15</span>,
    y <span class="op">=</span> <span class="fl">15</span>,
    label <span class="op">=</span> <span class="st">"Subject to reporting delays"</span>,
    angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-134-1.png" width="672"></div>
<p>The same black vertical line can be achieved with the code below, but using <code>geom_vline()</code> you lose the ability to control the height:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,
           size <span class="op">=</span> <span class="fl">2</span>,
           color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
</div>
<div id="bars-color" class="section level3 unnumbered">
<h3>Bars color<a class="anchor" aria-label="anchor" href="#bars-color"><i class="fas fa-link"></i></a>
</h3>
<p>An alternative approach could be to adjust the color or display of the tentative bars of data themselves. You could create a new column in the data preparation stage and use it to group the data, such that the <code>aes(fill = )</code> of tentative data can be a different color or alpha than the other bars.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add column</span>
<span class="co">############</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">central_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>tentative <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="va">date_onset</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span> <span class="op">~</span> <span class="st">"Tentative"</span>, <span class="co"># tenative if in last 7 days</span>
    <span class="cn">TRUE</span>                                       <span class="op">~</span> <span class="st">"Reliable"</span><span class="op">)</span><span class="op">)</span> <span class="co"># all else reliable</span>

<span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, fill <span class="op">=</span> <span class="va">tentative</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># pre-defined data vector, see top of ggplot page</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,           <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Show days that are tentative reporting"</span>,
    subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># remove title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-136-1.png" width="672"></div>
</div>
</div>
<div id="multi-level-date-labels" class="section level2" number="1.5">
<h2>
<span class="header-section-number">1.5</span> Multi-level date labels<a class="anchor" aria-label="anchor" href="#multi-level-date-labels"><i class="fas fa-link"></i></a>
</h2>
<p>If you want multi-level date labels (e.g.Â month and year) <em>without duplicating the lower label levels</em>, consider one of the approaches below:</p>
<p>Remember - you can can use tools like <code>\n</code> <em>within</em> the <code>date_labels</code> or <code>labels</code> arguments to put parts of each label on a new line below. However, the code below helps you take years or months (for example) on a lower line <em>and only once</em>. A few notes on the code below:</p>
<ul>
<li>Case counts are aggregated into weeks for aesthetic reasons. See Epicurves page (aggregated data tab) for details.<br>
</li>
<li>A <code>geom_area()</code> line is used instead of a histogram, as the faceting approach below does not work well with histograms.</li>
</ul>
<p><strong>Aggregate to weekly counts</strong></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create dataset of case counts by week</span>
<span class="co">#######################################</span>
<span class="va">central_weekly</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># filter linelist</span>
  <span class="fu">mutate</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu">count</span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                              <span class="co"># summarize weekly case counts</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                     <span class="co"># remove cases with missing onset_date</span>
  <span class="fu">complete</span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,   <span class="co"># fill-in all weeks with no cases reported</span>
    to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,
    by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Make plots</strong></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with box border on year</span>
<span class="co">##############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_area</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,    <span class="co"># make line, specify x and y</span>
            stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># because line height is count number</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,             <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,          <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># remove excess space</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>, <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,                <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                   <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,         <span class="co"># facet labels placement</span>
        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># facet labels no fill grey border</span>
                                        colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,
        panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># no space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels, grey label border"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-138-1.png" width="672"></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with no box border on year</span>
<span class="co">#################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># establish x and y for entire plot</span>
  <span class="fu">geom_line</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,              <span class="co"># make line, line height is count number</span>
            color <span class="op">=</span> <span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>            <span class="co"># line color</span>
  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># make points at the weekly data points</span>
  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#69b3a2"</span>,               <span class="co"># fill area below line</span>
            alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># fill transparency</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,            <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,         <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># remove excess space</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,   <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,               <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,                     <span class="co"># facet label placement</span>
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,            <span class="co"># no facet lable background</span>
          panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,          
          panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey40"</span><span class="op">)</span>,  <span class="co"># grey border to facet PANEL</span>
          panel.spacing<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># No space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels - points, shaded, no label border"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-138-2.png" width="672"></div>
<p>The above techniques were adapted from <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">this</a> and <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">this</a> post on stackoverflow.com.</p>
<!-- ======================================================= -->
</div>
<div id="dual-axis" class="section level2" number="1.6">
<h2>
<span class="header-section-number">1.6</span> Dual-axis<a class="anchor" aria-label="anchor" href="#dual-axis"><i class="fas fa-link"></i></a>
</h2>
<p>Although there are fierce discussions about the validity of dual axes within the data visualization community, many epi supervisors still want to see an epicurve or similar chart with a percent overlaid with a second axis.</p>
<p>One example, of the <strong>cowplot</strong> method is shown below:</p>
<ul>
<li>Two distinct plots are made, and then combined with <strong>cowplot</strong> package.<br>
</li>
<li>The plots must have the exact same x-axis (set limits) or else the data and labels will not align<br>
</li>
<li>Each uses <code>theme_cowplot()</code> and one has the y-axis moved to the right side of the plot</li>
</ul>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>

<span class="co"># Make first plot of epicurve histogram</span>
<span class="co">#######################################</span>
<span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># plot cases per week</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># create histogram  </span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># bin breaks every week beginning monday before first case, going to monday after last case</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">+</span>  <span class="co"># pre-defined vector of weekly dates (see top of ggplot section)</span>
        
  <span class="co"># specify beginning and end of date axis to align with other plot</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># min/max of the pre-defined weekly breaks of histogram</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">"Daily cases"</span>,
      x <span class="op">=</span> <span class="st">"Date of symptom onset"</span>
    <span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>


<span class="co"># make second plot of percent died per week</span>
<span class="co">###########################################</span>
<span class="va">plot_deaths</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                        <span class="co"># begin with linelist</span>
  <span class="fu">group_by</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># create week column</span>
  
  <span class="co"># summarise to get weekly percent of cases who died</span>
  <span class="fu">summarise</span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
            died <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            pct_died <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="va">died</span><span class="op">/</span><span class="va">n_cases</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># begin plot</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># line of weekly percent who died</span>
  <span class="fu">geom_line</span><span class="op">(</span>                                <span class="co"># create line of percent died</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">pct_died</span><span class="op">)</span>,  <span class="co"># specify y-height as pct_died column</span>
    stat <span class="op">=</span> <span class="st">"identity"</span>,                      <span class="co"># set line height to the value in pct_death column, not the number of rows (which is default)</span>
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># Same date-axis limits as the other plot - perfect alignment</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># min/max of the pre-defined weekly breaks of histogram</span>
  
  
  <span class="co"># y-axis adjustments</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>                <span class="co"># adjust y-axis</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>,         <span class="co"># set break intervals of percent axis</span>
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,              <span class="co"># set extent of percent axis</span>
    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span>             <span class="co"># move percent axis to the right</span>
  
  <span class="co"># Y-axis label, no x-axis label</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,
       y <span class="op">=</span> <span class="st">"Percent deceased"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># percent axis label</span>
  
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>                   <span class="co"># add this to make the two plots merge together nicely</span></code></pre></div>
<p>Now use <strong>cowplot</strong> to overlay the two plots. Attention has been paid to the x-axis alignment, side of the y-axis, and use of <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">align_plots</span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_deaths</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>
<span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-140-1.png" width="672"></div>
</div>
<div id="cumulative-incidence-1" class="section level2" number="1.7">
<h2>
<span class="header-section-number">1.7</span> Cumulative Incidence<a class="anchor" aria-label="anchor" href="#cumulative-incidence-1"><i class="fas fa-link"></i></a>
</h2>
<p>Note: If using <strong>incidence2</strong>, see the section on how you can produce cumulative incidence with a simple function. This page will address how to calculate cumulative incidence and plot it with ggplot().</p>
<p>If beginning with a case linelist, create a new column containing the cumulative number of cases per day in an outbreak using <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> from <strong>base</strong> R:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                <span class="co"># count of rows per day (returned in column "n")   </span>
  <span class="fu">mutate</span><span class="op">(</span>                         
    cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>       <span class="co"># new column of the cumulative number of rows at each date</span>
    <span class="op">)</span></code></pre></div>
<p>The first 10 rows are shown below:</p>
<div id="htmlwidget-fb0c3ae9e043bc0c1646" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fb0c3ae9e043bc0c1646">{"x":{"filter":"none","data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05"],[1,1,2,1,1,1,2,1,1,1],[1,2,4,5,6,7,9,10,11,12]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n      <th>cumulative_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>This cumulative column can then be plotted against <code>date_onset</code>, using <code>geom_line()</code>:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>

<span class="va">plot_cumulative</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-143-1.png" width="672"></div>
<p>It can also be overlaid onto the epicurve, with dual-axis using the <strong>cowplot</strong> method described above and in the [ggplot tips] page:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>

<span class="co"># Make first plot of epicurve histogram</span>
<span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>          
    data <span class="op">=</span> <span class="va">linelist</span>,
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    y <span class="op">=</span> <span class="st">"Daily cases"</span>,
    x <span class="op">=</span> <span class="st">"Date of symptom onset"</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>

<span class="co"># make second plot of cumulative cases line</span>
<span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,
       y <span class="op">=</span> <span class="st">"Cumulative cases"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>
    axis.line.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now use <strong>cowplot</strong> to overlay the two plots. Attention has been paid to the x-axis alignment, side of the y-axis, and use of <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">align_plots</span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_cumulative</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>
<span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-145-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="resources" class="section level2" number="1.8">
<h2>
<span class="header-section-number">1.8</span> Resources<a class="anchor" aria-label="anchor" href="#resources"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html"></a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#epidemic-curves"><span class="header-section-number">1</span> Epidemic curves</a></li>
<li>
<a class="nav-link" href="#preparation"><span class="header-section-number">1.1</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#packages">Packages</a></li>
<li><a class="nav-link" href="#import-data">Import data</a></li>
<li><a class="nav-link" href="#set-parameters">Set parameters</a></li>
<li><a class="nav-link" href="#verify-dates">Verify dates</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epicurves-with-incidence2-package"><span class="header-section-number">1.2</span> Epicurves with incidence2 package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simple-example">Simple example</a></li>
<li><a class="nav-link" href="#change-time-interval-of-case-aggregation">Change time interval of case aggregation</a></li>
<li><a class="nav-link" href="#groups">Groups</a></li>
<li><a class="nav-link" href="#filtered-data">Filtered data</a></li>
<li><a class="nav-link" href="#aggregated-counts">Aggregated counts</a></li>
<li><a class="nav-link" href="#facetssmall-multiples">Facets/small multiples</a></li>
<li><a class="nav-link" href="#modifications-with-plot">Modifications with plot()</a></li>
<li><a class="nav-link" href="#modifications-with-ggplot2">Modifications with ggplot2</a></li>
<li><a class="nav-link" href="#change-colors">Change colors</a></li>
<li><a class="nav-link" href="#adjust-level-order">Adjust level order</a></li>
<li><a class="nav-link" href="#vertical-gridlines">Vertical gridlines</a></li>
<li><a class="nav-link" href="#cumulative-incidence">Cumulative incidence</a></li>
<li><a class="nav-link" href="#rolling-average">Rolling average</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epicurves-with-ggplot2"><span class="header-section-number">1.3</span> Epicurves with ggplot2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#specify-case-bins">Specify case bins</a></li>
<li><a class="nav-link" href="#weekly-epicurve-example">Weekly epicurve example</a></li>
<li><a class="nav-link" href="#groupcolor-by-value">Group/color by value</a></li>
<li><a class="nav-link" href="#adjust-colors">Adjust colors</a></li>
<li><a class="nav-link" href="#adjust-level-order-1">Adjust level order</a></li>
<li><a class="nav-link" href="#adjust-legend">Adjust legend</a></li>
<li><a class="nav-link" href="#bars-side-by-side">Bars side-by-side</a></li>
<li><a class="nav-link" href="#axis-limits">Axis limits</a></li>
<li><a class="nav-link" href="#date-axis-labelsgridlines">Date-axis labels/gridlines</a></li>
<li><a class="nav-link" href="#aggregated-data"><span class="header-section-number">1.3.1</span> Aggregated data</a></li>
<li><a class="nav-link" href="#moving-averages"><span class="header-section-number">1.3.2</span> Moving averages</a></li>
<li><a class="nav-link" href="#facetingsmall-multiples"><span class="header-section-number">1.3.3</span> Faceting/small-multiples</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#tentative-data"><span class="header-section-number">1.4</span> Tentative data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-annotate">Using annotate()</a></li>
<li><a class="nav-link" href="#bars-color">Bars color</a></li>
</ul>
</li>
<li><a class="nav-link" href="#multi-level-date-labels"><span class="header-section-number">1.5</span> Multi-level date labels</a></li>
<li><a class="nav-link" href="#dual-axis"><span class="header-section-number">1.6</span> Dual-axis</a></li>
<li><a class="nav-link" href="#cumulative-incidence-1"><span class="header-section-number">1.7</span> Cumulative Incidence</a></li>
<li><a class="nav-link" href="#resources"><span class="header-section-number">1.8</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-03-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
