<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1 Cleaning data | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome - THIS IS A DRAFT</a></li>
<li class="book-part">Preview pages</li>
<li><a class="active" href="cleaning-data.html"><span class="header-section-number">1</span> Cleaning data</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cleaning-data" class="section level1 tabset tabset-fade" number="1">
<h1>
<span class="header-section-number">1</span> Cleaning data<a class="anchor" aria-label="anchor" href="#cleaning-data"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/cleaning.png" width="298" height="10%" style="display: block; margin: auto;"></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
<div id="overview" class="section level2 tabset tabset-fade" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"><i class="fas fa-link"></i></a>
</h2>
<p>This page demonstrates common steps necessary to clean a dataset, starting with importing raw data and demonstrating a “pipe chain” of cleaning steps.</p>
<p>This page uses a simulated Ebola case linelist, which is referenced throughout the handbook.</p>
<p>Here are some of the functions described in this page:</p>
<ul>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> - pipe to pass the dataset from one function to the next<br>
</li>
<li>
<code>mutate()</code> - to create, transform, and re-define columns<br>
</li>
<li>
<code>select()</code> - to select or re-name columns<br>
</li>
<li>
<code>rename()</code> - to rename columns<br>
</li>
<li>
<code>across()</code> - to transform multiple columns at one time<br>
</li>
<li>
<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> - to keep certain rows<br>
</li>
<li>
<code>add_row()</code> - to add row manually<br>
</li>
<li>
<code>clean_names()</code> - to standardize the syntax of column names<br>
</li>
<li>
<code>as.characer()</code>, <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code>, <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code>, etc. - to convert the class of a column<br>
</li>
<li>
<code>recode()</code> - to re-code values in a column<br>
</li>
<li>
<code>case_when()</code> - to re-code values in a column using more complex logical criteria<br>
</li>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>, <code>na_if()</code>, <code>coalesce()</code> - special functions for re-coding<br>
</li>
<li>
<code>clean_data()</code> - to re-code/clean using a data dictionary<br>
</li>
<li>
<code>age_categories()</code> and <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> - to create categorical groups from a numeric column<br>
</li>
<li>
<code>distinct()</code> - to de-duplicate rows</li>
</ul>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
<div id="cleaning-pipeline" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> Cleaning pipeline<a class="anchor" aria-label="anchor" href="#cleaning-pipeline"><i class="fas fa-link"></i></a>
</h2>
<p><strong>This page proceeds through typical cleaning steps, adding them sequentially to a cleaning pipe chain.</strong></p>
<p>In epidemiological analysis and data processing, cleaning steps are often performed linked together, sequentially. In R this often manifests as a cleaning “pipeline”, where <em>the raw dataset is passed or “piped” from one cleaning step to another</em>.</p>
<p>The chain often utilizes <strong>dplyr</strong> verb functions and the <strong>magrittr</strong> pipe operator <code><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>. The pipe begins with the “raw” data (<code>linelist_raw</code>) and ends with a “clean” dataset (<code>linelist</code>).</p>
<p>In a cleaning pipeline the order of the steps is important. Cleaning steps might include:</p>
<ul>
<li>Importing of data<br>
</li>
<li>Column names cleaned or changed<br>
</li>
<li>De-duplication<br>
</li>
<li>Column creation and transformation (e.g. re-coding or cleaning values)<br>
</li>
<li>Rows filtered or added</li>
</ul>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
<div id="load-packages" class="section level2" number="1.3">
<h2>
<span class="header-section-number">1.3</span> Load packages<a class="anchor" aria-label="anchor" href="#load-packages"><i class="fas fa-link"></i></a>
</h2>
<p>Below are the packages used in the page to clean the data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,        <span class="co"># importing data  </span>
  <span class="va">here</span>,       <span class="co"># relative file pathways  </span>
  <span class="va">janitor</span>,    <span class="co"># data cleaning</span>
  <span class="va">lubridate</span>,  <span class="co"># working with dates</span>
  <span class="va">epikit</span>,     <span class="co"># age_categories() function</span>
  <span class="va">tidyverse</span>   <span class="co"># data manipulation and visualization</span>
<span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="import-data" class="section level2" number="1.4">
<h2>
<span class="header-section-number">1.4</span> Import data<a class="anchor" aria-label="anchor" href="#import-data"><i class="fas fa-link"></i></a>
</h2>
<div id="import" class="section level3 unnumbered">
<h3>Import<a class="anchor" aria-label="anchor" href="#import"><i class="fas fa-link"></i></a>
</h3>
<p>Here we import the raw .xlsx dataset using the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the package <strong>rio</strong>, and save it as the dataframe <code>linelist_raw</code>. If your dataset is large and takes a long time to import, it can be useful to have the import command be separate from the pipe chain and the “raw” saved as a distinct file. This also allows easy comparison between the original and cleaned versions.</p>
<p>See the page on [Importing and exporting] data for more details and unusual situations, including:</p>
<ul>
<li>Skipping the import of certain rows<br>
</li>
<li>Dealing with a second row that is a data dictionary<br>
</li>
<li>Importing from Google sheets</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_raw.xlsx"</span><span class="op">)</span></code></pre></div>
<p>You can view the first 50 rows of the the original “raw” dataset below:</p>
<div id="htmlwidget-0cf3421dbb4db39abed0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0cf3421dbb4db39abed0">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399161600000\" data-max=\"1406937600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1398556800000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399420800000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2700264337236\" data-max=\"-13.2083805379189\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45020022241045\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"50\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"7\" data-max=\"98\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"13\" data-max=\"258\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"36\" data-max=\"37.9\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["6c286a","5fe599","6285c9","893f25","c4e706","275cc7","133ee7","dbebea","788a99","2978ac","57a565","a6c614","c15f36","c97dd9","02d8fd","bd14fc","af9f9a","589e9f","ae96ac","ec8ee4","b799eb","ceed40","9371a9","403057","7fd086","1c1848","959170","64c8ef","a47529","52ea64","92ab68","f81362","6670a5","4c1040","ae50c8","583717","770e5e","1e1825","b013ab","9fcf61","c5bc73","db7b54","38cc4a","cc7393","3789ee","8188cd","c8c030","a81f7d","6b70f0","316781"],[2,4,4,3,5,5,3,7,5,4,4,5,5,9,9,6,6,9,10,6,5,5,8,10,7,8,8,6,5,7,8,8,9,7,9,10,7,8,8,10,7,14,8,8,10,7,9,12,7,8],[null,"2014-05-08T00:00:00Z","2014-05-04T00:00:00Z","2014-05-18T00:00:00Z",null,"2014-05-24T00:00:00Z","2014-05-23T00:00:00Z",null,"2014-06-01T00:00:00Z","2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-05T00:00:00Z",null,null,"2014-06-14T00:00:00Z","2014-06-04T00:00:00Z",null,"2014-06-11T00:00:00Z","2014-06-20T00:00:00Z","2014-06-15T00:00:00Z","2014-06-27T00:00:00Z",null,null,null,null,"2014-07-09T00:00:00Z","2014-06-29T00:00:00Z",null,"2014-06-13T00:00:00Z","2014-07-15T00:00:00Z",null,null,"2014-07-18T00:00:00Z","2014-07-17T00:00:00Z","2014-07-20T00:00:00Z",null,null,null,"2014-07-24T00:00:00Z",null,"2014-07-27T00:00:00Z","2014-07-26T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-07-16T00:00:00Z",null,"2014-08-02T00:00:00Z",null,"2014-07-22T00:00:00Z"],["2014-04-27","2014-05-13","2014-05-14","2014-05-21","2014-05-23","2014-05-27","2014-05-27","2014-06-02","2014-06-06","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-19","2014-06-20","2014-06-20","2014-06-20","2014-06-24","2014-06-25","2014-06-30","2014-07-03","2014-07-07","2014-07-08","2014-07-09","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-20","2014-07-25","2014-07-27","2014-07-29","2014-07-29","2014-07-30","2014-07-30","2014-07-31","2014-07-31","2014-08-01","2014-08-01","2014-08-01","2014-08-02","2014-08-02","2014-08-03","2014-08-03","2014-08-03"],["2014-04-27T00:00:00Z","2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-22T00:00:00Z","2014-05-24T00:00:00Z","2014-05-28T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-18T00:00:00Z","2014-06-19T00:00:00Z","2014-06-19T00:00:00Z","2014-06-20T00:00:00Z","2014-06-22T00:00:00Z","2014-06-20T00:00:00Z","2014-06-26T00:00:00Z","2014-06-25T00:00:00Z","2014-07-02T00:00:00Z","2014-07-05T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-15T00:00:00Z","2014-07-18T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-21T00:00:00Z","2014-07-22T00:00:00Z","2014-07-20T00:00:00Z","2014-07-27T00:00:00Z","2014-07-28T00:00:00Z","2014-07-30T00:00:00Z","2014-07-31T00:00:00Z","2014-07-30T00:00:00Z","2014-07-31T00:00:00Z","2014-08-02T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z","2014-08-04T00:00:00Z","2014-08-04T00:00:00Z"],["2014-05-07T00:00:00Z",null,"2014-05-17T00:00:00Z","2014-05-29T00:00:00Z","2014-06-02T00:00:00Z","2014-06-07T00:00:00Z","2014-05-29T00:00:00Z","2014-06-05T00:00:00Z","2014-06-25T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-06-26T00:00:00Z","2014-06-28T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-27T00:00:00Z","2014-07-13T00:00:00Z","2014-06-30T00:00:00Z","2014-06-27T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-31T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-27T00:00:00Z","2014-07-14T00:00:00Z","2014-07-19T00:00:00Z","2014-07-25T00:00:00Z","2014-07-26T00:00:00Z","2014-07-26T00:00:00Z","2014-08-05T00:00:00Z","2014-08-07T00:00:00Z","2014-08-01T00:00:00Z",null,"2014-08-08T00:00:00Z","2014-08-06T00:00:00Z",null,"2014-08-01T00:00:00Z","2014-08-05T00:00:00Z","2014-08-05T00:00:00Z","2014-08-11T00:00:00Z",null,"2014-08-21T00:00:00Z","2014-08-09T00:00:00Z","2014-09-13T00:00:00Z","2014-08-29T00:00:00Z","2014-08-11T00:00:00Z","2014-09-05T00:00:00Z",null,"2014-08-07T00:00:00Z"],["Death",null,"Death","Recover",null,"Death","Death",null,"Recover","Death","Death","Recover","Recover","Recover","Death","Death",null,null,"Death","Death","Recover","Recover",null,"Death","Recover","Death","Death","Recover","Death","Death",null,"Death","Death","Recover","Death","Death","Recover","Death","Death","Recover","Death","Death","Recover","Death",null,"Recover",null,"Recover","Death","Death"],["f","m","f","m","m","f","f","m","m","m","m","f","f","m","m","f","f","m","m","m","m","m","f","f","m","f","f","m","m","f","f","m","f","f","f","m","f","f","m","f","f","f","m","f","f","f","f","m","m","m"],[null,"Other",null,"Military Hospital",null,"Central Hospital",null,"Port Hospital","Port Hospital","Port Hospital","Military Hospital","Other",null,"Port Hospital","Port Hospital","Port Hospital",null,null,"Port Hospital",null,null,"Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Port Hospital","Port Hospital","Central Hospital","Central Hospital","Military Hospital",null,"Military Hospital","Other","Military Hospital","Other","Port Hospital","Other","Port Hospital","Port Hospital",null,"Port Hospital","Military Hospital","Military Hospital",null,null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital",null,"Port Hospital",null,"Other"],[-13.2311229156957,-13.2157351064963,-13.2205862656383,-13.2228638912441,-13.2143394209926,-13.2369393782451,-13.2230208115547,-13.2164705932244,-13.2128924575825,-13.2206286746001,-13.253989309478,-13.2190654487695,-13.2189533374241,-13.2243437095992,-13.2124311244169,-13.2322364148998,-13.2371313571269,-13.2083835761865,-13.2131457458534,-13.2578516459532,-13.2162953240809,-13.2471655635541,-13.2680671272333,-13.2160179088168,-13.2353020203708,-13.2113470441303,-13.2452992638476,-13.2614705796373,-13.2227293309912,-13.2177946632397,-13.2333516655879,-13.2163318124535,-13.2217866965605,-13.2359603887432,-13.2472895700622,-13.2587625731645,-13.2351591427265,-13.2083805379189,-13.2700264337236,-13.2631399589905,-13.2224162932627,-13.2194851717021,-13.2573683214693,-13.2589430372533,-13.2137356012883,-13.2611950766249,-13.2106014146595,-13.2477515432081,-13.2486407324245,-13.2331787372694],[8.46477606739351,8.46897295100924,8.45056919644254,8.46082377490923,8.48932072596067,8.46916113869591,8.46142781816041,8.48666377289188,8.46852156267174,8.48401630165138,8.45837125340844,8.47737640975659,8.45136291368722,8.47145134147474,8.45344099552146,8.47727846519132,8.48777544809491,8.46320325007363,8.46397733703235,8.45196229052854,8.46395131808455,8.48811520075179,8.473437335922,8.46242233645879,8.46849944119707,8.47982352763317,8.48334624336805,8.45750552360835,8.48480589906514,8.45020022241045,8.46517148129756,8.4630635336683,8.4623972994508,8.47704542384682,8.48450777619227,8.45574180260702,8.46765214132969,8.45570803751877,8.47765318263688,8.4653055523942,8.46186770657403,8.45077238424485,8.4532568143863,8.45415199059547,8.4732571907655,8.46334217568605,8.47793008081529,8.48500469856184,8.48480340615605,8.46382313795279],[null,"f547d6","f9149b","11f8ea",null,"e02f66","76b97a",null,"374728","996f3a","133ee7","3ff1bc",null,null,"e61cb9","db11a9",null,"8b4c1c","02d8fd","be502d","ea3740",null,null,null,null,"3e6957","beb26e",null,"a2086d","64c8ef",null,null,"67be4e","916d0a","26c588",null,null,null,"eae3e8",null,"4af3d1","df7c34","53608c",null,"3b096b","916d0a",null,"a5bda8",null,"d05405"],[null,"other","other","other",null,"other","other",null,"other","other","other","funeral",null,null,"other","other",null,"other","other","other","other",null,null,null,null,"other","funeral",null,"other","other",null,null,"other","other","other",null,null,null,"other",null,"other","other","funeral",null,"other","other",null,"funeral",null,"other"],["14","12","4","66","18","7","10","7","2","7","11","19","15","19","3","14","32","6","6","11","30","7","1","4","19","0","4","8","41","9","3","19","16","16","5","43","16","16","33","33","26","17","6","2","35","5","22","25","46","24"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[71,60,29,98,66,43,50,40,35,42,46,62,50,64,43,57,81,35,44,60,74,52,20,48,57,7,40,57,93,32,31,59,59,52,33,71,51,55,67,72,67,64,30,20,63,45,60,62,74,63],[121,146,78,258,124,114,100,89,55,97,140,143,128,184,66,163,165,112,96,117,178,126,33,54,119,13,57,124,180,96,51,118,130,143,94,206,132,162,193,190,161,147,70,39,187,77,159,190,223,164],[22,22,23,22,22,23,22,21,21,24,23,21,22,22,23,23,22,23,23,21,22,22,21,23,22,23,22,21,24,22,24,22,22,22,22,23,22,21,22,24,22,21,21,21,24,20,20,21,24,23],["no","no","no","no","no","no","no","no",null,"no",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no",null,"no","no","no","no","no",null,"no","no","no","no","no","no","no",null,null,"no",null,"no",null,"no","no"],["no","yes","no","no","no","no","yes","no",null,"no",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no",null,"yes","yes","no","no","no",null,"no","yes","no","no","no","yes","no",null,null,"no",null,"no",null,"no","no"],["yes","no","yes","yes","yes","yes","no","yes",null,"yes",null,"yes","yes",null,"no","no","yes","no","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes",null,"yes","yes","yes","yes","no",null,"no","yes","yes","yes","yes","yes","yes",null,null,"yes",null,"yes",null,"yes","yes"],["no","no","no","no","no","no","no","no",null,"yes",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"yes",null,"no","no","no","no","no",null,"no","no","no","no","no","no","no",null,null,"no",null,"no",null,"no","no"],["no","yes","yes","yes","no","no","no","yes",null,"no",null,"no","no",null,"yes","no","no","yes","yes","yes","yes","yes","yes","yes","no","no",null,"no",null,"no","no","yes","no","no",null,"no","yes","no","yes","yes","yes","no",null,null,"yes",null,"no",null,"no","no"],[36.5,37.7,36.3,37.1,37.4,36.9,36.9,37.1,36.6,36,37.1,36.4,37,37.3,37.2,36.7,36.9,37.6,36.2,36.3,36.6,37.9,36.5,36.7,37.4,37.1,36.9,36.6,37.4,37.2,36.7,36.6,36.5,37,37.2,36.2,37.4,37.3,37.6,36.9,36.4,37.3,37.2,37.3,36.4,37.1,37.2,36.3,37,37.1],["12:38","05:39",null,"08:32","10:32","10:57","11:11","16:40","12:53","17:18","07:34",null,"10:30","08:45","12:12","11:23","11:31",null,"15:34",null,"18:07",null,"10:12","13:19","11:26",null,"16:60","09:35","14:47",null,"15:40","16:07","12:28","22:18","15:39","16:47","17:42","05:18","14:32","12:02","05:25","15:36","16:01","16:23","13:35","13:33","18:36","13:36","12:47","11:32"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,18,24]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="review" class="section level3 unnumbered">
<h3>Review<a class="anchor" aria-label="anchor" href="#review"><i class="fas fa-link"></i></a>
</h3>
<p>You can use the package <strong>skimr</strong> and its function <code>skim()</code> to get an overview of the entire dataframe (see page on [Descriptive analysis]).</p>
<p>Scroll to the right to see that histograms of each numeric column are included.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-225">Table 1.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">linelist_raw</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">6609</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">POSIXct</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: character</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">case_id</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">5888</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">date onset</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">575</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">outcome</td>
<td align="right">1473</td>
<td align="right">0.78</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">326</td>
<td align="right">0.95</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">hospital</td>
<td align="right">1507</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">infector</td>
<td align="right">2361</td>
<td align="right">0.64</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2697</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">source</td>
<td align="right">2361</td>
<td align="right">0.64</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">107</td>
<td align="right">0.98</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">76</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">age_unit</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">fever</td>
<td align="right">261</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">chills</td>
<td align="right">261</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">cough</td>
<td align="right">261</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">aches</td>
<td align="right">261</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vomit</td>
<td align="right">261</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">time_admission</td>
<td align="right">893</td>
<td align="right">0.86</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1094</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">merged_header</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">…28</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="7%">
<col width="5%">
<col width="7%">
<col width="11%">
<col width="4%">
<col width="10%">
<col width="11%">
<col width="11%">
<col width="4%">
<col width="4%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">generation</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">16.590000000000000</td>
<td align="right">5.69</td>
<td align="right">0.000000000000000</td>
<td align="right">13.000000000000000</td>
<td align="right">16.000000000000000</td>
<td align="right">20.00</td>
<td align="right">37.00</td>
<td align="left">▁▆▇▂▁</td>
</tr>
<tr class="even">
<td align="left">lon</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">-13.230000000000000</td>
<td align="right">0.02</td>
<td align="right">-13.270000000000000</td>
<td align="right">-13.250000000000000</td>
<td align="right">-13.230000000000000</td>
<td align="right">-13.22</td>
<td align="right">-13.21</td>
<td align="left">▅▃▃▆▇</td>
</tr>
<tr class="odd">
<td align="left">lat</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">8.470000000000001</td>
<td align="right">0.01</td>
<td align="right">8.449999999999999</td>
<td align="right">8.460000000000001</td>
<td align="right">8.470000000000001</td>
<td align="right">8.48</td>
<td align="right">8.49</td>
<td align="left">▅▇▇▇▆</td>
</tr>
<tr class="even">
<td align="left">row_num</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3239.800000000000182</td>
<td align="right">1856.62</td>
<td align="right">1.000000000000000</td>
<td align="right">1646.000000000000000</td>
<td align="right">3239.000000000000000</td>
<td align="right">4834.00</td>
<td align="right">6479.00</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="odd">
<td align="left">wt_kg</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">52.859999999999999</td>
<td align="right">18.35</td>
<td align="right">-16.000000000000000</td>
<td align="right">42.000000000000000</td>
<td align="right">54.000000000000000</td>
<td align="right">65.00</td>
<td align="right">125.00</td>
<td align="left">▁▃▇▂▁</td>
</tr>
<tr class="even">
<td align="left">ht_cm</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">124.590000000000003</td>
<td align="right">49.22</td>
<td align="right">2.000000000000000</td>
<td align="right">91.000000000000000</td>
<td align="right">129.000000000000000</td>
<td align="right">158.00</td>
<td align="right">299.00</td>
<td align="left">▂▅▇▂▁</td>
</tr>
<tr class="odd">
<td align="left">ct_blood</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="right">21.239999999999998</td>
<td align="right">1.66</td>
<td align="right">16.000000000000000</td>
<td align="right">20.000000000000000</td>
<td align="right">22.000000000000000</td>
<td align="right">22.00</td>
<td align="right">25.00</td>
<td align="left">▁▃▅▇▁</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">138</td>
<td align="right">0.98</td>
<td align="right">38.579999999999998</td>
<td align="right">0.97</td>
<td align="right">35.500000000000000</td>
<td align="right">38.200000000000003</td>
<td align="right">38.799999999999997</td>
<td align="right">39.20</td>
<td align="right">40.80</td>
<td align="left">▁▂▃▇▁</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: POSIXct</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">infection date</td>
<td align="right">2360</td>
<td align="right">0.64</td>
<td align="left">2012-05-02</td>
<td align="left">2015-04-27</td>
<td align="left">2014-10-04</td>
<td align="right">524</td>
</tr>
<tr class="even">
<td align="left">hosp date</td>
<td align="right">5</td>
<td align="right">1.00</td>
<td align="left">2012-05-06</td>
<td align="left">2015-04-30</td>
<td align="left">2014-10-16</td>
<td align="right">573</td>
</tr>
<tr class="odd">
<td align="left">date_of_outcome</td>
<td align="right">1053</td>
<td align="right">0.84</td>
<td align="left">2012-05-11</td>
<td align="left">2015-06-04</td>
<td align="left">2014-10-26</td>
<td align="right">558</td>
</tr>
</tbody>
</table></div>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
</div>
<div id="column-names" class="section level2 tabset tabset-fade" number="1.5">
<h2>
<span class="header-section-number">1.5</span> Column names<a class="anchor" aria-label="anchor" href="#column-names"><i class="fas fa-link"></i></a>
</h2>
<p>Column names are used very often, so they must have “clean” syntax. We suggest the following:</p>
<ul>
<li>Short names</li>
<li>No spaces (replace with underscores _ ,</li>
<li>No unusual characters (&amp;, #, &lt;, &gt;, …)<br>
</li>
<li>Similar style nomenclature (e.g. all date columns named like <strong>date_</strong>onset, <strong>date_</strong>report, <strong>date_</strong>death…)</li>
</ul>
<p>The columns names of <code>linelist_raw</code> are printed below using <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> from <strong>base</strong> R. We can see that:</p>
<ul>
<li>Some names contain spaces<br>
</li>
<li>Different naming patterns are used for dates (‘date onset’ vs. ‘infection date’)<br>
</li>
<li>There must have been a <em>merged header</em> across the two last columns in the .xlsx. We know this because the name of two merged columns (“merged_header”) was applied to the first one, and the second column was assigned a placeholder name “…28”, as it was then empty and is the 28th column.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection date"  "date onset"      "hosp date"       "date_of_outcome" "outcome"         "gender"         
##  [9] "hospital"        "lon"             "lat"             "infector"        "source"          "age"             "age_unit"        "row_num"        
## [17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"           "chills"          "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"   "...28"</code></pre>
<p>Note: For a column name that include spaces, surround the name with back-ticks, for example: linelist$`infection date`. note that on your keyboard, the back-tick (`) is different from the single quotation mark (’).</p>
<div id="automatic-name-cleaning" class="section level3 unnumbered">
<h3>Automatic name cleaning<a class="anchor" aria-label="anchor" href="#automatic-name-cleaning"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code>clean_names()</code> from the package <strong>janitor</strong> standardizes column names and makes them unique by doing the following:</p>
<ul>
<li>Converts all names to consist of only underscores, numbers, and letters<br>
</li>
<li>Accented characters are transliterated to ASCII (e.g. german o with umlaut becomes “o”, spanish “enye” becomes “n”)<br>
</li>
<li>Capitalization preference can be specified using the <code>case =</code> argument (“snake” is default, alternatives include “sentence”, “title”, “small_camel”…)<br>
</li>
<li>You can designate specific name replacements with the <code>replace =</code> argument (e.g. replace = c(onset = “date_of_onset”))<br>
</li>
<li>Here is an online <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">vignette</a>
</li>
</ul>
<p>Below, the cleaning pipeline begins by using <code>clean_names()</code> on the raw linelist.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># send the dataset through the function clean_names()</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># see the new names</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection_date"  "date_onset"      "hosp_date"       "date_of_outcome" "outcome"         "gender"         
##  [9] "hospital"        "lon"             "lat"             "infector"        "source"          "age"             "age_unit"        "row_num"        
## [17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"           "chills"          "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"   "x28"</code></pre>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> The last column name “…28” was changed to “x28”.</span></p>
</div>
<div id="manual-name-cleaning" class="section level3 unnumbered">
<h3>Manual name cleaning<a class="anchor" aria-label="anchor" href="#manual-name-cleaning"><i class="fas fa-link"></i></a>
</h3>
<p>Re-naming columns manually is often necessary. Below, re-naming is performed using the <code>rename()</code> function from the <strong>dplyr</strong> package, as part of a pipe chain. <code>rename()</code> uses the style “NEW = OLD”, the new column name is given before the old column name.</p>
<p>Below, a re-name command is added to the cleaning pipeline:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span></code></pre></div>
<p><strong>Now you can see that the columns names have been changed:</strong></p>
<pre><code>##  [1] "case_id"              "generation"           "date_infection"       "date_onset"           "date_hospitalisation" "date_outcome"        
##  [7] "outcome"              "gender"               "hospital"             "lon"                  "lat"                  "infector"            
## [13] "source"               "age"                  "age_unit"             "row_num"              "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"                "chills"               "cough"                "aches"                "vomit"               
## [25] "temp"                 "time_admission"       "merged_header"        "x28"</code></pre>
<div id="rename-by-column-position" class="section level4 unnumbered">
<h4>Rename by column position<a class="anchor" aria-label="anchor" href="#rename-by-column-position"><i class="fas fa-link"></i></a>
</h4>
<p>You can also rename by column position, instead of column name, for example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rename</span><span class="op">(</span>newNameForFirstColumn  <span class="op">=</span> <span class="fl">1</span>,
       newNameForSecondColumn <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
<div id="rename-via-select" class="section level4 unnumbered">
<h4>Rename via <code>select()</code><a class="anchor" aria-label="anchor" href="#rename-via-select"><i class="fas fa-link"></i></a>
</h4>
<p>You can also rename columns within the <strong>dplyr</strong> <code>select()</code> function, which is used to retain only certain columns (and covered later in this page). This approach also uses the format <code>new_name = old_name</code>. Here is an example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="co"># NEW name             # OLD name</span>
         date_infection       <span class="op">=</span> <span class="va">`infection date`</span>,    <span class="co"># rename and KEEP ONLY these columns</span>
         date_hospitalisation <span class="op">=</span> <span class="va">`hosp date`</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="other-name-challenges" class="section level3 unnumbered">
<h3>Other name challenges<a class="anchor" aria-label="anchor" href="#other-name-challenges"><i class="fas fa-link"></i></a>
</h3>
<div id="empty-excel-column-names" class="section level4 unnumbered">
<h4>Empty Excel column names<a class="anchor" aria-label="anchor" href="#empty-excel-column-names"><i class="fas fa-link"></i></a>
</h4>
<p>If you importing an Excel sheet with a missing column name, depending on the import function used, R will likely create a column name with a value like “…1” or “…2”. You can clean these names manually by referencing their position number (see example above), or their name (<code>linelist_raw$...1</code>).</p>
</div>
<div id="merged-excel-column-names-and-cells" class="section level4 unnumbered">
<h4>Merged Excel column names and cells<a class="anchor" aria-label="anchor" href="#merged-excel-column-names-and-cells"><i class="fas fa-link"></i></a>
</h4>
<p>Merged cells in an Excel file are a common occurrence when receiving data from field level. Merged cells can be nice for human reading of data, but cause many problems for machine reading of data. R cannot accommodate merged cells.</p>
<p>Remind people doing data entry that <strong>human-readable data is not the same as machine-readable data</strong>. Strive to train users about the principles of <a href="https://r4ds.had.co.nz/tidy-data.html"><strong>tidy data</strong></a>. If at all possible, try to change procedures so that data arrive in a tidy format without merged cells.</p>
<ul>
<li>Each variable must have its own column.<br>
</li>
<li>Each observation must have its own row.<br>
</li>
<li>Each value must have its own cell.</li>
</ul>
<p>When using <strong>rio</strong>’s <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function, the value in a merged cell will be assigned to the first cell and subsequent cells will be empty.</p>
<p>One solution to deal with merged cells is to import the data with the function <code>readWorkbook()</code> from package <strong>openxlsx</strong>. Set the argument <code>fillMergedCells = TRUE</code>. This gives the value in a merged cell to all cells within the merge range.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/readWorkbook.html">readWorkbook</a></span><span class="op">(</span><span class="st">"linelist_raw.xlsx"</span>, fillMergedCells <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> If column names are merged, you will end up with duplicate column names, which you will need to fix manually - R does not work well with duplicate column names! You can re-name them by referencing their position (e.g. column 5), as explained in the section on manual column name cleaning..</span></p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="select-or-re-order-columns" class="section level2 tabset tabset-fade" number="1.6">
<h2>
<span class="header-section-number">1.6</span> Select or re-order columns<a class="anchor" aria-label="anchor" href="#select-or-re-order-columns"><i class="fas fa-link"></i></a>
</h2>
<p>Use <code>select()</code> to select the columns you want to retain, and their order in the dataframe.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> In the examples below, <code>linelist</code> is modified with <code>select()</code> but not over-written. New column names are only displayed for purpose of example.</span></p>
<p><strong>Here are ALL the column names in the linelist:</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"              "generation"           "date_infection"       "date_onset"           "date_hospitalisation" "date_outcome"        
##  [7] "outcome"              "gender"               "hospital"             "lon"                  "lat"                  "infector"            
## [13] "source"               "age"                  "age_unit"             "row_num"              "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"                "chills"               "cough"                "aches"                "vomit"               
## [25] "temp"                 "time_admission"       "merged_header"        "x28"</code></pre>
<div id="keep-columns" class="section level3" number="1.6.1">
<h3>
<span class="header-section-number">1.6.1</span> Keep columns<a class="anchor" aria-label="anchor" href="#keep-columns"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Select only the columns you want to remain</strong></p>
<p>Put their names in the <code>select()</code> command, with no quotation marks. They will appear in the order you provide. Note that if you include a column that does not exist, R will return an error (see <code>any_of</code> below if you want no error in this situation).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># linelist dataset is piped through select() command, and names() prints just the column names</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">date_hospitalisation</span>, <span class="va">fever</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># display the column names</span></code></pre></div>
<pre><code>## [1] "case_id"              "date_onset"           "date_hospitalisation" "fever"</code></pre>
</div>
<div id="helper-functions" class="section level3" number="1.6.2">
<h3>
<span class="header-section-number">1.6.2</span> Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"><i class="fas fa-link"></i></a>
</h3>
<p>Helper functions and operators exist to make it easy to specify columns.</p>
<p>For example, if you want to re-order the columns, <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> is useful to signify all other columns not yet mentioned. The command below pulls columns <code>date_onset</code> and <code>date_hospitalisation</code> to the beginning:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># move date_onset and date_hospitalisation to beginning</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_hospitalisation</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "date_onset"           "date_hospitalisation" "case_id"              "generation"           "date_infection"       "date_outcome"        
##  [7] "outcome"              "gender"               "hospital"             "lon"                  "lat"                  "infector"            
## [13] "source"               "age"                  "age_unit"             "row_num"              "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"                "chills"               "cough"                "aches"                "vomit"               
## [25] "temp"                 "time_admission"       "merged_header"        "x28"</code></pre>
<p>As well as <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> here are other helpers functions that work <em>within</em> <code>select()</code>:</p>
<ul>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> - all other columns not mentioned<br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col()</a></code> - the last column<br>
</li>
<li>
<code>where()</code> - applies a function to all columns and selects those which are TRUE<br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> - matches to a specified prefix. Example: <code>select(starts_with("date"))</code>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code> - matches to a specified suffix. Example: <code>select(ends_with("_end"))</code><br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> - columns containing a character string. Example: <code>select(contains("time"))</code>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> - to apply a regular expression (regex). Example: <code>select(contains("[pt]al"))</code><br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">num_range()</a></code> - a numerical range like x01, x02, x03<br>
</li>
<li>
<code>any_of()</code> - matches IF column is named. Useful if the name might not exist. Example: <code>select(any_of(date_onset, date_death, cardiac_arrest))</code>
</li>
</ul>
<p>In addition, use normal operators such as <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> to list several columns, <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code> for consecutive columns, <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> for opposite, <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> for AND, and <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> for OR.</p>
<p>Use <code>where()</code> to specify logical criteria for columns. If providing a function inside <code>where()</code>, do not include the empty parentheses. Below selects columns that are class Numeric.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select columns that are class Numeric</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "generation" "lon"        "lat"        "row_num"    "wt_kg"      "ht_cm"      "ct_blood"   "temp"</code></pre>
<p>Use <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> to select only columns in which the column name contains a string. <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code> and <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> provide more nuance.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select columns containing certain characters</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "date_infection"       "date_onset"           "date_hospitalisation" "date_outcome"</code></pre>
<p>The function <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> works similarly to <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> but can be provided a regular expression (see page on [Characters and strings]), such as multiple strings separated by OR bars within the parentheses:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># searched for multiple character matches</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"onset|hosp|fev"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># note the OR symbol "|"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "date_onset"           "date_hospitalisation" "hospital"             "fever"</code></pre>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If a column name that you specifically provide does not exist in the data, it can return an error and stop your code. Consider using <code>any_of()</code> to cite columns that may or may not exist, especially useful in negative (remove) selections.</span></p>
<p>Only one of these columns exists, but no error is produced and the code continues.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">any_of</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_onset"</span>, <span class="st">"village_origin"</span>, <span class="st">"village_detection"</span>, <span class="st">"village_residence"</span>, <span class="st">"village_travel"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "date_onset"</code></pre>
</div>
<div id="remove-columns" class="section level3" number="1.6.3">
<h3>
<span class="header-section-number">1.6.3</span> Remove columns<a class="anchor" aria-label="anchor" href="#remove-columns"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Indicate which columns to remove</strong> by placing a minus symbol “-” in front of the column name (e.g. <code>select(-outcome)</code>), or a vector of column names (as below). All other columns will be retained.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">fever</span><span class="op">:</span><span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># remove onset and all from fever to vomit</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"              "generation"           "date_infection"       "date_hospitalisation" "date_outcome"         "outcome"             
##  [7] "gender"               "hospital"             "lon"                  "lat"                  "infector"             "source"              
## [13] "age"                  "age_unit"             "row_num"              "wt_kg"                "ht_cm"                "ct_blood"            
## [19] "temp"                 "time_admission"       "merged_header"        "x28"</code></pre>
</div>
<div id="standalone" class="section level3" number="1.6.4">
<h3>
<span class="header-section-number">1.6.4</span> Standalone<a class="anchor" aria-label="anchor" href="#standalone"><i class="fas fa-link"></i></a>
</h3>
<p><code>select()</code> can also be used as an independent command (not in a pipe chain). In this case, the first argument is the original dataframe to be operated upon.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a new linelist with id and age-related columns</span>
<span class="va">linelist_age</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">case_id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># display the column names</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_age</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "case_id"  "age"      "age_unit"</code></pre>
<p><strong>Add to the pipe chain</strong></p>
<p>In the <code>linelist_raw</code>, there are a few columns we do not need: <code>row_num</code>, <code>merged_header</code>, and <code>x28</code>. Remove them by adding a <code>select()</code> command to the cleaning pipe chain:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">#####################################################</span>

    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="deduplication" class="section level2" number="1.7">
<h2>
<span class="header-section-number">1.7</span> Deduplication<a class="anchor" aria-label="anchor" href="#deduplication"><i class="fas fa-link"></i></a>
</h2>
<p>See the handbook page on [De-duplication]. Only a very simple de-duplication example is presented here.</p>
<p>The package <strong>dplyr</strong> offers the <code>distinct()</code> function to reduce the dataframe to only unique rows - removing rows that are 100% duplicates. We just add the simple command <code>distinct()</code> to the pipe chain:</p>
<p>We begin with 6609 rows in <code>linelist</code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>After de-duplication there are 6479 rows. So there were rows that were 100% duplicates of other rows.</p>
<p>Below, the <code>distinct()</code> command is added to the cleaning pipe chain:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">#####################################################</span>
    
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="column-creation-and-transformation" class="section level2 tabset tabset-fade" number="1.8">
<h2>
<span class="header-section-number">1.8</span> Column creation and transformation<a class="anchor" aria-label="anchor" href="#column-creation-and-transformation"><i class="fas fa-link"></i></a>
</h2>
<p><strong>The verb <code>mutate()</code> is used to add a new column, or to modify an existing one.</strong> Below is an example of creating a new columns with <code>mutate()</code>. The syntax is: <code>mutate(new_column_name = value or transformation)</code></p>
<div id="new-columns" class="section level3 unnumbered">
<h3>New columns<a class="anchor" aria-label="anchor" href="#new-columns"><i class="fas fa-link"></i></a>
</h3>
<p>The most basic <code>mutate()</code> command to create a new column might look like this. It creates a new column <code>new_col</code> where the value in every row is 10.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>new_col <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>You can also reference values in other columns, to perform calculations. For example below the Body Mass Index (BMI) is calculated using the formula BMI = kg/m^2, using column <code>ht_cm</code> and column <code>wt_kg</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>If creating multiple new columns, separate each with a comma and new line. Below, are examples of ways new columns, including pasting together values from other columns using <code>str_glue()</code> from the <strong>stringr</strong> package:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                       
  <span class="fu">mutate</span><span class="op">(</span>
    new_var_dup    <span class="op">=</span> <span class="va">case_id</span>,             <span class="co"># new column = duplicate/copy another existing column</span>
    new_var_static <span class="op">=</span> <span class="fl">7</span>,                   <span class="co"># new column = all values the same</span>
    new_var_static <span class="op">=</span> <span class="va">new_var_static</span> <span class="op">+</span> <span class="fl">5</span>,  <span class="co"># you can overwrite a column, and it can be a calculation using other variables</span>
    new_var_paste  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{hospital} on ({date_hospitalisation})"</span><span class="op">)</span> <span class="co"># new column = pasting together values from other columns</span>
    <span class="op">)</span> </code></pre></div>
<p><strong><em>Scroll to the right to see the new columns (first 50 rows shown):</em></strong></p>
<div id="htmlwidget-4cf313f6787e5743a373" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4cf313f6787e5743a373">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399161600000\" data-max=\"1406937600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1398556800000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"time\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399420800000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2700264337236\" data-max=\"-13.2083805379189\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45020022241045\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"7\" data-max=\"98\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"13\" data-max=\"258\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"36\" data-max=\"37.9\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"14.7226729162911\" data-max=\"414.201183431953\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["6c286a","5fe599","6285c9","893f25","c4e706","275cc7","133ee7","dbebea","788a99","2978ac","57a565","a6c614","c15f36","c97dd9","02d8fd","bd14fc","af9f9a","589e9f","ae96ac","ec8ee4","b799eb","ceed40","9371a9","403057","7fd086","1c1848","959170","64c8ef","a47529","52ea64","92ab68","f81362","6670a5","4c1040","ae50c8","583717","770e5e","1e1825","b013ab","9fcf61","c5bc73","db7b54","38cc4a","cc7393","3789ee","8188cd","c8c030","a81f7d","6b70f0","316781"],[2,4,4,3,5,5,3,7,5,4,4,5,5,9,9,6,6,9,10,6,5,5,8,10,7,8,8,6,5,7,8,8,9,7,9,10,7,8,8,10,7,14,8,8,10,7,9,12,7,8],[null,"2014-05-08T00:00:00Z","2014-05-04T00:00:00Z","2014-05-18T00:00:00Z",null,"2014-05-24T00:00:00Z","2014-05-23T00:00:00Z",null,"2014-06-01T00:00:00Z","2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-05T00:00:00Z",null,null,"2014-06-14T00:00:00Z","2014-06-04T00:00:00Z",null,"2014-06-11T00:00:00Z","2014-06-20T00:00:00Z","2014-06-15T00:00:00Z","2014-06-27T00:00:00Z",null,null,null,null,"2014-07-09T00:00:00Z","2014-06-29T00:00:00Z",null,"2014-06-13T00:00:00Z","2014-07-15T00:00:00Z",null,null,"2014-07-18T00:00:00Z","2014-07-17T00:00:00Z","2014-07-20T00:00:00Z",null,null,null,"2014-07-24T00:00:00Z",null,"2014-07-27T00:00:00Z","2014-07-26T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-07-16T00:00:00Z",null,"2014-08-02T00:00:00Z",null,"2014-07-22T00:00:00Z"],["2014-04-27","2014-05-13","2014-05-14","2014-05-21","2014-05-23","2014-05-27","2014-05-27","2014-06-02","2014-06-06","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-19","2014-06-20","2014-06-20","2014-06-20","2014-06-24","2014-06-25","2014-06-30","2014-07-03","2014-07-07","2014-07-08","2014-07-09","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-20","2014-07-25","2014-07-27","2014-07-29","2014-07-29","2014-07-30","2014-07-30","2014-07-31","2014-07-31","2014-08-01","2014-08-01","2014-08-01","2014-08-02","2014-08-02","2014-08-03","2014-08-03","2014-08-03"],["2014-04-27T00:00:00Z","2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-22T00:00:00Z","2014-05-24T00:00:00Z","2014-05-28T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-18T00:00:00Z","2014-06-19T00:00:00Z","2014-06-19T00:00:00Z","2014-06-20T00:00:00Z","2014-06-22T00:00:00Z","2014-06-20T00:00:00Z","2014-06-26T00:00:00Z","2014-06-25T00:00:00Z","2014-07-02T00:00:00Z","2014-07-05T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-15T00:00:00Z","2014-07-18T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-21T00:00:00Z","2014-07-22T00:00:00Z","2014-07-20T00:00:00Z","2014-07-27T00:00:00Z","2014-07-28T00:00:00Z","2014-07-30T00:00:00Z","2014-07-31T00:00:00Z","2014-07-30T00:00:00Z","2014-07-31T00:00:00Z","2014-08-02T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z","2014-08-04T00:00:00Z","2014-08-04T00:00:00Z"],["2014-05-07T00:00:00Z",null,"2014-05-17T00:00:00Z","2014-05-29T00:00:00Z","2014-06-02T00:00:00Z","2014-06-07T00:00:00Z","2014-05-29T00:00:00Z","2014-06-05T00:00:00Z","2014-06-25T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-06-26T00:00:00Z","2014-06-28T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-27T00:00:00Z","2014-07-13T00:00:00Z","2014-06-30T00:00:00Z","2014-06-27T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-31T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-27T00:00:00Z","2014-07-14T00:00:00Z","2014-07-19T00:00:00Z","2014-07-25T00:00:00Z","2014-07-26T00:00:00Z","2014-07-26T00:00:00Z","2014-08-05T00:00:00Z","2014-08-07T00:00:00Z","2014-08-01T00:00:00Z",null,"2014-08-08T00:00:00Z","2014-08-06T00:00:00Z",null,"2014-08-01T00:00:00Z","2014-08-05T00:00:00Z","2014-08-05T00:00:00Z","2014-08-11T00:00:00Z",null,"2014-08-21T00:00:00Z","2014-08-09T00:00:00Z","2014-09-13T00:00:00Z","2014-08-29T00:00:00Z","2014-08-11T00:00:00Z","2014-09-05T00:00:00Z",null,"2014-08-07T00:00:00Z"],["Death",null,"Death","Recover",null,"Death","Death",null,"Recover","Death","Death","Recover","Recover","Recover","Death","Death",null,null,"Death","Death","Recover","Recover",null,"Death","Recover","Death","Death","Recover","Death","Death",null,"Death","Death","Recover","Death","Death","Recover","Death","Death","Recover","Death","Death","Recover","Death",null,"Recover",null,"Recover","Death","Death"],["f","m","f","m","m","f","f","m","m","m","m","f","f","m","m","f","f","m","m","m","m","m","f","f","m","f","f","m","m","f","f","m","f","f","f","m","f","f","m","f","f","f","m","f","f","f","f","m","m","m"],[null,"Other",null,"Military Hospital",null,"Central Hospital",null,"Port Hospital","Port Hospital","Port Hospital","Military Hospital","Other",null,"Port Hospital","Port Hospital","Port Hospital",null,null,"Port Hospital",null,null,"Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Port Hospital","Port Hospital","Central Hospital","Central Hospital","Military Hospital",null,"Military Hospital","Other","Military Hospital","Other","Port Hospital","Other","Port Hospital","Port Hospital",null,"Port Hospital","Military Hospital","Military Hospital",null,null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital",null,"Port Hospital",null,"Other"],[-13.2311229156957,-13.2157351064963,-13.2205862656383,-13.2228638912441,-13.2143394209926,-13.2369393782451,-13.2230208115547,-13.2164705932244,-13.2128924575825,-13.2206286746001,-13.253989309478,-13.2190654487695,-13.2189533374241,-13.2243437095992,-13.2124311244169,-13.2322364148998,-13.2371313571269,-13.2083835761865,-13.2131457458534,-13.2578516459532,-13.2162953240809,-13.2471655635541,-13.2680671272333,-13.2160179088168,-13.2353020203708,-13.2113470441303,-13.2452992638476,-13.2614705796373,-13.2227293309912,-13.2177946632397,-13.2333516655879,-13.2163318124535,-13.2217866965605,-13.2359603887432,-13.2472895700622,-13.2587625731645,-13.2351591427265,-13.2083805379189,-13.2700264337236,-13.2631399589905,-13.2224162932627,-13.2194851717021,-13.2573683214693,-13.2589430372533,-13.2137356012883,-13.2611950766249,-13.2106014146595,-13.2477515432081,-13.2486407324245,-13.2331787372694],[8.46477606739351,8.46897295100924,8.45056919644254,8.46082377490923,8.48932072596067,8.46916113869591,8.46142781816041,8.48666377289188,8.46852156267174,8.48401630165138,8.45837125340844,8.47737640975659,8.45136291368722,8.47145134147474,8.45344099552146,8.47727846519132,8.48777544809491,8.46320325007363,8.46397733703235,8.45196229052854,8.46395131808455,8.48811520075179,8.473437335922,8.46242233645879,8.46849944119707,8.47982352763317,8.48334624336805,8.45750552360835,8.48480589906514,8.45020022241045,8.46517148129756,8.4630635336683,8.4623972994508,8.47704542384682,8.48450777619227,8.45574180260702,8.46765214132969,8.45570803751877,8.47765318263688,8.4653055523942,8.46186770657403,8.45077238424485,8.4532568143863,8.45415199059547,8.4732571907655,8.46334217568605,8.47793008081529,8.48500469856184,8.48480340615605,8.46382313795279],[null,"f547d6","f9149b","11f8ea",null,"e02f66","76b97a",null,"374728","996f3a","133ee7","3ff1bc",null,null,"e61cb9","db11a9",null,"8b4c1c","02d8fd","be502d","ea3740",null,null,null,null,"3e6957","beb26e",null,"a2086d","64c8ef",null,null,"67be4e","916d0a","26c588",null,null,null,"eae3e8",null,"4af3d1","df7c34","53608c",null,"3b096b","916d0a",null,"a5bda8",null,"d05405"],[null,"other","other","other",null,"other","other",null,"other","other","other","funeral",null,null,"other","other",null,"other","other","other","other",null,null,null,null,"other","funeral",null,"other","other",null,null,"other","other","other",null,null,null,"other",null,"other","other","funeral",null,"other","other",null,"funeral",null,"other"],["14","12","4","66","18","7","10","7","2","7","11","19","15","19","3","14","32","6","6","11","30","7","1","4","19","0","4","8","41","9","3","19","16","16","5","43","16","16","33","33","26","17","6","2","35","5","22","25","46","24"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[71,60,29,98,66,43,50,40,35,42,46,62,50,64,43,57,81,35,44,60,74,52,20,48,57,7,40,57,93,32,31,59,59,52,33,71,51,55,67,72,67,64,30,20,63,45,60,62,74,63],[121,146,78,258,124,114,100,89,55,97,140,143,128,184,66,163,165,112,96,117,178,126,33,54,119,13,57,124,180,96,51,118,130,143,94,206,132,162,193,190,161,147,70,39,187,77,159,190,223,164],[22,22,23,22,22,23,22,21,21,24,23,21,22,22,23,23,22,23,23,21,22,22,21,23,22,23,22,21,24,22,24,22,22,22,22,23,22,21,22,24,22,21,21,21,24,20,20,21,24,23],["no","no","no","no","no","no","no","no",null,"no",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no",null,"no","no","no","no","no",null,"no","no","no","no","no","no","no",null,null,"no",null,"no",null,"no","no"],["no","yes","no","no","no","no","yes","no",null,"no",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no",null,"yes","yes","no","no","no",null,"no","yes","no","no","no","yes","no",null,null,"no",null,"no",null,"no","no"],["yes","no","yes","yes","yes","yes","no","yes",null,"yes",null,"yes","yes",null,"no","no","yes","no","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes",null,"yes","yes","yes","yes","no",null,"no","yes","yes","yes","yes","yes","yes",null,null,"yes",null,"yes",null,"yes","yes"],["no","no","no","no","no","no","no","no",null,"yes",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"yes",null,"no","no","no","no","no",null,"no","no","no","no","no","no","no",null,null,"no",null,"no",null,"no","no"],["no","yes","yes","yes","no","no","no","yes",null,"no",null,"no","no",null,"yes","no","no","yes","yes","yes","yes","yes","yes","yes","no","no",null,"no",null,"no","no","yes","no","no",null,"no","yes","no","yes","yes","yes","no",null,null,"yes",null,"no",null,"no","no"],[36.5,37.7,36.3,37.1,37.4,36.9,36.9,37.1,36.6,36,37.1,36.4,37,37.3,37.2,36.7,36.9,37.6,36.2,36.3,36.6,37.9,36.5,36.7,37.4,37.1,36.9,36.6,37.4,37.2,36.7,36.6,36.5,37,37.2,36.2,37.4,37.3,37.6,36.9,36.4,37.3,37.2,37.3,36.4,37.1,37.2,36.3,37,37.1],["12:38","05:39",null,"08:32","10:32","10:57","11:11","16:40","12:53","17:18","07:34",null,"10:30","08:45","12:12","11:23","11:31",null,"15:34",null,"18:07",null,"10:12","13:19","11:26",null,"16:60","09:35","14:47",null,"15:40","16:07","12:28","22:18","15:39","16:47","17:42","05:18","14:32","12:02","05:25","15:36","16:01","16:23","13:35","13:33","18:36","13:36","12:47","11:32"],[48.49395533092,28.1478701444924,47.6660092044707,14.7226729162911,42.9240374609781,33.0871037242228,50,50.4986744097967,115.702479338843,44.6381124455309,23.469387755102,30.3193310186317,30.517578125,18.9035916824197,98.7144168962351,21.4535737137265,29.7520661157025,27.9017857142857,47.7430555555556,43.8308130615823,23.355636914531,32.7538422776518,183.654729109275,164.609053497942,40.2513946755173,414.201183431953,123.114804555248,37.0707596253902,28.7037037037037,34.7222222222222,119.18492887351,42.3728813559322,34.9112426035503,25.4291163382073,37.3472159348121,16.7310773871241,29.2699724517906,20.9571711629325,17.9870600553035,19.9445983379501,25.8477682188187,29.6172890925078,61.2244897959184,131.492439184747,18.0159569904773,75.8981278461798,23.7332384003797,17.1745152354571,14.8806531400189,23.4235574063058],["6c286a","5fe599","6285c9","893f25","c4e706","275cc7","133ee7","dbebea","788a99","2978ac","57a565","a6c614","c15f36","c97dd9","02d8fd","bd14fc","af9f9a","589e9f","ae96ac","ec8ee4","b799eb","ceed40","9371a9","403057","7fd086","1c1848","959170","64c8ef","a47529","52ea64","92ab68","f81362","6670a5","4c1040","ae50c8","583717","770e5e","1e1825","b013ab","9fcf61","c5bc73","db7b54","38cc4a","cc7393","3789ee","8188cd","c8c030","a81f7d","6b70f0","316781"],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],["NA on (2014-04-27)","Other on (2014-05-15)","NA on (2014-05-14)","Military Hospital on (2014-05-22)","NA on (2014-05-24)","Central Hospital on (2014-05-28)","NA on (2014-05-29)","Port Hospital on (2014-06-03)","Port Hospital on (2014-06-07)","Port Hospital on (2014-06-08)","Military Hospital on (2014-06-15)","Other on (2014-06-18)","NA on (2014-06-19)","Port Hospital on (2014-06-19)","Port Hospital on (2014-06-20)","Port Hospital on (2014-06-22)","NA on (2014-06-20)","NA on (2014-06-26)","Port Hospital on (2014-06-25)","NA on (2014-07-02)","NA on (2014-07-05)","Port Hospital on (2014-07-09)","St. Mark's Maternity Hospital (SMMH) on (2014-07-09)","Other on (2014-07-11)","Port Hospital on (2014-07-13)","Port Hospital on (2014-07-14)","Central Hospital on (2014-07-13)","Central Hospital on (2014-07-15)","Military Hospital on (2014-07-18)","NA on (2014-07-20)","Military Hospital on (2014-07-20)","Other on (2014-07-21)","Military Hospital on (2014-07-22)","Other on (2014-07-20)","Port Hospital on (2014-07-27)","Other on (2014-07-28)","Port Hospital on (2014-07-30)","Port Hospital on (2014-07-31)","NA on (2014-07-30)","Port Hospital on (2014-07-31)","Military Hospital on (2014-08-02)","Military Hospital on (2014-08-01)","NA on (2014-08-03)","NA on (2014-08-03)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","Port Hospital on (2014-08-03)","NA on (2014-08-02)","Port Hospital on (2014-08-04)","NA on (2014-08-04)","Other on (2014-08-04)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>new_var_dup<\/th>\n      <th>new_var_static<\/th>\n      <th>new_var_paste<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,23,25,27]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> The verb <code>transmute()</code> adds new columns just like <code>mutate()</code> but also drops/removes all other columns that you do not mention.</span></p>
</div>
<div id="convert-column-class" class="section level3 unnumbered">
<h3>Convert column class<a class="anchor" aria-label="anchor" href="#convert-column-class"><i class="fas fa-link"></i></a>
</h3>
<p>Often you will need to set the correct class for a column. There are ways to set column class during the import commands, but often this is often cumbersome. See section on <a href="#objectclasses">object classes</a> to learn more about converting the class of objects, including columns.</p>
<p>First, run some checks on important columns to see if they are the correct class:</p>
<p>Currently, the class of the “age” column is character. To perform quantitative analyses, we need these numbers to be recognized as numeric!</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<p>The class of the “date_onset” column is also character! To perform analyses, these dates must be recognized as dates!</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<p>In this case, use <code>mutate()</code> to define the column as itself, but converted to a different class. Here is a basic example, converting or ensuring that the column <code>age</code> is class Numeric:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Examples of other converting functions:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Examples of modifying class</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>date_var      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">date_var</span>, format <span class="op">=</span> <span class="st">"MM/DD/YYYY"</span><span class="op">)</span>,  <span class="co"># See page on Dates for details  </span>
         numeric_var   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">numeric_var</span><span class="op">)</span>,
         character_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">character_var</span><span class="op">)</span>,
         factor_var    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">factor_var</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span>  <span class="co"># See page on Factors for details  </span>
         <span class="op">)</span></code></pre></div>
<p>Dates can be especially difficult! The date values must all be in the same format for conversion to work correctly (e.g “MM/DD/YYYY”, or “DD Mmm YYYY”). See the page on Working with Dates (LINK) for details. Especially after converting to class date, check your data visually or with a cross-table to confirm that each value was converted correctly. For <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code>, the <code>format =</code> argument is often a source of errors.</p>
</div>
<div id="using-base-r" class="section level3 unnumbered">
<h3>Using <strong>base</strong> R<a class="anchor" aria-label="anchor" href="#using-base-r"><i class="fas fa-link"></i></a>
</h3>
<p>To define a new column (or re-define a column) using <strong>base</strong> R, just use the assignment operator as below.
Remember that when using <strong>base</strong> R you must specify the dataframe before writing the column name (e.g. <code>dataframe$column</code>). Here are two dummy examples:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span><span class="op">$</span><span class="va">old_var</span> <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">$</span><span class="va">old_var</span> <span class="op">+</span> <span class="fl">7</span>
<span class="va">linelist</span><span class="op">$</span><span class="va">new_var</span> <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">$</span><span class="va">old_var</span> <span class="op">+</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age</span></code></pre></div>
</div>
<div id="mutate-on-grouped-values" class="section level3 unnumbered">
<h3>Mutate on grouped values<a class="anchor" aria-label="anchor" href="#mutate-on-grouped-values"><i class="fas fa-link"></i></a>
</h3>
<p>If your dataframe is already <em>grouped</em> (see page on [Grouping data]), <code>mutate()</code> may behave differently than if the dataframe is not grouped. Any summarizing functions, like <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, etc. will be based on only the grouped rows, not all the rows.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># age normalized to mean of ALL rows</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">age</span>, <span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_norm <span class="op">=</span> <span class="va">age</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>

<span class="co"># age normalized to mean of hospital group</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">age</span>, <span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_norm <span class="op">=</span> <span class="va">age</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Read more about using mutate on grouped dataframes in this <a href="https://dplyr.tidyverse.org/reference/mutate.html">tidyverse mutate documentation</a>.</p>
<div id="add-to-pipe-chain" class="section level4 unnumbered">
<h4>Add to pipe chain<a class="anchor" aria-label="anchor" href="#add-to-pipe-chain"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Below, a new column is added to the pipe chain and some classes are converted.</strong></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################</span>
    <span class="co"># add new column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
</div>
</div>
</div>
<div id="re-code-values" class="section level2" number="1.9">
<h2>
<span class="header-section-number">1.9</span> Re-code values<a class="anchor" aria-label="anchor" href="#re-code-values"><i class="fas fa-link"></i></a>
</h2>
<p>Here are a few scenarios where you need to re-code (change) values:</p>
<ul>
<li>to edit one specific value (e.g. one date with an incorrect year or format)<br>
</li>
<li>to reconcile values not spelled the same</li>
<li>to create a new column of groupings of categorical values<br>
</li>
<li>to create a new column of grouping of numeric values (e.g. age categories)</li>
</ul>
<div id="re-code-specific-values" class="section level3 unnumbered">
<h3>Re-code specific values<a class="anchor" aria-label="anchor" href="#re-code-specific-values"><i class="fas fa-link"></i></a>
</h3>
<p>To change values manually you can use the <code>recode()</code> function within the <code>mutate()</code> function.</p>
<p>Imagine there is a nonsensical date in the data (e.g. “2014-14-15”): you could fix the date in the source data, or, you could write the change into the cleaning pipeline via <code>mutate()</code> and <code>recode()</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fix incorrect values                   # old value       # new value</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>date_onset <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"2014-14-15"</span> <span class="op">=</span> <span class="st">"2014-04-15"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <code>mutate()</code> line above can be read as: “mutate the column <code>date_onset</code> to equal the column <code>date_onset</code> re-coded so that OLD VALUE is changed to NEW VALUE”. Note that this pattern (OLD = NEW) for <code>recode()</code> is the opposite of most R patterns (new = old). The R development community is working on revising this.</p>
<p><strong>Here is another example re-coding multiple values within one column.</strong></p>
<p>In <code>linelist</code> the values in the column “hospital” must be cleaned. There are several different spellings and many missing values.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##                      Central Hopital                     Central Hospital                           Hospital A                           Hospital B 
##                                   11                                  443                                  289                                  289 
##                     Military Hopital                    Military Hospital                     Mitylira Hopital                    Mitylira Hospital 
##                                   30                                  786                                    1                                   79 
##                                Other                         Port Hopital                        Port Hospital St. Mark's Maternity Hospital (SMMH) 
##                                  885                                   47                                 1725                                  411 
##   St. Marks Maternity Hopital (SMMH)                                 &lt;NA&gt; 
##                                   11                                 1472</code></pre>
<p>The <code>recode()</code> command below re-defines the column “hospital” as the current column “hospital”, but with the specified recode changes. Don’t forget commas after each!</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co">#    reference: OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now we see the spellings in the <code>hospital</code> column have been corrected and consolidated:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##                     Central Hospital                           Hospital A                           Hospital B                    Military Hospital 
##                                  454                                  289                                  289                                  896 
##                                Other                        Port Hospital St. Mark's Maternity Hospital (SMMH)                                 &lt;NA&gt; 
##                                  885                                 1772                                  422                                 1472</code></pre>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> The number of spaces before and after an equals sign does not matter. Make your code easier to read by aligning the = for all or most rows. Also, consider adding a hashed comment row to clarify for future readers which side is OLD and which side is NEW. </span></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Sometimes a <em>blank</em> character value exists in a dataset (not recognized as R’s value for missing - <code>NA</code>). You can reference this value with two quotation marks with no space inbetween ("").</span></p>
</div>
<div id="re-code-missing-values" class="section level3 unnumbered">
<h3>Re-code missing values<a class="anchor" aria-label="anchor" href="#re-code-missing-values"><i class="fas fa-link"></i></a>
</h3>
<p><strong>dplyr</strong> offers two special function for handling missing values:</p>
<p><strong><code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code></strong></p>
<p>To change missing values (<code>NA</code>) to a specific value, such as “Missing”, use the function <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code> within <code>mutate()</code>. Note that this is used in the same manner as <code>recode</code> above - the name of the variable must be repeated within <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong><code>na_if()</code></strong></p>
<p>To convert a specific value to <code>NA</code>, use <code>na_if()</code>. The command below performs the opposite operation of <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>. In the example below, any values of “Missing” in the column <code>hospital</code> are converted to <code>NA</code>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">na_if</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note: <code>na_if()</code> <strong>cannot be used for logic criteria</strong> (e.g. “all values &gt; 99”) - use <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> or <code>case_when()</code> for this:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert temperatures above 40 to NA </span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Convert onset dates earlier than 2000 to missing</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="re-code-by-logic" class="section level3 unnumbered">
<h3>Re-code by logic<a class="anchor" aria-label="anchor" href="#re-code-by-logic"><i class="fas fa-link"></i></a>
</h3>
<p>Below is demonstrated how to re-code values in a column using logic and conditions:</p>
<ul>
<li>Using <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code>, <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> and <code>if_else()</code> for simple logic</li>
<li>Using <code>case_when()</code> for more complex logic</li>
</ul>
</div>
<div id="re-code-with-simple-logic" class="section level3 unnumbered">
<h3>Re-code with simple logic<a class="anchor" aria-label="anchor" href="#re-code-with-simple-logic"><i class="fas fa-link"></i></a>
</h3>
<div id="replace" class="section level4 unnumbered">
<h4>
<code>replace()</code><a class="anchor" aria-label="anchor" href="#replace"><i class="fas fa-link"></i></a>
</h4>
<p>To re-code with simple logical criteria, you can use <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> within <code>mutate()</code>. <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> is a function from <strong>base</strong> R. Use a logic condition to specify the rows to change . The general syntax is:</p>
<p><code>mutate(col_to_change = replace(col_to_change, criteria for rows, new value))</code>.</p>
<p>One common situation is <strong>changing one value in one row, using an unique row identifier</strong>. Below, the gender is changed to “Female” in the row where the column <code>case_id</code> is “2195”.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="cleaning-data.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: change gender of one specific observation to "Female" </span></span>
<span id="cb55-2"><a href="cleaning-data.html#cb55-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="cleaning-data.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">replace</span>(gender, case_id <span class="sc">==</span> <span class="st">"2195"</span>, <span class="st">"Female"</span>)</span></code></pre></div>
<p>The equivalent command using <strong>base</strong> R syntax and the indexing brackets <code>[ ]</code> is below. It reads as “Change the value of the dataframe <code>linelist</code>‘s column <code>gender</code> (for the rows where <code>linelist</code>’s column <code>case_id</code> has the value ’2195’) to ‘Female’”.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="va">linelist</span><span class="op">$</span><span class="va">case_id</span> <span class="op">==</span> <span class="st">"2195"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Female"</span></code></pre></div>
</div>
<div id="ifelse-and-if_else" class="section level4 unnumbered">
<h4>
<code>ifelse()</code> and <code>if_else()</code><a class="anchor" aria-label="anchor" href="#ifelse-and-if_else"><i class="fas fa-link"></i></a>
</h4>
<p>Another tool for simple logical re-coding is <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> and its partner <code>if_else()</code>. However, in most cases it is better to use <code>case_when()</code> (for clarity).</p>
<p>These commands are simplified versions of an <code>if</code> and <code>else</code> programming statement (LINK). The general syntax is:<br><code>ifelse(condition, value to return if condition evaluates to TRUE, value to return if condition evaluates to FALSE)</code></p>
<p>Below, the column <code>source_known</code> is defined (or re-defined). Its value in a given row is set to “known” if the row’s value in column <code>source</code> is <em>not</em> missing. If the value in <code>source</code> <em>is</em> missing, then the value in <code>source_known</code> is set to “unknown”.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>source_known <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">source</span><span class="op">)</span>, <span class="st">"known"</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><code>if_else()</code> is a special version from <strong>dplyr</strong> that handles dates. Note that if the ‘true’ value is a date, the ‘false’ value must also qualify a date, hence using the special character <code>NA_real_</code> instead of just <code>NA</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a date of death column, which is NA if patient has not died.</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>date_death <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, <span class="va">date_outcome</span>, <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Avoid stringing together many ifelse commands… use <code>case_when()</code> instead!</strong> <code>case_when()</code> is much easier to read and you’ll make fewer errors.</p>
<div class="inline-figure"><img src="images/ifelse%20bad.png" width="100%" style="display: block; margin: auto;"></div>
<p>Outside of the context of a dataframe, if you want to have an object used in your code switch its value based on criteria, consider using <code><a href="https://rdrr.io/r/base/switch.html">switch()</a></code> from <strong>base</strong> R. See the section on using <code><a href="https://rdrr.io/r/base/switch.html">switch()</a></code> in the page on R interactive console.</p>
</div>
</div>
<div id="re-code-with-complex-logic" class="section level3 unnumbered">
<h3>Re-code with complex logic<a class="anchor" aria-label="anchor" href="#re-code-with-complex-logic"><i class="fas fa-link"></i></a>
</h3>
<p>Use <strong>dplyr</strong>’s <code>case_when()</code> if you need to use complex logic statements to re-code values. There are important differences from <code>recode()</code> in syntax and logic order!</p>
<p><code>case_when()</code> commands have a Right-Hand Side (RHS) and a Left-Hand Side (LHS) separated by a “tilde” <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>. The logic criteria are in the LHS and the pursuant value is on the RHS. Statements are separated by commas. It is important to note that:</p>
<ul>
<li>Statements are evaluated in the order written - from top-to-bottom. Thus it is best to write the most specific criteria first, and the most general last.<br>
</li>
<li>End with <code>TRUE</code> on the LHS, which signifies any row value that did not meet any of the previous criteria<br>
</li>
<li>The values on the RHS must all be the same class - either numeric, character, logical, etc.
<ul>
<li>To assign <code>NA</code>, you may need to use special values such as <code>NA_character_</code>, <code>NA_real_</code> (for numeric or POSIX), and <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date(NA)</a></code>
</li>
</ul>
</li>
</ul>
<p>Below we utilize the columns <code>age</code> and <code>age_unit</code> to create a column <code>age_years</code>:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
            <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span>  <span class="op">~</span> <span class="va">age</span>,       <span class="co"># if age is given in years</span>
            <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,    <span class="co"># if age is given in months</span>
            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span>      <span class="op">~</span> <span class="va">age</span>,       <span class="co"># if age unit is missing, assume years</span>
            <span class="cn">TRUE</span>                 <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="co"># any other circumstance assign missing</span></code></pre></div>
</div>
<div id="re-code-with-a-cleaning-dictionary" class="section level3 unnumbered">
<h3>Re-code with a cleaning dictionary<a class="anchor" aria-label="anchor" href="#re-code-with-a-cleaning-dictionary"><i class="fas fa-link"></i></a>
</h3>
<p>Use the package <strong>linelist</strong> to clean a linelist with a <em>cleaning dictionary</em>.</p>
<ol style="list-style-type: decimal">
<li>Import a cleaning dictionary with 3 columns:
<ul>
<li>A “from” column (the incorrect value)<br>
</li>
<li>A “to” column (the correct value)<br>
</li>
<li>A column specifying the column for the changes to be applied (or “.global” to apply to all columns)</li>
</ul>
</li>
</ol>
<div class="inline-figure"><img src="images/cleaning_dict.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cleaning_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"cleaning_dict.csv"</span><span class="op">)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Store names of any columns that you want to “protect” from the changes. They must be provided to <code>clean_data()</code> as a numeric or logical vector, so you will see use of <code><a href="https://rdrr.io/r/base/names.html">names(.)</a></code> in the command below (the dot means the dataframe).</li>
</ol>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">protected_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"case_id"</span>, <span class="st">"source"</span><span class="op">)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Run <code>clean_data()</code>, specifying the cleaning dictionary</li>
</ol>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">linelist</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/linelist/man/clean_data.html">clean_data</a></span><span class="op">(</span>
    wordlists <span class="op">=</span> <span class="va">cleaning_dict</span>,
    spelling_vars <span class="op">=</span> <span class="st">"col"</span>,       <span class="co"># dict column containing column names, defaults to 3rd column in dict</span>
    protect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">protected_cols</span>
  <span class="op">)</span></code></pre></div>
<p>Scroll too see how values have changed - particularly <code>gender</code> (lowercase to uppercase), and all the symptoms columns have been transformed from yes/no to 1/0.</p>
<div id="htmlwidget-4ec3c98b6af9e1c22079" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4ec3c98b6af9e1c22079">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399161600000\" data-max=\"1406937600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1398556800000\" data-max=\"1.407024e+12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1398556800000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399420800000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2700264337236\" data-max=\"-13.2083805379189\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45020022241045\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"66\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"7\" data-max=\"98\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"13\" data-max=\"258\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"36\" data-max=\"37.9\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"14.7226729162911\" data-max=\"414.201183431953\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"66\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["6c286a","5fe599","6285c9","893f25","c4e706","275cc7","133ee7","dbebea","788a99","2978ac","57a565","a6c614","c15f36","c97dd9","02d8fd","bd14fc","af9f9a","589e9f","ae96ac","ec8ee4","b799eb","ceed40","9371a9","403057","7fd086","1c1848","959170","64c8ef","a47529","52ea64","92ab68","f81362","6670a5","4c1040","ae50c8","583717","770e5e","1e1825","b013ab","9fcf61","c5bc73","db7b54","38cc4a","cc7393","3789ee","8188cd","c8c030","a81f7d","6b70f0","316781"],[2,4,4,3,5,5,3,7,5,4,4,5,5,9,9,6,6,9,10,6,5,5,8,10,7,8,8,6,5,7,8,8,9,7,9,10,7,8,8,10,7,14,8,8,10,7,9,12,7,8],[null,"2014-05-08","2014-05-04","2014-05-18",null,"2014-05-24","2014-05-23",null,"2014-06-01","2014-05-30","2014-05-28","2014-06-05",null,null,"2014-06-14","2014-06-04",null,"2014-06-11","2014-06-20","2014-06-15","2014-06-27",null,null,null,null,"2014-07-09","2014-06-29",null,"2014-06-13","2014-07-15",null,null,"2014-07-18","2014-07-17","2014-07-20",null,null,null,"2014-07-24",null,"2014-07-27","2014-07-26","2014-07-19",null,"2014-07-26","2014-07-16",null,"2014-08-02",null,"2014-07-22"],["2014-04-27","2014-05-13","2014-05-14","2014-05-21","2014-05-23","2014-05-27","2014-05-27","2014-06-02","2014-06-06","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-19","2014-06-20","2014-06-20","2014-06-20","2014-06-24","2014-06-25","2014-06-30","2014-07-03","2014-07-07","2014-07-08","2014-07-09","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-20","2014-07-25","2014-07-27","2014-07-29","2014-07-29","2014-07-30","2014-07-30","2014-07-31","2014-07-31","2014-08-01","2014-08-01","2014-08-01","2014-08-02","2014-08-02","2014-08-03","2014-08-03","2014-08-03"],["2014-04-27","2014-05-15","2014-05-14","2014-05-22","2014-05-24","2014-05-28","2014-05-29","2014-06-03","2014-06-07","2014-06-08","2014-06-15","2014-06-18","2014-06-19","2014-06-19","2014-06-20","2014-06-22","2014-06-20","2014-06-26","2014-06-25","2014-07-02","2014-07-05","2014-07-09","2014-07-09","2014-07-11","2014-07-13","2014-07-14","2014-07-13","2014-07-15","2014-07-18","2014-07-20","2014-07-20","2014-07-21","2014-07-22","2014-07-20","2014-07-27","2014-07-28","2014-07-30","2014-07-31","2014-07-30","2014-07-31","2014-08-02","2014-08-01","2014-08-03","2014-08-03","2014-08-02","2014-08-03","2014-08-02","2014-08-04","2014-08-04","2014-08-04"],["2014-05-07",null,"2014-05-17","2014-05-29","2014-06-02","2014-06-07","2014-05-29","2014-06-05","2014-06-25","2014-06-15",null,"2014-06-26","2014-06-28","2014-07-11","2014-07-01","2014-06-27","2014-07-13","2014-06-30","2014-06-27",null,"2014-07-12","2014-07-31","2014-07-20","2014-07-22","2014-07-27","2014-07-14","2014-07-19","2014-07-25","2014-07-26","2014-07-26","2014-08-05","2014-08-07","2014-08-01",null,"2014-08-08","2014-08-06",null,"2014-08-01","2014-08-05","2014-08-05","2014-08-11",null,"2014-08-21","2014-08-09","2014-09-13","2014-08-29","2014-08-11","2014-09-05",null,"2014-08-07"],["death",null,"death","recover",null,"death","death",null,"recover","death","death","recover","recover","recover","death","death",null,null,"death","death","recover","recover",null,"death","recover","death","death","recover","death","death",null,"death","death","recover","death","death","recover","death","death","recover","death","death","recover","death",null,"recover",null,"recover","death","death"],["F","M","F","M","M","F","F","M","M","M","M","F","F","M","M","F","F","M","M","M","M","M","F","F","M","F","F","M","M","F","F","M","F","F","F","M","F","F","M","F","F","F","M","F","F","F","F","M","M","M"],[null,"other",null,"military_hospital",null,"central_hospital",null,"port_hospital","port_hospital","port_hospital","military_hospital","other",null,"port_hospital","port_hospital","port_hospital",null,null,"port_hospital",null,null,"port_hospital","st_mark_s_maternity_hospital_smmh","other","port_hospital","port_hospital","central_hospital","central_hospital","military_hospital",null,"military_hospital","other","military_hospital","other","port_hospital","other","port_hospital","port_hospital",null,"port_hospital","military_hospital","military_hospital",null,null,"st_mark_s_maternity_hospital_smmh","port_hospital",null,"port_hospital",null,"other"],[-13.2311229156957,-13.2157351064963,-13.2205862656383,-13.2228638912441,-13.2143394209926,-13.2369393782451,-13.2230208115547,-13.2164705932244,-13.2128924575825,-13.2206286746001,-13.253989309478,-13.2190654487695,-13.2189533374241,-13.2243437095992,-13.2124311244169,-13.2322364148998,-13.2371313571269,-13.2083835761865,-13.2131457458534,-13.2578516459532,-13.2162953240809,-13.2471655635541,-13.2680671272333,-13.2160179088168,-13.2353020203708,-13.2113470441303,-13.2452992638476,-13.2614705796373,-13.2227293309912,-13.2177946632397,-13.2333516655879,-13.2163318124535,-13.2217866965605,-13.2359603887432,-13.2472895700622,-13.2587625731645,-13.2351591427265,-13.2083805379189,-13.2700264337236,-13.2631399589905,-13.2224162932627,-13.2194851717021,-13.2573683214693,-13.2589430372533,-13.2137356012883,-13.2611950766249,-13.2106014146595,-13.2477515432081,-13.2486407324245,-13.2331787372694],[8.46477606739351,8.46897295100924,8.45056919644254,8.46082377490923,8.48932072596067,8.46916113869591,8.46142781816041,8.48666377289188,8.46852156267174,8.48401630165138,8.45837125340844,8.47737640975659,8.45136291368722,8.47145134147474,8.45344099552146,8.47727846519132,8.48777544809491,8.46320325007363,8.46397733703235,8.45196229052854,8.46395131808455,8.48811520075179,8.473437335922,8.46242233645879,8.46849944119707,8.47982352763317,8.48334624336805,8.45750552360835,8.48480589906514,8.45020022241045,8.46517148129756,8.4630635336683,8.4623972994508,8.47704542384682,8.48450777619227,8.45574180260702,8.46765214132969,8.45570803751877,8.47765318263688,8.4653055523942,8.46186770657403,8.45077238424485,8.4532568143863,8.45415199059547,8.4732571907655,8.46334217568605,8.47793008081529,8.48500469856184,8.48480340615605,8.46382313795279],[null,"f547d6","f9149b","11f8ea",null,"e02f66","76b97a",null,"374728","996f3a","133ee7","3ff1bc",null,null,"e61cb9","db11a9",null,"8b4c1c","02d8fd","be502d","ea3740",null,null,null,null,"3e6957","beb26e",null,"a2086d","64c8ef",null,null,"67be4e","916d0a","26c588",null,null,null,"eae3e8",null,"4af3d1","df7c34","53608c",null,"3b096b","916d0a",null,"a5bda8",null,"d05405"],[null,"other","other","other",null,"other","other",null,"other","other","other","funeral",null,null,"other","other",null,"other","other","other","other",null,null,null,null,"other","funeral",null,"other","other",null,null,"other","other","other",null,null,null,"other",null,"other","other","funeral",null,"other","other",null,"funeral",null,"other"],[14,12,4,66,18,7,10,7,2,7,11,19,15,19,3,14,32,6,6,11,30,7,1,4,19,0,4,8,41,9,3,19,16,16,5,43,16,16,33,33,26,17,6,2,35,5,22,25,46,24],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[71,60,29,98,66,43,50,40,35,42,46,62,50,64,43,57,81,35,44,60,74,52,20,48,57,7,40,57,93,32,31,59,59,52,33,71,51,55,67,72,67,64,30,20,63,45,60,62,74,63],[121,146,78,258,124,114,100,89,55,97,140,143,128,184,66,163,165,112,96,117,178,126,33,54,119,13,57,124,180,96,51,118,130,143,94,206,132,162,193,190,161,147,70,39,187,77,159,190,223,164],[22,22,23,22,22,23,22,21,21,24,23,21,22,22,23,23,22,23,23,21,22,22,21,23,22,23,22,21,24,22,24,22,22,22,22,23,22,21,22,24,22,21,21,21,24,20,20,21,24,23],["0","0","0","0","0","0","0","0",null,"0",null,"0","0",null,"0","0","0","0","0","0","0","0","0","0","0","0",null,"0",null,"0","0","0","0","0",null,"0","0","0","0","0","0","0",null,null,"0",null,"0",null,"0","0"],["0","1","0","0","0","0","1","0",null,"0",null,"0","0",null,"0","0","0","0","0","0","0","0","0","0","0","0",null,"0",null,"1","1","0","0","0",null,"0","1","0","0","0","1","0",null,null,"0",null,"0",null,"0","0"],["1","0","1","1","1","1","0","1",null,"1",null,"1","1",null,"0","0","1","0","1","1","1","1","1","1","1","1",null,"1",null,"1","1","1","1","0",null,"0","1","1","1","1","1","1",null,null,"1",null,"1",null,"1","1"],["0","0","0","0","0","0","0","0",null,"1",null,"0","0",null,"0","0","0","0","0","0","0","0","0","0","0","0",null,"1",null,"0","0","0","0","0",null,"0","0","0","0","0","0","0",null,null,"0",null,"0",null,"0","0"],["0","1","1","1","0","0","0","1",null,"0",null,"0","0",null,"1","0","0","1","1","1","1","1","1","1","0","0",null,"0",null,"0","0","1","0","0",null,"0","1","0","1","1","1","0",null,null,"1",null,"0",null,"0","0"],[36.5,37.7,36.3,37.1,37.4,36.9,36.9,37.1,36.6,36,37.1,36.4,37,37.3,37.2,36.7,36.9,37.6,36.2,36.3,36.6,37.9,36.5,36.7,37.4,37.1,36.9,36.6,37.4,37.2,36.7,36.6,36.5,37,37.2,36.2,37.4,37.3,37.6,36.9,36.4,37.3,37.2,37.3,36.4,37.1,37.2,36.3,37,37.1],["12_38","05_39",null,"08_32","10_32","10_57","11_11","16_40","12_53","17_18","07_34",null,"10_30","08_45","12_12","11_23","11_31",null,"15_34",null,"18_07",null,"10_12","13_19","11_26",null,"16_60","09_35","14_47",null,"15_40","16_07","12_28","22_18","15_39","16_47","17_42","05_18","14_32","12_02","05_25","15_36","16_01","16_23","13_35","13_33","18_36","13_36","12_47","11_32"],[48.49395533092,28.1478701444924,47.6660092044707,14.7226729162911,42.9240374609781,33.0871037242228,50,50.4986744097967,115.702479338843,44.6381124455309,23.469387755102,30.3193310186317,30.517578125,18.9035916824197,98.7144168962351,21.4535737137265,29.7520661157025,27.9017857142857,47.7430555555556,43.8308130615823,23.355636914531,32.7538422776518,183.654729109275,164.609053497942,40.2513946755173,414.201183431953,123.114804555248,37.0707596253902,28.7037037037037,34.7222222222222,119.18492887351,42.3728813559322,34.9112426035503,25.4291163382073,37.3472159348121,16.7310773871241,29.2699724517906,20.9571711629325,17.9870600553035,19.9445983379501,25.8477682188187,29.6172890925078,61.2244897959184,131.492439184747,18.0159569904773,75.8981278461798,23.7332384003797,17.1745152354571,14.8806531400189,23.4235574063058],[14,12,4,66,18,7,10,7,2,7,11,19,15,19,3,14,32,6,6,11,30,7,1,4,19,0,4,8,41,9,3,19,16,16,5,43,16,16,33,33,26,17,6,2,35,5,22,25,46,24]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>age_years<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,13,15,16,17,23,25,26]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: orange;"><strong><em>CAUTION:</em></strong> <code>clean_data()</code> from <strong>linelist</strong> package will also clean values in your data unless those columns are protected - you may encounter changes to columns with dashes “-” or .</span></p>
<p>Note that your column names in the cleaning dictionary must correspond to the names at this point in your cleaning script. <code>clean_data()</code> itself also implements a column name cleaning function similar to <code>clean_names()</code> from <strong>janitor</strong> that standardizes column names prior to applying the dictionary.</p>
<p>See this <a href="https://www.repidemicsconsortium.org/linelist/reference/clean_data.html">online reference for the linelist package</a> for more details.</p>
</div>
</div>
<div id="other-transformations" class="section level2" number="1.10">
<h2>
<span class="header-section-number">1.10</span> Other transformations<a class="anchor" aria-label="anchor" href="#other-transformations"><i class="fas fa-link"></i></a>
</h2>
<div id="coalesce" class="section level3 unnumbered">
<h3>
<code>coalesce()</code><a class="anchor" aria-label="anchor" href="#coalesce"><i class="fas fa-link"></i></a>
</h3>
<p>This <strong>dplyr</strong> function finds the first non-missing value at each position.</p>
<p>Say you have two vectors, one for village of detection and another for village of residence. You can use coalesce to pick the first non-missing value for each index:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">village_detection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="cn">NA</span>,  <span class="cn">NA</span><span class="op">)</span>
<span class="va">village_residence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span>

<span class="fu">coalesce</span><span class="op">(</span><span class="va">village_detection</span>, <span class="va">village_residence</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a" "b" "a" "d"</code></pre>
<p>If you provide dataframe columns, for each row it will fill the value with the first non-missing value in the columns you provided.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>village <span class="op">=</span> <span class="fu">coalesce</span><span class="op">(</span><span class="va">village_detection</span>, <span class="va">village_residence</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="cumulative-mathematics" class="section level3 unnumbered">
<h3>Cumulative mathematics<a class="anchor" aria-label="anchor" href="#cumulative-mathematics"><i class="fas fa-link"></i></a>
</h3>
<p>If you a column to reflect the cumulative sum/mean/min/max etc as assessed down the rows of a dataframe, use the following functions:</p>
<p><code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> returns the cumulative sum, as shown below:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>     <span class="co"># returns only one number</span></code></pre></div>
<pre><code>## [1] 31</code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>  <span class="co"># returns the cumulative sum at each step</span></code></pre></div>
<pre><code>## [1]  2  6 21 31</code></pre>
<p>This can be used in a dataframe when making a new column. For example, to calculate the cumulative number of cases per day in an outbreak, consider code like this:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>           <span class="co"># count of rows per day   </span>
  <span class="fu">mutate</span><span class="op">(</span>                         
    cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>  <span class="co"># new column of the cumulative sum at that row</span>
    <span class="op">)</span>

<span class="va">cumulative_case_counts</span></code></pre></div>
<pre><code>##     date_onset  n cumulative_cases
## 1   2012-04-21  1                1
## 2   2012-05-07  1                2
## 3   2012-05-20  1                3
## 4   2012-05-21  1                4
## 5   2012-05-25  1                5
## 6   2012-06-05  1                6
## 7   2012-06-06  1                7
## 8   2012-06-07  2                9
## 9   2012-06-12  1               10
## 10  2012-07-03  1               11
## 11  2012-07-08  1               12
## 12  2012-07-09  1               13
## 13  2012-07-15  2               15
## 14  2012-07-16  1               16
## 15  2012-07-18  1               17
## 16  2012-07-20  1               18
## 17  2012-07-22  1               19
## 18  2012-07-24  1               20
## 19  2012-07-26  2               22
## 20  2012-07-29  2               24
## 21  2012-07-31  1               25
## 22  2012-08-02  1               26
## 23  2012-08-05  1               27
## 24  2012-08-07  1               28
## 25  2012-08-08  1               29
## 26  2012-08-12  1               30
## 27  2012-08-13  2               32
## 28  2012-08-14  1               33
## 29  2012-08-16  4               37
## 30  2012-08-17  1               38
## 31  2012-08-18  1               39
## 32  2012-08-19  2               41
## 33  2012-08-23  1               42
## 34  2012-08-24  3               45
## 35  2012-08-25  2               47
## 36  2012-08-28  1               48
## 37  2012-08-29  1               49
## 38  2012-08-30  2               51
## 39  2012-09-01  2               53
## 40  2012-09-02  1               54
## 41  2012-09-03  2               56
## 42  2012-09-05  2               58
## 43  2012-09-06  1               59
## 44  2012-09-07  2               61
## 45  2012-09-08  2               63
## 46  2012-09-09  3               66
## 47  2012-09-11  6               72
## 48  2012-09-12  2               74
## 49  2012-09-13  4               78
## 50  2012-09-14  1               79
## 51  2012-09-15  2               81
## 52  2012-09-16  2               83
## 53  2012-09-17  1               84
## 54  2012-09-18  2               86
## 55  2012-09-19  2               88
## 56  2012-09-21  2               90
## 57  2012-09-23  6               96
## 58  2012-09-24  7              103
## 59  2012-09-25  3              106
## 60  2012-09-26  1              107
## 61  2012-09-27  3              110
## 62  2012-09-28  4              114
## 63  2012-09-29  7              121
## 64  2012-09-30  6              127
## 65  2012-10-01  3              130
## 66  2012-10-02  9              139
## 67  2012-10-03  2              141
## 68  2012-10-04  5              146
## 69  2012-10-05  5              151
## 70  2012-10-06  5              156
## 71  2012-10-07  1              157
## 72  2012-10-08  6              163
## 73  2012-10-09  5              168
## 74  2012-10-10  2              170
## 75  2012-10-11  3              173
## 76  2012-10-12  3              176
## 77  2012-10-13  6              182
## 78  2012-10-14  5              187
## 79  2012-10-15  4              191
## 80  2012-10-16 10              201
## 81  2012-10-17  5              206
## 82  2012-10-18  5              211
## 83  2012-10-19  6              217
## 84  2012-10-20  4              221
## 85  2012-10-21  8              229
## 86  2012-10-22  3              232
## 87  2012-10-23  7              239
## 88  2012-10-24 10              249
## 89  2012-10-25  4              253
## 90  2012-10-26 10              263
## 91  2012-10-27 13              276
## 92  2012-10-28  6              282
## 93  2012-10-29  4              286
## 94  2012-10-30  3              289
## 95  2012-10-31  7              296
## 96  2012-11-01  5              301
## 97  2012-11-02  7              308
## 98  2012-11-03  9              317
## 99  2012-11-04  6              323
## 100 2012-11-05  1              324
## 101 2012-11-06  1              325
## 102 2012-11-07  3              328
## 103 2012-11-08  8              336
## 104 2012-11-09  3              339
## 105 2012-11-10  8              347
## 106 2012-11-11  5              352
## 107 2012-11-12  2              354
## 108 2012-11-13  6              360
## 109 2012-11-14  1              361
## 110 2012-11-15  4              365
## 111 2012-11-16  3              368
## 112 2012-11-17  3              371
## 113 2012-11-18  4              375
## 114 2012-11-19  1              376
## 115 2012-11-20  4              380
## 116 2012-11-21  6              386
## 117 2012-11-22  2              388
## 118 2012-11-23  6              394
## 119 2012-11-24  4              398
## 120 2012-11-25  5              403
## 121 2012-11-26  1              404
## 122 2012-11-27  3              407
## 123 2012-11-28  5              412
## 124 2012-11-29  6              418
## 125 2012-11-30  3              421
## 126 2012-12-01  4              425
## 127 2012-12-02  3              428
## 128 2012-12-04  6              434
## 129 2012-12-05  3              437
## 130 2012-12-06  5              442
## 131 2012-12-07  3              445
## 132 2012-12-08  1              446
## 133 2012-12-09  3              449
## 134 2012-12-10  6              455
## 135 2012-12-11  2              457
## 136 2012-12-12  1              458
## 137 2012-12-13  4              462
## 138 2012-12-14  7              469
## 139 2012-12-15  2              471
## 140 2012-12-16  4              475
## 141 2012-12-17  2              477
## 142 2012-12-18  1              478
## 143 2012-12-19  3              481
## 144 2012-12-20  3              484
## 145 2012-12-21  3              487
## 146 2012-12-22  3              490
## 147 2012-12-24  2              492
## 148 2012-12-25  3              495
## 149 2012-12-26  2              497
## 150 2012-12-27  1              498
## 151 2012-12-28  1              499
## 152 2012-12-29  3              502
## 153 2012-12-30  1              503
## 154 2012-12-31  1              504
## 155 2013-01-01  3              507
## 156 2013-01-03  2              509
## 157 2013-01-05  4              513
## 158 2013-01-06  2              515
## 159 2013-01-07  1              516
## 160 2013-01-08  1              517
## 161 2013-01-11  4              521
## 162 2013-01-12  4              525
## 163 2013-01-14  1              526
## 164 2013-01-15  1              527
## 165 2013-01-16  2              529
## 166 2013-01-17  1              530
## 167 2013-01-19  3              533
## 168 2013-01-20  1              534
## 169 2013-01-21  1              535
## 170 2013-01-23  1              536
## 171 2013-01-25  2              538
## 172 2013-01-26  1              539
## 173 2013-01-28  1              540
## 174 2013-01-29  2              542
## 175 2013-02-01  2              544
## 176 2013-02-02  2              546
## 177 2013-02-04  1              547
## 178 2013-02-05  1              548
## 179 2013-02-06  1              549
## 180 2013-02-09  1              550
## 181 2013-02-10  2              552
## 182 2013-02-15  1              553
## 183 2013-02-19  1              554
## 184 2013-02-20  1              555
## 185 2013-02-21  2              557
## 186 2013-02-22  1              558
## 187 2013-02-24  1              559
## 188 2013-03-03  3              562
## 189 2013-03-05  2              564
## 190 2013-03-08  1              565
## 191 2013-03-09  1              566
## 192 2013-03-11  1              567
## 193 2013-03-12  1              568
## 194 2013-03-13  1              569
## 195 2013-03-18  1              570
## 196 2013-03-19  2              572
## 197 2013-03-20  1              573
## 198 2013-03-22  1              574
## 199 2013-03-23  1              575
## 200 2013-03-27  1              576
## 201 2013-03-29  1              577
## 202 2013-04-01  2              579
## 203 2013-04-05  1              580
## 204 2013-04-13  1              581
## 205 2013-04-14  1              582
## 206 2013-04-16  1              583
## 207 2013-04-24  1              584
## 208 2013-04-27  2              586
## 209 2014-04-07  1              587
## 210 2014-04-15  1              588
## 211 2014-04-21  2              590
## 212 2014-04-25  1              591
## 213 2014-04-26  1              592
## 214 2014-04-27  1              593
## 215 2014-05-01  2              595
## 216 2014-05-03  1              596
## 217 2014-05-04  1              597
## 218 2014-05-05  1              598
## 219 2014-05-06  3              601
## 220 2014-05-07  2              603
## 221 2014-05-08  2              605
## 222 2014-05-09  2              607
## 223 2014-05-10  1              608
## 224 2014-05-11  1              609
## 225 2014-05-12  3              612
## 226 2014-05-13  3              615
## 227 2014-05-14  3              618
## 228 2014-05-16  2              620
## 229 2014-05-17  3              623
## 230 2014-05-18  4              627
## 231 2014-05-19  3              630
## 232 2014-05-20  1              631
## 233 2014-05-21  3              634
## 234 2014-05-22  1              635
## 235 2014-05-23  2              637
## 236 2014-05-24  2              639
## 237 2014-05-25  3              642
## 238 2014-05-26  4              646
## 239 2014-05-27 11              657
## 240 2014-05-28  1              658
## 241 2014-05-29  1              659
## 242 2014-05-30  1              660
## 243 2014-05-31  2              662
## 244 2014-06-02  5              667
## 245 2014-06-03  3              670
## 246 2014-06-05  4              674
## 247 2014-06-06  5              679
## 248 2014-06-07  5              684
## 249 2014-06-08  1              685
## 250 2014-06-09  5              690
## 251 2014-06-10  5              695
## 252 2014-06-11  3              698
## 253 2014-06-12  1              699
## 254 2014-06-13  1              700
## 255 2014-06-14  2              702
## 256 2014-06-15  5              707
## 257 2014-06-16  6              713
## 258 2014-06-17  4              717
## 259 2014-06-18  2              719
## 260 2014-06-19  3              722
## 261 2014-06-20  7              729
## 262 2014-06-21  3              732
## 263 2014-06-22  5              737
## 264 2014-06-23  2              739
## 265 2014-06-24  6              745
## 266 2014-06-25  5              750
## 267 2014-06-26  3              753
## 268 2014-06-27  2              755
## 269 2014-06-28  2              757
## 270 2014-06-29  2              759
## 271 2014-06-30  6              765
## 272 2014-07-01  4              769
## 273 2014-07-02  4              773
## 274 2014-07-03  5              778
## 275 2014-07-04  7              785
## 276 2014-07-05  5              790
## 277 2014-07-06  3              793
## 278 2014-07-07  3              796
## 279 2014-07-08  7              803
## 280 2014-07-09  8              811
## 281 2014-07-10  5              816
## 282 2014-07-11  4              820
## 283 2014-07-12  6              826
## 284 2014-07-13  6              832
## 285 2014-07-14 11              843
## 286 2014-07-15 10              853
## 287 2014-07-16  6              859
## 288 2014-07-17  6              865
## 289 2014-07-18 10              875
## 290 2014-07-19  7              882
## 291 2014-07-20 12              894
## 292 2014-07-21  4              898
## 293 2014-07-22  6              904
## 294 2014-07-23 11              915
## 295 2014-07-24  9              924
## 296 2014-07-25 10              934
## 297 2014-07-26  7              941
## 298 2014-07-27 12              953
## 299 2014-07-28  6              959
## 300 2014-07-29 15              974
## 301 2014-07-30 14              988
## 302 2014-07-31  8              996
## 303 2014-08-01 10             1006
## 304 2014-08-02 16             1022
## 305 2014-08-03 13             1035
## 306 2014-08-04 18             1053
## 307 2014-08-05 18             1071
## 308 2014-08-06  9             1080
## 309 2014-08-07  9             1089
## 310 2014-08-08  9             1098
## 311 2014-08-09 10             1108
## 312 2014-08-10 14             1122
## 313 2014-08-11 17             1139
## 314 2014-08-12  7             1146
## 315 2014-08-13 17             1163
## 316 2014-08-14 13             1176
## 317 2014-08-15 19             1195
## 318 2014-08-16 31             1226
## 319 2014-08-17 13             1239
## 320 2014-08-18 14             1253
## 321 2014-08-19 15             1268
## 322 2014-08-20 20             1288
## 323 2014-08-21 20             1308
## 324 2014-08-22 29             1337
## 325 2014-08-23 19             1356
## 326 2014-08-24 27             1383
## 327 2014-08-25 23             1406
## 328 2014-08-26 19             1425
## 329 2014-08-27 25             1450
## 330 2014-08-28 23             1473
## 331 2014-08-29 26             1499
## 332 2014-08-30 25             1524
## 333 2014-08-31 22             1546
##  [ reached 'max' / getOption("max.print") -- omitted 243 rows ]</code></pre>
<p>See the page on [Epidemic curves] for how to plot cumulative incidence with the epicurve.</p>
<p>See also:<br>
cumsum(), cummean(), cummin(), cummax(), cumany(), cumall()</p>
</div>
<div id="add-to-pipe-chain-1" class="section level3 unnumbered">
<h3>Add to pipe chain<a class="anchor" aria-label="anchor" href="#add-to-pipe-chain-1"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Below, some new columns and column transformations are added to the pipe chain.</strong></p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################</span>
    
    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="num_cats" class="section level2" number="1.11">
<h2>
<span class="header-section-number">1.11</span> Numeric categories<a class="anchor" aria-label="anchor" href="#num_cats"><i class="fas fa-link"></i></a>
</h2>
<p>Here we describe some special approaches for creating numeric categories. Common examples include age categories, groups of lab values, etc. Here we will discuss:</p>
<ul>
<li>
<code>age_categories()</code>, from the <strong>epikit</strong> package<br>
</li>
<li>
<code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, from <strong>base</strong> R<br>
</li>
<li>
<code>case_when()</code><br>
</li>
<li>quantile breaks</li>
</ul>
<div id="review-distribution" class="section level3 unnumbered">
<h3>Review distribution<a class="anchor" aria-label="anchor" href="#review-distribution"><i class="fas fa-link"></i></a>
</h3>
<p>For this example we will create an <code>age_cat</code> column using the <code>age_years</code> column.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#check the class of the linelist variable age</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "numeric"</code></pre>
<p>First, examine the distribution of your data, to make appropriate cut-points. See the page on how to [Plot continuous data].</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># examine the distribution</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-281-1.png" width="672" height="50%"></div>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>##           Min.        1st Qu.         Median           Mean        3rd Qu.           Max.           NA's 
##  0.00000000000  6.00000000000 13.00000000000 16.31495424837 24.00000000000 95.00000000000            104</code></pre>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Sometimes, numeric variables will import as class “character”. This occurs if there are non-numeric characters in some of the values, for example an entry of “2 months” for age, or (depending on your R locale settings) if a comma is used in the decimals place (e.g. “4,5” to mean four and one half years)..</span></p>
<!-- ======================================================= -->
</div>
<div id="age_categories" class="section level3 unnumbered">
<h3>
<code>age_categories()</code><a class="anchor" aria-label="anchor" href="#age_categories"><i class="fas fa-link"></i></a>
</h3>
<p>With the <strong>epikit</strong> package, you can use the <code>age_categories()</code> function to easily categorize and label numeric columns (note: this function can be applied to non-age numeric variables too). Of note: <em>the output is an ordered factor.</em></p>
<p>Here are the required inputs:</p>
<ul>
<li>A numeric vector (column)<br>
</li>
<li>The <code>breakers =</code> - a numeric vector of break points for the new groups</li>
</ul>
<p>First, the most simple example:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Simple example</span>
<span class="co">################</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">epikit</span><span class="op">)</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>
      <span class="va">age_years</span>,
      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-69   70+  &lt;NA&gt; 
##  1159  1225  1045   839  1117   581   263   107    27    12   104</code></pre>
<p>The break values you specify are by default included in the “higher” group - groups are “open” on the lower/left side. As shown below, you can add 1 to each break value to achieve groups that are open at the top/right.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Include upper ends for the same categories</span>
<span class="co">############################################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>
      <span class="va">age_years</span>, 
      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">11</span>, <span class="fl">16</span>, <span class="fl">21</span>, <span class="fl">31</span>, <span class="fl">41</span>, <span class="fl">51</span>, <span class="fl">61</span>, <span class="fl">71</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-5  6-10 11-15 16-20 21-30 31-40 41-50 51-60 61-70   71+  &lt;NA&gt; 
##  1412  1214   999   776  1053   553   245    88    24    11   104</code></pre>
<p>You can adjust how the labels are displayed with <code>separator =</code>. The default is “-”</p>
<p>You can adjust the upper cut-off of values allowed to be included in a group. Use <code>ceiling =</code>, the default is FALSE. If TRUE, the highest break value is a “ceiling” and a category “XX+” is not included. Any values above highest break value or <code>upper</code> (if defined) are categorized as <code>NA</code>. Below is an example with <code>ceiling = TRUE</code>, so that there is no category of XX+ and values above 70 (the highest break value) are assigned as NA.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With ceiling set to TRUE</span>
<span class="co">##########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>
      <span class="va">age_years</span>, 
      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span>,
      ceiling <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 70 is ceiling, all above become NA</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-70  &lt;NA&gt; 
##  1159  1225  1045   839  1117   581   263   107    28   115</code></pre>
<p>Alternatively, instead of <code>breakers =</code>, you can provide all of <code>lower =</code>, <code>upper =</code>, and <code>by =</code>:</p>
<ul>
<li>
<code>lower =</code> The lowest number you want considered - default is 0<br>
</li>
<li>
<code>upper =</code> The highest number you want considered<br>
</li>
<li>
<code>by =</code> The number of years between groups</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>
      <span class="va">age_years</span>, 
      lower <span class="op">=</span> <span class="fl">0</span>,
      upper <span class="op">=</span> <span class="fl">100</span>,
      by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-9 10-19 20-29 30-39 40-49 50-59 60-69 70-79 80-89 90-99  100+  &lt;NA&gt; 
##  2384  1884  1117   581   263   107    27     9     0     3     0   104</code></pre>
<p>See the function’s Help page for more details (enter <code>?age_categories</code> in the R console).</p>
<!-- ======================================================= -->
</div>
<div id="cut" class="section level3" number="1.11.1">
<h3>
<span class="header-section-number">1.11.1</span> <code>cut()</code><a class="anchor" aria-label="anchor" href="#cut"><i class="fas fa-link"></i></a>
</h3>
<p>You can also use the <strong>base</strong> R function <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, which creates categories from a numeric column. The differences from <code>age_categories()</code> are:</p>
<ul>
<li>You do not need to install/load another package<br>
</li>
<li>You can specify whether groups are open/closed on the right/left<br>
</li>
<li>You must provide accurate labels yourself<br>
</li>
<li>If you want 0 included in the lowest group you must specify this</li>
</ul>
<p>The basic syntax within <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> is to first provide the numeric variable to be cut (age_years), and then the <em>breaks</em> argument, which is a numeric vector (<code><a href="https://rdrr.io/r/base/c.html">c()</a></code>) of break points. Using <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, the resulting column is an ordered factor. If used within <code>mutate()</code> (a <strong>dplyr</strong> verb) it is not necessary to specify the dataframe before the column name (e.g. <code>linelist$age_years</code>).</p>
<p>Create new column of age categories (<code>age_cat</code>) by cutting the numeric <code>age_year</code> column at specified break points.</p>
<ul>
<li>Specify numeric vector of break points<br>
</li>
<li>Default behavior for <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> is that lower break values are <em>excluded</em> from each category, and upper break values are <em>included</em>. This is the opposite behavior from the <code>age_categories()</code> function.<br>
</li>
<li>Include 0 in the lowest category by adding <code>include.lowest = TRUE</code><br>
</li>
<li>Add a vector of customized labels using the <code>labels =</code> argument<br>
</li>
<li>Check your work with cross-tabulation of the numeric and category columns - be aware of missing values</li>
</ul>
<p>Below is a detailed description of the behavior of using <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> to make the <code>age_cat</code> column. Key points:</p>
<ul>
<li>Inclusion/exclusion behavior of break points<br>
</li>
<li>Custom category labels<br>
</li>
<li>Handling missing values<br>
</li>
<li><strong>Check your work!</strong></li>
</ul>
<p>A simple example of <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> applied to <code>age_years</code> to make the new variable <code>age_cat</code> is below:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create new variable, by cutting the numeric age variable</span>
<span class="co"># by default, upper break is excluded and lower break excluded from each category</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>
      <span class="va">age_years</span>,
      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,
                 <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,
      include.lowest <span class="op">=</span> <span class="cn">TRUE</span>         <span class="co"># include 0 in lowest group</span>
      <span class="op">)</span><span class="op">)</span>

<span class="co"># tabulate the number of observations per group</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##    [0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50]  (50,70] (70,100]     &lt;NA&gt; 
##     1412     1214      999      776     1053      798      112       11      104</code></pre>
<ul>
<li><p><strong>By default</strong>, the categorization occurs so that the right/upper side is “open” and inclusive (and the left/lower side is “closed” or exclusive). The default labels use the notation “(A, B]”, which means the group does not include A (the lower break value), but includes B (the upper break value). <strong>Reverse this behavior by providing the <code>right = TRUE</code> argument</strong>.</p></li>
<li><p>Thus, <strong>by default</strong> “0” values are excluded from the lowest group, and categorized as <code>NA</code>. “0” values could be infants coded as age 0. To change this <strong>add the argument <code>include.lowest = TRUE</code></strong>. Then, any “0” values are included in the lowest group. The automatically-generated label for the lowest category will change from “(0,B]” to “[0,B]”, which signifies that 0 values are included.</p></li>
<li><p><strong>Check your work!!!</strong> Verify that each age value was assigned to the correct category by cross-tabulating the numeric and category columns. Examine assignment of boundary values (e.g. 15, if neighboring categories are 10-15 and 15-20).</p></li>
</ul>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Cross tabulation of the numeric and category columns. </span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="st">"Numeric Values"</span> <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>,   <span class="co"># names specified in table for clarity.</span>
      <span class="st">"Categories"</span>     <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>,
      useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                        <span class="co"># don't forget to examine NA values</span></code></pre></div>
<pre><code>##                    Categories
## Numeric Values      [0,5] (5,10] (10,15] (15,20] (20,30] (30,50] (50,70] (70,100] &lt;NA&gt;
##   0                   127      0       0       0       0       0       0        0    0
##   0.166666666666667     1      0       0       0       0       0       0        0    0
##   0.333333333333333     2      0       0       0       0       0       0        0    0
##   0.5                   2      0       0       0       0       0       0        0    0
##   0.666666666666667     8      0       0       0       0       0       0        0    0
##   0.75                  6      0       0       0       0       0       0        0    0
##   0.833333333333333     4      0       0       0       0       0       0        0    0
##   0.916666666666667     2      0       0       0       0       0       0        0    0
##   1                   264      0       0       0       0       0       0        0    0
##   1.5                   2      0       0       0       0       0       0        0    0
##   2                   247      0       0       0       0       0       0        0    0
##   3                   248      0       0       0       0       0       0        0    0
##   4                   246      0       0       0       0       0       0        0    0
##   5                   253      0       0       0       0       0       0        0    0
##   6                     0    274       0       0       0       0       0        0    0
##   7                     0    220       0       0       0       0       0        0    0
##   8                     0    240       0       0       0       0       0        0    0
##   9                     0    238       0       0       0       0       0        0    0
##   10                    0    242       0       0       0       0       0        0    0
##   11                    0      0     229       0       0       0       0        0    0
##   12                    0      0     233       0       0       0       0        0    0
##   13                    0      0     181       0       0       0       0        0    0
##   14                    0      0     160       0       0       0       0        0    0
##   15                    0      0     196       0       0       0       0        0    0
##   16                    0      0       0     186       0       0       0        0    0
##   17                    0      0       0     150       0       0       0        0    0
##   18                    0      0       0     157       0       0       0        0    0
##   19                    0      0       0     150       0       0       0        0    0
##   20                    0      0       0     133       0       0       0        0    0
##   21                    0      0       0       0     134       0       0        0    0
##   22                    0      0       0       0     126       0       0        0    0
##   23                    0      0       0       0     118       0       0        0    0
##   24                    0      0       0       0     118       0       0        0    0
##   25                    0      0       0       0     119       0       0        0    0
##   26                    0      0       0       0      93       0       0        0    0
##   27                    0      0       0       0      88       0       0        0    0
##   28                    0      0       0       0      96       0       0        0    0
##   29                    0      0       0       0      92       0       0        0    0
##   30                    0      0       0       0      69       0       0        0    0
##   31                    0      0       0       0       0      66       0        0    0
##   32                    0      0       0       0       0      67       0        0    0
##   33                    0      0       0       0       0      84       0        0    0
##   34                    0      0       0       0       0      59       0        0    0
##   35                    0      0       0       0       0      59       0        0    0
##   36                    0      0       0       0       0      43       0        0    0
##   37                    0      0       0       0       0      38       0        0    0
##   38                    0      0       0       0       0      53       0        0    0
##   39                    0      0       0       0       0      43       0        0    0
##   40                    0      0       0       0       0      41       0        0    0
##   41                    0      0       0       0       0      42       0        0    0
##   42                    0      0       0       0       0      31       0        0    0
##   43                    0      0       0       0       0      20       0        0    0
##   44                    0      0       0       0       0      32       0        0    0
##   45                    0      0       0       0       0      19       0        0    0
##   46                    0      0       0       0       0      19       0        0    0
##   47                    0      0       0       0       0      18       0        0    0
##   48                    0      0       0       0       0      25       0        0    0
##   49                    0      0       0       0       0      16       0        0    0
##   50                    0      0       0       0       0      23       0        0    0
##   51                    0      0       0       0       0       0      18        0    0
##   52                    0      0       0       0       0       0      13        0    0
##   53                    0      0       0       0       0       0      11        0    0
##   54                    0      0       0       0       0       0       5        0    0
##   55                    0      0       0       0       0       0      10        0    0
##   56                    0      0       0       0       0       0       7        0    0
##   57                    0      0       0       0       0       0       6        0    0
##   58                    0      0       0       0       0       0       8        0    0
##   59                    0      0       0       0       0       0       6        0    0
##   60                    0      0       0       0       0       0       4        0    0
##   61                    0      0       0       0       0       0       3        0    0
##   62                    0      0       0       0       0       0       1        0    0
##   63                    0      0       0       0       0       0       6        0    0
##   65                    0      0       0       0       0       0       4        0    0
##   66                    0      0       0       0       0       0       3        0    0
##   67                    0      0       0       0       0       0       3        0    0
##   69                    0      0       0       0       0       0       3        0    0
##   70                    0      0       0       0       0       0       1        0    0
##   71                    0      0       0       0       0       0       0        3    0
##   72                    0      0       0       0       0       0       0        2    0
##   76                    0      0       0       0       0       0       0        1    0
##   77                    0      0       0       0       0       0       0        2    0
##   91                    0      0       0       0       0       0       0        1    0
##   94                    0      0       0       0       0       0       0        1    0
##   95                    0      0       0       0       0       0       0        1    0
##   &lt;NA&gt;                  0      0       0       0       0       0       0        0  104</code></pre>
<p><strong>Reverse break inclusion behavior in <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code></strong></p>
<p>Lower break values will be included in each category (and upper break values excluded) if the argument <code>right =</code> is included and and set to <code>TRUE</code>. This is applied below - note how the values have shifted among the categories.</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> If you include the <code>include.lowest = TRUE</code> argument <strong>and</strong> <code>right = TRUE</code>, the extreme inclusion will now apply to the <em>highest</em> break point value and category, not the lowest.</span></p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>
      <span class="va">age_years</span>,
      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,
                 <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,  <span class="co"># same breaks as above</span>
      right <span class="op">=</span> <span class="cn">FALSE</span>,                <span class="co"># include each *lower* break point</span>
      include.lowest <span class="op">=</span> <span class="cn">TRUE</span>         <span class="co"># include *highest* value *highest* group</span>
      <span class="op">)</span><span class="op">)</span>                                                 

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##    [0,5)   [5,10)  [10,15)  [15,20)  [20,30)  [30,50)  [50,70) [70,100]     &lt;NA&gt; 
##     1159     1225     1045      839     1117      844      134       12      104</code></pre>
<p><strong>Add labels</strong></p>
<p>As these are manually written, be very careful to ensure they are accurate! Check your work using cross-tabulation, as described below. Below is the same code as above, with manual labels added.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>
      <span class="va">age_years</span>,
      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,
                 <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,  <span class="co"># same breaks as above</span>
      right <span class="op">=</span> <span class="cn">FALSE</span>,                <span class="co"># include each *lower* break point</span>
      include.lowest <span class="op">=</span> <span class="cn">TRUE</span>,        <span class="co"># include *highest* value *highest* group</span>
      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>,
                 <span class="st">"15-19"</span>, <span class="st">"20-29"</span>, <span class="st">"30-49"</span>,
                 <span class="st">"50-69"</span>, <span class="st">"70-100"</span><span class="op">)</span>
      <span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##    0-4    5-9  10-14  15-19  20-29  30-49  50-69 70-100   &lt;NA&gt; 
##   1159   1225   1045    839   1117    844    134     12    104</code></pre>
<p><strong>Re-labeling <code>NA</code> values with <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code></strong></p>
<p>Because <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> does not automatically label <code>NA</code> values, you may want to assign a label such as “Missing”. This requires a few extra steps because <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> automatically classified the new column <code>age_cat</code> as class Factor (a rigid class limited to the defined values).</p>
<p>First, convert <code>age_cut</code> from Factor to Character class, so you have flexibility to add new character values (e.g. “Missing”). Otherwise you will encounter an error. Then, use the <strong>dplyr</strong> verb <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code> to replace <code>NA</code> values with a character value like “Missing”. These steps can be combined into one step, as shown below.</p>
<p>Note that Missing has been added, <strong>but the order of the categories is now wrong (alphabetical considering numbers as characters).</strong></p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># cut() creates age_cat, automatically of class Factor      </span>
  <span class="fu">mutate</span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">age_years</span>,
                          breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,          
                          right <span class="op">=</span> <span class="cn">FALSE</span>,
                          include.lowest <span class="op">=</span> <span class="cn">TRUE</span>,        
                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>,
                                     <span class="st">"20-29"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70-100"</span><span class="op">)</span><span class="op">)</span>,
         
         <span class="co"># convert to class Character, and replace NA with "Missing"</span>
         age_cat <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     0-4   10-14   15-19   20-29   30-49     5-9   50-69  70-100 Missing    &lt;NA&gt; 
##    1159    1045     839    1117     844    1225     134      12     104       0</code></pre>
<p>To fix this, re-convert <code>age_cat</code> to a factor, and define the order of the levels correctly.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># cut() creates age_cat, automatically of class Factor      </span>
  <span class="fu">mutate</span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">age_years</span>,
                          breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,          
                          right <span class="op">=</span> <span class="cn">FALSE</span>,
                          include.lowest <span class="op">=</span> <span class="cn">TRUE</span>,        
                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>,
                                     <span class="st">"20-29"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70-100"</span><span class="op">)</span><span class="op">)</span>,
         
         <span class="co"># convert to class Character, and replace NA with "Missing"</span>
         age_cat <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span>, <span class="st">"Missing"</span><span class="op">)</span>,
         
         <span class="co"># re-classify age_cat as Factor, with correct level order and new "Missing" level</span>
         age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>,
                                              <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70-100"</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>    
  

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     0-4     5-9   10-14   15-19   20-29   30-49   50-69  70-100 Missing    &lt;NA&gt; 
##    1159    1225    1045     839    1117     844     134      12     104       0</code></pre>
<p>If the above seems cumbersome, consider using <code>age_categories()</code> instead, as described before.</p>
<p><strong>Make breaks and labels</strong></p>
<p>For a fast way to make breaks and labels manually, use something like below. See the [R Basics] page for references on <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> and <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code>.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make break points from 0 to 90 by 5</span>
<span class="va">age_seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">age_seq</span>

<span class="co"># Make labels for the above categories, assuming default cut() settings</span>
<span class="va">age_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">age_seq</span><span class="op">+</span><span class="fl">1</span>, <span class="st">"-"</span>, <span class="va">age_seq</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">age_labels</span>

<span class="co"># check that both vectors are the same length</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_seq</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_labels</span><span class="op">)</span></code></pre></div>
<p>Read more about <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> in its Help page by entering <code><a href="https://rdrr.io/r/base/cut.html">?cut</a></code> in the R console.</p>
</div>
<div id="quantile-breaks" class="section level3 unnumbered">
<h3>Quantile breaks<a class="anchor" aria-label="anchor" href="#quantile-breaks"><i class="fas fa-link"></i></a>
</h3>
<p>Make breaks from <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code>. This is from the <strong>stats</strong> package which comes in <strong>base</strong> R.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_quantiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.90</span>, <span class="fl">.95</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">age_quantiles</span></code></pre></div>
<pre><code>##  0% 25% 50% 75% 90% 95% 
##   0   6  13  24  35  42</code></pre>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># to return only the numbers use unname()</span>
<span class="va">age_quantiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">age_quantiles</span><span class="op">)</span>
<span class="va">age_quantiles</span></code></pre></div>
<pre><code>## [1]  0  6 13 24 35 42</code></pre>
<p>You can then use these as break points in <code>age_categories()</code> or <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>.</p>
<!-- ======================================================= -->
</div>
<div id="case_when" class="section level3 unnumbered">
<h3>
<code>case_when()</code><a class="anchor" aria-label="anchor" href="#case_when"><i class="fas fa-link"></i></a>
</h3>
<p>The dplyr function <code>case_when()</code> can also be used to create numeric categories.</p>
<ul>
<li>Allows explicit setting of break point inclusion/exclusion<br>
</li>
<li>Allows designation of label for <code>NA</code> values in one step<br>
</li>
<li>More complicated code<br>
</li>
<li>Allow more flexibility to include other variables in the logic</li>
</ul>
<p><strong>If using <code>case_when()</code> please review the proper use as described earlier in this page, as logic and order of assignment are important understand to avoid errors.</strong></p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> In <code>case_when()</code> all right-hand side values must be of the same class. Thus, if your categories are character values (e.g. “20-30 years”) then any designated outcome for <code>NA</code> age values must also be character (either “Missing”, or the special <code>NA_character_</code> instead of <code>NA</code>).</span></p>
<p>You will need to designate the column as a factor (by wrapping <code>case_when()</code> in the function <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>) and provide the ordering of the factor levels using the <code>levels =</code> argument <em>after</em> the close of the <code>case_when()</code> function. When using <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, the factor and ordering of levels is done automatically.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu">case_when</span><span class="op">(</span>
      <span class="co"># provide the case_when logic and outcomes</span>
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">5</span>     <span class="op">~</span> <span class="st">"0-4"</span>,          
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">10</span>    <span class="op">~</span> <span class="st">"5-9"</span>,
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">15</span>   <span class="op">~</span> <span class="st">"10-14"</span>,
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">15</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">20</span>   <span class="op">~</span> <span class="st">"15-19"</span>,
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">20</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">30</span>   <span class="op">~</span> <span class="st">"20-29"</span>,
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">50</span>   <span class="op">~</span> <span class="st">"30-49"</span>,
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">70</span>   <span class="op">~</span> <span class="st">"50-69"</span>,
      <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">45</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;=</span> <span class="fl">100</span> <span class="op">~</span> <span class="st">"70-100"</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_years</span><span class="op">)</span>                   <span class="op">~</span> <span class="st">"Missing"</span>,      <span class="co"># if age_years is missing</span>
      <span class="cn">TRUE</span>                               <span class="op">~</span> <span class="st">"Check value"</span><span class="op">)</span>, <span class="co"># trigger for review</span>
      
      <span class="co"># define the levels order for factor()</span>
      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>,<span class="st">"5-9"</span>, <span class="st">"10-14"</span>,
                 <span class="st">"15-19"</span>, <span class="st">"20-29"</span>, <span class="st">"30-49"</span>,
                 <span class="st">"50-69"</span>, <span class="st">"70-100"</span>, <span class="st">"Missing"</span>, <span class="st">"Check value"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And now view the results with a table of the new column:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##         0-4         5-9       10-14       15-19       20-29       30-49       50-69      70-100     Missing Check value        &lt;NA&gt; 
##        1159        1225        1045         839        1117         844         134          12         104           0           0</code></pre>
</div>
<div id="add-to-pipe-chain-2" class="section level3 unnumbered">
<h3>Add to pipe chain<a class="anchor" aria-label="anchor" href="#add-to-pipe-chain-2"><i class="fas fa-link"></i></a>
</h3>
<p>Below, code to create two categorical age columns is added to the cleaning pipe chain:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################   </span>
    <span class="fu">mutate</span><span class="op">(</span>
          <span class="co"># age categories: custom</span>
          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,
        
          <span class="co"># age categories: 0 to 85 by 5s</span>
          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="add-rows" class="section level2" number="1.12">
<h2>
<span class="header-section-number">1.12</span> Add rows<a class="anchor" aria-label="anchor" href="#add-rows"><i class="fas fa-link"></i></a>
</h2>
<p>Remember that each column must contain values of only one class (either character, numeric, logical, etc.). So adding a row requires nuance to maintain this.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_row</span><span class="op">(</span>row_num <span class="op">=</span> <span class="fl">666</span>,
          case_id <span class="op">=</span> <span class="st">"abc"</span>,
          generation <span class="op">=</span> <span class="fl">4</span>,
          `infection date` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-10-10"</span><span class="op">)</span>,
          .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Use <code>.before</code> and <code>.after.</code> to place the row you want to add. <code>.before = 3</code> will put the new row before the 3rd row. The default behavior is to add the row to the end. Columns not specified will be left empty.</p>
<p>The new <em>row number</em> may look strange (“…23”) but the row numbers in the pre-existing rows <em>have</em> changed. So if using the command twice, examine/test the insertion carefully.</p>
<p>If a class you provide is off you will see an error like this:</p>
<pre><code>Error: Can't combine ..1$infection date &lt;date&gt; and ..2$infection date &lt;character&gt;.</code></pre>
<p>(when inserting a row with a date value, remember to wrap the date in the function <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> like <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date("2020-10-10")</a></code>).</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="filter-rows" class="section level2 tabset tabset-fade" number="1.13">
<h2>
<span class="header-section-number">1.13</span> Filter rows<a class="anchor" aria-label="anchor" href="#filter-rows"><i class="fas fa-link"></i></a>
</h2>
<p>A typical early cleaning step is to filter the dataframe for specific rows using the <strong>dplyr</strong> verb <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>. Within <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, give the logic that must be <code>TRUE</code> for a row in the dataset to be kept.</p>
<p>Below is shown how to filter rows based on simple and complex logical conditions, and how to filter/subset rows as a stand-alone command and with <strong>base</strong> R</p>
<!-- ======================================================= -->
<div id="a-simple-filter" class="section level3 unnumbered">
<h3>A simple <code>filter()</code><a class="anchor" aria-label="anchor" href="#a-simple-filter"><i class="fas fa-link"></i></a>
</h3>
<p>This simple example re-defines the dataframe <code>linelist</code> as itself, having filtered the rows to meet a logical condition. <strong>Only the rows where the logical statement within the parentheses is <code>TRUE</code> are kept.</strong></p>
<p>In this case, the logical statement is <code>!is.na(case_id)</code>, which is asking whether the value in the column <code>case_id</code> is <strong>not</strong> missing (<code>NA</code>). Thus, rows where <code>case_id</code> is <strong>not</strong> missing are kept.</p>
<p>Before the filter is applied, the number of rows in <code>linelist</code> is 6479.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span><span class="op">)</span>  <span class="co"># keep only rows where case_id is not missing</span></code></pre></div>
<p>After the filter is applied, the number of rows in <code>linelist</code> is 6474.</p>
<!-- ======================================================= -->
</div>
<div id="a-complex-filter" class="section level3 unnumbered">
<h3>A complex <code>filter()</code><a class="anchor" aria-label="anchor" href="#a-complex-filter"><i class="fas fa-link"></i></a>
</h3>
<p>A more complex example using <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>:</p>
<div id="examine-the-data" class="section level4 unnumbered">
<h4>Examine the data<a class="anchor" aria-label="anchor" href="#examine-the-data"><i class="fas fa-link"></i></a>
</h4>
<p>Below is a simple one-line command to create a histogram of onset dates. See that a second smaller outbreak from 2012-2013 is also included in this dataset. <strong>For our analyses, we want to remove entries from this earlier outbreak.</strong></p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, breaks <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-300-1.png" width="50%"></div>
</div>
<div id="how-filters-handle-missing-numeric-and-date-values" class="section level4 unnumbered">
<h4>How filters handle missing numeric and date values<a class="anchor" aria-label="anchor" href="#how-filters-handle-missing-numeric-and-date-values"><i class="fas fa-link"></i></a>
</h4>
<p>Can we just filter by <code>date_onset</code> to rows after June 2013? <strong>Caution! Applying the code <code>filter(date_onset &gt; as.Date("2013-06-01")))</code> would remove any rows in the later epidemic with a missing date of onset!</strong></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Filtering to greater than (&gt;) or less than (&lt;) a date or number can remove any rows with missing values (<code>NA</code>)! This is because <code>NA</code> is treated as infinitely large and small.</span></p>
</div>
<div id="design-the-filter" class="section level4 unnumbered">
<h4>Design the filter<a class="anchor" aria-label="anchor" href="#design-the-filter"><i class="fas fa-link"></i></a>
</h4>
<p>Examine a cross-tabulation to make sure we exclude only the correct rows:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># hospital name</span>
      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># year of date_onset</span>
      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># show missing values</span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2012 2013 2014 2015 &lt;NA&gt;
##   Central Hospital                        0    0  359   95    0
##   Hospital A                            244   44    0    0    0
##   Hospital B                            253   35    0    0    0
##   Military Hospital                       0    0  698  198    0
##   Missing                                 0    0 1159  310    0
##   Other                                   0    0  713  172    0
##   Port Hospital                           7    3 1423  339    0
##   St. Mark's Maternity Hospital (SMMH)    0    0  331   91    0
##   &lt;NA&gt;                                    0    0    0    0    0</code></pre>
<p>What other criteria can we filter on to remove the first outbreak (in 2012 &amp; 2013) from the dataset? We see that:</p>
<ul>
<li>The first epidemic occurred at Hospital A, Hospital B, and that there were also 10 cases at Port Hospital.<br>
</li>
<li>Hospitals A &amp; B did <em>not</em> have cases in the second epidemic, but Port Hospital did.</li>
</ul>
<p>We want to exclude:</p>
<ul>
<li>The 586 rows with onset in 2012 and 2013 at either hospital A, B, or Port:
<ul>
<li>Exclude the 586 rows with onset in 2012 and 2013</li>
<li>Exclude the 0 rows from Hospitals A &amp; B with missing onset dates<br>
</li>
<li>Do <strong>not</strong> exclude the 0 other rows with missing onset dates.</li>
</ul>
</li>
</ul>
<p>We start with a linelist of <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist)</a></code>. Here is our filter statement:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="co"># keep rows where onset is after 1 June 2013 OR where onset is missing and it was a hospital OTHER than Hospital A or B</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 5888</code></pre>
<p>When we re-make the cross-tabulation, we see that Hospitals A &amp; B are removed completely, and the 10 Port Hospital cases from 2012 &amp; 2013 are removed, and all other values are the same - just as we wanted.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># hospital name</span>
      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># year of date_onset</span>
      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># show missing values</span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2014 2015 &lt;NA&gt;
##   Central Hospital                      359   95    0
##   Military Hospital                     698  198    0
##   Missing                              1159  310    0
##   Other                                 713  172    0
##   Port Hospital                        1423  339    0
##   St. Mark's Maternity Hospital (SMMH)  331   91    0
##   &lt;NA&gt;                                    0    0    0</code></pre>
<p>Multiple statements can be included within one filter command (separated by commas), or you can always pipe to a separate filter() command for clarity.</p>
<p><em>Note: some readers may notice that it would be easier to just filter by <code>date_hospitalisation</code> because it is 100% complete with no missing values. This is true. But <code>date_onset</code> is used for purposes of demonstrating a complex filter.</em></p>
</div>
</div>
<div id="filter-stand-alone-command" class="section level3" number="1.13.1">
<h3>
<span class="header-section-number">1.13.1</span> Filter stand-alone command<a class="anchor" aria-label="anchor" href="#filter-stand-alone-command"><i class="fas fa-link"></i></a>
</h3>
<p>Filtering can also be done as a stand-alone command (not part of a pipe chain). Like other <strong>dplyr</strong> verbs, in this case the first argument must be the dataset itself.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataframe &lt;- filter(dataframe, condition(s) for rows to keep)</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can also use <strong>base</strong> R to subset using square brackets which reflect the [rows, columns] that you want to retain.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataframe &lt;- dataframe[row conditions, column conditions] (blank means keep all)</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Use bracket-subset syntax with <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> to quickly review a few records.</span></p>
</div>
<div id="filter-to-quickly-review-observations" class="section level3" number="1.13.2">
<h3>
<span class="header-section-number">1.13.2</span> Filter to quickly review observations<a class="anchor" aria-label="anchor" href="#filter-to-quickly-review-observations"><i class="fas fa-link"></i></a>
</h3>
<p>This <strong>base</strong> R syntax can be handy when you want to quickly view a subset of rows and columns. Use the <strong>base</strong> R <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> command (note the capital “V”) around the [] subset you want to see. The result will appear as a dataframe in your RStudio viewer panel. For example, if I want to review onset and hospitalization dates of 3 specific cases:</p>
<p>View the linelist in the viewer panel:</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<p>View specific data for three cases:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">[</span><span class="va">linelist</span><span class="op">$</span><span class="va">case_id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_onset"</span>, <span class="st">"date_hospitalisation"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Note: the above command can also be written with <strong>dplyr</strong> verbs <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> and <code>select()</code> as below:</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span>
       <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">case_id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
       <span class="fu">select</span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_hospitalisation</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="add-to-pipe-chain-3" class="section level3" number="1.13.3">
<h3>
<span class="header-section-number">1.13.3</span> Add to pipe chain<a class="anchor" aria-label="anchor" href="#add-to-pipe-chain-3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="fu">mutate</span><span class="op">(</span>
          <span class="co"># age categories: custom</span>
          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,
        
          <span class="co"># age categories: 0 to 85 by 5s</span>
          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
          <span class="co"># keep only rows where case_id is not missing</span>
          <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>,  
          
          <span class="co"># also filter to keep only the second outbreak</span>
          <span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="row-wise-calculations" class="section level2" number="1.14">
<h2>
<span class="header-section-number">1.14</span> Row-wise calculations<a class="anchor" aria-label="anchor" href="#row-wise-calculations"><i class="fas fa-link"></i></a>
</h2>
<p>If you want to perform a calculation within a row, you can use <code>rowwise()</code> from <strong>dplyr</strong>. See the vignette on <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html">row-wise calculations</a></p>
<p>For example, this code applies <code>rowwise()</code> and then creates a new column that sums the number of symptoms per case:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_symptoms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="transformations-across-multiple-columns" class="section level2" number="1.15">
<h2>
<span class="header-section-number">1.15</span> Transformations across multiple columns<a class="anchor" aria-label="anchor" href="#transformations-across-multiple-columns"><i class="fas fa-link"></i></a>
</h2>
<p>Often to write concise code you want to apply the same transformation to multiple columns at once. A transformation can be applied to multiple variables at once using the <code>across()</code> function from the package <strong>dplyr</strong> (contained within <strong>tidyverse</strong> package).</p>
<p><code>across()</code> can be used with any <strong>dplyr</strong> verb, but commonly with as <code>mutate()</code>, <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, or <code>summarise()</code>.
<code>across()</code> allows you to specify which columns you want a function to apply to. To specify the columns, you can name them indvidually, or use helped functions.</p>
<p>Here the transformation <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> is applied to specific columns named within <code>across()</code>. Note that functions in <code>across()</code> are written <em>without</em> their parentheses ( )</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">ht_cm</span>, <span class="va">wt_kg</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>There are helpers available to assist you in specifying columns:</p>
<ul>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> - all other columns not mentioned<br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col()</a></code> - the last column<br>
</li>
<li>
<code>where()</code> - applies a function to all columns and selects those which are TRUE<br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> - matches to a specified prefix. Example: <code>select(starts_with("date"))</code>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code> - matches to a specified suffix. Example: <code>select(ends_with("_end"))</code><br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> - columns containing a character string. Example: <code>select(contains("time"))</code>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> - to apply a regular expression (regex). Example: <code>select(contains("[pt]al"))</code><br>
</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">num_range()</a></code> -</li>
<li>
<code>any_of()</code> - matches if column is named. Useful if the name might not exist. Example: <code>any_of(date_onset, date_death, cardiac_arrest)</code>
</li>
</ul>
<p>Here is an example of how one would change <strong>all columns</strong> to character class:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#to change all columns to character class</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Columns where the name contains the string “date” (note placement of commas and parentheses):</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#to change all columns to character class</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Below, we want to mutate the columns where they are class POSIXct (a datetime class that shows timestamps) - where the function <code>is.POSIXct()</code> evaluates to <code>TRUE</code>. Then we want to apply the function <code>is.Date()</code> to of these column to convert them to class Date.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="va"><a href="http://lubridate.tidyverse.org/reference/posix_utils.html">is.POSIXct</a></span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>Note that within <code>across()</code> we also use the function <code>where()</code><br>
</li>
<li>Note that is.POSIXct is from the package <strong>lubridate</strong>. Other similar functions (<code><a href="https://rdrr.io/r/base/character.html">is.character()</a></code>, <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code>, and <code><a href="https://rdrr.io/r/base/logical.html">is.logical()</a></code>) are from <strong>base R</strong>
</li>
</ul>
<p>Here are a few online resources on using <code>across()</code>: <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/">creator Hadley Wickham’s thoughts/rationale</a></p>
<pre><code>## [1] "2014-04-17"</code></pre>
<pre><code>## [1] "2014-04-19"</code></pre>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html">Welcome - THIS IS A DRAFT</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cleaning-data"><span class="header-section-number">1</span> Cleaning data</a></li>
<li><a class="nav-link" href="#overview"><span class="header-section-number">1.1</span> Overview</a></li>
<li><a class="nav-link" href="#cleaning-pipeline"><span class="header-section-number">1.2</span> Cleaning pipeline</a></li>
<li><a class="nav-link" href="#load-packages"><span class="header-section-number">1.3</span> Load packages</a></li>
<li>
<a class="nav-link" href="#import-data"><span class="header-section-number">1.4</span> Import data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#import">Import</a></li>
<li><a class="nav-link" href="#review">Review</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#column-names"><span class="header-section-number">1.5</span> Column names</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#automatic-name-cleaning">Automatic name cleaning</a></li>
<li><a class="nav-link" href="#manual-name-cleaning">Manual name cleaning</a></li>
<li><a class="nav-link" href="#other-name-challenges">Other name challenges</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#select-or-re-order-columns"><span class="header-section-number">1.6</span> Select or re-order columns</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#keep-columns"><span class="header-section-number">1.6.1</span> Keep columns</a></li>
<li><a class="nav-link" href="#helper-functions"><span class="header-section-number">1.6.2</span> Helper functions</a></li>
<li><a class="nav-link" href="#remove-columns"><span class="header-section-number">1.6.3</span> Remove columns</a></li>
<li><a class="nav-link" href="#standalone"><span class="header-section-number">1.6.4</span> Standalone</a></li>
</ul>
</li>
<li><a class="nav-link" href="#deduplication"><span class="header-section-number">1.7</span> Deduplication</a></li>
<li>
<a class="nav-link" href="#column-creation-and-transformation"><span class="header-section-number">1.8</span> Column creation and transformation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#new-columns">New columns</a></li>
<li><a class="nav-link" href="#convert-column-class">Convert column class</a></li>
<li><a class="nav-link" href="#using-base-r">Using base R</a></li>
<li><a class="nav-link" href="#mutate-on-grouped-values">Mutate on grouped values</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#re-code-values"><span class="header-section-number">1.9</span> Re-code values</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#re-code-specific-values">Re-code specific values</a></li>
<li><a class="nav-link" href="#re-code-missing-values">Re-code missing values</a></li>
<li><a class="nav-link" href="#re-code-by-logic">Re-code by logic</a></li>
<li><a class="nav-link" href="#re-code-with-simple-logic">Re-code with simple logic</a></li>
<li><a class="nav-link" href="#re-code-with-complex-logic">Re-code with complex logic</a></li>
<li><a class="nav-link" href="#re-code-with-a-cleaning-dictionary">Re-code with a cleaning dictionary</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#other-transformations"><span class="header-section-number">1.10</span> Other transformations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#coalesce">coalesce()</a></li>
<li><a class="nav-link" href="#cumulative-mathematics">Cumulative mathematics</a></li>
<li><a class="nav-link" href="#add-to-pipe-chain-1">Add to pipe chain</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#num_cats"><span class="header-section-number">1.11</span> Numeric categories</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#review-distribution">Review distribution</a></li>
<li><a class="nav-link" href="#age_categories">age_categories()</a></li>
<li><a class="nav-link" href="#cut"><span class="header-section-number">1.11.1</span> cut()</a></li>
<li><a class="nav-link" href="#quantile-breaks">Quantile breaks</a></li>
<li><a class="nav-link" href="#case_when">case_when()</a></li>
<li><a class="nav-link" href="#add-to-pipe-chain-2">Add to pipe chain</a></li>
</ul>
</li>
<li><a class="nav-link" href="#add-rows"><span class="header-section-number">1.12</span> Add rows</a></li>
<li>
<a class="nav-link" href="#filter-rows"><span class="header-section-number">1.13</span> Filter rows</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#a-simple-filter">A simple filter()</a></li>
<li><a class="nav-link" href="#a-complex-filter">A complex filter()</a></li>
<li><a class="nav-link" href="#filter-stand-alone-command"><span class="header-section-number">1.13.1</span> Filter stand-alone command</a></li>
<li><a class="nav-link" href="#filter-to-quickly-review-observations"><span class="header-section-number">1.13.2</span> Filter to quickly review observations</a></li>
<li><a class="nav-link" href="#add-to-pipe-chain-3"><span class="header-section-number">1.13.3</span> Add to pipe chain</a></li>
</ul>
</li>
<li><a class="nav-link" href="#row-wise-calculations"><span class="header-section-number">1.14</span> Row-wise calculations</a></li>
<li><a class="nav-link" href="#transformations-across-multiple-columns"><span class="header-section-number">1.15</span> Transformations across multiple columns</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
