<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>1 Plotting with ggplot - basics and tips | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.7/header-attrs.js"></script>
    <script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.4/tabs.js"></script>
    <script src="libs/bs3compat-0.2.4/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.15/datatables.js"></script>
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="plotting-with-ggplot---basics-and-tips" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Plotting with ggplot - basics and tips</h1>
<p><strong>ggplot2</strong> is the most popular data visualisation package in R and is generally used instead of <strong>base</strong> <code>R</code> for creating figures. The “gg” in the name represents a “<strong>g</strong>rammar of <strong>g</strong>raphics”. <strong>ggplot2</strong> benefits from a wide variety of supplementary R packages that further enhance its functionality.</p>
<p>The syntax is significantly different from <strong>base</strong> <code>R</code> plotting, and has a learning curve associated with it. Using <strong>ggplot2</strong> generally requires the user to format their data in a way that is highly <strong>tidyverse</strong> compatible, which ultimately makes using these packages together very effective.</p>
<p>In this page we will cover:</p>
<ul>
<li>The fundamentals of plotting with <strong>ggplot2</strong><br />
</li>
<li>Tips and tricks to make your plots sharp</li>
</ul>
<p>There a several extensive <strong>ggplot2</strong> tutorials linked in the resources section. You can also download this <a href="https://rstudio.com/resources/cheatsheets/">data visualization with ggplot cheatsheet</a> from the RStudio website. If you want inspiration for ways to creatively visualise your data, we suggest reviewing websites like the <a href="https://www.r-graph-gallery.com/">R graph gallery</a> and <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
<div id="preparation" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Preparation</h2>
<div id="load-packages" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load packages with <code>library()</code> from <strong>base</strong> R. See the page on [R basics] for more information on R packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  tidyverse,      <span class="co"># includes ggplot2 and other</span></span>
<span id="cb1-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  rio,            <span class="co"># import/export</span></span>
<span id="cb1-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-4" aria-hidden="true" tabindex="-1"></a>  here,           <span class="co"># file locator</span></span>
<span id="cb1-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-5" aria-hidden="true" tabindex="-1"></a>  stringr,        <span class="co"># working with characters   </span></span>
<span id="cb1-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  scales,         <span class="co"># transform numbers</span></span>
<span id="cb1-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  ggrepel,        <span class="co"># smartly-placed labels</span></span>
<span id="cb1-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-8" aria-hidden="true" tabindex="-1"></a>  gghighlight,    <span class="co"># highlight one part of plot</span></span>
<span id="cb1-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  RColorBrewer    <span class="co"># color scales</span></span>
<span id="cb1-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb1-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="import-data" class="section level3 unnumbered">
<h3>Import data</h3>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the [Download handbook and data] page. The dataset is imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on [Import and export] for various ways to import data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb2-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.xlsx&quot;</span>)</span></code></pre></div>
<p>The first 50 rows of the linelist are displayed below. We will focus on the continuous variables <code>age</code>, <code>wt_kg</code> (weight in kilos), <code>ct_blood</code> (CT values), and <code>days_onset_hosp</code> (difference between onset date and hospitalisation).</p>
<div id="htmlwidget-ccc1c6fe5ed586bce619" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ccc1c6fe5ed586bce619">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="general-cleaning" class="section level3 unnumbered">
<h3>General cleaning</h3>
<p>When preparing data to plot, it is best to make the data adhere to <a href="https://r4ds.had.co.nz/tidy-data.html">“tidy” data standards</a> as much as possible. How to achieve this is expanded on in the data management pages of this handbook, such as [Cleaning data and core functions].</p>
<p>Some simple ways we can prepare our data to make it better for plotting can include making the contents of the data better for display - this does not necessarily mean its better for data manipulation! For example:</p>
<ul>
<li>Replace <code>NA</code> values in a character column with the string “Unknown”<br />
</li>
<li>Clean some columns so that their “data friendly” values with underscores etc are changed to normal text or title case (see [Characters and strings])</li>
</ul>
<p>Here are some examples of this in action:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make display version of columns with more friendly names</span></span>
<span id="cb3-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># f to Male, f to Female, NA to Unknown</span></span>
<span id="cb3-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender_disp =</span> <span class="fu">case_when</span>(gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">~</span> <span class="st">&quot;Male&quot;</span>,</span>
<span id="cb3-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-6" aria-hidden="true" tabindex="-1"></a>                            gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span> <span class="sc">~</span> <span class="st">&quot;Female&quot;</span>,</span>
<span id="cb3-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">is.na</span>(gender) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb3-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># replace NA with unknown for outcome</span></span>
<span id="cb3-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_disp =</span> <span class="fu">replace_na</span>(outcome, <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb3-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb3-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="pivoting-longer" class="section level3 unnumbered">
<h3>Pivoting longer</h3>
<p>As a matter of data structure, for <strong>ggplot2</strong> we often also want to pivot our data into <em>longer</em> formats, which will allow us to use a set of variables as a single variable. Read more about this is the page on [Pivoting data].</p>
<p>For example, if we wanted to show the number of cases with specific symptoms, we are limited by the fact that each symptom is a specific column. We can pivot this to a longer format like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb4-1" aria-hidden="true" tabindex="-1"></a>linelist_sym <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;fever&quot;</span>, <span class="st">&quot;chills&quot;</span>, <span class="st">&quot;cough&quot;</span>, <span class="st">&quot;aches&quot;</span>, <span class="st">&quot;vomit&quot;</span>),</span>
<span id="cb4-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb4-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;symptom_name&quot;</span>,</span>
<span id="cb4-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb4-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;symptom_is_present&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">symptom_is_present =</span> <span class="fu">replace_na</span>(symptom_is_present, <span class="st">&quot;unknown&quot;</span>))</span></code></pre></div>
<p>Here are the first 50 rows. Note that case has 5 rows - one for each possibly symptom. Scroll to the right to see the new columns <code>symptom_name</code> and <code>symptom_is_present</code>.</p>
<div id="htmlwidget-2209887855ddeb5179ca" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2209887855ddeb5179ca">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1401235200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399939200000\" data-max=\"1401926400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1402099200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400371200000\" data-max=\"1403049600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"61\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"61\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2572163655863\" data-max=\"-13.212910703914\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.4754761613651\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"91\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"11\" data-max=\"238\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"21\" data-max=\"23\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"35.9\" data-max=\"37.6\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"117.1875\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","5fe599","5fe599","5fe599","5fe599","8689b7","8689b7","8689b7","8689b7","8689b7","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","b8812a","b8812a","b8812a","b8812a","b8812a","893f25","893f25","893f25","893f25","893f25","be99c8","be99c8","be99c8","be99c8","be99c8","07e3e8","07e3e8","07e3e8","07e3e8","07e3e8","369449","369449","369449","369449","369449","f393b4","f393b4","f393b4","f393b4","f393b4","1389ca","1389ca","1389ca","1389ca","1389ca"],[4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],["2014-05-08","2014-05-08","2014-05-08","2014-05-08","2014-05-08",null,null,null,null,null,null,null,null,null,null,"2014-05-04","2014-05-04","2014-05-04","2014-05-04","2014-05-04","2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-03","2014-05-03","2014-05-03","2014-05-03","2014-05-03","2014-05-22","2014-05-22","2014-05-22","2014-05-22","2014-05-22","2014-05-28","2014-05-28","2014-05-28","2014-05-28","2014-05-28",null,null,null,null,null,null,null,null,null,null],["2014-05-13","2014-05-13","2014-05-13","2014-05-13","2014-05-13","2014-05-13","2014-05-13","2014-05-13","2014-05-13","2014-05-13","2014-05-16","2014-05-16","2014-05-16","2014-05-16","2014-05-16","2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-21","2014-05-21","2014-05-21","2014-05-21","2014-05-21","2014-05-22","2014-05-22","2014-05-22","2014-05-22","2014-05-22","2014-05-27","2014-05-27","2014-05-27","2014-05-27","2014-05-27","2014-06-02","2014-06-02","2014-06-02","2014-06-02","2014-06-02","2014-06-05","2014-06-05","2014-06-05","2014-06-05","2014-06-05","2014-06-05","2014-06-05","2014-06-05","2014-06-05","2014-06-05"],["2014-05-15","2014-05-15","2014-05-15","2014-05-15","2014-05-15","2014-05-14","2014-05-14","2014-05-14","2014-05-14","2014-05-14","2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-20","2014-05-20","2014-05-20","2014-05-20","2014-05-20","2014-05-22","2014-05-22","2014-05-22","2014-05-22","2014-05-22","2014-05-23","2014-05-23","2014-05-23","2014-05-23","2014-05-23","2014-05-29","2014-05-29","2014-05-29","2014-05-29","2014-05-29","2014-06-03","2014-06-03","2014-06-03","2014-06-03","2014-06-03","2014-06-06","2014-06-06","2014-06-06","2014-06-06","2014-06-06","2014-06-07","2014-06-07","2014-06-07","2014-06-07","2014-06-07"],[null,null,null,null,null,"2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-18","2014-05-30","2014-05-30","2014-05-30","2014-05-30","2014-05-30",null,null,null,null,null,"2014-05-29","2014-05-29","2014-05-29","2014-05-29","2014-05-29","2014-05-24","2014-05-24","2014-05-24","2014-05-24","2014-05-24","2014-06-01","2014-06-01","2014-06-01","2014-06-01","2014-06-01","2014-06-07","2014-06-07","2014-06-07","2014-06-07","2014-06-07","2014-06-18","2014-06-18","2014-06-18","2014-06-18","2014-06-18","2014-06-09","2014-06-09","2014-06-09","2014-06-09","2014-06-09"],[null,null,null,null,null,"Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover",null,null,null,null,null,"Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Death","Death","Death","Death","Death","Recover","Recover","Recover","Recover","Recover","Death","Death","Death","Death","Death"],["m","m","m","m","m","f","f","f","f","f","m","m","m","m","m","f","f","f","f","f","m","m","m","m","m","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","m","m","m","m","m","f","f","f","f","f"],[2,2,2,2,2,3,3,3,3,3,56,56,56,56,56,18,18,18,18,18,3,3,3,3,3,16,16,16,16,16,16,16,16,16,16,0,0,0,0,0,61,61,61,61,61,27,27,27,27,27],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,2,2,2,2,3,3,3,3,3,56,56,56,56,56,18,18,18,18,18,3,3,3,3,3,16,16,16,16,16,16,16,16,16,16,0,0,0,0,0,61,61,61,61,61,27,27,27,27,27],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","50-69","50-69","50-69","50-69","50-69","15-19","15-19","15-19","15-19","15-19","0-4","0-4","0-4","0-4","0-4","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","0-4","0-4","0-4","0-4","0-4","50-69","50-69","50-69","50-69","50-69","20-29","20-29","20-29","20-29","20-29"],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","55-59","55-59","55-59","55-59","55-59","15-19","15-19","15-19","15-19","15-19","0-4","0-4","0-4","0-4","0-4","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","0-4","0-4","0-4","0-4","0-4","60-64","60-64","60-64","60-64","60-64","25-29","25-29","25-29","25-29","25-29"],["Other","Other","Other","Other","Other","Missing","Missing","Missing","Missing","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing"],[-13.2157351064963,-13.2157351064963,-13.2157351064963,-13.2157351064963,-13.2157351064963,-13.2152339775486,-13.2152339775486,-13.2152339775486,-13.2152339775486,-13.2152339775486,-13.212910703914,-13.212910703914,-13.212910703914,-13.212910703914,-13.212910703914,-13.2363711169728,-13.2363711169728,-13.2363711169728,-13.2363711169728,-13.2363711169728,-13.2228638912441,-13.2228638912441,-13.2228638912441,-13.2228638912441,-13.2228638912441,-13.222625321098,-13.222625321098,-13.222625321098,-13.222625321098,-13.222625321098,-13.2331547837254,-13.2331547837254,-13.2331547837254,-13.2331547837254,-13.2331547837254,-13.2320975453153,-13.2320975453153,-13.2320975453153,-13.2320975453153,-13.2320975453153,-13.2225511595637,-13.2225511595637,-13.2225511595637,-13.2225511595637,-13.2225511595637,-13.2572163655863,-13.2572163655863,-13.2572163655863,-13.2572163655863,-13.2572163655863],[8.46897295100924,8.46897295100924,8.46897295100924,8.46897295100924,8.46897295100924,8.45171855856465,8.45171855856465,8.45171855856465,8.45171855856465,8.45171855856465,8.46481700596819,8.46481700596819,8.46481700596819,8.46481700596819,8.46481700596819,8.4754761613651,8.4754761613651,8.4754761613651,8.4754761613651,8.4754761613651,8.46082377490923,8.46082377490923,8.46082377490923,8.46082377490923,8.46082377490923,8.46183062600728,8.46183062600728,8.46183062600728,8.46183062600728,8.46183062600728,8.46272931462646,8.46272931462646,8.46272931462646,8.46272931462646,8.46272931462646,8.46144367534271,8.46144367534271,8.46144367534271,8.46144367534271,8.46144367534271,8.46191259217774,8.46191259217774,8.46191259217774,8.46191259217774,8.46191259217774,8.47292327643506,8.47292327643506,8.47292327643506,8.47292327643506,8.47292327643506],["f547d6","f547d6","f547d6","f547d6","f547d6",null,null,null,null,null,null,null,null,null,null,"f90f5f","f90f5f","f90f5f","f90f5f","f90f5f","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","aec8ec","aec8ec","aec8ec","aec8ec","aec8ec","893f25","893f25","893f25","893f25","893f25","133ee7","133ee7","133ee7","133ee7","133ee7",null,null,null,null,null,null,null,null,null,null],["other","other","other","other","other",null,null,null,null,null,null,null,null,null,null,"other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other","other",null,null,null,null,null,null,null,null,null,null],[27,27,27,27,27,25,25,25,25,25,91,91,91,91,91,41,41,41,41,41,36,36,36,36,36,56,56,56,56,56,47,47,47,47,47,0,0,0,0,0,86,86,86,86,86,69,69,69,69,69],[48,48,48,48,48,59,59,59,59,59,238,238,238,238,238,135,135,135,135,135,71,71,71,71,71,116,116,116,116,116,87,87,87,87,87,11,11,11,11,11,226,226,226,226,226,174,174,174,174,174],[22,22,22,22,22,22,22,22,22,22,21,21,21,21,21,23,23,23,23,23,23,23,23,23,23,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22],[36.8,36.8,36.8,36.8,36.8,36.9,36.9,36.9,36.9,36.9,36.9,36.9,36.9,36.9,36.9,36.8,36.8,36.8,36.8,36.8,36.9,36.9,36.9,36.9,36.9,37.6,37.6,37.6,37.6,37.6,37.3,37.3,37.3,37.3,37.3,37,37,37,37,37,36.4,36.4,36.4,36.4,36.4,35.9,35.9,35.9,35.9,35.9],[null,null,null,null,null,"09:36","09:36","09:36","09:36","09:36","16:48","16:48","16:48","16:48","16:48","11:22","11:22","11:22","11:22","11:22","12:60","12:60","12:60","12:60","12:60","14:13","14:13","14:13","14:13","14:13","14:33","14:33","14:33","14:33","14:33","09:25","09:25","09:25","09:25","09:25","11:16","11:16","11:16","11:16","11:16","10:55","10:55","10:55","10:55","10:55"],[117.1875,117.1875,117.1875,117.1875,117.1875,71.8184429761563,71.8184429761563,71.8184429761563,71.8184429761563,71.8184429761563,16.0652496292635,16.0652496292635,16.0652496292635,16.0652496292635,16.0652496292635,22.4965706447188,22.4965706447188,22.4965706447188,22.4965706447188,22.4965706447188,71.4144019043841,71.4144019043841,71.4144019043841,71.4144019043841,71.4144019043841,41.6171224732461,41.6171224732461,41.6171224732461,41.6171224732461,41.6171224732461,62.0953890870657,62.0953890870657,62.0953890870657,62.0953890870657,62.0953890870657,0,0,0,0,0,16.8376536925366,16.8376536925366,16.8376536925366,16.8376536925366,16.8376536925366,22.7903289734443,22.7903289734443,22.7903289734443,22.7903289734443,22.7903289734443],[2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2],["Male","Male","Male","Male","Male","Female","Female","Female","Female","Female","Male","Male","Male","Male","Male","Female","Female","Female","Female","Female","Male","Male","Male","Male","Male","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Male","Male","Male","Male","Male","Female","Female","Female","Female","Female"],["Unknown","Unknown","Unknown","Unknown","Unknown","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Unknown","Unknown","Unknown","Unknown","Unknown","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Recover","Death","Death","Death","Death","Death","Recover","Recover","Recover","Recover","Recover","Death","Death","Death","Death","Death"],["fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit"],["no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","no","no","no","no","no","no","no","yes","no","yes","no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","no","no","yes","no","yes","no","no","yes","no","yes","no","no","yes","no","no"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n      <th>gender_disp<\/th>\n      <th>outcome_disp<\/th>\n      <th>symptom_name<\/th>\n      <th>symptom_is_present<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,21,23,24]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
<p>Note that this format is not very useful for other operations, and should just be used for the plot it was made for. However, users should endeavor to use these practices as much as possible for the base dataset, as they are more tidyverse compliant, and will make working with the data easier.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="basics-of-ggplot" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Basics of ggplot</h2>
<p><strong>“Grammar of graphics” - ggplot2</strong></p>
<p>Plotting with <strong>ggplot2</strong> is based on “adding” plot layers and attribute specifications on top of one another, with each sub-command added with a plus symbol (<code>+</code>). The result is a multi-layer plot object that can be printed, saved/exported, etc.</p>
<p>ggplot objects can be highly complex, but the basic order of layers will usually look like this:</p>
<ol style="list-style-type: decimal">
<li>The baseline <code>ggplot()</code> command - establish the coordinate base and specify the dataset<br />
</li>
<li>Add “geom” layers - these geometric functions visualize the data as a bar graph, line plot, scatter plot, histogram, etc (or a combination!). These functions all start with <code>geom_</code> as a prefix.<br />
</li>
<li>Add adjustments to the plot “themes” and labels - For example, specify the axis labels, title, fonts, sizes, color schemes, legends, etc.</li>
</ol>
<p>A simple example of skeleton code is as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> my_data)<span class="sc">+</span>  </span>
<span id="cb5-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_XXXX</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> col1, <span class="at">y =</span> col2), <span class="at">fill =</span> <span class="st">&quot;color&quot;</span>)<span class="sc">+</span></span>
<span id="cb5-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span></code></pre></div>
<p>We will explain each component in the sections below.</p>
<div id="ggplot" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> <code>ggplot()</code></h3>
<p>The opening command of any ggplot2 plot is <code>ggplot()</code>. This command simply creates a blank canvas upon which to add layers. It “opens” the way for further layers to be added with a <code>+</code> symbol.</p>
<p>Typically, the command <code>ggplot()</code> includes the <code>data =</code> argument for the plot. This sets the default dataset to be used for subsequent layers of the plot.</p>
<p>Finally, this command will end with a <code>+</code> after the closing parentheses. This leaves the command “open”. The plot will only execute/appear when the command includes a final layer without a <code>+</code> at the end.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will create plot that is a blank canvas</span></span>
<span id="cb6-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)</span></code></pre></div>
</div>
<div id="geoms" class="section level3 unnumbered">
<h3>Geoms</h3>
<p>A blank canvas is not sufficient! We need to create geometries from our data! Bar plots, histograms, scatter plots, box plots!</p>
<p>This is done by adding layers of geometry to the initial <code>ggplot()</code> command. There are many <strong>ggplot2</strong> functions that create “geoms”. Each of these functions begins with “geom_”, so we will refer to them generically as <code>geom_XXXX()</code>. Some common geoms are listed below:</p>
<ul>
<li>Histograms - <code>geom_histogram()</code><br />
</li>
<li>Bar charts - <code>geom_bar()</code><br />
</li>
<li>Box plots - <code>geom_boxplot()</code><br />
</li>
<li>Points (e.g. scatter plots) - <code>geom_point()</code><br />
</li>
<li>Line graphs - <code>geom_line()</code> or <code>geom_path()</code><br />
</li>
<li>Trend lines - <code>geom_smooth()</code></li>
</ul>
<p>In one plot you can display one or multiple geoms. Each is added with a <code>+</code>, and they are plotted sequentially such that later geoms are plotted on top of previous ones.</p>
<p>But simply knowing these geom functions is not sufficient to produce a plot! We must also <em>map</em> the data to the plot…</p>
</div>
<div id="mapping-plot-aesthetics-to-data" class="section level3 unnumbered">
<h3>Mapping plot aesthetics to data</h3>
<p>The next core component of a <code>ggplot()</code> object is how plot “aesthetics” are mapped to columns in the data. By a plot “aesthetic”, we mean a visual property of an object in the plot. The two essential “aesthetics” are the x-axis, and (if necessary) the y-axis.</p>
<p>Below, we (finally) create a scatter plot of the linelist cases using <code>geom_point()</code> and by mapping the x-axis to the column <code>age</code> and the y-axis to the column <code>wt_kg</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span></span>
<span id="cb7-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>The following command produces a histogram with <code>geom_histogram()</code>, which by its very nature only requires a column for the x-axis. The count y-axis is generated automatically.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb8-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" />
<strong>Aesthetic mapping can be defined in several places, even multiple times!</strong></p>
<p>A <code>mapping = aes()</code> statement can be written in several places, or more than once. It can be written in the top <code>ggplot()</code> command, and/or for each individual <code>geom_XXXX()</code> beneath. The nuances include:</p>
<ul>
<li>Mapping assignments specified in the top <code>ggplot()</code> command will apply as defaults across any geom below.<br />
</li>
<li>Mapping assignments specified within one <code>geom_XXXX()</code> apply only to that geom.</li>
</ul>
<p>Likewise, a <code>data =</code> specified in the top <code>ggplot()</code> will apply by default to any geom below, but you can also specify data for each geom, if desired. This is a common way to create a plot that combined two datasets.</p>
<p>Thus, both of the following commands will create the same plot:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These commands will produce the exact same plot</span></span>
<span id="cb9-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb9-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb9-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb9-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))</span></code></pre></div>
</div>
<div id="other-aesthetics" class="section level3 unnumbered">
<h3>Other aesthetics</h3>
<p>There are other aesthetics which can be specific to the type of geom. Some examples:</p>
<ul>
<li><code>shape =</code> Display of a point (<code>geom_point()</code>) as a dot, star, triangle, square, etc.<br />
</li>
<li><code>fill =</code> The interior color (e.g. of a bar or boxplot)<br />
</li>
<li><code>color =</code> The exterior line(s) of a bar, boxplot, etc. (or the point color if using <code>geom_point()</code>)<br />
</li>
<li><code>size =</code> Size (e.g. line thickness, point size)<br />
</li>
<li><code>alpha =</code> Transparency (1 = opaque, 0 = invisible)<br />
</li>
<li><code>binwidth =</code> Width of histogram bins<br />
</li>
<li><code>linetype =</code> Line type (e.g. solid, dashed, dotted)</li>
</ul>
<p>The above aesthetics (and others not mentioned) can be placed inside or outside the <code>aes()</code>. This depends on whether you want their value to be <em>static</em> or to be scaled/depend on each row of data.</p>
<p>If you want the value to be static, you would write its assignment within the <code>geom_XXXX()</code> but <em>outside</em> of a <code>mapping = aes()</code> statement (there may not even be one in the geom). The assignment values would be unchanging - for example, <code>size = 1</code> or <code>color = "blue"</code>.</p>
<p>Here are two examples. In the first, the mapping assignments of the axes is set in the <code>ggplot()</code> command, and the color, size, and alpha are alone in the <code>geom_point()</code>. Note that they could not be written in <code>ggplot()</code>. In the second example, the axis mapping is done within the geom (just for example - it does not make a difference), and the binwidth, color, fill, and alpha are <em>outside</em> the <code>aes()</code> and set to static values.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot</span></span>
<span id="cb10-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  <span class="co"># set data and axes mapping</span></span>
<span id="cb10-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)         <span class="co"># set point aesthetics</span></span>
<span id="cb10-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb10-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span>       <span class="co"># set data</span></span>
<span id="cb10-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(              <span class="co"># display histogram</span></span>
<span id="cb10-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age),      <span class="co"># axis mapping for histogram</span></span>
<span id="cb10-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">7</span>,                <span class="co"># width of bins</span></span>
<span id="cb10-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,               <span class="co"># bin line color</span></span>
<span id="cb10-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>,               <span class="co"># bin interior color</span></span>
<span id="cb10-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span>)                 <span class="co"># bin transparency</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-16-2.png" width="50%" /></p>
<p>But you can instead map these aesthetics to columns in the data, so that their display is scaled by each row of data.</p>
<p>In this case, you assign these aesthetics <em>within</em> the <code>aes()</code>, alongside the axes assignments. The assignments are now to column names, not to static values. And finally, if you choose to put the <code>aes()</code> at the top in the <code>ggplot()</code> command, these assignments will apply by default to any geoms below.</p>
<p>Two examples are below.</p>
<p>Note in the first example how the color of each point reflects the age value - and a scale has appeared in a legend! For now just note that it exists - we will address how to modify it in later sections. The second example highlights two new mapped aesthetics (color <em>and</em> size), while shape and alpha remain mapped to static values outside of any <code>aes()</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot</span></span>
<span id="cb11-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,   <span class="co"># set data</span></span>
<span id="cb11-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># map aesthetics to column values</span></span>
<span id="cb11-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># map x-axis to age            </span></span>
<span id="cb11-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># map y-axis to weight</span></span>
<span id="cb11-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age))<span class="sc">+</span>     <span class="co"># map color to age</span></span>
<span id="cb11-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()            <span class="co"># display data as points </span></span>
<span id="cb11-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot</span></span>
<span id="cb11-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,   <span class="co"># set data</span></span>
<span id="cb11-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># map aesthetics to column values</span></span>
<span id="cb11-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># map x-axis to age            </span></span>
<span id="cb11-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># map y-axis to weight</span></span>
<span id="cb11-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age,       <span class="co"># map color to age</span></span>
<span id="cb11-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> age))<span class="sc">+</span>      <span class="co"># map size to age</span></span>
<span id="cb11-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(             <span class="co"># display data as points</span></span>
<span id="cb11-17"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">&quot;diamond&quot;</span>,      <span class="co"># points display as diamonds</span></span>
<span id="cb11-18"><a href="plotting-with-ggplot-basics-and-tips.html#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>)            <span class="co"># point transparency at 30%</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-17-2.png" width="50%" /></p>
<p>It becomes important to track your layers and aesthetics when making more complex plots - like those with multiple geoms.</p>
<p>In the example below, the <code>size =</code> aesthetic is assigned twice - once for <code>geom_point()</code> and once for <code>geom_smooth()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,</span>
<span id="cb12-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb12-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ht_cm, <span class="at">y =</span> wt_kg, <span class="at">color =</span> age_years)) <span class="sc">+</span> <span class="co"># map aesthetics to columns</span></span>
<span id="cb12-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  <span class="co"># add points for each row of data</span></span>
<span id="cb12-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="co"># add a trend line with linear method, width of 2</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Note that propoerly aligning axes to plot from multiple dataset on top of one another can be difficult. Consider instead using <strong>cowplot</strong> or a similar package to combine two plots - as described in that section of the [ggplot tips] page.</p>
<p>Here is an actual code example:</p>
<ul>
<li><p>Within <code>ggplot()</code>, the data is set as the data frame <code>linelist</code>. Within <code>aes()</code>, the <code>age</code> column is mapped to the x-axis. This command concludes with a <code>+</code> to facilitate the next line within the context of the plot.</p></li>
<li><p>The <code>geom_histogram()</code> displays the data as a histogram. The width of each bin is set to 10 units, the fill in the bars is <code>"red"</code>, and the color of the lines around the bars is set to <code>"black"</code>. This command also concludes with a <code>+</code> to usher in the next line.</p></li>
<li><p>The final line is the <code>labs()</code> function, which can be used to adjust the axis labels, title, subtitle, caption, etc. At the end of this command, there is no <code>+</code>, indicating that the plot code is ended.</p></li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set dataset and the baseline mapping of variables to axes</span></span>
<span id="cb13-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb13-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a geometric object with some parameters</span></span>
<span id="cb13-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb13-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">10</span>,</span>
<span id="cb13-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb13-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb13-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add labels to the axes</span></span>
<span id="cb13-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age in years&quot;</span>,</span>
<span id="cb13-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of cases&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="defining-plots" class="section level3 unnumbered">
<h3>Defining plots</h3>
<p>Plots can be printed to the Plots RStudio pane, as we have done until now, by simply beginning the command with <code>ggplot()</code>. However, you can also save the plot as an object by using the assignment operator <code>&lt;-</code> and giving it a name. It will not print unless the object name itself is run. You can also print it by wrapping the plot name with <code>print()</code>, but this is only necessary in certain circumstances like if the plot is created inside a <em>for loop</em>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define plot</span></span>
<span id="cb14-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb14-2" aria-hidden="true" tabindex="-1"></a>age_by_wt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age_years, <span class="at">y =</span> wt_kg, <span class="at">color =</span> age_years))<span class="sc">+</span></span>
<span id="cb14-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)</span>
<span id="cb14-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb14-5" aria-hidden="true" tabindex="-1"></a>age_by_wt    <span class="co"># print</span></span></code></pre></div>
</div>
<div id="saving-plots" class="section level3 unnumbered">
<h3>Saving plots</h3>
<p>Exporting ggplots is made easy with the <code>ggsave()</code> function from <strong>ggplot2</strong>. It can work in two ways, either:</p>
<ul>
<li>Specify the name of the plot object, then the file path and name with extension
<ul>
<li>For example: <code>ggsave(my_plot, "My Documents/work/plots/my_plot.png")</code><br />
</li>
</ul></li>
<li>Save the last plot that was printed
<ul>
<li>For example: <code>ggsave("My Documents/work/plots/my_plot.png")</code></li>
</ul></li>
</ul>
<p>You can export as png, pdf, jpeg, tiff, bmp, svg, or several other file types, by specifying the file extension in the file path.</p>
<p>You can also specify the arguments <code>width =</code>, <code>height =</code>, and <code>units =</code> (either “in”, “cm”, or “mm”). You can also specify <code>dpi =</code> with a number for plot resolution (e.g. 300). See the function details by entering <code>?ggsave</code> or reading the <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">documentation online</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="themes-and-labels" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Themes and Labels</h2>
<p>One of the most important aspects of data visualisation is presenting data in a clear way with nice aesthetics. The plot we made previously looks ok, but we could make the theme a little nicer. <code>ggplot2</code> comes with some preset themes that can be used to change the theme of the plot. We can also edit themes of the plot with extreme detail with the <code>theme()</code> function. We can also add some nicer labels to the plot with the <code>labs()</code> function. There are 5 standard labeling locations:</p>
<ol style="list-style-type: decimal">
<li><code>x</code> - the x-axis</li>
<li><code>y</code> - the y-axis</li>
<li><code>title</code> - the main plot title</li>
<li><code>subtitle</code> - directly underneath the plot title in smaller text (by default)</li>
<li><code>caption</code> - bottom of plot, on the right by default</li>
</ol>
<p>For example, we can update the plot we previously plotted with nice labels like this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-1" aria-hidden="true" tabindex="-1"></a>wt_ht_plot <span class="ot">&lt;-</span> wt_ht_plot <span class="sc">+</span> </span>
<span id="cb15-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set the theme to classic</span></span>
<span id="cb15-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb15-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># further edit the theme to move the legend position</span></span>
<span id="cb15-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add nicer labels</span></span>
<span id="cb15-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Weight (kg)&quot;</span>, </span>
<span id="cb15-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;height (cm)&quot;</span>,</span>
<span id="cb15-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Patient height and weight&quot;</span>,</span>
<span id="cb15-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;total patients {nrow(linelist)}&quot;</span>),</span>
<span id="cb15-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;produced by me!&quot;</span>)</span>
<span id="cb15-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb15-11" aria-hidden="true" tabindex="-1"></a>wt_ht_plot</span></code></pre></div>
<p>The <code>theme()</code> function can also be used to edit the defaults of these elements. This function can take an extremely large number of arguments, each of which can be used to edit very specific aspects of the plot. We won’t go through all examples, look at how editing aspects of text elements is done. The basic way this is done is:</p>
<ol style="list-style-type: decimal">
<li>Calling the specific argument of <code>theme()</code> for the element we want to edit (e.g. <code>plot.title</code> for the plot title)</li>
<li>Supplying the <code>element_text()</code> function to the argument (there are other versions of this e.g. <code>element_rect()</code> for editing the plot background aesthetics)</li>
<li>Changing the arguments in <code>element_text()</code></li>
</ol>
<p>For example, we increase the size of the plot title with <code>size</code>, make the subtitle italicised with <code>face</code>, and right
justify the caption with <code>hjust</code>. We’ll also change the legend location for good measure!</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-1" aria-hidden="true" tabindex="-1"></a>wt_ht_plot <span class="sc">+</span> </span>
<span id="cb16-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb16-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-3" aria-hidden="true" tabindex="-1"></a>          <span class="co"># size of title is 30</span></span>
<span id="cb16-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb16-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># right justify caption</span></span>
<span id="cb16-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb16-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-7" aria-hidden="true" tabindex="-1"></a>          <span class="co"># subtitle is italicised</span></span>
<span id="cb16-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb16-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>))</span></code></pre></div>
<p>If you ever want to remove an element of a plot, you can also do it through <code>theme()</code>! Just pass <code>element_blank()</code> to an argument in theme to have it disappear completely!</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Run <code>theme_get()</code> from <strong>ggplot2</strong> to print a list of all 90+ <code>theme()</code> options to the console.</span></p>
<!-- ======================================================= -->
</div>
<div id="colour-schemes" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Colour schemes</h2>
<p>One thing that can initially be difficult to understand with <code>ggplot2</code> is control of colour schemes when passing colour or fill as a variable rather than defining them explicitly within a geom. There are a few simple tricks that can be used to achieve this however. Remember that when setting colours, you can use colour names (as long as they are recognised) like <code>"red"</code>, or a specific hex colour such as <code>"#ff0505"</code>.</p>
<p>One of the most useful tricks is using manual scaling functions to explicitly define colours. These are functions with the syntax <code>scale_xxx_manual()</code> (e.g. <code>scale_colour_manual()</code> or <code>scale_fill_manual()</code>). In this function you can explicitly define which colours map to which value using the <code>values =</code> argument. You can control the legend title with the <code>name =</code> argument, and the order of factors with <code>breaks =</code>.</p>
<p>If you want predefined palettes, you can use the <code>scale_xxx_brewer</code> or <code>scale_xxx_viridis_y</code> functions.</p>
<p>The ‘brewer’ functions can draw from <a href="colorbrewer.org">colorbrewer.org</a> palettes.<br />
The ‘viridis’ functions draw from viridis (colourblind friendly!) palettes, which “provide colour maps that are perceptually uniform in both colour and black-and-white. They are also designed to be perceived by viewers with common forms of colour blindness.” (read more <a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">here</a> and <a href="https://bids.github.io/colormap/">here</a>). Define if the palette is discrete, continuous, or binned by specifying this at the end of the function (e.g. discrete is <code>scale_xxx_viridis_d</code>).</p>
<p>Test your image in this <a href="https://www.color-blindness.com/coblis-color-blindness-simulator/">color blindness simulator</a>. If you have a red/green color scheme, try a “hot-cold” (red-blue) scheme instead as described <a href="https://www.visualisingdata.com/2019/08/five-ways-to-design-for-red-green-colour-blindness/#:~:text=The%20pink%2Dred%20through%20to,green%20hues%20used%20by%20default.">here</a></p>
<p>We can see this by using the symptom-specific data frame we made in the previous section:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-1" aria-hidden="true" tabindex="-1"></a>symp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(linelist_sym, <span class="fu">aes</span>(<span class="at">x =</span> symptom_name, <span class="at">fill =</span> symptom_is_present)) <span class="sc">+</span></span>
<span id="cb17-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show as a portion of all</span></span>
<span id="cb17-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;fill&quot;</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Symptom&quot;</span>,</span>
<span id="cb17-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Symptom status (proportion)&quot;</span></span>
<span id="cb17-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb17-10" aria-hidden="true" tabindex="-1"></a>symp_plot</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-1" aria-hidden="true" tabindex="-1"></a>symp_plot <span class="sc">+</span></span>
<span id="cb18-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb18-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># explicitly define colours</span></span>
<span id="cb18-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb18-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;no&quot;</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb18-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;unknown&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb18-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># order the factors correctly</span></span>
<span id="cb18-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>, <span class="st">&quot;unknown&quot;</span>),</span>
<span id="cb18-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># legend has no title</span></span>
<span id="cb18-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb18-11" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb19-1" aria-hidden="true" tabindex="-1"></a>symp_plot <span class="sc">+</span></span>
<span id="cb19-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(</span>
<span id="cb19-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>, <span class="st">&quot;unknown&quot;</span>),</span>
<span id="cb19-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb19-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-3.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="change-order-of-discrete-variables" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Change order of discrete variables</h2>
<p>Changing the order that discrete variables appear in is often difficult to understand for people who are new to <code>ggplot2</code> graphs. It’s easy to understand how to do this however once you understand how <code>ggplot2</code> handles discrete variables under the hood. Generally speaking, if a discrete varaible is used, it is automatically converted to a <code>factor</code> type - which orders factors by alphabetical order by default. To handle this, you simply have to reorder the factor levels to reflect the order you would like them to appear in the chart. For more detailed information on how to reorder <code>factor</code> objects, see the factor section of the guide.</p>
<p>We can look at a common example using age groups - by default the 5-9 age group will be placed in the middle of the age groups (given alphabetical order), but we can move it behind the 0-4 age group of the chart by releveling the factors.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the instances of age_cat5 where data is missing</span></span>
<span id="cb20-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(linelist <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_cat5)),</span>
<span id="cb20-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-4" aria-hidden="true" tabindex="-1"></a>       <span class="co"># relevel the factor within the ggplot call (can do externally as well)</span></span>
<span id="cb20-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(age_cat5, <span class="st">&quot;5-9&quot;</span>, <span class="at">after =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb20-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">stat =</span> <span class="st">&quot;count&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age group&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Number of hospitalisations&quot;</span>,</span>
<span id="cb20-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Total hospitalisations by age group&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="multiple-plots" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Multiple plots</h2>
<p>Often its useful to show multiple graphs on one page, or one super-figure. There are a few ways to achieve this and a lot of packages that can help to facilitate it. However, while external packages are nice, it is often easier to use faceting as an alternative that is prebuilt into <code>ggplot2</code>. Faceting plots is extremely easy to do in terms of code, and produces plots with more predictable aesthetics - you wont have to wrangle legends and ensure that axes are aligned etc.</p>
<p>Faceting is a very specific way to obtain multiple plots - by definition, to facet you have to show the same type of plot in each facet, where every plot is specific to a level of a variable. This is done with one of two functions:</p>
<ol style="list-style-type: decimal">
<li><p><code>facet_wrap()</code> This is used when you want to show a different graph for each level of a <em>single</em> variable. One example of this could be showing a different epidemic curve for each hospital in a region.</p></li>
<li><p><code>facet_grid()</code> This is used when you want to bring a second variable into the faceting arrangement. Here each element of a grid is shows the intersection between an x or y element of a grid. For example, this could involve showing a different epidemic curve for each hospital in a region, shown horizontally, for each age group, shown vertically.</p></li>
</ol>
<p>This can quickly become an overwhelming amount of information - its good to ensure you don’t have too many levels of each variable that you choose to facet by! Here are some quick examples with the malaria dataset:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-1" aria-hidden="true" tabindex="-1"></a>malaria_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;malaria_facility_count_data.rds&quot;</span>)) </span>
<span id="cb21-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># show a wrapped plot with facets by district</span></span>
<span id="cb21-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot, <span class="at">fill =</span> District)) <span class="sc">+</span></span>
<span id="cb21-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;date of data collection&quot;</span>,</span>
<span id="cb21-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;malaria cases&quot;</span>,</span>
<span id="cb21-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Malaria cases by district&quot;</span></span>
<span id="cb21-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>District) <span class="sc">+</span></span>
<span id="cb21-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>We can also use a <code>facet_grid()</code> approach with the different age groups - we need to do some data transformations first however, as the age groups all are in their own columns - we want them in a single column. When you pass the two variables to <code>facet_grid()</code>, you can use formula notation (e.g. <code>x ~ y</code>) or wrap the variables in <code>vars()</code>. For reference, this: <code>facet_grid(x ~ y)</code> is equivalent to <code>facet_grid(rows = vars(x), cols = vars(y))</code> Here’s how we can do this:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-1" aria-hidden="true" tabindex="-1"></a>malaria_age <span class="ot">&lt;-</span> malaria_data <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb22-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># choose all the columns that start with malaria rdt (age group specific)</span></span>
<span id="cb22-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;malaria_rdt_&quot;</span>),</span>
<span id="cb22-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># column names become age group</span></span>
<span id="cb22-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;age_group&quot;</span>,</span>
<span id="cb22-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># values to a single column (num_cases)</span></span>
<span id="cb22-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;num_cases&quot;</span></span>
<span id="cb22-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean up age group column - replace &quot;malaria_rdt_&quot; to leave only age group</span></span>
<span id="cb22-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then replace 15 with 15+</span></span>
<span id="cb22-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then refactor the age groups so they are in order</span></span>
<span id="cb22-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">str_replace</span>(age_group, <span class="st">&quot;malaria_rdt_&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-14" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="st">&quot;15&quot;</span>, <span class="st">&quot;15+&quot;</span>, .) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-15" aria-hidden="true" tabindex="-1"></a>           forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(., <span class="st">&quot;5-14&quot;</span>, <span class="at">after =</span> <span class="dv">1</span>))</span>
<span id="cb22-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># make the same plot as before, but show in a grid</span></span>
<span id="cb22-19"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_age, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> num_cases, <span class="at">fill =</span> age_group)) <span class="sc">+</span></span>
<span id="cb22-20"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-21"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-22"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;date of data collection&quot;</span>,</span>
<span id="cb22-23"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;malaria cases&quot;</span>,</span>
<span id="cb22-24"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Malaria cases by district and age group&quot;</span></span>
<span id="cb22-25"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-26"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(District), <span class="at">cols =</span> <span class="fu">vars</span>(age_group)) <span class="sc">+</span></span>
<span id="cb22-27"><a href="plotting-with-ggplot-basics-and-tips.html#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>While faceting is a convenient approach to plotting, sometimes its not possible to get the results you want from its relatively restrictive approach. Here, you may choose to combine plots by sticking them together into a larger plot. There are three well known packages that are great for this - <code>cowplot</code>, <code>gridExtra</code>, and <code>patchwork</code>. However, these packages largely do the same things, so we’ll focus on <code>cowplot</code> for this section.</p>
<p>The <code>cowplot</code> package has a fairly wide range of functions, but the easiest use of it can be achieved through the use of <code>plot_grid()</code>. This is effectively a way to arrange predefined plots in a grid formation. We can work through another example with the malaria dataset - here we can plot the total cases by district, and also show the epidemic curve over time.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bar chart of total cases by district</span></span>
<span id="cb23-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> District, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;District&quot;</span>,</span>
<span id="cb23-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Total number of cases&quot;</span>,</span>
<span id="cb23-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Total malaria cases by district&quot;</span></span>
<span id="cb23-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb23-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># epidemic curve over time</span></span>
<span id="cb23-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Date of data submission&quot;</span>,</span>
<span id="cb23-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span>  <span class="st">&quot;number of cases&quot;</span></span>
<span id="cb23-17"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-18"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb23-19"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-20" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2,</span>
<span id="cb23-21"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-21" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># 1 column and two rows - stacked on top of each other</span></span>
<span id="cb23-22"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb23-23"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb23-24"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-24" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># top plot is 2/3 as tall as second</span></span>
<span id="cb23-25"><a href="plotting-with-ggplot-basics-and-tips.html#cb23-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="marginal-distributions" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Marginal distributions</h2>
<p>To show the distributions on the edges of a <code>geom_point()</code> scatterplot, you can use the <strong>ggExtra</strong> package and its function <code>ggMarginal()</code>. Save your original ggplot as an object, then pass it to <code>ggMarginal()</code> as shown below. Here are the key arguments:</p>
<ul>
<li>You must specify the <code>type =</code> as either “histogram”, “density” “boxplot”, “violin”, or “densigram”.<br />
</li>
<li>By default, marginal plots will appear for both axes. You can set <code>margins =</code> to “x” or “y” if you only want one.<br />
</li>
<li>Other optional arguments include <code>fill =</code> (bar color), <code>color =</code> (line color), <code>size =</code> (plot size relative to margin size, so larger number makes the marginal plot smaller).<br />
</li>
<li>You can provide other axis-specific arguments to <code>xparams =</code> and <code>yparams =</code>. For example, to have different histogram bin sizes, as shown below.</li>
</ul>
<p>You can have the marginal plots reflect groups (columns that have been assigned to <code>color =</code> in your <code>ggplot()</code> mapped aesthetics). If this is the case, set the <code>ggMarginal()</code> argument <code>groupColour =</code> or <code>groupFill =</code> to <code>TRUE</code>, as shown below.</p>
<p>Read more at <a href="https://cran.r-project.org/web/packages/ggExtra/vignettes/ggExtra.html">this vignette</a>, in the <a href="https://www.r-graph-gallery.com/277-marginal-histogram-for-ggplot2.html">R Graph Gallery</a> or the function R documentation <code>?ggMarginal</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install/load ggExtra</span></span>
<span id="cb24-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb24-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggExtra)</span>
<span id="cb24-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic scatter plot of weight and age</span></span>
<span id="cb24-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb24-5" aria-hidden="true" tabindex="-1"></a>scatter_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb24-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb24-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Scatter plot of weight and age&quot;</span>)</span></code></pre></div>
<p>To add marginal histograms:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with histograms</span></span>
<span id="cb25-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(</span>
<span id="cb25-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  scatter_plot,                     <span class="co"># add marginal histograms</span></span>
<span id="cb25-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,               <span class="co"># specify histograms</span></span>
<span id="cb25-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>,               <span class="co"># bar fill</span></span>
<span id="cb25-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="dv">10</span>),    <span class="co"># other parameters for x-axis marginal</span></span>
<span id="cb25-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">yparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="dv">5</span>))     <span class="co"># other parameters for y-axis marginal</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Marginal histograms with grouped/colored values:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot, colored by outcome</span></span>
<span id="cb26-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome column is assigned as color in ggplot. groupFill in ggMarginal set to TRUE</span></span>
<span id="cb26-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-3" aria-hidden="true" tabindex="-1"></a>scatter_plot_color <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb26-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age, <span class="at">color =</span> outcome)) <span class="sc">+</span></span>
<span id="cb26-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Scatter plot of weight and age&quot;</span>)<span class="sc">+</span></span>
<span id="cb26-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb26-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(scatter_plot_color, <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>, <span class="at">groupFill =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Marginal density curve, with demonstration of size and color arguments:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with density curves</span></span>
<span id="cb27-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(</span>
<span id="cb27-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  scatter_plot,</span>
<span id="cb27-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;density&quot;</span>,</span>
<span id="cb27-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,                    <span class="co"># line color</span></span>
<span id="cb27-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">4</span>)                         <span class="co"># smaller number makes larger marginal plots</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Marginal boxplots, with demonstration of the margins argument:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with boxplot </span></span>
<span id="cb28-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(</span>
<span id="cb28-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  scatter_plot,</span>
<span id="cb28-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">margins =</span> <span class="st">&quot;x&quot;</span>,      <span class="co"># only show x-axis marginal plot</span></span>
<span id="cb28-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;boxplot&quot;</span>)   </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="smart-labeling" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Smart Labeling</h2>
<p>In <code>ggplot2</code>, it is also possible to add text to plots. However, this comes with the notable limitation where text labels often clash with data points in a plot, making them look messy or hard to read. There is no ideal way to deal with this in the base package, but there is a <code>ggplot2</code> add-on, known as <code>ggrepel</code> that makes dealing with this very simple!</p>
<p>The <code>ggrepel</code> package provides two new functions, <code>geom_label_repel()</code> and <code>geom_text_repel()</code>, which replace <code>geom_label()</code> and <code>geom_text()</code>. Simply use these functions instead of the base functions to produce neat labels. Within the function, map the aesthetics <code>aes()</code> as always, but include the argument <code>label =</code> to which you provide a column name containing the values you want to display (e.g. patient id, or name, etc.). You can make more complex labels by combining columns and newlines (<code>\n</code>) within <code>str_glue()</code> as shown below.</p>
<p>A few tips:</p>
<ul>
<li>Use <code>min.segment.length = 0</code> to always draw line segments, or <code>min.segment.length = Inf</code> to never draw them<br />
</li>
<li>Use <code>size =</code> outside of <code>aes()</code> to set text size<br />
</li>
<li>Use <code>force =</code> to change the degree of repulsion between labels and their respective points (default is 1)<br />
</li>
<li>Include <code>fill =</code> within <code>aes()</code> to have label colored by value
<ul>
<li>A letter “a” may appear in the legend - add <code>guides(fill = guide_legend(override.aes = aes(color = NA)))+</code> to remove it</li>
</ul></li>
</ul>
<p>See this is very in-depth <a href="https://ggrepel.slowkow.com/articles/examples.html">tutorial</a> for more.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggrepel)</span>
<span id="cb29-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                                               <span class="co"># start with linelist</span></span>
<span id="cb29-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>                                   <span class="co"># group by hospital</span></span>
<span id="cb29-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(                                               <span class="co"># create new dataset with summary values per hospital</span></span>
<span id="cb29-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cases =</span> <span class="fu">n</span>(),                                           <span class="co"># number of cases per hospital</span></span>
<span id="cb29-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay_mean =</span> <span class="fu">round</span>(<span class="fu">mean</span>(days_onset_hosp, <span class="at">na.rm=</span>T),<span class="dv">1</span>),    <span class="co"># mean delay per hospital</span></span>
<span id="cb29-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n_cases, <span class="at">y =</span> delay_mean))<span class="sc">+</span>      <span class="co"># send data frame to ggplot</span></span>
<span id="cb29-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span>                                    <span class="co"># add points</span></span>
<span id="cb29-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(                                        <span class="co"># add point labels</span></span>
<span id="cb29-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb29-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(</span>
<span id="cb29-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;{hospital}</span><span class="sc">\n</span><span class="st">{n_cases} cases, {delay_mean} days&quot;</span>)  <span class="co"># how label displays</span></span>
<span id="cb29-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-15" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb29-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,                                              <span class="co"># text size in labels</span></span>
<span id="cb29-17"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.segment.length =</span> <span class="dv">0</span>)<span class="sc">+</span>                               <span class="co"># show all line segments                </span></span>
<span id="cb29-18"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(                                                    <span class="co"># add axes labels</span></span>
<span id="cb29-19"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Mean delay to admission, by hospital&quot;</span>,</span>
<span id="cb29-20"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Number of cases&quot;</span>,</span>
<span id="cb29-21"><a href="plotting-with-ggplot-basics-and-tips.html#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Mean delay (days)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>You can label only a subset of the data points - by using standard <code>ggplot()</code> syntax to provide different <code>data =</code> for each <code>geom</code> layer of the plot. Below, All cases are plotted, but only a few are labeled.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb30-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># All points in grey</span></span>
<span id="cb30-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb30-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> linelist,                                   <span class="co"># all data provided to this layer</span></span>
<span id="cb30-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ht_cm, <span class="at">y =</span> wt_kg),</span>
<span id="cb30-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb30-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span>                                              <span class="co"># grey and semi-transparent</span></span>
<span id="cb30-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Few points in black</span></span>
<span id="cb30-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb30-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(days_onset_hosp <span class="sc">&gt;</span> <span class="dv">15</span>),  <span class="co"># filtered data provided to this layer</span></span>
<span id="cb30-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ht_cm, <span class="at">y =</span> wt_kg),</span>
<span id="cb30-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>)<span class="sc">+</span>                                                <span class="co"># default black and not transparent</span></span>
<span id="cb30-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># point labels for few points</span></span>
<span id="cb30-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb30-17"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(days_onset_hosp <span class="sc">&gt;</span> <span class="dv">15</span>),  <span class="co"># filter the data for the labels</span></span>
<span id="cb30-18"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb30-19"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> ht_cm,</span>
<span id="cb30-20"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> wt_kg,</span>
<span id="cb30-21"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> outcome,                                          <span class="co"># label color by outcome</span></span>
<span id="cb30-22"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;Delay: {days_onset_hosp}d&quot;</span>)), <span class="co"># label created with str_glue()</span></span>
<span id="cb30-23"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.segment.length =</span> <span class="dv">0</span>) <span class="sc">+</span>                                  <span class="co"># show line segments for all</span></span>
<span id="cb30-24"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-25"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove letter &quot;a&quot; from inside legend boxes</span></span>
<span id="cb30-26"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">aes</span>(<span class="at">color =</span> <span class="cn">NA</span>)))<span class="sc">+</span></span>
<span id="cb30-27"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-28"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axis labels</span></span>
<span id="cb30-29"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-30"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Cases with long delay to admission&quot;</span>,</span>
<span id="cb30-31"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;weight (kg)&quot;</span>,</span>
<span id="cb30-32"><a href="plotting-with-ggplot-basics-and-tips.html#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;height(cm)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="time-axes" class="section level2" number="1.9">
<h2><span class="header-section-number">1.9</span> Time axes</h2>
<p>Working with time axes in ggplot can seem daunting, but is made very easy with a few key functions. Remember that when working with time or date that you should ensure that the correct variables are formatted as date or datetime class - see the [Working with dates] page for more information on this, or [Epidemic curves] page (ggplot section) for examples.</p>
<p>The single most useful set of functions for working with dates in <code>ggplot2</code> are the scale functions (<code>scale_x_date()</code>, <code>scale_x_datetime()</code>, and their cognate y-axis functions). These functions let you define how often you have axis labels, and how to format axis labels. To find out how to format dates, see the <em>working with dates</em> section again! You can use the <code>date_breaks</code> and <code>date_labels</code> arguments to specify how dates should look:</p>
<ol style="list-style-type: decimal">
<li><p><code>date_breaks</code> allows you to specify how often axis breaks occur - you can pass a string here (e.g. <code>"3 months"</code>, or "<code>2 days"</code>)</p></li>
<li><p><code>date_labels</code> allows you to define the format dates are shown in. You can pass a date format string to these arguments (e.g. <code>"%b-%d-%Y"</code>):</p></li>
</ol>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make epi curve by date of onset when available</span></span>
<span id="cb31-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(linelist, <span class="fu">aes</span>(<span class="at">x =</span> date_onset)) <span class="sc">+</span></span>
<span id="cb31-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;count&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb31-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1 break every 1 month</span></span>
<span id="cb31-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;1 months&quot;</span>,</span>
<span id="cb31-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># labels should show month then date</span></span>
<span id="cb31-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%b %d&quot;</span></span>
<span id="cb31-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="highlighting" class="section level2" number="1.10">
<h2><span class="header-section-number">1.10</span> Highlighting</h2>
<p>Highlighting specific elements in a chart is a useful way to draw attention to a specific instance of a variable while also providing information on the dispersion of the full dataset. While this is not easily done in base <code>ggplot2</code>, there is an external package that can help to do this known as <code>gghighlight</code>. This is easy to use within the ggplot syntax.</p>
<p>The <code>gghighlight</code> package uses the <code>gghighlight()</code> function to achieve this effect. To use this function, supply a logical statement to the function - this can have quite flexible outcomes, but here we’ll show an example of the age distribution of cases in our linelist, highlighting them by outcome.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load gghighlight</span></span>
<span id="cb32-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb32-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NA values with unknown in the outcome variable</span></span>
<span id="cb32-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-5" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">replace_na</span>(outcome, <span class="st">&quot;Unknown&quot;</span>))</span>
<span id="cb32-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># produce a histogram of all cases by age</span></span>
<span id="cb32-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb32-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist,</span>
<span id="cb32-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age_years, <span class="at">fill =</span> outcome)) <span class="sc">+</span></span>
<span id="cb32-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb32-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb32-13" aria-hidden="true" tabindex="-1"></a>  gghighlight<span class="sc">::</span><span class="fu">gghighlight</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>)     <span class="co"># highlight instances where the patient has died.</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>This also works well with faceting functions - it allows the user to produce facet plots with the background data highlighted that doesn’t apply to the facet!</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># produce a histogram of all cases by age</span></span>
<span id="cb33-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb33-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist,</span>
<span id="cb33-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age_years, <span class="at">fill =</span> outcome)) <span class="sc">+</span></span>
<span id="cb33-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span>                                <span class="co"># make the histogram</span></span>
<span id="cb33-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  gghighlight<span class="sc">::</span><span class="fu">gghighlight</span>() <span class="sc">+</span>                      <span class="co"># highlight instances where the patient has died</span></span>
<span id="cb33-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>outcome)                              <span class="co"># make facets by outcome</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="dual-axes" class="section level2" number="1.11">
<h2><span class="header-section-number">1.11</span> Dual axes</h2>
<p>A secondary y-axis is often a requested addition to a <code>ggplot2</code> graph. While there is a robust debate about the validity of such graphs in the data visualization community, and they are often not recommended, your manager may still want them. Below, we present two methods to achieve them.</p>
<ol style="list-style-type: decimal">
<li>Using the <strong>cowplot</strong> package to combine two separate plots<br />
</li>
<li>Using a statistical transformation of the data on the primary axis</li>
</ol>
<div id="using-cowplot" class="section level3 unnumbered">
<h3>Using <strong>cowplot</strong></h3>
<p>This approach involves creating two separate plots - one with a y-axis on the left, and the other with y-axis on the right. Both will use a specific <code>theme_cowplot()</code> and must have the same x-axis. Then in a third command the two plots are aligned and overlaid on top of each other. The functionalities of <strong>cowplot</strong>, of which this is only one, are described in depth at this <a href="https://wilkelab.org/cowplot/articles/aligning_plots.html">site</a>.</p>
<p>To demonstrate this technique we will overlay the epidemic curve with a line of the weekly percent of patients who died. We use this example because the alignment of dates on the x-axis is more complex than say, aligning a bar chart with another plot. Some things to note:</p>
<ul>
<li>The epicurve and the line are aggregated into weeks prior to plotting <em>and</em> the <code>date_breaks</code> and <code>date_labels</code> are identical - we do this so that the x-axes of the two plots are the same when they are overlaid.<br />
</li>
<li>The y-axis is moved to the right-side for plot 2 with the <code>position =</code> argument of <code>scale_y_continuous()</code>.<br />
</li>
<li>Both plots make use of <code>theme_cowplot()</code></li>
</ul>
<p>Note there is another example of this technique in the [Epicurves] page - overlaying cumulative incidence on top of the epicurve.</p>
<p><strong>Make plot 1</strong><br />
This is essentially the epicurve. We use <code>geom_area()</code> just to demonstrate its use (area under a line, by default)</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(cowplot)            <span class="co"># load/install cowplot</span></span>
<span id="cb34-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                 <span class="co"># save plot as object</span></span>
<span id="cb34-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">count</span>(</span>
<span id="cb34-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">epiweek =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date_onset, <span class="st">&quot;week&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb34-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">x =</span> epiweek, <span class="at">y =</span> n), <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_date</span>(</span>
<span id="cb34-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">&quot;month&quot;</span>,</span>
<span id="cb34-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">&quot;%b&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_cowplot</span>()<span class="sc">+</span></span>
<span id="cb34-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">labs</span>(</span>
<span id="cb34-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Weekly cases&quot;</span></span>
<span id="cb34-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-14" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb34-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb34-16" aria-hidden="true" tabindex="-1"></a>p1                                      <span class="co"># view plot </span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p><strong>Make plot 2</strong><br />
Create the second plot showing a line of the weekly percent of cases who died.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>         <span class="co"># save plot as object</span></span>
<span id="cb35-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(</span>
<span id="cb35-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">epiweek =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date_onset, <span class="st">&quot;week&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarise</span>(</span>
<span id="cb35-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb35-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">pct_death =</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>, <span class="at">na.rm=</span>T) <span class="sc">/</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> epiweek, <span class="at">y =</span> pct_death))<span class="sc">+</span></span>
<span id="cb35-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb35-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_date</span>(</span>
<span id="cb35-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">&quot;month&quot;</span>,</span>
<span id="cb35-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">&quot;%b&quot;</span>)<span class="sc">+</span></span>
<span id="cb35-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(</span>
<span id="cb35-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="st">&quot;right&quot;</span>)<span class="sc">+</span></span>
<span id="cb35-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_cowplot</span>()<span class="sc">+</span></span>
<span id="cb35-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(</span>
<span id="cb35-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="st">&quot;Epiweek of symptom onset&quot;</span>,</span>
<span id="cb35-17"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">&quot;Weekly percent of deaths&quot;</span>,</span>
<span id="cb35-18"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">&quot;Weekly case incidence and percent deaths&quot;</span></span>
<span id="cb35-19"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-19" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb35-20"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="plotting-with-ggplot-basics-and-tips.html#cb35-21" aria-hidden="true" tabindex="-1"></a>p2     <span class="co"># view plot</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Now we align the plot using the function <code>align_plots()</code>, specifying horizontal and vertical alignment (“hv”, could also be “h”, “v”, “none”). We specify alignment of all axes as well (top, bottom, left, and right) with “tblr”. The output is of class list (2 elements).</p>
<p>Then we draw the two plots together using <code>ggdraw()</code> (from <strong>cowplot</strong>) and referencing the two parts of the <code>aligned_plots</code> object.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb36-1" aria-hidden="true" tabindex="-1"></a>aligned_plots <span class="ot">&lt;-</span> <span class="fu">align_plots</span>(p1, p2, <span class="at">align=</span><span class="st">&quot;hv&quot;</span>, <span class="at">axis=</span><span class="st">&quot;tblr&quot;</span>)                  <span class="co"># align the two plots and save them as list</span></span>
<span id="cb36-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb36-2" aria-hidden="true" tabindex="-1"></a>aligned_plotted <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>(aligned_plots[[<span class="dv">1</span>]]) <span class="sc">+</span> <span class="fu">draw_plot</span>(aligned_plots[[<span class="dv">2</span>]])  <span class="co"># overlay them and save the visual plot</span></span>
<span id="cb36-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb36-3" aria-hidden="true" tabindex="-1"></a>aligned_plotted                                                                <span class="co"># print the overlayed plots</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
</div>
<div id="statistical-transformation" class="section level3 unnumbered">
<h3>Statistical transformation</h3>
<p>Unfortunately, secondary axes are not well supported in the <code>ggplot</code> syntax. For this reason, you’re fairly limited in terms of what can be shown with a secondary axis - the second axis has to be a direct transformation of the secondary axis.</p>
<p>Differences in axis values will be purely cosmetic - if you want to show two different variables on one graph, with different y-axis scales for each variable, this will not work without some work behind the scenes. To obtain this effect, you will have to transform one of your variables in the data, and apply the same transformation <em>in reverse</em> when specifying the axis labels. Based on this, you can either specify the transformation explicitly (e.g. variable a is around 10x as large as variable b) or calculate it in the code (e.g. what is the ratio between the maximum values of each dataset).</p>
<p>The syntax for adding a secondary axis is very straightforward! When calling a <code>scale_xxx_xxx()</code> function (e.g. <code>scale_y_continuous()</code>), use the <code>sec.axis</code> argument to call the <code>sec_axis()</code> function. The <code>trans</code> argument in this function allows you to specify the label transformation for the axis - provide this in standard tidyverse syntax.</p>
<p>For example, if we want to show the number of positive RDTs in the malaria dataset for facility 1, showing 0-4 year olds and all cases on chart:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take malaria data from facility 1</span></span>
<span id="cb37-2"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-2" aria-hidden="true" tabindex="-1"></a>malaria_facility_1 <span class="ot">&lt;-</span> malaria_data <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location_name <span class="sc">==</span> <span class="st">&quot;Facility 1&quot;</span>)</span>
<span id="cb37-4"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the ratio between malaria_rdt_0-4 and malaria_tot </span></span>
<span id="cb37-6"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-7" aria-hidden="true" tabindex="-1"></a>tf_ratio <span class="ot">&lt;-</span> <span class="fu">max</span>(malaria_facility_1<span class="sc">$</span>malaria_tot, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">max</span>(malaria_facility_1<span class="sc">$</span><span class="st">`</span><span class="at">malaria_rdt_0-4</span><span class="st">`</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb37-8"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># transform the values in the dataset</span></span>
<span id="cb37-10"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-11" aria-hidden="true" tabindex="-1"></a>malaria_facility_1 <span class="ot">&lt;-</span> malaria_facility_1 <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">malaria_rdt_0_4_tf =</span> <span class="st">`</span><span class="at">malaria_rdt_0-4</span><span class="st">`</span> <span class="sc">*</span> tf_ratio)</span>
<span id="cb37-13"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-14"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the graph with dual axes</span></span>
<span id="cb37-16"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_facility_1, <span class="fu">aes</span>(<span class="at">x =</span> data_date)) <span class="sc">+</span></span>
<span id="cb37-18"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> malaria_tot, <span class="at">col =</span> <span class="st">&quot;Total cases&quot;</span>)) <span class="sc">+</span></span>
<span id="cb37-19"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> malaria_rdt_0_4_tf, <span class="at">col =</span> <span class="st">&quot;Cases: 0-4 years old&quot;</span>)) <span class="sc">+</span></span>
<span id="cb37-20"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb37-21"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Total cases&quot;</span>,</span>
<span id="cb37-22"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span> . <span class="sc">/</span> tf_ratio, <span class="at">name =</span> <span class="st">&quot;Cases: 0-4 years old&quot;</span>)</span>
<span id="cb37-23"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-24"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;date of data collection&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-25"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-26"><a href="plotting-with-ggplot-basics-and-tips.html#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
</div>
</div>
<div id="combine-plots" class="section level2" number="1.12">
<h2><span class="header-section-number">1.12</span> Combine plots</h2>
<p>UNDER CONSTRUCTION</p>
<p><strong>cowplot</strong></p>
<p><strong>patchwork</strong></p>
</div>
<div id="packages-to-help-you" class="section level2" number="1.13">
<h2><span class="header-section-number">1.13</span> Packages to help you</h2>
<p>UNDER CONSTRUCTION</p>
<p>There are some really neat R packages specifically designed to help you navigate <strong>ggplot2</strong>:</p>
<div id="gghelp-from-ggx" class="section level3" number="1.13.1">
<h3><span class="header-section-number">1.13.1</span> <code>gghelp()</code> from <strong>ggx</strong></h3>
<p>Converts a normal language query into a ggplot command.</p>
<p><a href="https://rdrr.io/github/brandmaier/ggx/man/gghelp.html" class="uri">https://rdrr.io/github/brandmaier/ggx/man/gghelp.html</a></p>
</div>
<div id="point-and-click-with-equisse" class="section level3" number="1.13.2">
<h3><span class="header-section-number">1.13.2</span> Point-and-click with <strong>equisse</strong></h3>
<p><a href="https://github.com/dreamRs/esquisse" class="uri">https://github.com/dreamRs/esquisse</a></p>
<p>“This addin allows you to interactively explore your data by visualizing it with the ggplot2 package. It allows you to draw bar plots, curves, scatter plots, histograms, boxplot and sf objects, then export the graph or retrieve the code to reproduce the graph.”</p>
<p>Documentation:<a href="https://dreamrs.github.io/esquisse/index.html" class="uri">https://dreamrs.github.io/esquisse/index.html</a></p>
<p>Install and then launch the addin via the RStudio menu or with <code>esquisse::esquisser()</code>.</p>
</div>
</div>
<div id="miscellaneous" class="section level2" number="1.14">
<h2><span class="header-section-number">1.14</span> Miscellaneous</h2>
<div id="numeric-display" class="section level3 unnumbered">
<h3>Numeric display</h3>
<p>You can disable scientific notation by running this command prior to plotting.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span></code></pre></div>
<p>Or apply <code>number_format()</code> from the <strong>scales</strong> package to a specific value or column, as shown below.</p>
<p>Use functions from the package <strong>scales</strong> to easily adjust how numbers are displayed. These can be applied to columns in your data frame, but are shown on individual numbers for purpose of example.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb39-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">number</span>(<span class="fl">6.2e5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;620 000&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb41-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">number</span>(<span class="fl">1506800.62</span>,  <span class="at">accuracy =</span> <span class="fl">0.1</span>,)</span></code></pre></div>
<pre><code>## [1] &quot;1 506 800.6&quot;</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb43-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fl">1506800.62</span>, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1,506,800.62&quot;</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb45-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fl">1506800.62</span>, <span class="at">accuracy =</span> <span class="fl">0.01</span>,  <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span> , <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1.506.800,62&quot;</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb47-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;10%&quot;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb49-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="dv">56</span>)</span></code></pre></div>
<pre><code>## [1] &quot;$56&quot;</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="plotting-with-ggplot-basics-and-tips.html#cb51-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">scientific</span>(<span class="dv">100000</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1e+05&quot;</code></pre>
</div>
</div>
<div id="resources" class="section level2" number="1.15">
<h2><span class="header-section-number">1.15</span> Resources</h2>
<p>Inspiration
<a href="https://www.tidyverse.org/blog/2018/07/ggplot2-3-0-0/">ggplot graph gallery</a></p>
<p>Presentation of data
European Centre for Disease Prevention and Control <a href="https://ecdc.europa.eu/sites/portal/files/documents/Guidelines%20for%20presentation%20of%20surveillance%20data-final-with-cover-for-we....pdf">Guidelines of presentation of surveillance data</a></p>
<p>Facets and labellers
<a href="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/#modifying-facet-label-text">Using labellers for facet strips</a>
<a href="https://ggplot2.tidyverse.org/reference/labellers.html">Labellers</a></p>
<p>Adjusting order with factors
<a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a><br />
<a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a><br />
<a href="https://cmdlinetips.com/2019/02/how-to-reorder-a-boxplot-in-r/">How to reorder a boxplot</a><br />
<a href="https://www.r-graph-gallery.com/267-reorder-a-variable-in-ggplot2.html">Reorder a variable in ggplot2</a><br />
<a href="https://r4ds.had.co.nz/factors.html">R for Data Science - Factors</a></p>
<p>Legends<br />
<a href="https://stackoverflow.com/questions/38425908/reverse-stacking-order-without-affecting-legend-order-in-ggplot2-bar-charts">Adjust legend order</a></p>
<p>Captions
<a href="https://stackoverflow.com/questions/64701500/left-align-ggplot-caption">Caption alignment</a></p>
<p>Labels<br />
<a href="https://ggrepel.slowkow.com/articles/examples.html">ggrepel</a></p>
<p>Cheatsheets<br />
<a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/">Beautiful plotting with ggplot2</a></p>
<p>TO DO - Under construction</p>
<ul>
<li>Straight horizontal, vertical, or other line</li>
</ul>
<p>You can also add straight lines to your plot with <code>geom_hline()</code> (horizontal), <code>geom_vline()</code> (vertical) or <code>geom_abline()</code> (with a specified y intercept and slope)</p>
<p>Using option <code>label_wrap_gen</code> in facet_wrap to have multiple strip lines
labels and colors of strips</p>
<p>Axis text vertical adjustment
rotation
Labellers</p>
<p>limit range with limit() and coord_cartesian(), ylim(), or scale_x_continuous()
theme_classic()</p>
<p>expand = c(0,0)
coord_flip()
tick marks</p>
<p>ggrepel
animations</p>
<p>remove
remove title
using fill = or color = in labs()
flip order / don’t flip order
move location
color? theme(legend.title = element_text(colour=“chocolate”, size=16, face=“bold”))+ scale_color_discrete(name=“This color ischocolate!?”)
Color of boxes behind points in legend
theme(legend.key=element_rect(fill=‘pink’)) or use fill = NA to remove them. <a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/" class="uri">http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/</a>
Change size of symbols in legend only guides(colour = guide_legend(override.aes = list(size=4)))</p>
<p>Turn off a layer in the legend
geom_text(data=nmmaps, aes(date, temp, label=round(temp)), size=4)
geom_text(data=nmmaps, aes(date, temp, label=round(temp), size=4), show_guide=FALSE)</p>
<p>Force a legend even if there is no aes().
ggplot(nmmaps, aes(x=date, y=o3))+
geom_line(aes(color=“Important line”))+
geom_point(aes(color=“My points”))
Control the shape in the legend with guides - a list with linetype and shape
ggplot(nmmaps, aes(x=date, y=o3))+geom_line(aes(color=“Important line”))+
geom_point(aes(color=“Point values”))+
scale_colour_manual(name=’‘, values=c(’Important line’=‘grey’, ‘Point values’=‘red’), guide=‘legend’) +
guides(colour = guide_legend(override.aes = list(linetype=c(1,0)
, shape=c(NA, 16))))</p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-04-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
