<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1 Organizing routine reports | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Preview pages</li>
<li><a class="active" href="organizing-routine-reports.html"><span class="header-section-number">1</span> Organizing routine reports</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="organizing-routine-reports" class="section level1" number="1">
<h1>
<span class="header-section-number">1</span> Organizing routine reports<a class="anchor" aria-label="anchor" href="#organizing-routine-reports"><i class="fas fa-link"></i></a>
</h1>
<p>This page will cover the <strong>reportfactory</strong> package. <strong>reportfactory</strong> is a package developed by RECON (R Epidemics Consortium).</p>
<p><strong>reportfactory</strong> is an <em>accompaniment to using R Markdowns for reports</em>. It is built for scenarios where you are running routine reports (daily, weekly, etc.). It makes easier the organization and compilation of multiple R Markdown files and their outputs. In essence, it provides a “factory” from which you can run the R Markdown reports, get automatically organized date- and time-stamped folders for the outputs, and have “light” version control.</p>
<div id="preparation" class="section level2" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation"><i class="fas fa-link"></i></a>
</h2>
<div id="load-packages" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages"><i class="fas fa-link"></i></a>
</h3>
<p>From within the open R project, install and/or load the <strong>reportfactory</strong> package from CRAN.</p>
<p>In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load packages with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> from <strong>base</strong> R. See the page on [R basics] for more information on R packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">reportfactory</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="new-factory" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> New factory<a class="anchor" aria-label="anchor" href="#new-factory"><i class="fas fa-link"></i></a>
</h2>
<p>To create a new factory, run the function <code>new_factory()</code>. This will create a new self-contained R project folder. By default:</p>
<ul>
<li>The factory will be added to your working directory</li>
<li>The name of the factory R project will be called “new_factory.Rproj”<br>
</li>
<li>Your RStudio session will “move in” to this R project</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This will create the factory in the working directory</span>
<span class="fu">new_factory</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Of the default settings, below are several that you might want to adjust within the <code>new_factory()</code> command:</p>
<ul>
<li>
<code>factory =</code> - You can provide a name for the factory folder. The default is as shown above: “new_factory”.<br>
</li>
<li>
<code>path =</code> - You can designate a file path for the new factory. The default is the working directory.<br>
</li>
<li>
<code>report_sources =</code> You can provide an alternate name for the folder which holds the R Markdown scripts that create the reports. The default is “report_sources”.<br>
</li>
<li>
<code>outputs =</code> You can provide an alternate name for the folder which holds the output reports. The default is “outputs”.</li>
</ul>
<p>See <code>?new_factory</code> for a complete list of the arguments.</p>
</div>
<div id="review-the-factory" class="section level2" number="1.3">
<h2>
<span class="header-section-number">1.3</span> Review the factory<a class="anchor" aria-label="anchor" href="#review-the-factory"><i class="fas fa-link"></i></a>
</h2>
<p>Looking inside the “new_factory” folder we can see that sub-folders and files were created automatically.</p>
<div class="inline-figure"><img src="images/factory_new2.png" width="424"></div>
<ul>
<li>The <em>report_sources</em> folder will hold your R Markdown scripts, which generate your reports<br>
</li>
<li>The <em>outputs</em> folder will hold the report outputs (e.g. HTML, Word, PDF, etc.) - it will store them in automatically-generated sub-folders organized by report and date-time stamp<br>
</li>
<li>The <em>scripts</em> folder can be used to store other R scripts (e.g. that are sourced by your Rmd scripts)<br>
</li>
<li>The <em>data</em> folder can be used to hold your data (“raw” and “clean” subfolders are included)<br>
</li>
<li>A <em>.here</em> file, so you can use the <strong>here</strong> package to call files in the sub-folders by their relation to this root folder (see [R projects] page for details)<br>
</li>
<li>A <em>gitignore</em> file was created in case you link this R project to a Github repository (see [Version control and collaboration with Github])<br>
</li>
<li>An empty README file, for if you use a Github repository</li>
</ul>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> depending on your computer’s setting, files such as “.here” may be invisible.</span></p>
<p>When you create the new factory, your R session was transferred to the new R project, so you should <em>again</em> load the <strong>reportfactory</strong> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">reportfactory</span><span class="op">)</span></code></pre></div>
<p>Now you can run a command to see the internal structure (all folders and files) in the factory.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">factory_overview</span><span class="op">(</span><span class="op">)</span>            <span class="co"># print overview of the factory to console</span></code></pre></div>
<p>The following “tree” of the factory’s folders and files is printed to the R console. Note that in the “data” folder there are sub-folders for “raw” and “clean” data, and example CSV data. There is also “example_report.Rmd” in the “report_sources” folder.</p>
<div class="inline-figure"><img src="images/factory_overview.png" width="202"></div>
</div>
<div id="create-a-report" class="section level2" number="1.4">
<h2>
<span class="header-section-number">1.4</span> Create a report<a class="anchor" aria-label="anchor" href="#create-a-report"><i class="fas fa-link"></i></a>
</h2>
<p>From within the factory R project, create a R Markdown report just as you would normally. See the [R Markdown][Reports with R Markdown] page for instructions. For purposes of example, we have added the following to the factory:</p>
<ul>
<li>A new R markdown script entitled “daily_sitrep.Rmd”, saved within the “report_sources” folder<br>
</li>
<li>Data for the report (“linelist_cleaned.rds”), saved to the “clean” sub-folder within the “data” folder</li>
</ul>
<p>We can see using <code>factory_overview()</code> our R Markdown in the “report_sources” folder and the data file in the “clean” data folder (highlighted):</p>
<div class="inline-figure"><img src="images/factory_overview2.png" width="149"></div>
<p>Below is a screenshot of the beginning of the R Markdown “daily_sitrep.Rmd”. You can see that the output format is set to be HTML, via the YAML header <code>output: html_document</code>.</p>
<div class="inline-figure"><img src="images/factory_new_rmd.png" width="420"></div>
<p>In this simple script, there are commands to:</p>
<ul>
<li>Load necessary packages<br>
</li>
<li>Import the linelist data using a filepath from the <strong>here</strong> package (read more in the page on [Import and export])</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"clean"</span>, <span class="st">"linelist_cleaned.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>Print a summary table of cases, and export it with <code>export()</code> as a .csv file<br>
</li>
<li>Print an epicurve, and export it with <code>ggsave()</code> as a .png file</li>
</ul>
<p>You can review just the list of R Markdown reports in the “report_sources” folder with this command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">list_reports</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="compile" class="section level2" number="1.5">
<h2>
<span class="header-section-number">1.5</span> Compile<a class="anchor" aria-label="anchor" href="#compile"><i class="fas fa-link"></i></a>
</h2>
<p>In a report factory, to “compile” a R Markdown report means that the .Rmd script will be run and the output will be produced (as specified in the script YAML e.g. as HTML, Word, PDF, etc).</p>
<p>Furthermore, the factory will auto-create a date- and time-stamped folder for the outputs in the “outputs” folder. The report itself and any exported files produced in the script (e.g. csv, png, xlsx) will be saved into this folder. In addition, the Rmd script itself will be saved in this folder, so you have a record of that version of the script.</p>
<p>This contrasts with the normal behavior of a “knitted” R Markdown, which saves outputs to the location of the Rmd script. This default behavior can result in crowded, messy folders. The factory aims to improve organization when one needs to run reports frequently.</p>
<div id="compile-by-name" class="section level3 unnumbered">
<h3>Compile by name<a class="anchor" aria-label="anchor" href="#compile-by-name"><i class="fas fa-link"></i></a>
</h3>
<p>You can compile a specific report by running <code>compile_reports()</code> and providing the Rmd script name (without .Rmd extension) to <code>reports =</code>. For simplicity, you can skip the <code>reports =</code> and just write the R Markdown name in quotes, as below.</p>
<div class="inline-figure"><img src="images/factory_compile1.png" width="271"></div>
<p>This command would compile only the “daily_sitrep.Rmd” report, saving the HTML report, and the .csv table and .png epicurve exports into a date- and time-stamped sub-folder specific to the report, within the “outputs” folder.</p>
<p>Note that if you choose to provide the .Rmd extension, you must correctly type the extension as it is saved in the file name (.rmd vs. .Rmd).</p>
<p>Also note that when you compile, you may see several files temporarily appear in the “report_sources” folder - but they will soon disappear as they are transferred to the correct “outputs” folder.</p>
</div>
<div id="compile-by-number" class="section level3 unnumbered">
<h3>Compile by number<a class="anchor" aria-label="anchor" href="#compile-by-number"><i class="fas fa-link"></i></a>
</h3>
<p>You can also specify the Rmd script to compile by providing a number or vector of numbers to <code>reports =</code>. The numbers must align with the order the reports appear when you run <code>list_reports()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compile the second and fourth Rmds in the "report_sources" folder</span>
<span class="fu">compile_reports</span><span class="op">(</span>reports <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="compile-all" class="section level3 unnumbered">
<h3>Compile all<a class="anchor" aria-label="anchor" href="#compile-all"><i class="fas fa-link"></i></a>
</h3>
<p>You can compile <em>all</em> the R Markdown reports in the “report_sources” folder by setting the <code>reports =</code> argument to TRUE.</p>
<div class="inline-figure"><img src="images/factory_compile_all.png" width="268"></div>
</div>
<div id="compile-from-sub-folder" class="section level3 unnumbered">
<h3>Compile from sub-folder<a class="anchor" aria-label="anchor" href="#compile-from-sub-folder"><i class="fas fa-link"></i></a>
</h3>
<p>You can add sub-folders to the “report_sources” folder. To run an R Markdown report from a subfolder, simply provide the name of the folder to <code>subfolder =</code>. Below is an example of code to compile a Rmd report that lives in a sub_folder of “report_sources”.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">compile_reports</span><span class="op">(</span>
     reports <span class="op">=</span> <span class="st">"summary_for_partners.Rmd"</span>,
     subfolder <span class="op">=</span> <span class="st">"for_partners"</span><span class="op">)</span></code></pre></div>
<p>You can compile all Rmd reports within a subfolder by providing the subfolder name to <code>reports =</code>, with a slash on the end, as below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">compile_reports</span><span class="op">(</span>reports <span class="op">=</span> <span class="st">"for_partners/"</span><span class="op">)</span></code></pre></div>
</div>
<div id="parameterization" class="section level3 unnumbered">
<h3>Parameterization<a class="anchor" aria-label="anchor" href="#parameterization"><i class="fas fa-link"></i></a>
</h3>
<p>As noted in the page on [R Markdown reports], you can run reports with specified parameters. You can pass these parameters as a list to <code>compile_reports()</code> via the <code>params =</code> argument. For example, in this fictional report there are three parameters provided to the R Markdown reports.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">compile_reports</span><span class="op">(</span>
  reports <span class="op">=</span> <span class="st">"daily_sitrep.Rmd"</span>,
  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>most_recent_data <span class="op">=</span> <span class="cn">TRUE</span>,
                region <span class="op">=</span> <span class="st">"NORTHERN"</span>,
                rates_denominator <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span>,
  subfolder <span class="op">=</span> <span class="st">"regional"</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="outputs" class="section level2" number="1.6">
<h2>
<span class="header-section-number">1.6</span> Outputs<a class="anchor" aria-label="anchor" href="#outputs"><i class="fas fa-link"></i></a>
</h2>
<p>After we have compiled the reports are few times, the “outputs” folder might look like this (highlights added for clarity):</p>
<div class="inline-figure"><img src="images/factory_overview_all.png" width="350"></div>
<ul>
<li>Within “outputs”, sub-folders have been created for each Rmd report<br>
</li>
<li>Within those, further sub-folders have been created for each unique compiling
<ul>
<li>These are date- and time-stamped (“2021-04-23_T11-07-36” means 23rd April 2021 at 11:07:36)<br>
</li>
<li>You can edit the date/time-stamp format. See <code>?compile_reports</code>
</li>
</ul>
</li>
<li>Within each date/time compiled folder, the report output is stored (e.g. HTML, PDF, Word) along with the Rmd script (version control!) and any other exported files (e.g. table.csv, epidemic_curve.png)</li>
</ul>
<p>Here is a view inside one of the date/time-stamped folders, for the “daily_sitrep” report. The file path is highlighted in yellow for emphasis.</p>
<div class="inline-figure"><img src="images/factory_compile_folder.png" width="435"></div>
<p>Finally, below is a screenshot of the HTML report output.</p>
<div class="inline-figure"><img src="images/factory_html.png" width="452"></div>
<p>You can use <code>list_outputs()</code> to review a list of the outputs.</p>
</div>
<div id="miscellaneous" class="section level2" number="1.7">
<h2>
<span class="header-section-number">1.7</span> Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"><i class="fas fa-link"></i></a>
</h2>
<div id="knit" class="section level3 unnumbered">
<h3>Knit<a class="anchor" aria-label="anchor" href="#knit"><i class="fas fa-link"></i></a>
</h3>
<p>You can still “knit” one of your R Markdown reports by pressing the “Knit” button, if you want. If you do this, as by default, the outputs will appear in the folder where the Rmd is saved - the “report_sources” folder. In prior versions of <strong>reportfactory</strong>, having any non-Rmd files in “report_sources” would prevent compiling, but this is no longer the case. You can run <code>compile_reports()</code> and no error will occur.</p>
</div>
<div id="scripts" class="section level3 unnumbered">
<h3>Scripts<a class="anchor" aria-label="anchor" href="#scripts"><i class="fas fa-link"></i></a>
</h3>
<p>We encourage you to utilize the “scripts” folder to store “runfiles” or .R scripts that are sourced by your .Rmd scripts. See the page on [R Markdown][Reports with R Markdown] for tips on how to structure your code across several files.</p>
</div>
<div id="extras" class="section level3 unnumbered">
<h3>Extras<a class="anchor" aria-label="anchor" href="#extras"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>With <strong>reportfactory</strong>, you can use the function <code>list_deps()</code> to list all packages required across all the reports in the entire factory.</p></li>
<li>
<p>There is an accompanying package in development called <strong>rfextras</strong> that offers more helper functions to assist you in building reports, such as:</p>
<ul>
<li>
<code>load_scripts()</code> - sources/loads all .R scripts in a given folder (the “scripts” folder by default)<br>
</li>
<li>
<code>find_latest()</code> - finds the latest version of a file (e.g. the latest dataset)</li>
</ul>
</li>
</ul>
<!-- ======================================================= -->
</div>
</div>
<div id="resources" class="section level2" number="1.8">
<h2>
<span class="header-section-number">1.8</span> Resources<a class="anchor" aria-label="anchor" href="#resources"><i class="fas fa-link"></i></a>
</h2>
<p>See the <strong>reportfactory</strong> package’s <a href="https://github.com/reconverse/reportfactory">Github page</a></p>
<p>See the <strong>rfextras</strong> package’s <a href="https://github.com/reconhub/rfextras">Github page</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html"></a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#organizing-routine-reports"><span class="header-section-number">1</span> Organizing routine reports</a></li>
<li>
<a class="nav-link" href="#preparation"><span class="header-section-number">1.1</span> Preparation</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#load-packages">Load packages</a></li></ul>
</li>
<li><a class="nav-link" href="#new-factory"><span class="header-section-number">1.2</span> New factory</a></li>
<li><a class="nav-link" href="#review-the-factory"><span class="header-section-number">1.3</span> Review the factory</a></li>
<li><a class="nav-link" href="#create-a-report"><span class="header-section-number">1.4</span> Create a report</a></li>
<li>
<a class="nav-link" href="#compile"><span class="header-section-number">1.5</span> Compile</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#compile-by-name">Compile by name</a></li>
<li><a class="nav-link" href="#compile-by-number">Compile by number</a></li>
<li><a class="nav-link" href="#compile-all">Compile all</a></li>
<li><a class="nav-link" href="#compile-from-sub-folder">Compile from sub-folder</a></li>
<li><a class="nav-link" href="#parameterization">Parameterization</a></li>
</ul>
</li>
<li><a class="nav-link" href="#outputs"><span class="header-section-number">1.6</span> Outputs</a></li>
<li>
<a class="nav-link" href="#miscellaneous"><span class="header-section-number">1.7</span> Miscellaneous</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#knit">Knit</a></li>
<li><a class="nav-link" href="#scripts">Scripts</a></li>
<li><a class="nav-link" href="#extras">Extras</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources"><span class="header-section-number">1.8</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-04-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
