---
title:  |  
  ![](../images/R Handbook Logo.png)
author: ""
date: "Produced `r format(Sys.time(), '%A %d %B %Y')`"
output:
  html_document:
    code_folding: show
    highlight: zenburn
    number_sections: no
    theme: sandstone
    toc: yes
    toc_collapse: no
    toc_depth: 3
    toc_float: yes
params:
    run_page_ind: TRUE
---

```{r, child = 'page_setup.Rmd', eval = params$run_page_ind, include = F}
```


<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
# Cleaning data {#cleaning .tabset .tabset-fade}

<!-- ======================================================= -->
## Overview {.tabset .tabset-fade .tabset-pills}  

Text about cleaning data, approaches, etc.
renaming
replace missing with
dealing with cases (all lower, etc)
case_when()
factors


<!-- ======================================================= -->
## Preparation {.tabset .tabset-fade .tabset-pills}

```{r, clean_packages}
pacman::p_load(tidyverse, janitor, epitrix)
```

<!-- ======================================================= -->
## Clean Variable Names {.tabset .tabset-fade .tabset-pills}

Variable names are used so often, it is best to have them be "clean" (no spaces, no unusual characters, etc.)  

The function `clean_names()` from the package **janitor** is very useful. 

https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning


```{r clean_names}
names(linelist)

linelist <- linelist %>% 
  janitor::clean_names()
```

Note that if you want to use variable names that include spaces, surround the names with back-ticks when referencing them in the code. On a keyboard, the back-tick (`) is different from the single quotation mark ('), and is sometimes on the same key as the tilde (~).  

So a command referencing a variable names containing spaces might look like this:  

```{r, eval=F}
# re-naming a variable from a name that contains spaces
linelist$age <- linelist$`age of patient`

# or

linelist <- linelist %>% 
  mutate(age = `age of patient`)
```


<!-- ======================================================= -->
## Classes {.tabset .tabset-fade .tabset-pills #Classes}

See section on [object classes](#objectclasses)   

```{r}
linelist <- linelist %>% 
  mutate(age           = as.numeric(age),
         outcome       = as.character(outcome),
         date_of_onset = as.Date(date_of_onset, format = "%d/%m/%Y"),
         outcome       = factor(outcome, levels = c("Recover", "Death"))
         )
```

<!-- ======================================================= -->
## Creating new variables {#newvars .tabset .tabset-fade .tabset-pills}

**base R** method 
```{r, eval=F}
linelist$new_var <- "new value"
```


Using **dplyr**
`mutate()`
transmute()


```{r, eval=F}
linelist <- linelist %>% 
  mutate(new_var_dup    = id,                  # new variable - replicate another variable
         new_var_static = 7,                   # new variable - all values the same
         new_var_static = new_var_static + 5   # you can modify a variable multiple times
         new_var_calc   = (age / 12) + months  # new variable - calculation
         new_var_paste  = paste0(district, "(", province, ")") # new variable - pasting together values
```


<!-- ======================================================= -->
## Groups by condition (`case_when()`) {#casewhen}

TODO tutorial on using case_when()

<!-- ======================================================= -->
### Numeric groups  

For example, creating age groups
`cut()`

`case_when()`

`age_categories()` (R4Epis package)

by percentile


<!-- ======================================================= -->
## Modifying existing values {.tabset .tabset-fade .tabset-pills}

Missing if... `na_if()`

Replace

WHAT TO DO IF AGE IS SPREAD ACROSS TWO VARAIBLES (e.g. numeric age + unit)


<!-- ======================================================= -->
### Highest in hierarchy

Within a group, indicate/convert to the highest value in the group

Santa Clara County example - COVID contact tracing data - classification of multiple phone call records from same person into the highest category. (classify all as the highest of the group)




```{r, child= 'page_closeout.Rmd', eval = params$run_page_ind == F, include = F}
```
