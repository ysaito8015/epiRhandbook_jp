<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>19 Heatmaps &amp; density plots | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">2</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">3</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">4</span> R Basics</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">5</span> Importing data</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">6</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">7</span> Working with Dates</a></li>
<li><a class="" href="charactersstrings.html"><span class="header-section-number">8</span> Characters/strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">9</span> De-duplication</a></li>
<li><a class="" href="ifelse-for-loops.html"><span class="header-section-number">10</span> if/else &amp; ‘for’ loops</a></li>
<li><a class="" href="apply-functions.html"><span class="header-section-number">11</span> apply functions</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="cat-analysis.html"><span class="header-section-number">12</span> Analysis</a></li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">13</span> Descriptive analysis</a></li>
<li><a class="" href="abberation-detection.html"><span class="header-section-number">14</span> Abberation detection</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">15</span> Epidemic curves</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">16</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">17</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">18</span> Combination analysis</a></li>
<li><a class="active" href="heatmaps-density-plots.html"><span class="header-section-number">19</span> Heatmaps &amp; density plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="collaboration.html"><span class="header-section-number">20</span> Collaboration</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">21</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="heatmaps-density-plots" class="section level1 tabset tabset-fade" number="19">
<h1>
<span class="header-section-number">19</span> Heatmaps &amp; density plots<a class="anchor" aria-label="anchor" href="#heatmaps-density-plots"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="overview-14" class="section level2 tabset tabset-fade" number="19.1">
<h2>
<span class="header-section-number">19.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-14"><i class="fas fa-link"></i></a>
</h2>
<p>Heatmaps can be useful when tracking reporting metrics across many facilities/jurisdictions over time</p>
<p>For example, the image below shows % of weekdays that data was received from each facility, week-by-week:</p>
<pre><code>## `summarise()` has grouped output by 'location_name'. You can override using the `.groups` argument.</code></pre>
<pre><code>## Joining, by = c("location_name", "week")</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-368-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-368-2.png" width="50%"></p>
<!-- ======================================================= -->
</div>
<div id="preparation-12" class="section level2 tabset tabset-fade" number="19.2">
<h2>
<span class="header-section-number">19.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-12"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">OpenStreetMap</span>,
               <span class="va">aweek</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="reporting-metrics-over-time" class="section level2 tabset tabset-fade" number="19.3">
<h2>
<span class="header-section-number">19.3</span> Reporting metrics over time<a class="anchor" aria-label="anchor" href="#reporting-metrics-over-time"><i class="fas fa-link"></i></a>
</h2>
<h2>
Reporting metrics over time
<a class="anchor" aria-label="anchor" href="#reporting-metrics-over-time"><i class="fas fa-link"></i></a>
</h2>
<p>Often in public health, an objective is to assess trends over time for many entities (facilities, jurisdictions, etc.). One way to visualize trends over time from many entities is a heatmap where the x-axis is time and the y-axis are the many entities.</p>
<div id="preparation-13" class="section level3" number="19.3.1">
<h3>
<span class="header-section-number">19.3.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-13"><i class="fas fa-link"></i></a>
</h3>
<h3>
Preparation
<a class="anchor" aria-label="anchor" href="#preparation-13"><i class="fas fa-link"></i></a>
</h3>
<p>To demonstrate this, we import this dataset of daily malaria case reports from 65 facilities.</p>
<p>The preparation will involve:</p>
<ul>
<li>Importing and reviewing the data<br>
</li>
<li>Aggregating the daily data into weekly, and summarizing weekly performance</li>
</ul>
<div id="load-and-view" class="section level4" number="19.3.1.1">
<h4>
<span class="header-section-number">19.3.1.1</span> Load and view<a class="anchor" aria-label="anchor" href="#load-and-view"><i class="fas fa-link"></i></a>
</h4>
<p>Below are the first 30 rows of these data:</p>
<div id="htmlwidget-96f79f11b78b64bf7191" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-96f79f11b78b64bf7191">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1560124800000\" data-max=\"1560470400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"36\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"36\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"62\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"134\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"23\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 2","Facility 3","Facility 4","Facility 5","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 7","Facility 8","Facility 9","Facility 10","Facility 11","Facility 12","Facility 13","Facility 14","Facility 15","Facility 16","Facility 17","Facility 18","Facility 19","Facility 19","Facility 20","Facility 21","Facility 19","Facility 22","Facility 23","Facility 23"],["2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-12","2019-06-12","2019-06-11","2019-06-10","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-13","2019-06-12","2019-06-13","2019-06-13","2019-06-11","2019-06-13","2019-06-13","2019-06-14"],["2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14","2019-06-14"],["North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North","North"],["Spring","Bolo","Dingo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Bolo","Spring","Bolo","Spring","Dingo","Bolo","Dingo","Barnard","Barnard","Barnard","Bolo","Bolo","Bolo","Barnard","Bolo","Bolo","Bolo","Dingo","Dingo"],[11,11,8,16,9,3,4,15,11,19,12,7,27,0,17,36,0,5,6,9,4,7,12,4,14,28,5,11,8,8],[12,10,5,16,2,1,0,14,11,15,7,1,8,10,15,36,0,1,3,9,4,0,2,7,9,18,3,4,7,7],[23,5,5,17,6,4,3,13,13,15,13,20,18,24,28,62,0,10,2,16,1,6,18,41,14,5,24,13,16,16],[46,26,18,49,17,8,7,42,35,49,32,28,53,34,60,134,0,16,11,34,9,13,32,52,37,51,32,28,31,31],[1,2,3,4,5,6,6,5,5,5,7,8,9,10,11,12,13,14,15,16,17,18,19,19,20,21,19,22,23,23]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>submitted_date<\/th>\n      <th>Province<\/th>\n      <th>District<\/th>\n      <th>malaria_rdt_0-4<\/th>\n      <th>malaria_rdt_5-14<\/th>\n      <th>malaria_rdt_15<\/th>\n      <th>malaria_tot<\/th>\n      <th>newid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,8,9]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="packages-5" class="section level4" number="19.3.1.2">
<h4>
<span class="header-section-number">19.3.1.2</span> Packages<a class="anchor" aria-label="anchor" href="#packages-5"><i class="fas fa-link"></i></a>
</h4>
<p>The packages we will use are:</p>
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="co"># ggplot and data manipulation</span>
               <span class="va">rio</span>,       <span class="co"># importing data</span>
               <span class="va">aweek</span><span class="op">)</span>     <span class="co"># manage weeks</span></code></pre></div>
</div>
<div id="aggregate-and-summarize" class="section level4" number="19.3.1.3">
<h4>
<span class="header-section-number">19.3.1.3</span> Aggregate and summarize<a class="anchor" aria-label="anchor" href="#aggregate-and-summarize"><i class="fas fa-link"></i></a>
</h4>
<p>The objective is to transform the daily reports (seen in previous tab) into weekly reports with a summary of performance - in this case <em>the proportion of days per week that the facility reported any data</em> for <strong>Spring District</strong> from April-May 2019.</p>
<p>To achieve this:</p>
<ol style="list-style-type: decimal">
<li>Filter the data as appropriate (by place, date)<br>
</li>
<li>Create a week column using <code>date2week()</code> from package <strong>aweek</strong>
<ul>
<li>This function transforms dates to weeks, using a specified start date of each week (e.g. “Monday”)<br>
</li>
<li>The <code>floor_day =</code> argument means that dates are rounded into the week only (day of the week is not shown)<br>
</li>
<li>The <code>factor =</code> argument converts the new column to a factor - important because all possible weeks within the date range are designated as levels, even if there is no data for them currently.<br>
</li>
</ul>
</li>
<li>The data are grouped by columns “location” and “week” to create analysis units of “facility-week”<br>
</li>
<li>The verb <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> creates new columns to calculate reporting performance for each “facility-week”:
<ul>
<li>Number of days per week (7 - a static value)<br>
</li>
<li>Number of reports received from the facility-week (could be more than 7!)<br>
</li>
<li>Sum of malaria cases reported by the facility-week (just for interest)<br>
</li>
<li>Number of <em>unique</em> days in the facility-week for which there is data reported<br>
</li>
<li>
<strong>Percent of the 7 days per facility-week for which data was reported</strong><br>
</li>
</ul>
</li>
<li>The dataframe is joined (<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code>) to a comprehensive list of all possible facility-week combinations, to make the dataset complete. The matrix of all possible combinations is created by applying <code><a href="https://tidyr.tidyverse.org/reference/expand.html">expand()</a></code> to those two columns of the dataframe as it is at that moment in the pipe chain (represented by “.”). Because a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> is used, all rows in the <code><a href="https://tidyr.tidyverse.org/reference/expand.html">expand()</a></code> dataframe are kept, and added to agg_weeks if necessary. These new rows appear with <code>NA</code> (missing) summarized values.</li>
</ol>
<div class="sourceCode" id="cb732"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create weekly summary dataset</span>
<span class="va">agg_weeks</span> <span class="op">&lt;-</span> <span class="va">facility_count_data</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># filter the data as appropriate</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op">==</span> <span class="st">"Spring"</span>,
         <span class="va">data_date</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-06-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># Create week column from data_date</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">date2week</a></span><span class="op">(</span><span class="va">data_date</span>,
                                 start_date <span class="op">=</span> <span class="st">"Monday"</span>,
                                 floor_day <span class="op">=</span> <span class="cn">TRUE</span>,
                                 factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># Group into facility-weeks</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">location_name</span>, <span class="va">week</span>, .drop <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># Create summary column on the grouped data</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_days          <span class="op">=</span> <span class="fl">7</span>,                                          <span class="co"># 7 days per week           </span>
            n_reports       <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,                                 <span class="co"># number of reports received per week (could be &gt;7)</span>
            malaria_tot     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">malaria_tot</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,                <span class="co"># total malaria cases reported</span>
            n_days_reported <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data_date</span><span class="op">)</span><span class="op">)</span>,                  <span class="co"># number of unique days reporting per week</span>
            p_days_reported <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">n_days_reported</span> <span class="op">/</span> <span class="va">n_days</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># percent of days reporting</span>
  
  <span class="co"># Ensure every possible facility-week combination appears in the data</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">expand</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">week</span>, <span class="va">location_name</span><span class="op">)</span><span class="op">)</span>    <span class="co"># "." represents the dataset at that moment in the pipe chain</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'location_name'. You can override using the `.groups` argument.</code></pre>
<pre><code>## Joining, by = c("location_name", "week")</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="create-heatmap" class="section level3 tabset tabset-fade" number="19.3.2">
<h3>
<span class="header-section-number">19.3.2</span> Create heatmap<a class="anchor" aria-label="anchor" href="#create-heatmap"><i class="fas fa-link"></i></a>
</h3>
<h3>
Create heatmap
<a class="anchor" aria-label="anchor" href="#create-heatmap"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>ggplot()</code> is make using <code>geom_tile()</code>:</p>
<ul>
<li>Weeks on the x-axis is transformed to dates, allowing use of <code>scale_x_date()</code><br>
</li>
<li>location_name on the y-axis will show all facility names<br>
</li>
<li>The <code>fill</code> is the performance for that facility-week (numeric)<br>
</li>
<li>
<code>scale_fill_gradient()</code> is used on the numeric fill, specifying colors for high, low, and <code>NA</code><br>
</li>
<li>
<code>scale_x_date()</code> is used on the x-axis specifying labels every 2 weeks and their format<br>
</li>
<li>Aesthetic themes and labels can be adjusted as necessary</li>
</ul>
<!-- ======================================================= --><div id="basic" class="section level4" number="19.3.2.1">
<h4>
<span class="header-section-number">19.3.2.1</span> Basic<a class="anchor" aria-label="anchor" href="#basic"><i class="fas fa-link"></i></a>
</h4>
<h4>
Basic
<a class="anchor" aria-label="anchor" href="#basic"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">agg_weeks</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">week2date</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,            <span class="co"># transformed to date class</span>
           y <span class="op">=</span> <span class="va">location_name</span>,
           fill <span class="op">=</span> <span class="va">p_days_reported</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="co"># tiles</span>
  <span class="fu">geom_tile</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"white"</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># white gridlines</span>
  
  <span class="fu">scale_fill_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"orange"</span>, high <span class="op">=</span> <span class="st">"darkgreen"</span>, na.value <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
               date_breaks <span class="op">=</span> <span class="st">"2 weeks"</span>,
               date_labels <span class="op">=</span> <span class="st">"%d\n%b"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                  <span class="co"># simplify background</span>
  <span class="fu">theme</span><span class="op">(</span>
    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    legend.text  <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    legend.key.height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"cm"</span><span class="op">)</span>,         <span class="co"># height of legend key</span>
    legend.key.width  <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="st">"cm"</span><span class="op">)</span>,       <span class="co"># width of legend key</span>
    
    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0</span>,size<span class="op">=</span><span class="fl">14</span>,face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>
    <span class="op">)</span><span class="op">+</span>
  
  <span class="co"># plot labels</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week"</span>,
       y <span class="op">=</span> <span class="st">"Facility name"</span>,
       fill <span class="op">=</span> <span class="st">"Reporting\nperformance (%)"</span>, <span class="co"># legend title</span>
       title <span class="op">=</span> <span class="st">"Percent of days per week that facility reported data"</span>,
       subtitle <span class="op">=</span> <span class="st">"District health facilities, April-May 2019"</span>,
       caption <span class="op">=</span> <span class="st">"7-day weeks beginning on Mondays."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-373-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="ordered-y-axis" class="section level4" number="19.3.2.2">
<h4>
<span class="header-section-number">19.3.2.2</span> Ordered y-axis<a class="anchor" aria-label="anchor" href="#ordered-y-axis"><i class="fas fa-link"></i></a>
</h4>
<h4>
Ordered y-axis
<a class="anchor" aria-label="anchor" href="#ordered-y-axis"><i class="fas fa-link"></i></a>
</h4>
<p>If you want to order the y-axis facilities by something, convert them to class Factor and provide the order. Below, the order is set based on the total number of reporting days filed by the facility across the whole timespan:</p>
<div class="sourceCode" id="cb736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">facility_order</span> <span class="op">&lt;-</span> <span class="va">agg_weeks</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">location_name</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>tot_reports <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n_days_reported</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">tot_reports</span><span class="op">)</span> <span class="co"># ascending order</span></code></pre></div>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">as.tibble</span><span class="op">(</span><span class="va">facility_order</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 2
##    location_name tot_reports
##    &lt;chr&gt;               &lt;int&gt;
##  1 Facility 56             1
##  2 Facility 65             6
##  3 Facility 11            19
##  4 Facility 39            31
##  5 Facility 59            33
##  6 Facility 27            40
##  7 Facility 32            41
##  8 Facility 51            41
##  9 Facility 7             42
## 10 Facility 1             46
## 11 Facility 9             48
## 12 Facility 35            50
## 13 Facility 50            51
## 14 Facility 58            53
## 15 Facility 28            75</code></pre>
<p>Now use the above vector (<code>facility_order$location_name</code>) to be the order of the factor levels of location_name in the dataset <code>agg_weeks</code>:</p>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agg_weeks</span> <span class="op">&lt;-</span> <span class="va">agg_weeks</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>location_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">location_name</span>, levels <span class="op">=</span> <span class="va">facility_order</span><span class="op">$</span><span class="va">location_name</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And now the data are re-plotted, with location_name being an ordered factor:</p>
<div class="sourceCode" id="cb740"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">agg_weeks</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">week2date</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,            <span class="co"># transformed to date class</span>
           y <span class="op">=</span> <span class="va">location_name</span>,
           fill <span class="op">=</span> <span class="va">p_days_reported</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="co"># tiles</span>
  <span class="fu">geom_tile</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"white"</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># white gridlines</span>

  <span class="fu">scale_fill_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"orange"</span>, high <span class="op">=</span> <span class="st">"darkgreen"</span>, na.value <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
               date_breaks <span class="op">=</span> <span class="st">"2 weeks"</span>,
               date_labels <span class="op">=</span> <span class="st">"%d\n%b"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                  <span class="co"># simplify background</span>
  <span class="fu">theme</span><span class="op">(</span>
    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    legend.text  <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    legend.key.height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"cm"</span><span class="op">)</span>,         <span class="co"># height of legend key</span>
    legend.key.width  <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="st">"cm"</span><span class="op">)</span>,       <span class="co"># width of legend key</span>
    
    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0</span>,size<span class="op">=</span><span class="fl">14</span>,face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>
    <span class="op">)</span><span class="op">+</span>
  
  <span class="co"># plot labels</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week"</span>,
       y <span class="op">=</span> <span class="st">"Facility name"</span>,
       fill <span class="op">=</span> <span class="st">"Reporting\nperformance (%)"</span>, <span class="co"># legend title</span>
       title <span class="op">=</span> <span class="st">"Percent of days per week that facility reported data"</span>,
       subtitle <span class="op">=</span> <span class="st">"District health facilities, April-May 2019"</span>,
       caption <span class="op">=</span> <span class="st">"7-day weeks beginning on Mondays."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-377-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="display-values" class="section level4" number="19.3.2.3">
<h4>
<span class="header-section-number">19.3.2.3</span> Display values<a class="anchor" aria-label="anchor" href="#display-values"><i class="fas fa-link"></i></a>
</h4>
<h4>
Display values
<a class="anchor" aria-label="anchor" href="#display-values"><i class="fas fa-link"></i></a>
</h4>
<p>You can add a <code>geom_text()</code> layer on top of the tiles, to display the actual numbers of each tile. Be aware this may not look pretty if you have many small tiles!</p>
<ul>
<li>Note the fillowing code added <code>geom_text(aes(label=p_days_reported))+</code>. In the aesthetic <code>aes()</code> of the <code>geom_tile()</code> the argument <code>label</code> (what to show) is set to the same numeric column used to create the color gradient.</li>
</ul>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">agg_weeks</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">week2date</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,            <span class="co"># transformed to date class</span>
           y <span class="op">=</span> <span class="va">location_name</span>,
           fill <span class="op">=</span> <span class="va">p_days_reported</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="co"># tiles</span>
  <span class="fu">geom_tile</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"white"</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># white gridlines</span>
  
  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">p_days_reported</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>          <span class="co"># add text on top of tile</span>
  
  <span class="fu">scale_fill_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"orange"</span>, high <span class="op">=</span> <span class="st">"darkgreen"</span>, na.value <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
               date_breaks <span class="op">=</span> <span class="st">"2 weeks"</span>,
               date_labels <span class="op">=</span> <span class="st">"%d\n%b"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                  <span class="co"># simplify background</span>
  <span class="fu">theme</span><span class="op">(</span>
    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    legend.text  <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    legend.key.height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"cm"</span><span class="op">)</span>,         <span class="co"># height of legend key</span>
    legend.key.width  <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="st">"cm"</span><span class="op">)</span>,       <span class="co"># width of legend key</span>
    
    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0</span>,size<span class="op">=</span><span class="fl">14</span>,face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>
    <span class="op">)</span><span class="op">+</span>
  
  <span class="co"># plot labels</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week"</span>,
       y <span class="op">=</span> <span class="st">"Facility name"</span>,
       fill <span class="op">=</span> <span class="st">"Reporting\nperformance (%)"</span>, <span class="co"># legend title</span>
       title <span class="op">=</span> <span class="st">"Percent of days per week that facility reported data"</span>,
       subtitle <span class="op">=</span> <span class="st">"District health facilities, April-May 2019"</span>,
       caption <span class="op">=</span> <span class="st">"7-day weeks beginning on Mondays."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-378-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="gis-heatmaps" class="section level2 tabset tabset-fade" number="19.4">
<h2>
<span class="header-section-number">19.4</span> GIS heatmaps<a class="anchor" aria-label="anchor" href="#gis-heatmaps"><i class="fas fa-link"></i></a>
</h2>
<p>Contoured heatmap of cases over a basemap</p>
<ol style="list-style-type: decimal">
<li>Create basemap tile from OpenStreetMap<br>
</li>
<li>Plot the cases from <code>linelist</code> using the latitude and longitude</li>
</ol>
<p><a href="http://data-analytics.net/cep/Schedule_files/geospatial.html" class="uri">http://data-analytics.net/cep/Schedule_files/geospatial.html</a></p>
<div class="sourceCode" id="cb742"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">OpenStreetMap</span><span class="op">)</span>

<span class="co"># Fit basemap by range of lat/long coordinates. Choose tile type</span>
<span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">openmap</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">lat</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">lon</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># limits of tile</span>
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">lat</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">lon</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>,
               zoom <span class="op">=</span> <span class="cn">NULL</span>,
               type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"osm"</span>, <span class="st">"stamen-toner"</span>, <span class="st">"stamen-terrain"</span>,<span class="st">"stamen-watercolor"</span>, <span class="st">"esri"</span>,<span class="st">"esri-topo"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
               mergeTiles <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded ellps WGS 84 in CRS definition:
## +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): Discarded datum World Geodetic System 1984
## in CRS definition</code></pre>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Projection WGS84</span>
<span class="va">map.latlon</span> <span class="op">&lt;-</span> <span class="fu">openproj</span><span class="op">(</span><span class="va">map</span>, projection <span class="op">=</span> <span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="op">)</span>

<span class="co"># Plot map. Must be autoplotted to work with ggplot</span>
<span class="fu">OpenStreetMap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/OpenStreetMap/man/autoplot.OpenStreetMap.html">autoplot.OpenStreetMap</a></span><span class="op">(</span><span class="va">map.latlon</span><span class="op">)</span><span class="op">+</span>
  <span class="co"># Density tiles  </span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>,
        y <span class="op">=</span> <span class="va">lat</span>,
        fill <span class="op">=</span> <span class="va">..level..</span>,
        alpha<span class="op">=</span><span class="va">..level..</span><span class="op">)</span>,
    bins <span class="op">=</span> <span class="fl">10</span>,
    geom <span class="op">=</span> <span class="st">"polygon"</span>,
    contour_var <span class="op">=</span> <span class="st">"count"</span>,
    data <span class="op">=</span> <span class="va">linelist</span>,
    show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitude"</span>,
       y <span class="op">=</span> <span class="st">"Latitude"</span>,
       title <span class="op">=</span> <span class="st">"Distribution of simulated cases"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-379-1.png" width="672"><a href="https://www.rdocumentation.org/packages/OpenStreetMap/versions/0.3.4/topics/autoplot.OpenStreetMap" class="uri">https://www.rdocumentation.org/packages/OpenStreetMap/versions/0.3.4/topics/autoplot.OpenStreetMap</a></p>
<!-- ======================================================= -->
</div>
<div id="resources-10" class="section level2 tabset tabset-fade" number="19.5">
<h2>
<span class="header-section-number">19.5</span> Resources<a class="anchor" aria-label="anchor" href="#resources-10"><i class="fas fa-link"></i></a>
</h2>
<p>This tab should stay with the name “Resources”.
Links to other online tutorials or resources.</p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="combination-analysis.html"><span class="header-section-number">18</span> Combination analysis</a></div>
<div class="next"><a href="collaboration.html"><span class="header-section-number">20</span> Collaboration</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#heatmaps-density-plots"><span class="header-section-number">19</span> Heatmaps &amp; density plots</a></li>
<li><a class="nav-link" href="#overview-14"><span class="header-section-number">19.1</span> Overview</a></li>
<li><a class="nav-link" href="#preparation-12"><span class="header-section-number">19.2</span> Preparation</a></li>
<li><a class="nav-link" href="#reporting-metrics-over-time"><span class="header-section-number">19.3</span> Reporting metrics over time</a></li>
<li>
<a class="nav-link" href="#reporting-metrics-over-time">
Reporting metrics over time
</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#preparation-13"><span class="header-section-number">19.3.1</span> Preparation</a></li>
<li><a class="nav-link" href="#preparation-13">
Preparation
</a></li>
<li><a class="nav-link" href="#create-heatmap"><span class="header-section-number">19.3.2</span> Create heatmap</a></li>
<li><a class="nav-link" href="#create-heatmap">
Create heatmap
</a></li>
</ul>
</li>
<li><a class="nav-link" href="#gis-heatmaps"><span class="header-section-number">19.4</span> GIS heatmaps</a></li>
<li><a class="nav-link" href="#resources-10"><span class="header-section-number">19.5</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-01-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
