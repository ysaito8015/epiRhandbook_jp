<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>29 Plotting categorical variables | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">1</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">2</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="importing-and-exporting.html"><span class="header-section-number">4</span> Importing and exporting</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">5</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">6</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">7</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">8</span> Working with dates</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">9</span> Missing data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">10</span> Grouping data</a></li>
<li><a class="" href="joining-matching-datasets.html"><span class="header-section-number">11</span> Joining &amp; matching datasets</a></li>
<li><a class="" href="charactersstrings.html"><span class="header-section-number">12</span> Characters/strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">13</span> De-duplication</a></li>
<li><a class="" href="iteration-and-loops.html"><span class="header-section-number">14</span> Iteration and loops</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">15</span> Descriptive analysis</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">16</span> Simple statistical tests</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">17</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">18</span> Moving averages</a></li>
<li><a class="" href="outbreak-detection.html"><span class="header-section-number">19</span> Outbreak detection</a></li>
<li><a class="" href="time-series-analysis.html"><span class="header-section-number">20</span> Time series analysis</a></li>
<li><a class="" href="epidemicmodels.html"><span class="header-section-number">21</span> Epidemic modeling</a></li>
<li><a class="" href="modeling.html"><span class="header-section-number">22</span> Modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">23</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis-1.html"><span class="header-section-number">24</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">25</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">26</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">27</span> Epidemic curves</a></li>
<li><a class="" href="plotting-continuous-data.html"><span class="header-section-number">28</span> Plotting continuous data</a></li>
<li><a class="active" href="plotting-categorical-variables.html"><span class="header-section-number">29</span> Plotting categorical variables</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">30</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">31</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">32</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">33</span> Combination analysis</a></li>
<li><a class="" href="heatmaps-density-plots.html"><span class="header-section-number">34</span> Heatmaps &amp; density plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">36</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">38</span> Errors &amp; Warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">39</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">40</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">41</span> Routine reports</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">42</span> R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny basics</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">44</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">46</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="plotting-categorical-variables" class="section level1 tabset tabset-fade" number="29">
<h1>
<span class="header-section-number">29</span> Plotting categorical variables<a class="anchor" aria-label="anchor" href="#plotting-categorical-variables"><i class="fas fa-link"></i></a>
</h1>
<p>For appropriate plotting of categorical data, e.g. the distribution of sex, symptoms, ethnic group, etc.</p>
<!-- ======================================================= -->
<div id="overview-25" class="section level2 tabset tabset-fade" number="29.1">
<h2>
<span class="header-section-number">29.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-25"><i class="fas fa-link"></i></a>
</h2>
<h2>
Overview
<a class="anchor" aria-label="anchor" href="#overview-25"><i class="fas fa-link"></i></a>
</h2>
<p>In this section we cover use of R’s built-in functions or functions from the <code>ggplot2</code> package to visualise discrete/categorical data. The additional functionality of ggplot2 compared to R means we recommend it for presentation-ready visualisations.</p>
<p>We cover visualising distributions of categorical values, as counts and proportions.</p>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-549-1.png" width="100%"></div>
<!-- ======================================================= -->
</div>
<div id="preparation-20" class="section level2 tabset tabset-fade" number="29.2">
<h2>
<span class="header-section-number">29.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-20"><i class="fas fa-link"></i></a>
</h2>
<h2>
Preparation
<a class="anchor" aria-label="anchor" href="#preparation-20"><i class="fas fa-link"></i></a>
</h2>
<p>Preparation includes loading the relevant packages, namely <code>ggplot2</code>, (<code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("ggplot2")</a></code> if needed), and ensuring your data is the correct class and format.</p>
<div class="sourceCode" id="cb841"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>For the examples in this section, we use the simulated Ebola linelist, focusing on the discrete variables <code>hospital</code>, <code>outcome</code>, and <code>gender</code>.</p>
<p>For displaying frequencies, you have the option of creating plots based on:</p>
<ul>
<li>The linelist data, with one row per observation, or</li>
<li>A summary table based on the linelist, with one row per category. An example is below to show the use of <code>dplyr</code> to create a table of case counts per hospital.</li>
</ul>
<p>Tables can be created using the ‘table’ method for built-in graphics</p>
<div class="sourceCode" id="cb842"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Table method</span>
  <span class="va">outcome_nbar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">outcome_nbar</span><span class="op">)</span> <span class="co"># View class of object</span></code></pre></div>
<pre><code>## [1] "table"</code></pre>
<div class="sourceCode" id="cb844"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">outcome_nbar</span> <span class="co"># View full table</span></code></pre></div>
<pre><code>## 
##   Death Recover 
##    2582    1983</code></pre>
<p>Or using other data management packages such as dplyr</p>
<div class="sourceCode" id="cb846"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Dplyr method</span>
  <span class="va">outcome_n</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="va">count</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">outcome_n</span><span class="op">)</span> <span class="co"># View class of object</span></code></pre></div>
<pre><code>## [1] "grouped_df" "tbl_df"     "tbl"        "data.frame"</code></pre>
<div class="sourceCode" id="cb848"><pre class="downlit sourceCode r">
<code class="sourceCode R">   <span class="va">outcome_n</span> <span class="co">#View full table</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
## # Groups:   outcome [3]
##   outcome     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Death    2582
## 2 Recover  1983
## 3 &lt;NA&gt;     1323</code></pre>
<!-- ======================================================= -->
</div>
<div id="plotting-with-base-graphics-1" class="section level2 tabset tabset-fade" number="29.3">
<h2>
<span class="header-section-number">29.3</span> Plotting with base graphics<a class="anchor" aria-label="anchor" href="#plotting-with-base-graphics-1"><i class="fas fa-link"></i></a>
</h2>
<h2>
In-built graphics package
<a class="anchor" aria-label="anchor" href="#plotting-with-base-graphics-1"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Bar plots</strong></p>
<p>To create bar plots in R, we create a frequency table using the <code>table</code> function. This creates an object of a table class, that R can recognise for plotting. We can create a simple frequency graph showing Ebola case outcomes (A), or add in colours to present outcomes by gender (B).</p>
<p>Note that NA values are excluded from these plots by default.</p>
<div class="sourceCode" id="cb850"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Outcomes in all cases</span>
<span class="va">outcome_nbar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">outcome_nbar</span>, main<span class="op">=</span> <span class="st">"A) Outcomes"</span><span class="op">)</span>

<span class="co"># B) Outcomes in all cases by gender of case</span>
<span class="va">outcome_nbar2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">outcome</span>, <span class="va">linelist</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span> <span class="co"># The first column is for groupings within a bar, the second is for the separate bars</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">outcome_nbar2</span>, legend.text<span class="op">=</span><span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">"B) Outcomes by gender"</span><span class="op">)</span> <span class="co"># Specify inclusion of legend</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-553-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-553-2.png" width="50%"></p>
<!-- ======================================================= -->
</div>
<div id="plotting-with-ggplot-1" class="section level2 tabset tabset-fade" number="29.4">
<h2>
<span class="header-section-number">29.4</span> Plotting with ggplot<a class="anchor" aria-label="anchor" href="#plotting-with-ggplot-1"><i class="fas fa-link"></i></a>
</h2>
<h2>
Plotting with ggplot()
<a class="anchor" aria-label="anchor" href="#plotting-with-ggplot-1"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Code syntax</strong></p>
<p>Ggplot has extensive functionality, and the same code syntax can be used for many different plot types.</p>
<p>Similar to the <em>plotting continuous data</em> section, basic breakdown of the ggplot code is as follows:</p>
<pre><code>ggplot(data = linelist)+  
  geom_XXXX(aes(x = col1, y = col2),
       fill = "color") </code></pre>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> starts off the function. You can specify the data and aesthetics (see next point) within the ggplot bracket, unless you are combining different data sources or plot types into one</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> stands for ‘aesthetics’, and is where the columns used for the visualisation are specified. For instance <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes(x = col1, y = col2)</a></code> to specify the data used for the x and y values.</li>
<li>
<code>fill</code> specifies the colour of bars, or of the subgroups if specified within the <code>aes</code> breacket.</li>
<li>
<code>geom_XXX</code> specifies what type of plot. Options include:
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> for a bar chart based on a linelist</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> for a bar chart based on a table with values (see preparation section)</li>
</ul>
</li>
</ul>
<p>For more see section on <a href="#ggplottips">ggplot tips</a>).</p>
<p><strong>Bar charts using raw data</strong></p>
<p>Below is code using <code>geom_bar</code> for creating some simple bar charts to show frequencies of Ebola patient outcomes: A) For all cases, and B) By hospital.</p>
<p>In the <code>aes</code> bracket, only <code>x</code> needs to be specified. Ggplot knows that y will be the number of observations that fall into those categories. Note that a bar is generated for cases with missing outcomes; these may be cases without known outcome or who are still currently sick.</p>
<div class="sourceCode" id="cb852"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Outcomes in all cases</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Number of recovered and dead Ebola cases"</span><span class="op">)</span>


<span class="co"># B) Outcomes in all cases by hosptial</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Number of recovered and dead Ebola cases, by hospital"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-554-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-554-2.png" width="50%"></p>
<p><strong>Bar charts using processed data</strong></p>
<p>As above, below is code using <code>geom_col</code> for creating simple bar charts to show frequencies of Ebola patient outcomes: A) For all cases, and B) By hospital. Note that a bar is generated for cases with missing outcomes; these may be cases without known outcome or who are still currently sick. We remove them in graph B.</p>
<p>With geom_col, both x and y need to be specified. Here x is the discrete variable <code>outcome</code> and y is the generated frequencies column <code>n</code>. To create B), an additional table needs to be created for frequencies of the combined categories <code>outcome</code> and <code>hospital</code>.</p>
<div class="sourceCode" id="cb853"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Outcomes in all cases</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">outcome_n</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Number of recovered and dead Ebola cases"</span><span class="op">)</span>

<span class="va">outcome_n2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">outcome_n2</span><span class="op">)</span> <span class="co">#Preview data</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   hospital, outcome [6]
##   hospital          outcome     n
##   &lt;chr&gt;             &lt;chr&gt;   &lt;int&gt;
## 1 Central Hospital  Death     193
## 2 Central Hospital  Recover   165
## 3 Central Hospital  &lt;NA&gt;       96
## 4 Military Hospital Death     399
## 5 Military Hospital Recover   309
## 6 Military Hospital &lt;NA&gt;      188</code></pre>
<div class="sourceCode" id="cb855"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># B) Outcomes in all cases by hospital</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">outcome_n2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co">#Remove missing outcomes</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Number of recovered and dead Ebola cases, by hospital"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-555-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-555-2.png" width="50%"></p>
<p>Rather than presenting frequencies, we can also calculate proportions and graph these, as shown in A) below. Here rather than showing the distribution of hospital of admission among those who died and recovered, we show the outcome distribution of patients by hospital.</p>
<p>As shown in B, we can also change the stacked bar plot appearance, so that each subcategory is a separate bar, using <code>position = "dodge"</code>. This is sometimes appropriate in that it allows for easier comparison of the height of each category. Both examples below also use <code>coord_flip</code> for horizontal plots.</p>
<div class="sourceCode" id="cb856"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcome_n2</span> <span class="op">&lt;-</span> <span class="va">outcome_n2</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="co"># Calculate proportions</span>

<span class="co"># A) % outcome by hospital </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">outcome_n2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">hospital</span>, y <span class="op">=</span> <span class="va">prop</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Change the view to horizontal so it is easier to read</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Proportion of recovered and dead Ebola cases by hospital - option 1"</span><span class="op">)</span>


<span class="co"># B) Outcomes in all cases by hosptial</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">outcome_n2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">hospital</span>, y <span class="op">=</span> <span class="va">prop</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Change the view to horizontal so it is easier to read</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Proportion of recovered and dead Ebola cases, by hospital - option 2"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-556-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-556-2.png" width="50%"></p>
<p>We can also use faceting to create futher mini-graphs, as detailed in the continuous data visualisation section. Specifically, one can use:</p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> - this will recreate the sub-graphs and present them alphabetically (typically, unless stated otherwise). You can invoke certain options to determine the look of the facets, e.g. <code>nrow=1</code> or <code>ncol=1</code> to control the number of rows or columns that the faceted plots are arranged within. See plot A below.</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> - this is suited to seeing subgroups for particular combinations of discrete variables. See plot B below.</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="resources-19" class="section level2 tabset tabset-fade" number="29.5">
<h2>
<span class="header-section-number">29.5</span> Resources<a class="anchor" aria-label="anchor" href="#resources-19"><i class="fas fa-link"></i></a>
</h2>
<h2>
Resources
<a class="anchor" aria-label="anchor" href="#resources-19"><i class="fas fa-link"></i></a>
</h2>
<p>There is a huge amount of help online, especially with ggplot. see:</p>
<ul>
<li><a href="http://r-statistics.co/ggplot2-cheatsheet.html" class="uri">http://r-statistics.co/ggplot2-cheatsheet.html</a></li>
<li><a href="https://biostats.w.uib.no/the-ggplot2-cheat-sheet-by-rstudio/" class="uri">https://biostats.w.uib.no/the-ggplot2-cheat-sheet-by-rstudio/</a></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="plotting-continuous-data.html"><span class="header-section-number">28</span> Plotting continuous data</a></div>
<div class="next"><a href="tables.html"><span class="header-section-number">30</span> Tables</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#plotting-categorical-variables"><span class="header-section-number">29</span> Plotting categorical variables</a></li>
<li><a class="nav-link" href="#overview-25"><span class="header-section-number">29.1</span> Overview</a></li>
<li><a class="nav-link" href="#overview-25">
Overview
</a></li>
<li><a class="nav-link" href="#preparation-20"><span class="header-section-number">29.2</span> Preparation</a></li>
<li><a class="nav-link" href="#preparation-20">
Preparation
</a></li>
<li><a class="nav-link" href="#plotting-with-base-graphics-1"><span class="header-section-number">29.3</span> Plotting with base graphics</a></li>
<li><a class="nav-link" href="#plotting-with-base-graphics-1">
In-built graphics package
</a></li>
<li><a class="nav-link" href="#plotting-with-ggplot-1"><span class="header-section-number">29.4</span> Plotting with ggplot</a></li>
<li><a class="nav-link" href="#plotting-with-ggplot-1">
Plotting with ggplot()
</a></li>
<li><a class="nav-link" href="#resources-19"><span class="header-section-number">29.5</span> Resources</a></li>
<li><a class="nav-link" href="#resources-19">
Resources
</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
