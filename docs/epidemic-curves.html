<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>28 Epidemic curves | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">The Epidemiologist R Handbook</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">1</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">2</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transition to R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">5</span> Import and export</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">7</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">8</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">10</span> Factors</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivoting data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">13</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">14</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration-and-loops.html"><span class="header-section-number">16</span> Iteration and loops</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="missing-data.html"><span class="header-section-number">17</span> Missing data</a></li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">18</span> Descriptive analysis</a></li>
<li><a class="" href="univariate-and-multivariate-regression.html"><span class="header-section-number">19</span> Univariate and multivariate regression</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">20</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">21</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">22</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">23</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">24</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">25</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">26</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">27</span> ggplot tips</a></li>
<li><a class="active" href="epidemic-curves.html"><span class="header-section-number">28</span> Epidemic curves</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">29</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">30</span> Plot categorical data</a></li>
<li><a class="" href="tables-1.html"><span class="header-section-number">31</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">32</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">33</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">34</span> Combination analysis</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">35</span> Heatmaps</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">36</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">37</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">38</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">39</span> Errors &amp; warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">40</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">41</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">42</span> Routine reports</a></li>
<li><a class="" href="r-markdown-1.html"><span class="header-section-number">43</span> R Markdown</a></li>
<li><a class="" href="shiny-and-dashboards.html"><span class="header-section-number">44</span> Shiny and dashboards</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">45</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">46</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">47</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">48</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="epidemic-curves" class="section level1" number="28">
<h1>
<span class="header-section-number">28</span> Epidemic curves<a class="anchor" aria-label="anchor" href="#epidemic-curves"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-703-1.png" width="75%"></div>
<p>An epidemic curve (also known as an “epi curve”) is a core epidemiological chart typically used to visualize the temporal pattern of illness onset among a cluster or epidemic of cases.</p>
<p>Analysis of the epicurve can reveal temporal trends, outliers, the magnitude of the outbreak, the most likely time period of exposure, time intervals between case generations, and can even help identify the mode of transmission of an unidentified disease (e.g. point source, continuous common source, person-to-person propogation). One online lesson on interpretation of epi curves can be found at the website of the <a href="https://www.cdc.gov/training/quicklearns/epimode/index.html">US CDC</a>.</p>
<p>In this page we demonstrate two approaches to producing epicurves in R:</p>
<ul>
<li>The <strong>incidence</strong> package, which can produce an epi curve with fast and simple commands<br>
</li>
<li>The <strong>ggplot2</strong> package, which allows for advanced customizability via more complex commands</li>
</ul>
<p>The combination of these packages is also addressed, as are specific use-cases such as:</p>
<ul>
<li>Plotting aggregated count data<br>
</li>
<li>Faceting or producing small-multiples<br>
</li>
<li>Applying moving averages<br>
</li>
<li>Showing which data are “tentative” or subject to reporting delays<br>
</li>
<li>Overlaying cumulative case incidence using a second axis</li>
</ul>
<!-- ======================================================= --><div id="preparation-18" class="section level2" number="28.1">
<h2>
<span class="header-section-number">28.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-18"><i class="fas fa-link"></i></a>
</h2>
<div id="packages-5" class="section level3 unnumbered">
<h3>Packages<a class="anchor" aria-label="anchor" href="#packages-5"><i class="fas fa-link"></i></a>
</h3>
<p>This code chunk shows the loading of packages required for the analyses.</p>
<div class="sourceCode" id="cb1110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,          <span class="co"># file import/export</span>
  <span class="va">here</span>,         <span class="co"># relative filepaths </span>
  <span class="va">lubridate</span>,    <span class="co"># working with dates/epiweeks</span>
  <span class="va">aweek</span>,        <span class="co"># alternative package for working with dates/epiweeks</span>
  <span class="va">incidence</span>,    <span class="co"># epicurves of linelist data</span>
  <span class="va">stringr</span>,      <span class="co"># search and manipulate character strings</span>
  <span class="va">forcats</span>,      <span class="co"># working with factors</span>
  <span class="va">RColorBrewer</span>, <span class="co"># Color palettes from colorbrewer2.org</span>
  <span class="va">tidyverse</span>     <span class="co"># data management + ggplot2 graphics</span>
<span class="op">)</span> </code></pre></div>
</div>
<div id="load-data-7" class="section level3 unnumbered">
<h3>Load data<a class="anchor" aria-label="anchor" href="#load-data-7"><i class="fas fa-link"></i></a>
</h3>
<p>Two example datasets are used in this section:</p>
<ul>
<li>Linelist of individual cases from a simulated epidemic<br>
</li>
<li>Aggregated counts by hospital from the same simulated epidemic</li>
</ul>
<p>The datasets are imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data. The linelist and aggregated counts are displayed below.</p>
<div class="sourceCode" id="cb1111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p><strong>Case linelist</strong></p>
<p>The first 50 rows are displayed</p>
<div id="htmlwidget-1a8d243b2609f37ae6f2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1a8d243b2609f37ae6f2">{"x":{"filter":"none","data":[["a3c8b8","d8a13d","5fe599","8689b7","11f8ea","893f25","be99c8","d0523a","ce9c02","275cc7","07e3e8","8a4580","2b8773","057e7a","be502d","4cff96","bab455","a6c614","c15f36","2eaa9a","2ebf95","c36eb4","02d8fd","af9f9a","88eff2","f50e8a","bc648d","567136","b799eb","67184b","170473","42e1a9","64c8ef","8ebf6e","e56412","0b46a0","188619","62a2ef","da8ecb","148f18","a9feb3","92ab68","58b968","f81362","6670a5","92ddf7","386dfb","3ad520","ae50c8","2ed605"],[4,4,4,4,2,3,3,7,5,5,4,4,5,7,5,6,5,5,5,5,6,8,9,6,5,10,9,6,5,6,7,12,6,7,9,9,7,9,5,6,6,8,10,8,9,9,9,7,9,9],["2014-05-07","2014-05-06","2014-05-08",null,null,"2014-05-18","2014-05-03","2014-05-20","2014-05-27","2014-05-24","2014-05-22",null,"2014-05-31","2014-06-04","2014-06-09","2014-06-05",null,"2014-06-05",null,"2014-06-07",null,"2014-06-15","2014-06-14",null,null,null,null,null,"2014-06-27",null,"2014-07-05",null,null,"2014-07-02","2014-07-12","2014-07-12","2014-07-05","2014-07-02","2014-06-20",null,"2014-06-29",null,"2014-07-18",null,"2014-07-18","2014-07-19","2014-07-19","2014-07-12","2014-07-20","2014-07-27"],["2014-05-08","2014-05-08","2014-05-13","2014-05-13","2014-05-16","2014-05-21","2014-05-22","2014-05-24","2014-05-27","2014-05-27","2014-05-27","2014-06-02","2014-06-06","2014-06-14","2014-06-15","2014-06-15","2014-06-15","2014-06-16","2014-06-17","2014-06-17","2014-06-19","2014-06-20","2014-06-20","2014-06-20","2014-06-20","2014-06-22","2014-06-30","2014-07-02","2014-07-03","2014-07-04","2014-07-09","2014-07-12","2014-07-14","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-19","2014-07-19","2014-07-20","2014-07-20","2014-07-20","2014-07-23","2014-07-23","2014-07-24","2014-07-25","2014-07-28"],["2014-05-10","2014-05-10","2014-05-15","2014-05-14","2014-05-18","2014-05-22","2014-05-23","2014-05-26","2014-05-29","2014-05-28","2014-05-29","2014-06-02","2014-06-07","2014-06-15","2014-06-16","2014-06-16","2014-06-16","2014-06-18","2014-06-19","2014-06-17","2014-06-21","2014-06-21","2014-06-20","2014-06-20","2014-06-21","2014-06-23","2014-07-02","2014-07-03","2014-07-05","2014-07-06","2014-07-10","2014-07-14","2014-07-15","2014-07-14","2014-07-17","2014-07-16","2014-07-19","2014-07-19","2014-07-20","2014-07-20","2014-07-21","2014-07-20","2014-07-21","2014-07-21","2014-07-22","2014-07-25","2014-07-23","2014-07-24","2014-07-27","2014-07-30"],["2014-05-14",null,null,"2014-05-18","2014-05-30","2014-05-29","2014-05-24","2014-06-05","2014-06-17","2014-06-07","2014-06-01",null,"2014-06-16",null,"2014-06-19","2014-06-25","2014-06-18","2014-06-26","2014-06-28",null,"2014-06-23","2014-06-24","2014-07-01","2014-07-13","2014-06-24","2014-07-01","2014-07-14","2014-07-07","2014-07-12","2014-07-09","2014-08-09","2014-07-20","2014-07-25","2014-07-27","2014-07-19","2014-08-11","2014-07-24","2014-07-23","2014-08-01","2014-07-23","2014-08-03","2014-08-05","2014-07-28","2014-08-07","2014-08-01",null,null,null,"2014-08-08","2014-08-09"],["Recover",null,null,"Recover","Recover","Recover","Recover",null,"Death","Death","Recover","Death",null,"Recover","Death",null,"Death","Recover","Recover","Recover","Death","Death","Death",null,"Death",null,"Recover",null,"Recover","Death","Recover","Death","Recover","Recover","Death","Recover","Death","Death",null,"Death","Death",null,null,"Death","Death","Recover","Recover",null,"Death",null],["m","f","m","f","m","m","f","f","m","f","f","m","f","f","m","m","f","f","f","f","m","m","m","f","f","f","m","m","m","m","f","f","m","f","f","f","m","f","m","f","f","f","m","m","f","m","f","f","f","f"],[1,4,21,2,27,25,18,2,20,4,22,7,7,18,33,34,12,31,0,3,3,51,51,9,15,8,35,37,34,15,35,9,30,9,23,13,25,14,39,1,14,12,14,28,13,6,42,10,6,10],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,4,21,2,27,25,18,2,20,4,22,7,7,18,33,34,12,31,0,3,3,51,51,9,15,8,35,37,34,15,35,9,30,9,23,13,25,14,39,1,14,12,14,28,13,6,42,10,6,10],["0-4","0-4","20-29","0-4","20-29","20-29","15-19","0-4","20-29","0-4","20-29","5-9","5-9","15-19","30-49","30-49","10-14","30-49","0-4","0-4","0-4","50-69","50-69","5-9","15-19","5-9","30-49","30-49","30-49","15-19","30-49","5-9","30-49","5-9","20-29","10-14","20-29","10-14","30-49","0-4","10-14","10-14","10-14","20-29","10-14","5-9","30-49","10-14","5-9","10-14"],["0-4","0-4","20-24","0-4","25-29","25-29","15-19","0-4","20-24","0-4","20-24","5-9","5-9","15-19","30-34","30-34","10-14","30-34","0-4","0-4","0-4","50-54","50-54","5-9","15-19","5-9","35-39","35-39","30-34","15-19","35-39","5-9","30-34","5-9","20-24","10-14","25-29","10-14","35-39","0-4","10-14","10-14","10-14","25-29","10-14","5-9","40-44","10-14","5-9","10-14"],["Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Missing","Port Hospital","Central Hospital","Missing","Military Hospital","Missing","Missing","Military Hospital","Port Hospital","Port Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Military Hospital","Military Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Central Hospital","Missing","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Other","Military Hospital","Missing","Military Hospital","Missing","Port Hospital","Military Hospital"],[-13.2231931914572,-13.2354719577436,-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2228638912441,-13.222625321098,-13.2565628977111,-13.2243703238737,-13.2369393782451,-13.2331547837254,-13.2222002700958,-13.2149474159902,-13.2180326141688,-13.2535215623253,-13.217651519706,-13.2372027220014,-13.2190654487695,-13.2189533374241,-13.209391925612,-13.2265780018024,-13.2619688324425,-13.2124311244169,-13.2371313571269,-13.2195578885261,-13.2336087079551,-13.2130045468176,-13.2160657166043,-13.2162953240809,-13.2355883289789,-13.247814368147,-13.2142410663192,-13.2614705796373,-13.2630592726116,-13.2343341712241,-13.2087039682346,-13.2581175859281,-13.2379376608352,-13.218781651651,-13.2483677722899,-13.2155668757305,-13.2333516655879,-13.238964614443,-13.2163318124535,-13.2217866965605,-13.2221173306518,-13.2510797882678,-13.262635786914,-13.2472895700622,-13.2597714344876],[8.47325128269697,8.4627682729487,8.46897295100924,8.45171855856465,8.46481700596819,8.46082377490923,8.46183062600728,8.48379248016347,8.47024789713924,8.46916113869591,8.46272931462646,8.46388925014565,8.45192988292173,8.47155535608018,8.45884880725177,8.46236804334872,8.46956119136946,8.47737640975659,8.45136291368722,8.47570184950483,8.48676680560442,8.48475855218221,8.45344099552146,8.48777544809491,8.46210832824745,8.47804840685363,8.47135450705077,8.48802917129884,8.46395131808455,8.4728562695215,8.47038713612408,8.4641347894342,8.45750552360835,8.47493999153642,8.47832062438022,8.4763997148275,8.45535258467199,8.4697737543226,8.48438437371817,8.48466158574339,8.4627846208641,8.46517148129756,8.48776686246878,8.4630635336683,8.4623972994508,8.46420961833913,8.47178418137766,8.4632880274758,8.48450777619227,8.45925216791802],["2ae019","20b688","f547d6",null,null,"11f8ea","aec8ec","4b38b7","53da57","e02f66","893f25",null,"5387a2","cbbe78","a2086d","ba7326",null,"3ff1bc",null,"9f6884",null,"057e7a","e61cb9",null,null,null,null,null,"ea3740",null,"71577a",null,null,"567136","894024","894024","71577a","b0c500","eb2277",null,"af1c1f",null,"62a2ef",null,"67be4e","d15be5","f36522","312ecf","26c588","e26da6"],["other","other","other",null,null,"other","other","other","other","other","other",null,"other","funeral","other","other",null,"funeral",null,"other",null,"other","other",null,null,null,null,null,"other",null,"other",null,null,"other","funeral","funeral","other","other","funeral",null,"other",null,"other",null,"other","other","other","other","other","other"],[18,35,78,18,68,66,57,25,64,41,72,45,29,53,71,77,52,71,0,35,45,82,92,34,40,42,67,75,66,52,84,39,66,52,55,60,67,59,75,28,61,55,77,68,51,44,88,46,33,53],[50,74,148,61,198,161,116,48,156,75,144,109,99,140,157,146,118,162,22,62,58,195,257,114,144,96,206,172,176,125,229,88,177,88,150,151,169,136,186,24,124,147,163,167,152,89,188,112,72,139],[22,21,22,23,21,21,22,20,22,23,22,20,22,22,21,22,22,23,23,21,23,20,22,22,22,22,22,22,22,22,23,23,23,22,23,23,20,22,21,22,23,23,23,20,21,21,22,21,22,23],[null,"no","no",null,null,"no",null,"no","no","no","no","no","no","no",null,null,null,"no","no",null,"no","no","no","no","no",null,"no",null,null,"no",null,null,"no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no"],[null,"no","yes",null,null,"no",null,"yes","no","no","no","no","yes","yes",null,null,null,"no","no",null,"no","no","no","no","no",null,"no",null,null,"no",null,null,"yes",null,"no","no","no","yes","no","no","no","yes","yes","yes","no","no",null,"no","no","yes"],[null,"yes","yes",null,null,"yes",null,"no","yes","yes","yes","no","yes","yes",null,null,null,"yes","yes",null,"yes","no","yes","yes","yes",null,"yes",null,null,"yes",null,null,"yes",null,"no","yes","yes","yes","yes","no","yes","yes","no","yes","yes","yes",null,"yes","yes","yes"],[null,"no","yes",null,null,"no",null,"no","no","no","no","no","no","no",null,null,null,"no","no",null,"no","no","no","no","no",null,"no",null,null,"no",null,null,"no",null,"no","no","no","no","no","no","no","no","yes","no","no","yes",null,"no","no","no"],[null,"yes","yes",null,null,"yes",null,"yes","yes","no","yes","no","yes","yes",null,null,null,"no","yes",null,"no","yes","yes","no","yes",null,"yes",null,null,"yes",null,null,"no",null,"yes","yes","no","no","no","no","yes","yes","no","yes","no","no",null,"no","yes","no"],[37.3,37.4,37,36,36.7,37.3,36.8,37,36.4,37.2,37.3,36.9,37,36.9,37.3,37.1,36.7,36.6,37.7,37.6,36.8,36.9,36.6,37.7,37,36.4,36.4,37.4,36.3,37,37.5,37.8,36.8,37.5,37.4,36.5,37.2,36.6,37.3,36.3,37.2,36.9,36.4,36.4,36.2,37,37.2,37.3,36.4,37.5],["20:35","14:16","09:17","11:32","18:52","16:51",null,"14:29","11:57","09:21","13:08","23:20","17:29",null,"18:39",null,"14:16",null,"08:00","11:43","11:10","15:10","11:53","19:11",null,"14:26","04:17","17:32",null,null,"12:28",null,"10:12","10:39","16:46","19:50","16:06","13:52","11:28","07:40","12:60","15:24","06:27","06:17","09:36","14:01","17:06","12:57","13:07",null],[72,63.9152666179693,35.6099342585829,48.3740929857565,17.3451688603204,25.4619806334632,42.3602853745541,108.506944444444,26.2984878369494,72.8888888888889,34.7222222222222,37.8755996969952,29.5888174676053,27.0408163265306,28.8044139721693,36.1231000187652,37.3455903476013,27.0538027739674,0,91.05098855359,133.769322235434,21.5647600262985,13.9290526730155,26.1618959679902,19.2901234567901,45.5729166666667,15.7884814779904,25.3515413737155,21.3068181818182,33.28,16.018001182281,50.3615702479339,21.0667432730058,67.1487603305785,24.4444444444444,26.3146353230121,23.458562375267,31.8987889273356,21.6788067984738,486.111111111111,39.6722164412071,25.4523578138738,28.9811434378411,24.3823729785937,22.0740997229917,55.5485418507764,24.8981439565414,36.6709183673469,63.6574074074074,27.431292376171],[2,2,2,1,2,1,1,2,2,1,2,0,1,1,1,1,1,2,2,0,2,1,0,0,1,1,2,1,2,2,1,2,1,0,2,0,2,2,2,1,2,1,1,1,2,2,0,0,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Case counts aggregated by hospital</strong></p>
<p>The first 50 rows are displayed</p>
<div id="htmlwidget-601676b788506f067476" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-601676b788506f067476">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="set-parameters" class="section level3 unnumbered">
<h3>Set parameters<a class="anchor" aria-label="anchor" href="#set-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>You may want to set editable parameters for production of a report, such as the date for which the data is current (the “data date”).
You can then reference <code>data_date</code> in the code when applying filters or in captions that auto-update.</p>
<div class="sourceCode" id="cb1112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set the report date for the report</span>
<span class="co">## note: can be set to Sys.Date() for the current date</span>
<span class="va">data_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-05-15"</span><span class="op">)</span></code></pre></div>
</div>
<div id="verify-dates" class="section level3 unnumbered">
<h3>Verify dates<a class="anchor" aria-label="anchor" href="#verify-dates"><i class="fas fa-link"></i></a>
</h3>
<p>Verify that each relevant date column is class Date and has an appropriate range of values.</p>
<p>You can do this one-by-one using <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code> for histograms, or <code><a href="https://rdrr.io/r/base/range.html">range()</a></code> with <code>na.rm=TRUE</code>.</p>
<p>An alternative is to use a <em>for loop</em> to print a histogram for each pre-defined date column.</p>
<div class="sourceCode" id="cb1113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create character vector of column names </span>
<span class="va">DateCols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/vars_select.html">vars_select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"date|Date|dt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Produce histogram of each date column</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">Col</span> <span class="kw">in</span> <span class="va">DateCols</span><span class="op">)</span> <span class="op">{</span>     <span class="co"># open loop. iterate for each name in vector DateCols</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">[</span>, <span class="va">Col</span><span class="op">]</span>,     <span class="co"># print histogram of the column in linelist dataframe</span>
       breaks <span class="op">=</span> <span class="fl">50</span>,         <span class="co"># number of breaks for the histogram</span>
       xlab <span class="op">=</span> <span class="va">Col</span><span class="op">)</span>          <span class="co"># x-axis label is the name of the column</span>
  <span class="op">}</span>                         <span class="co"># close the loop</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-709-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-709-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-709-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-709-4.png" width="50%"></p>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurves-with-incidence-package" class="section level2" number="28.2">
<h2>
<span class="header-section-number">28.2</span> Epicurves with <code>incidence</code> package<a class="anchor" aria-label="anchor" href="#epicurves-with-incidence-package"><i class="fas fa-link"></i></a>
</h2>
<p>Below we demonstrate how to make epicurves using the <strong>incidence</strong> package.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> The <strong>incidence</strong> package currently expects data to be in a “linelist” format of one row per case (not aggregated counts). If your data is aggregated counts, read the section on aggregated data using <strong>ggplot2</strong>.</span></p>
<p>The documentation for plotting an <strong>incidence</strong> object can be accessed by entering <code>?plot.incidence</code> in your R console. For further information see this <a href="https://cran.r-project.org/web/packages/incidence/vignettes/customize_plot.html#example-data-simulated-ebola-outbreak">incidence package vignette</a>.</p>
<!-- ======================================================= -->
<div id="simple-example" class="section level3 unnumbered">
<h3>Simple example<a class="anchor" aria-label="anchor" href="#simple-example"><i class="fas fa-link"></i></a>
</h3>
<p><strong>2 steps are requires to plot an epicurve with the <em>incidence</em> package:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Create</strong> an <em>incidence object</em> (using the function <code>incidence()</code>)
<ul>
<li>Provide the case linelist<br>
</li>
<li>Specify the <em>time interval</em> into which the cases should be aggregated (daily, weekly, monthly..)<br>
</li>
<li>Specify any sub-groups<br>
</li>
</ul>
</li>
<li>
<strong>Plot</strong> the incidence object
<ul>
<li>Specify labels, aesthetic themes, etc.</li>
</ul>
</li>
</ol>
<p><strong>A simple example</strong> - an epicurve of daily cases:</p>
<div class="sourceCode" id="cb1114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load incidence package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">incidence</span><span class="op">)</span>

<span class="co"># create the incidence object, aggregating cases by day</span>
<span class="va">epi_day</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>,  <span class="co"># the dataset and date column of interest</span>
                     interval <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>     <span class="co"># the time interval</span>

<span class="co"># plot the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_day</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-710-1.png" width="672"></div>
</div>
<div id="change-time-interval-of-case-aggregation" class="section level3 unnumbered">
<h3>Change time interval of case aggregation<a class="anchor" aria-label="anchor" href="#change-time-interval-of-case-aggregation"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>interval</code> argument of <code>incidence()</code> defines how the observations are grouped into vertical bars. Some options are given below:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Argument option</th>
<th>Further explanation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>“week”</td>
<td>note: Monday start day is default</td>
</tr>
<tr class="even">
<td>“2 weeks”</td>
<td>or 3, 4, 5…</td>
</tr>
<tr class="odd">
<td>“Sunday week”</td>
<td>weeks beginning on Sundays</td>
</tr>
<tr class="even">
<td>“2 Sunday weeks”</td>
<td>or 3, 4, 5…</td>
</tr>
<tr class="odd">
<td>“MMWRweek”</td>
<td>week starts on Sundays - see US CDC</td>
</tr>
<tr class="even">
<td>“month”</td>
<td>1st of month</td>
</tr>
<tr class="odd">
<td>“quarter”</td>
<td>1st of month of quarter</td>
</tr>
<tr class="even">
<td>“2 months”</td>
<td>or 3, 4, 5…</td>
</tr>
<tr class="odd">
<td>“year”</td>
<td>1st day of calendar year</td>
</tr>
</tbody>
</table></div>
<p>Below are examples of how different intervals look when applied to the linelist. The format and frequency of the date <em>labels</em> on the x-axis are the defaults for the specified interval.</p>
<div class="sourceCode" id="cb1115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create the incidence objects (with different intervals)</span>
<span class="co">##############################</span>
<span class="co"># Weekly (Monday week by default)</span>
<span class="va">epi_wk</span>      <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span>

<span class="co"># Sunday week</span>
<span class="va">epi_Sun_wk</span>  <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span>

<span class="co"># Three weeks (Monday weeks by default)</span>
<span class="va">epi_3wk</span>     <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>

<span class="co"># Monthly</span>
<span class="va">epi_month</span>   <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span>


<span class="co"># Plot the incidence objects (+ titles for clarity)</span>
<span class="co">############################</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_wk</span><span class="op">)</span><span class="op">+</span>     <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Monday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_Sun_wk</span><span class="op">)</span><span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sunday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_3wk</span><span class="op">)</span><span class="op">+</span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"3 (Monday) weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_month</span><span class="op">)</span><span class="op">+</span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Months"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/incidence-1.png" width="50%"><img src="_main_files/figure-html/incidence-2.png" width="50%"><img src="_main_files/figure-html/incidence-3.png" width="50%"><img src="_main_files/figure-html/incidence-4.png" width="50%"></p>
</div>
<div id="filtered-data" class="section level3 unnumbered">
<h3>Filtered data<a class="anchor" aria-label="anchor" href="#filtered-data"><i class="fas fa-link"></i></a>
</h3>
<p>To plot the epicurve of a subset of data:</p>
<ol style="list-style-type: decimal">
<li>Filter the linelist data<br>
</li>
<li>Provide the filtered data to the <code>incidence()</code> command<br>
</li>
<li>Plot the incidence object</li>
</ol>
<p>The example below uses data filtered to show only cases at Central Hospital.</p>
<div class="sourceCode" id="cb1116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>

<span class="co"># plot the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weekly case incidence at Central Hospital"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-711-1.png" width="672"></div>
</div>
<div id="modifications-with-plot" class="section level3 unnumbered">
<h3>Modifications with <code>plot()</code><a class="anchor" aria-label="anchor" href="#modifications-with-plot"><i class="fas fa-link"></i></a>
</h3>
<p>An epicurve produced by <strong>incidence</strong> can be modified via these arguments <em>within the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function</em>.</p>
<ul>
<li>
<code>show_cases =</code> Logical; if TRUE, each case is shows as a box. Displays best on smaller outbreaks.<br>
</li>
<li>
<code>color =</code> Color of case bars/boxes<br>
</li>
<li>
<code>border =</code> Color of line around boxes, if <code>show_cases = TRUE</code><br>
</li>
<li>
<code>alpha =</code> Transparency of case bars/boxes (1 is fully opaque, 0 is fully transparent)<br>
</li>
<li>
<code>xlab =</code> Title of x-axis<br>
</li>
<li>
<code>ylab =</code> Title of y-axis - defaults to user-defined incidence time interval<br>
</li>
<li>
<code>labels_week =</code> Logical; whether x-axis labels are in week format (YYYY-Www) or date format (YYYY-MM-DD), absent other modifications</li>
<li>
<code>n_breaks =</code> Number of x-axis label breaks, absent other modifications<br>
</li>
<li>
<code>first_date</code> &amp; <code>last_date</code> Dates used to limit the date axis of the plot</li>
</ul>
<p>Type <code>?plot.incidence</code> in the R console for more details on each. Below is an example using some of the above arguments.</p>
<p>To further adjust plot appearance, see the section on using <code>ggplot()</code> to apply <code>theme()</code> arguments to the <strong>incidence</strong> plot.</p>
<div class="sourceCode" id="cb1117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span>,
     xlab <span class="op">=</span> <span class="st">"Week of onset"</span>,
     ylab <span class="op">=</span> <span class="st">"Week of onset"</span>,
     show_cases <span class="op">=</span> <span class="cn">TRUE</span>,       <span class="co"># show each case as an individual box</span>
     alpha <span class="op">=</span> <span class="fl">0.5</span>,
     color <span class="op">=</span> <span class="st">"darkblue"</span>,
     border <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-712-1.png" width="50%"></div>
</div>
<div id="modifications-with-ggplot2" class="section level3 unnumbered">
<h3>Modifications with ggplot2<a class="anchor" aria-label="anchor" href="#modifications-with-ggplot2"><i class="fas fa-link"></i></a>
</h3>
<p>You can add <strong>ggplot2</strong> modifications to the incidence plot by adding a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> after the close of the incidence <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, as demonstrated below. See the <strong>ggplot2</strong> section and page on <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> for more options.</p>
<div class="sourceCode" id="cb1118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span>,         <span class="co"># plot with incidence package and arguments</span>
     xlab <span class="op">=</span> <span class="st">"Week of onset"</span>,
     ylab <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,
     show_cases <span class="op">=</span> <span class="cn">TRUE</span>,
     alpha <span class="op">=</span> <span class="fl">0.5</span>,
     color <span class="op">=</span> <span class="st">"darkblue"</span>,
     border <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># Add modifications using ggplot() functions</span>
  <span class="co">############################################</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>            <span class="co"># convert to ggplot date scale (changes default label format)</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># remove excess space on left and right</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># remove excess space below 0 on y-axis</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Incidence plot with ggplot() modifications"</span>,
    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span>                            <span class="co"># dynamic caption - see page on characters and strings</span>
      <span class="st">"n = {central_cases} from Central Hospital
      Case onsets range from {earliest_date} to {latest_date}. {missing_onset} cases are missing date of onset and not shown"</span>,
      central_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span>,
      earliest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">'%a %d %b %Y'</span><span class="op">)</span>,
      latest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">'%a %d %b %Y'</span><span class="op">)</span>,      
      missing_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">central_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>         <span class="co"># simplify background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, <span class="co"># axis titles larger and bold</span>
    axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,  <span class="co"># axis text size and bold</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>               <span class="co"># move caption to left</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-713-1.png" width="672"></div>
</div>
<div id="group-and-color-by-values" class="section level3 unnumbered">
<h3>Group and color by values<a class="anchor" aria-label="anchor" href="#group-and-color-by-values"><i class="fas fa-link"></i></a>
</h3>
<p>To color cases by a value, provide the column to the <code>groups =</code> argument in the <code>incidence()</code> command.</p>
<p>In the example below the cases in the whole outbreak are colored by their age category. Note the use of <code>incidence()</code> argument <code>na_as_group =</code>. If <code>TRUE</code> (by default), missing values (<code>NA</code>) will form their own group. To adjust the legend title, add the <strong>ggplot2</strong> function <code>labs()</code> as shown in the second plot, specifying a label for <code>fill =</code>.</p>
<div class="sourceCode" id="cb1119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category</span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>,            <span class="co"># date of onset for x-axis</span>
                               interval <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># Monday weekly aggregation of cases</span>
                               groups <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, <span class="co"># color by age_cat value</span>
                               na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>        <span class="co"># missing values assigned their own group</span>


<span class="co"># plot the grouped incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span><span class="op">)</span>

<span class="co"># plot the grouped incidence object, specifying legend title</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Age category"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-714-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-714-2.png" width="50%"></p>
</div>
<div id="change-colors" class="section level3 unnumbered">
<h3>Change colors<a class="anchor" aria-label="anchor" href="#change-colors"><i class="fas fa-link"></i></a>
</h3>
<p>To specify colors manually, provide the name of the color or a character vector of colors to the argument <code>color =</code>. The number of colors listed must equal the number of groups (be aware of missing values as a group)</p>
<div class="sourceCode" id="cb1120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># weekly outbreak by hospital</span>
<span class="va">hosp_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, 
                               interval <span class="op">=</span> <span class="st">"week"</span>, 
                               groups <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,
                               na_as_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>   <span class="co"># Missing values not assigned their own group</span>
<span class="co"># default colors</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hosp_outbreak</span><span class="op">)</span>

<span class="co"># manual colors</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hosp_outbreak</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"darkblue"</span>, <span class="st">"purple"</span>, <span class="st">"grey"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-715-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-715-2.png" width="50%"></p>
<div id="change-color-palette" class="section level4 unnumbered">
<h4>Change color palette<a class="anchor" aria-label="anchor" href="#change-color-palette"><i class="fas fa-link"></i></a>
</h4>
<p>Use the argument <code>col_pal</code> in <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> to change the color palette to one of the default <strong>base</strong> R palettes (do <em>not</em> put the name of the palette in quotes).</p>
<p>Alternatively, adjust the palette with <strong>ggplot2</strong> “fill” scales - see the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page for details.</p>
<div class="sourceCode" id="cb1121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category</span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>,            <span class="co"># date of onset for x-axis</span>
                               interval <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># weekly aggregation of cases</span>
                               groups <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, <span class="co"># color by age_cat value</span>
                               na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>        <span class="co"># missing values assigned their own group</span>

<span class="co"># plot the epicurve with default palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span><span class="op">)</span>

<span class="co"># plot with different color palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, col_pal <span class="op">=</span> <span class="va">rainbow</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-716-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-716-2.png" width="50%"></p>
</div>
</div>
<div id="adjust-level-order-1" class="section level3 unnumbered">
<h3>Adjust level order<a class="anchor" aria-label="anchor" href="#adjust-level-order-1"><i class="fas fa-link"></i></a>
</h3>
<p>To adjust the order of group appearance (on plot and in legend), the grouping column must be class Factor. See the page on <a href="factors.html#factors">Factors</a> for more information.</p>
<p>Below is an epicurve by gender, and the objective is to show “Missing” on the top of the epicurve, “Male” in the middle, and “Female” on the bottom - but to have the Legend in the reverse order so that Missing is on the bottom of the legend.</p>
<p>First, let’s see the plot with the default ordering:</p>
<div class="sourceCode" id="cb1122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ORIGINAL - hospital NOT as factor</span>
<span class="co">###################################</span>

<span class="co"># create weekly incidence object, rows grouped by hospital and week</span>
<span class="va">hospital_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, 
  interval <span class="op">=</span> <span class="st">"week"</span>, 
  groups <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hospital_outbreak</span>,
     show_cases <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ORIGINAL - hospital not a factor"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-717-1.png" width="672"></div>
<p>Now, to make some changes to the levels we can do the following:</p>
<ul>
<li>The package <strong>forcats</strong> is loaded, to work with factors<br>
</li>
<li>A dataset for plotting is defined in which:
<ul>
<li>the <code>gender</code> column is re-defined as a factor with <code>as_factor()</code><br>
</li>
<li>missing values (<code>NA</code>) are converted to “Missing” with <code>fct_explicit_na()</code><br>
</li>
<li>low-count groups are combined into “Other”, we leave the top 3 with <code>fct_lump()</code><br>
</li>
<li>the order of levels are defined with “Other” and “Missing” first, so they appears at the top of the bars<br>
</li>
</ul>
</li>
<li>The incidence object is created and plotted as before
<ul>
<li>Specify colors so that “Missing” is grey, change background to white<br>
</li>
<li>The order of the legend is reversed using <code>guides()</code> from <strong>ggplot2</strong>
</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb1123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># MODIFIED - hospital as factor</span>
<span class="co">###############################</span>

<span class="co"># load forcats package for working with factors</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span>

<span class="co"># Convert hospital column to factor and adjust levels</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                      <span class="co"># define as factor</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># convert NA to "Missing" </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_lump</span><span class="op">(</span><span class="va">hospital</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                <span class="co"># Keep 3 most frequent hospitals, with remaining combined into "Other" </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Set "Missing" and "Other" as top levels</span>


<span class="co"># Create weekly incidence object, grouped by hospital and week</span>
<span class="va">hospital_outbreak_mod</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">plot_data</span><span class="op">$</span><span class="va">date_onset</span>, 
  interval <span class="op">=</span> <span class="st">"week"</span>, 
  groups <span class="op">=</span> <span class="va">plot_data</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hospital_outbreak_mod</span>,
     show_cases <span class="op">=</span> <span class="cn">FALSE</span>,    <span class="co"># do NOT show box around each case</span>
     color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"darkgreen"</span>, <span class="st">"brown"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># specify colors                      </span>
  
  <span class="co"># ggplot modifications     </span>
  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># reverse order of legend only</span>
  
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>

  <span class="co"># labels added via ggplot</span>
  <span class="fu">labs</span><span class="op">(</span>
      title <span class="op">=</span> <span class="st">"MODIFIED - hospital as factor"</span>,   <span class="co"># plot title</span>
      subtitle <span class="op">=</span> <span class="st">"Other &amp; Missing at top of epicurve and bottom of legend and fewer categories"</span>,
      y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,               <span class="co"># y axis title  </span>
      x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,               <span class="co"># x axis title</span>
      fill <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>                         <span class="co"># title of legend     </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-718-1.png" width="672"></div>
</div>
<div id="change-legend" class="section level3 unnumbered">
<h3>Change legend<a class="anchor" aria-label="anchor" href="#change-legend"><i class="fas fa-link"></i></a>
</h3>
<p>Add <strong>ggplot2</strong> commands to the incidence plot, such as:</p>
<ul>
<li>
<code>labs(fill = "Legend title")</code> to change the legend title<br>
</li>
<li>
<code>theme(legend.title = element_blank())</code> to remove the legend title<br>
</li>
<li>
<code>theme(legend.position = "top")</code> (or “bottom”, “left”, “right”)</li>
<li>
<code>theme(legend.direction = "horizontal")</code><br>
</li>
<li>
<code>guides(fill = guide_legend(reverse = TRUE))</code> to reverse order of the legend</li>
</ul>
<p>See the page of <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> for more details on working with legends.</p>
</div>
<div id="date-axis-labelsgridlines" class="section level3 unnumbered">
<h3>Date-axis labels/gridlines<a class="anchor" aria-label="anchor" href="#date-axis-labelsgridlines"><i class="fas fa-link"></i></a>
</h3>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Remember that date-axis <strong>labels</strong> are independent from the aggregation of the data into bars</span></p>
<div id="modify-the-bars" class="section level4 unnumbered">
<h4>Modify the bars<a class="anchor" aria-label="anchor" href="#modify-the-bars"><i class="fas fa-link"></i></a>
</h4>
<p>The aggregation of data into bars occurs when you set the <code>interval =</code> when creating the incidence object. The options for <code>interval</code> include options like “day”, “Monday week”, “Sunday week”, “month”, “2 weeks”, etc, as described in an earlier section.</p>
</div>
<div id="modify-date-axis-labels-frequency-format" class="section level4 unnumbered">
<h4>Modify date-axis labels (frequency &amp; format)<a class="anchor" aria-label="anchor" href="#modify-date-axis-labels-frequency-format"><i class="fas fa-link"></i></a>
</h4>
<p>If working with the <strong>incidence</strong> package, you have several options to make modifications to the date-axis labels:</p>
<ol style="list-style-type: decimal">
<li>Add <strong>incidence</strong> package functions <code>scale_x_incidence()</code> and <code>make_breaks()</code><br>
</li>
<li>Add the <strong>ggplot2</strong> function <code>scale_x_date()</code> and arguments such as <code>date_breaks =</code> and <code>date_labels =</code><br>
</li>
<li>Use a combination of the above</li>
</ol>
</div>
<div id="option-1-add-scale_x_incidence-only" class="section level4 unnumbered">
<h4>Option 1: Add <code>scale_x_incidence()</code> only<a class="anchor" aria-label="anchor" href="#option-1-add-scale_x_incidence-only"><i class="fas fa-link"></i></a>
</h4>
<p><code>scale_x_incidence()</code> is from the <strong>incidence</strong> package.</p>
<ul>
<li>
<strong>Advantages</strong>: Short code. Auto-adjusts weekly labels to the interval of incidence object (Monday, Sunday weeks, etc.)<br>
</li>
<li>
<strong>Disadvantages</strong>: Cannot make <em>fine</em> adjustments to label format, nor to minor vertical grid-lines between labels<br>
</li>
<li>
<strong>Syntax</strong>: Provide the name of the incidence object to ensure date labels align with specified interval (e.g. Sunday or Monday weeks)</li>
</ul>
<p>Optional arguments:</p>
<ul>
<li>Use <code>n_breaks =</code> to specify the number of date labels, which start from the beginning of the <em>interval</em> of the first case
<ul>
<li>Tip: for breaks every nth interval, use <code>n_breaks = nrow(i)/n</code> (where “i” is the incidence object name and “n” is a number)<br>
</li>
</ul>
</li>
<li>Use <code>labels_week =</code> to adjust whether labels are formatted as weeks (YYYY-Www) or dates (YYYY-MM-DD)
<ul>
<li>One vertical gridline will appear per date label</li>
</ul>
</li>
</ul>
<p>Other notes:</p>
<ul>
<li>If the interval is “month”, <code>n_breaks</code> and <code>labels_week</code> will behave differently<br>
</li>
<li>Adding <strong>ggplot2</strong>’s <code>scale_x_date()</code> to the plot will remove any labels created by <code>scale_x_incidence</code>
</li>
<li>Type <code>?scale_x_incidence</code> into the R console to see more information</li>
</ul>
<p>See how in the plot below (with Sunday week interval), the first date label is 27 April 2014, which is the Sunday before the first case on May 1</p>
<div class="sourceCode" id="cb1124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create weekly incidence object (Sunday weeks)</span>
<span class="va">outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span>

<span class="co"># plot with scale_x_incidence()</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_incidence</span><span class="op">(</span><span class="va">outbreak</span>,             <span class="co"># name of incidence object</span>
                    labels_week <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># show dates instead of weeks</span>
                    n_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">outbreak</span><span class="op">)</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span> <span class="co"># breaks every 8 weeks from Sunday before first case</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-719-1.png" width="672"></div>
</div>
<div id="option-2-scale_x_date-and-make_breaks" class="section level4 unnumbered">
<h4>Option 2: <code>scale_x_date()</code> and <code>make_breaks()</code><a class="anchor" aria-label="anchor" href="#option-2-scale_x_date-and-make_breaks"><i class="fas fa-link"></i></a>
</h4>
<p>Add <code>scale_x_date()</code> from <strong>ggplot2</strong>, but also leverage <code>make_breaks()</code> from <strong>incidence</strong>:</p>
<ul>
<li>
<strong>Advantages</strong>: Best of both worlds: weekly labels auto-aligned to incidence interval, <em>and</em> you can make detailed adjustments to label format<br>
</li>
<li>
<strong>Disadvantages</strong>: <em>If</em> your want minor grid-lines on Sunday-week date labels, they are not auto-aligned, see Option 3</li>
</ul>
<p>Steps:</p>
<ol style="list-style-type: decimal">
<li>Creating the incidence object<br>
</li>
<li>Make a vector of date breaks using <code>make_breaks()</code>, which is similar to <code>scale_x_incidence()</code>. Provide the incidence object name and optionally <code>n_breaks</code> as described above.<br>
</li>
<li>Add <code>scale_x_date()</code> to the incidence plot and use the following arguments:<br>
</li>
</ol>
<ul>
<li>
<code>breaks =</code> provide the breaks vector you created with <code>make_breaks()</code>, by accessing the <code>$breaks</code> vector (see example below)<br>
</li>
<li>
<code>date_labels =</code> you can make fine adjustments to date label format (e.g. “%d %b”) (use “” for new line)<br>
</li>
<li>
<code>date_minor_breaks =</code> Sets frequency of minor gridlines, e.g. “weeks”. If using Sunday weeks and you want minor gridlines see Option 3.</li>
</ul>
<p>Note how in the example below, the incidence object interval is Monday weeks, and the first date label is 28 April, the Monday before the first case reported 1 May.</p>
<div class="sourceCode" id="cb1125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Break modification using scale_x_date() and make_breaks()</span>
<span class="co">###########################################################</span>
<span class="co"># make incidence object</span>
<span class="va">outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span>

<span class="co"># make breaks</span>
<span class="va">my_labels</span> <span class="op">&lt;-</span>  <span class="fu">make_breaks</span><span class="op">(</span><span class="va">outbreak</span>, n_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">outbreak</span><span class="op">)</span><span class="op">/</span><span class="fl">6</span><span class="op">)</span> <span class="co"># breaks every 6 weeks</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    breaks            <span class="op">=</span> <span class="va">my_labels</span><span class="op">$</span><span class="va">breaks</span>, <span class="co"># use $breaks on the make_breaks() output</span>
    date_labels       <span class="op">=</span> <span class="st">"%d %b\n%Y"</span>,      <span class="co"># detailed adjustment to date label format</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span>          <span class="co"># vertical lines each week (only works for Monday week incidence objects)  </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-720-1.png" width="672"></div>
</div>
<div id="option-3-use-scale_x_date-only" class="section level4 unnumbered">
<h4>Option 3: Use <code>scale_x_date()</code> only<a class="anchor" aria-label="anchor" href="#option-3-use-scale_x_date-only"><i class="fas fa-link"></i></a>
</h4>
<p>Add only <code>scale_x_date()</code> from <strong>ggplot2</strong> to the incidence plot:</p>
<ul>
<li>
<strong>Advantages</strong>: Complete control over breaks, labels, gridlines, and plot width<br>
</li>
<li>
<strong>Disadvantages</strong>: More code required, more opportunity to make mistakes</li>
</ul>
<p>Syntax:</p>
<p>If your incidence intervals are <strong>days</strong> or <strong>Monday weeks</strong> it’s easy!:</p>
<ul>
<li>Provide an interval for date labels to <code>date_breaks =</code> (e.g. “day”, “week”, “2 weeks”, “month”, “year”)</li>
<li>Provide an interval for minor vertical grid lines interval to <code>date_minor_breaks =</code>
</li>
</ul>
<div class="sourceCode" id="cb1126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Date break modification using scale_x_date() only</span>
<span class="co">###################################################</span>

<span class="co"># make incidence object</span>
<span class="va">outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># date labels appear every 3 Monday weeks</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># minor vertical lines appear every Monday week</span>
               date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span>  <span class="co"># date labels format </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-721-1.png" width="672"></div>
<p>If your incidence intervals are <strong>Sunday weeks</strong>, the code required is more complex - see below for a Sunday week example</p>
<ul>
<li>Provide a sequence of Sunday dates to <code>breaks =</code> and to <code>minor_breaks =</code><br>
</li>
<li>Use <code>date_labels =</code> for formatting (see Dates page for tips)<br>
</li>
<li>Add the argument <code>expand = c(0,0)</code> to start labels at the first incidence bar. Otherwise, the first label will shift depending on your specified label interval.</li>
</ul>
</div>
<div id="a-sunday-week-example" class="section level4 unnumbered">
<h4>A Sunday week example<a class="anchor" aria-label="anchor" href="#a-sunday-week-example"><i class="fas fa-link"></i></a>
</h4>
<p>If you want a plot of Sunday weeks and also finely-adjusted label formats, you might find this code example helpful.<br>
Here is an example of producing a weekly epicurve using <strong>incidence</strong> for Sunday weeks, with finely-adjusted date labels through <strong>ggplot2</strong>’s <code>scale_x_date()</code>:</p>
<div class="sourceCode" id="cb1127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load packages</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>,  <span class="co"># for ggplot</span>
               <span class="va">incidence</span>,  <span class="co"># for epicurve</span>
               <span class="va">lubridate</span><span class="op">)</span>  <span class="co"># for floor_date() and ceiling_date()</span>

<span class="co"># create incidence object (specifying SUNDAY weeks)</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>,
                              interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span> <span class="co"># equivalent to "MMWRweek" (see US CDC)</span>

<span class="co"># plot() the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span><span class="op">)</span><span class="op">+</span>                  
  
  <span class="co">### ggplot() commands added to the plot</span>
  
  <span class="co"># Date-axis </span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    
    <span class="co"># remove excess x-axis space below and after case bars</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                 
    
    <span class="co"># date labels every 3 weeks, from Sunday before first case to Sunday after last case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
    
    <span class="co"># grid-lines every week, from Sunday before first case to Sunday after last case</span>
    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    <span class="co"># date labels format</span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>       
  
  <span class="co"># Y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># remove excess space under x-axis</span>
  
  <span class="co"># Aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                    <span class="co"># simplify background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,       <span class="co"># axis titles formatting</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># caption formatting, left-aligned</span>
  
  <span class="co"># Plot labels</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week of symptom onset (Sunday weeks)"</span>, 
       y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>, 
       title <span class="op">=</span> <span class="st">"Weekly case incidence at Central Hospital (Sunday weeks)"</span>,
       <span class="co">#subtitle = "",</span>
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-722-1.png" width="672"></div>
</div>
</div>
<div id="facetssmall-multiples" class="section level3 unnumbered">
<h3>Facets/small multiples<a class="anchor" aria-label="anchor" href="#facetssmall-multiples"><i class="fas fa-link"></i></a>
</h3>
<p>To facet the plot by a variable (make “small multiples”), you must do this via <strong>ggplot2</strong>. See the section on facets.</p>
</div>
<div id="other-tips" class="section level3" number="28.2.1">
<h3>
<span class="header-section-number">28.2.1</span> Other tips<a class="anchor" aria-label="anchor" href="#other-tips"><i class="fas fa-link"></i></a>
</h3>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Be cautious if a static y-axis scale (e.g. 0 to 30 by 5: <code><a href="https://rdrr.io/r/base/seq.html">seq(0, 30, 5)</a></code>). Static numbers can cut-off your data if the data changes!.</span></p>
<p>Note: if using aggregated counts (for example an epiweek x-axis) your x-axis may not be Date class and may require use <code>scale_x_discrete()</code> instead of <code>scale_x_date()</code> - see section on aggregated data epicurves for more details.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurves-with-ggplot2" class="section level2" number="28.3">
<h2>
<span class="header-section-number">28.3</span> Epicurves with ggplot2<a class="anchor" aria-label="anchor" href="#epicurves-with-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Using the <strong>ggplot2</strong> package alone to create an epicurve can offer more customizable plots, but also involves more code and potential for error:</p>
<p>Unlike using <strong>incidence</strong> package, you must manually control the aggregation of the data (into weeks, months, etc) <em>and</em> the labels on the date axis. If not carefully managed, this can lead to headaches.</p>
<p>These examples use a subset of the <code>linelist</code> dataset - only the cases from Central Hospital.</p>
<div class="sourceCode" id="cb1128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<div id="examples-2" class="section level3 unnumbered">
<h3>Examples<a class="anchor" aria-label="anchor" href="#examples-2"><i class="fas fa-link"></i></a>
</h3>
<p>To produce an epicurve with <code>ggplot()</code> there are three main elements:</p>
<ul>
<li>A histogram, to aggregate the linelisted cases into “bins” and display bars reflecting the counts per bin<br>
</li>
<li>Scales for the axes and their associated labels<br>
</li>
<li>Themes for the plot appearance, including titles, labels, captions, etc.</li>
</ul>
<div id="simplest-examples" class="section level4 unnumbered">
<h4>Simplest examples<a class="anchor" aria-label="anchor" href="#simplest-examples"><i class="fas fa-link"></i></a>
</h4>
<p>Below is perhaps the most simple code to produce daily and weekly epicurves.</p>
<div class="sourceCode" id="cb1129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># daily </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># x column must be class Date</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># cases binned by 1 day </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Daily"</span><span class="op">)</span>

<span class="co"># weekly</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># cases binned each 7 days, beginning from first case (!) </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weekly"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/ggplot_simple-1.png" width="50%"><img src="_main_files/figure-html/ggplot_simple-2.png" width="50%"></p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Using <code>binwidth = 7</code> starts the first bin at the first case, which could be any day of the week! To create specific Monday or Sunday weeks, see guidance below .</span></p>
</div>
<div id="specify-bin-start-dates" class="section level4 unnumbered">
<h4>Specify bin start dates<a class="anchor" aria-label="anchor" href="#specify-bin-start-dates"><i class="fas fa-link"></i></a>
</h4>
<p>To create weekly epicurves where the bins begin on a specific day of the week (e.g. Monday or Sunday), specify the histogram bin <code>breaks =</code> manually (not with <code>binwidth</code>). This can be done by creating a <strong>sequence of dates using the <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> function</strong> (<strong>base</strong> R):</p>
<p>This function expects <code>to =</code>, <code>from =</code>, and <code>by =</code> arguments as shown below.</p>
<div class="sourceCode" id="cb1130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-01-01"</span><span class="op">)</span>,
  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2016-01-01"</span><span class="op">)</span>,
  by <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "2015-01-01" "2015-02-01" "2015-03-01" "2015-04-01" "2015-05-01" "2015-06-01" "2015-07-01" "2015-08-01" "2015-09-01" "2015-10-01" "2015-11-01" "2015-12-01" "2016-01-01"</code></pre>
<p>You can start/end the sequence at a specific date, as shown above, or you can write flexible code to begin the sequence at a specific day of the week <em>before the first case</em>. An example of creating such dynamic weekly breaks is below:</p>
<div class="sourceCode" id="cb1132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sequence of dates from the Monday before the first case to the Monday after the last case, by week</span>
<span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "2014-04-28" "2014-05-05" "2014-05-12" "2014-05-19" "2014-05-26" "2014-06-02" "2014-06-09" "2014-06-16" "2014-06-23" "2014-06-30" "2014-07-07" "2014-07-14" "2014-07-21"
## [14] "2014-07-28" "2014-08-04" "2014-08-11" "2014-08-18" "2014-08-25" "2014-09-01" "2014-09-08" "2014-09-15" "2014-09-22" "2014-09-29" "2014-10-06" "2014-10-13" "2014-10-20"
## [27] "2014-10-27" "2014-11-03" "2014-11-10" "2014-11-17" "2014-11-24" "2014-12-01" "2014-12-08" "2014-12-15" "2014-12-22" "2014-12-29" "2015-01-05" "2015-01-12" "2015-01-19"
## [40] "2015-01-26" "2015-02-02" "2015-02-09" "2015-02-16" "2015-02-23" "2015-03-02" "2015-03-09" "2015-03-16" "2015-03-23" "2015-03-30" "2015-04-06" "2015-04-13" "2015-04-20"
## [53] "2015-04-27" "2015-05-04"</code></pre>
<p>Let’s unpack the rather daunting code above:</p>
<ul>
<li>The “from” value (earliest date of the sequence) is created as follows: the minimum date value (<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> with <code>na.rm=TRUE</code>) in the column <code>date_onset</code> is fed to <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package. <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> uses the specified arguments to return the start date of that “week”, given that the start of each week is a Monday (<code>week_start = 1</code>).<br>
</li>
<li>Likewise, the “to” value (end date of the sequence) is created using the inverse function <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date()</a></code> to return the Monday <em>after</em> the last case.<br>
</li>
<li>The “by” argument of <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> can be set to any number of days, weeks, or months.</li>
</ul>
<p>These sequences of dates can be used to create histogram bin breaks, but also the breaks for the date labels, which may be independent from the bins. Read more about the date labels in later sections.</p>
<p><strong>Below are detailed example codes to produce weekly epicurves for Monday weeks and for Sunday weeks.</strong></p>
</div>
<div id="monday-weeks-example" class="section level4 unnumbered">
<h4>Monday weeks example<a class="anchor" aria-label="anchor" href="#monday-weeks-example"><i class="fas fa-link"></i></a>
</h4>
<p>Of note:</p>
<ul>
<li>The break points of the <em>histogram bins</em> are specified manually to begin the Monday (<code>week_start = 1</code>) before the earliest case and to end the Monday after the last case (see explanation above).<br>
</li>
<li>The breaks for <em>date labels</em> on the x-axis are easy and use <code>date_breaks =</code> within <code>scale_x_date()</code> because we want Monday weeks. For Sunday weeks, see next example.<br>
</li>
<li>Minor vertical gridlines between date labels are made using <code>date_minor_breaks =</code> within <code>scale_x_date()</code>. Again, Sunday week alignment would use a slightly different method.<br>
</li>
<li>Adding <code>expand = c(0,0)</code> to the x and y scales removes excess space on each side of the axes, which also ensures the date labels begin at the first bar.<br>
</li>
<li>Color and fill of the bars are defined in <code>geom_histogram()</code>
</li>
</ul>
<div class="sourceCode" id="cb1134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL MONDAY WEEK ALIGNMENT</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    
    <span class="co"># bars</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,   <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span>,   <span class="co"># color of fill within bars</span>
  
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>    <span class="co"># bins are 7-days</span>
  <span class="op">)</span><span class="op">+</span> 
    
  
  <span class="co"># x-axis labels</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space before and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># remove excess y-axis space below 0</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                <span class="co"># simplify plot background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, <span class="co"># caption on left side in italics</span>
                                hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, 
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases (Monday weeks)"</span>,
    subtitle <span class="op">=</span> <span class="st">"Note alignment of bars, vertical lines, and axis labels on Mondays"</span>,
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-728-1.png" width="672"></div>
</div>
<div id="sunday-weeks-example" class="section level4 unnumbered">
<h4>Sunday weeks example<a class="anchor" aria-label="anchor" href="#sunday-weeks-example"><i class="fas fa-link"></i></a>
</h4>
<p>The below code achieves the same epicurve but uses <em>Sunday</em> weeks. Of note:</p>
<ul>
<li>The break points of the <em>histogram bins</em> are specified manually to begin the Sunday (<code>week_start = 7</code>) before the earliest case and to end the Sunday after the last case (see explanation above).</li>
<li>Because the bins are <em>not</em> Monday weeks, the breaks for <em>date labels</em> on the x-axis and the vertical gridlines must be manually specified vectors of dates, as generated by <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>. These date break vectors are given to <code>breaks =</code> and <code>minor_breaks =</code> within <code>scale_x_date()</code>. Unlike for Monday weeks, you <em>cannot</em> use the <code>scale_x_date()</code> arguments <code>date_breaks</code> and <code>date_minor_breaks</code>.<br>
</li>
<li>Adding <code>expand = c(0,0)</code> to the x and y scales removes excess space on each side of the axes, which also ensures the labels begin at the first bar.<br>
</li>
<li>Color and fill are defined in <code>geom_histogram()</code>
</li>
</ul>
<div class="sourceCode" id="cb1135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL SUNDAY WEEK ALIGNMENT</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># Histogram -</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    
    <span class="co"># bars</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,   <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span>,   <span class="co"># color of fill within bars</span>
    
    <span class="co"># manually specify bin break points: starts the Sunday before first case, ends Sunday after last case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>    <span class="co"># bins are 7-days</span>
    <span class="op">)</span><span class="op">+</span> 
    
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
    
    <span class="co"># manually specify label breaks: starts the Sunday before first case, end Sunday after last case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
    
    <span class="co"># manually specify vertical gridline breaks: starts the Sunday before first case, end Sunday after last case</span>
    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
   
    <span class="co"># date label format</span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>         <span class="co"># day, above month abbrev., above 2-digit year</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># removes excess y-axis space below 0</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                               <span class="co"># a set of themes to simplify plot</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, <span class="co"># caption on left side in italics</span>
                                hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, 
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases (Sunday weeks)"</span>,
    subtitle <span class="op">=</span> <span class="st">"Note alignment of bars, vertical lines, and axis labels on Sundays"</span>,
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-729-1.png" width="672"></div>
</div>
</div>
<div id="groupcolor-by-value" class="section level3 unnumbered">
<h3>Group/color by value<a class="anchor" aria-label="anchor" href="#groupcolor-by-value"><i class="fas fa-link"></i></a>
</h3>
<p>The bars can be colored by group and “stacked”. To designate the column containing values for the groups, make the following changes. See the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page for details.</p>
<ul>
<li>Add the <em>aesthetics</em> argument <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> within <code>geom_histogram()</code><br>
</li>
<li>
<strong>Within <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code></strong>, provide the grouping column name to <code>group =</code> and <code>fill =</code> (no quotes needed).<br>
</li>
<li>Remove any <code>fill =</code> argument <em>outside</em> of <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, as it will override the one inside<br>
</li>
<li>Arguments <em>inside</em> <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> will apply <em>by group</em>, whereas any <em>outside</em> will apply to all bars (e.g. you may want <code>color =</code> outside, so each bar has the same color border)</li>
</ul>
<div class="sourceCode" id="cb1136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">geom_histogram</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<p>Here it is applied in practice:</p>
<div class="sourceCode" id="cb1137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,
        group <span class="op">=</span> <span class="va">hospital</span>,
        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,
    
    <span class="co"># bin breaks defined for Monday weeks</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    
    <span class="co"># Color around bars</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-731-1.png" width="672"></div>
</div>
<div id="adjust-colors" class="section level3 unnumbered">
<h3>Adjust colors<a class="anchor" aria-label="anchor" href="#adjust-colors"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>To <em>manually</em> set the fill for each group, use <code>scale_fill_manual()</code> (note: <code>scale_color_manual()</code> is different!).
<ul>
<li>Use the <code>values =</code> argument to apply a vector of colors.<br>
</li>
<li>Use <code>na.value =</code> to specify a color for <code>NA</code> values.<br>
</li>
<li>To change the text of legend labels you <em>can</em> use the <code>labels =</code> argument in <code>scale_fill_manual()</code>, but it is dangerously easy to accidentally give colors incorrect legend text! Instead, it is recommended to change legend text by converting the grouping column to class Factor and adjusting its labels as described in the <a href="factors.html#factors">Factors</a> page and briefly below.<br>
</li>
</ul>
</li>
<li>To adjust the colors via a pre-defined color scale, see the page on <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a>.</li>
</ul>
<div class="sourceCode" id="cb1138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,
        group <span class="op">=</span> <span class="va">hospital</span>,
        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,
    
    <span class="co"># bin breaks defined for Monday weeks</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    
    <span class="co"># Color around bars</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># manual specification of colors</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span> <span class="co"># specify fill colors ("values") - attention to order!</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-732-1.png" width="672"></div>
</div>
<div id="adjust-level-order-2" class="section level3 unnumbered">
<h3>Adjust level order<a class="anchor" aria-label="anchor" href="#adjust-level-order-2"><i class="fas fa-link"></i></a>
</h3>
<p>Stacking order, and the labels for each group in the legend, is best adjusted by classifying the group column as class Factor. You can then designate the levels and their labels, and the order (which is reflected in stack order). See the page on <a href="factors.html#factors">Factors</a> or <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> for details.</p>
<p>Before making the plot, convert the grouping column to class Factor using <code>as_factor()</code> from the <strong>forcats</strong> package. Then you can make other adjustments to the levels, as detailed in the page on <a href="factors.html#factors">Factors</a>.</p>
<div class="sourceCode" id="cb1139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load forcats package for working with factors</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span>

<span class="co"># Convert hospital column to factor and adjust levels</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                      <span class="co"># define as factor</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># convert NA to "Missing" </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_lump</span><span class="op">(</span><span class="va">hospital</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                <span class="co"># Keep 3 most frequent hospitals, with remaining combined into "Other" </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Set "Missing" and "Other" as top levels to appear on epicurve top</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Missing"           "Other"             "Port Hospital"     "Military Hospital"</code></pre>
<p>In the below plot, the only differences from previous is that column <code>hospital</code> has been consolidated as above, and we use <code>guides()</code> to reverse the legend order, so that “Missing” is on the bottom of the legend.</p>
<div class="sourceCode" id="cb1141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,
        group <span class="op">=</span> <span class="va">hospital</span>,
        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,
    
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>  
    
  <span class="co"># x-axis labels</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space before and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># remove excess y-axis space below 0</span>
  
  <span class="co"># manual specification of colors</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># specify fill colors ("values") - attention to order!</span>
  
  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># reverse order of legend only</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                <span class="co"># simplify plot background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, <span class="co"># caption on left side in italics</span>
                                hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, 
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases by hospital"</span>,
    subtitle <span class="op">=</span> <span class="st">"3 most frequent values shown individually, plus 'Other'"</span>,
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    fill     <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>   <span class="co"># title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-734-1.png" width="672"></div>
</div>
<div id="adjust-legend" class="section level3 unnumbered">
<h3>Adjust legend<a class="anchor" aria-label="anchor" href="#adjust-legend"><i class="fas fa-link"></i></a>
</h3>
<p>Read more about legends in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page. Here are a few highlights:</p>
<ul>
<li>
<code>labs(fill = "Legend title")</code> to edit the legend title<br>
</li>
<li>
<code>theme(legend.title = element_blank())</code> to have no title<br>
</li>
<li>
<code>theme(legend.position = "top")</code> (or “bottom”, “left”, “right”)</li>
<li>
<code>theme(legend.direction = "horizontal")</code><br>
</li>
<li>
<code>guides(fill = guide_legend(reverse = TRUE))</code> to reverse order of the legend</li>
</ul>
</div>
<div id="bars-side-by-side" class="section level3 unnumbered">
<h3>Bars side-by-side<a class="anchor" aria-label="anchor" href="#bars-side-by-side"><i class="fas fa-link"></i></a>
</h3>
<p>Side-by-side display of group bars (as opposed to stacked) is specified within <code>geom_histogram()</code> with <code>position = "dodge"</code> (place this outside of <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>).</p>
<p>If there are more than two value groups, these can become difficult to read. Consider instead using a faceted plot (small multiples). To improve readability in this example, missing gender values could be removed.</p>
<div class="sourceCode" id="cb1142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span><span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">date_onset</span>,
          group <span class="op">=</span> <span class="va">gender</span>,   <span class="co"># values grouped and colored by gender</span>
          fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,
        
        <span class="co"># bins start the Monday before first case, end Monday after last case</span>
        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
          from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>, <span class="co"># bins are 7-days</span>
        
        color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># bar edge color</span>
        position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># side-by-side bars</span>
                      
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
               date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co">#scale of colors and legend labels</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"orange"</span><span class="op">)</span>,  <span class="co"># specify fill colors ("values") - attention to order!</span>
                    na.value <span class="op">=</span> <span class="st">"grey"</span> <span class="op">)</span><span class="op">+</span>     

  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by gender"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Gender"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-735-1.png" width="672"></div>
</div>
<div id="axis-limits" class="section level3 unnumbered">
<h3>Axis limits<a class="anchor" aria-label="anchor" href="#axis-limits"><i class="fas fa-link"></i></a>
</h3>
<p>You can set maximum and minimum date values using <code>limits = c()</code> within <code>scale_x_date()</code>. For example:</p>
<div class="sourceCode" id="cb1143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scale_x_date</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-04-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># sets a minimum date but leaves the maximum open.  </span></code></pre></div>
<p>Likewise, if you want to the x-axis to extend to a specific date (e.g. current date), even if no new cases have been reported, you can use:</p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1144-1"><a href="epidemic-curves.html#cb1144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">Sys.Date</span>()) <span class="co"># ensures date axis will extend until current date  </span></span></code></pre></div>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Caution using limits! They remove all data outside the limits, which can impact y-axis max/min, modeling, and other statistics. Strongly consider instead using limits by adding <code>coord_cartesian( xlim= c(), ylim=c() )</code> to your plot, which acts as a “zoom” without removing data. </span></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Be cautious setting the y-axis scale breaks or limits (e.g. 0 to 30 by 5: <code><a href="https://rdrr.io/r/base/seq.html">seq(0, 30, 5)</a></code>). Such static numbers can cut-off your plot too short if the data changes to exceed the limit!.</span></p>
</div>
<div id="date-axis-labelsgridlines-1" class="section level3 unnumbered">
<h3>Date-axis labels/gridlines<a class="anchor" aria-label="anchor" href="#date-axis-labelsgridlines-1"><i class="fas fa-link"></i></a>
</h3>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Remember that date-axis <strong>labels</strong> are independent from the aggregation of the data into bars, but visually it can be important to align bins, date labels, and vertical grid lines.</span></p>
<p>To <strong>modify the date labels and grid lines</strong>, use <code>scale_x_date()</code> in one of these ways:</p>
<ul>
<li>
<strong>If your histogram bins are days, Monday weeks, months, or years</strong>:
<ul>
<li>Use <code>date_breaks =</code> to specify label frequency (e.g. “day”, “week”, “3 weeks”, “month”, or “year”)</li>
<li>Use <code>date_minor_breaks =</code> to specify frequency of minor vertical gridlines between date labels<br>
</li>
<li>Add <code>expand = c(0,0)</code> to begin the labels at the first bar (otherwise, first label will shift forward depending on specified frequency)<br>
</li>
<li>Use <code>date_labels =</code> to specify format of date labels - see the Dates page for tips (use <code>\n</code> for a new line)<br>
</li>
</ul>
</li>
<li>
<strong>If your histogram bins are Sunday weeks</strong>:
<ul>
<li>Use <code>breaks =</code> and <code>minor_breaks =</code> by providing a sequence of date breaks for each</li>
<li>You can still use <code>date_labels =</code> and <code>expand</code> for formatting as described above</li>
</ul>
</li>
</ul>
<p>Some notes:</p>
<ul>
<li>See the opening ggplot section for instructions on how to create a sequence of dates using <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>.<br>
</li>
<li>If using aggregated counts (for example an “epiweek” x-axis) your x-axis may not be Date class, and may require use <code>scale_x_discrete()</code> instead of <code>scale_x_date()</code> - see <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page for more details.<br>
</li>
<li>See <a href="https://rdrr.io/r/base/strptime.html">this page</a> or the <a href="working-with-dates.html#working-with-dates-1">Working with dates</a> page for tips on creating date labels.</li>
</ul>
<div id="demonstrations" class="section level4 unnumbered">
<h4>Demonstrations<a class="anchor" aria-label="anchor" href="#demonstrations"><i class="fas fa-link"></i></a>
</h4>
<p>Below is a demonstration of plots where the bins and the plot labels/grid lines are aligned and not aligned:</p>
<div class="sourceCode" id="cb1145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7-day binwidth defaults</span>
<span class="co">#################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># x column must be class Date</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,                       <span class="co"># 7 days per bin (! starts at first case!)</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,                 <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>               <span class="co"># color of bar fill</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays with first case\ndefault axis labels/ticks not aligned"</span><span class="op">)</span>


<span class="co"># 7-day bins + Monday labels</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,                 <span class="co"># 7-day bins with start at first case</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,               <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,       <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,    <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>              <span class="co"># remove excess space under x-axis, make flush with labels</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays with first case\nDate labels and gridlines on Mondays"</span><span class="op">)</span>



<span class="co"># 7-day bins + Months</span>
<span class="co">#####################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                 <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"months"</span>,          <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,      <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>    <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remove excess space under x-axis, make flush with labels</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays with first case\nGridlines at 1st of each month (with labels) and weekly on Mondays\nLabels on 1st of each month"</span><span class="op">)</span>


<span class="co"># TOTAL MONDAY ALIGNMENT: specify manual bin breaks to be mondays</span>
<span class="co">#################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,           <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"ALIGNED Mondays"</span>,
    subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Monday before first case (28 Apr)\nDate labels and gridlines on Mondays as well"</span><span class="op">)</span>


<span class="co"># TOTAL SUNDAY ALIGNMENT: specify manual bin breaks AND labels to be Sundays</span>
<span class="co">############################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="co"># histogram breaks set to 7 days beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
    <span class="co"># date label breaks set to every 3 weeks beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
    <span class="co"># gridlines set to weekly beginning Sunday before first case</span>
    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ALIGNED Sundays"</span>,
       subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Sunday before first case (27 Apr)\nDate labels and gridlines manually set to Sundays as well"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-738-1.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-738-2.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-738-3.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-738-4.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-738-5.png" width="672"></p>
</div>
</div>
</div>
<div id="facetingsmall-multiples" class="section level2" number="28.4">
<h2>
<span class="header-section-number">28.4</span> Faceting/small-multiples<a class="anchor" aria-label="anchor" href="#facetingsmall-multiples"><i class="fas fa-link"></i></a>
</h2>
<p>As with other ggplots, you can create facetted plots (“small multiples”). As explained in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page of this handbook, you can use either:</p>
<ul>
<li><code>facet_wrap()</code></li>
<li><code>facet_grid()</code></li>
</ul>
<div id="facet_wrap" class="section level3 unnumbered">
<h3>
<code>facet_wrap()</code><a class="anchor" aria-label="anchor" href="#facet_wrap"><i class="fas fa-link"></i></a>
</h3>
<p>For epicurves, <code>facet_wrap()</code> is typically easiest as it is likely that you only need to facet on one column. The general syntax is <code>facet_wrap(rows ~ cols)</code>, where to the left of the tilde (~) is the name of a column to be spread across the “rows” of the facetted plot, and to the right of the tilde is the name of a column to be spread across the “columns” of the facetted plot.</p>
<p>Most simply, just use one column name, to the right of the tilde: <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Free axes</strong><br>
You will need to decide whether the scales of the axes for each facet are “fixed” to the same dimensions (default), or “free” (meaning they will change based on the data within the facet). Do this with the <code>scales =</code> argument within <code>facet_wrap()</code> by specifying “free_x” or “free_y”, or “free”.</p>
<p><strong>Number of cols and rows of facets</strong><br>
This can be specified with <code>ncol =</code> and <code>nrow =</code> within <code>facet_wrap()</code>.</p>
<p><strong>Order of panels</strong><br>
To change the order of appearance, change the underlying order of the levels of the factor column used to create the facets.</p>
<p><strong>Aesthetics</strong><br>
Font size and face, strip color, etc. can be modified through <code>theme()</code> with arguments like:</p>
<ul>
<li>
<code>strip.text = element_text()</code> (size, colour, face, angle…)</li>
<li>
<code>strip.background = element_rect()</code> (e.g. element_rect(fill=“red”))<br>
</li>
<li>
<code>strip.position =</code> (position of the strip “bottom”, “top”, “left”, or “right”)</li>
</ul>
<p><strong>Strip labels</strong><br>
Labels of the facet plots can be modified through the “labels” of the column as a factor, or by the use of a “labeller”.</p>
<p>Make a labeller like this, using the function <code>as_labeller()</code> from <strong>ggplot2</strong>. Then provide the labeller to the <code>labeller =</code> argument of <code>facet_wrap()</code> as shown below.</p>
<div class="sourceCode" id="cb1146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
     <span class="st">"0-4"</span>   <span class="op">=</span> <span class="st">"Ages 0-4"</span>,
     <span class="st">"5-9"</span>   <span class="op">=</span> <span class="st">"Ages 5-9"</span>,
     <span class="st">"10-14"</span> <span class="op">=</span> <span class="st">"Ages 10-14"</span>,
     <span class="st">"15-19"</span> <span class="op">=</span> <span class="st">"Ages 15-19"</span>,
     <span class="st">"20-29"</span> <span class="op">=</span> <span class="st">"Ages 20-29"</span>,
     <span class="st">"30-49"</span> <span class="op">=</span> <span class="st">"Ages 30-49"</span>,
     <span class="st">"50-69"</span> <span class="op">=</span> <span class="st">"Ages 50-69"</span>,
     <span class="st">"70+"</span>   <span class="op">=</span> <span class="st">"Over age 70"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>An example facetted plot</strong> - facetted by column <code>age_cat</code>.</p>
<div class="sourceCode" id="cb1147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make plot</span>
<span class="co">###########</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">geom_histogram</span><span class="op">(</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">date_onset</span>,
          group <span class="op">=</span> <span class="va">age_cat</span>,
          fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,    <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
        
        <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
          from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
                      
    
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
               date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
        strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">age_cat</span>,
             ncol <span class="op">=</span> <span class="fl">4</span>,
             strip.position <span class="op">=</span> <span class="st">"top"</span>,
             labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-740-1.png" width="672"></div>
<p>See this <a href="https://ggplot2.tidyverse.org/reference/labellers.html">link</a> for more information on labellers.</p>
</div>
<div id="total-epidemic-in-facet-background" class="section level3 unnumbered">
<h3>Total epidemic in facet background<a class="anchor" aria-label="anchor" href="#total-epidemic-in-facet-background"><i class="fas fa-link"></i></a>
</h3>
<p>To show the total epidemic in the background of each facet, add a separate <code>geom_histogram()</code> command <em>before</em> the current one. Specify that the data used in this histogram is your data <em>without</em> the column used for faceting (use <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>). Then, specify a color like “grey” and a degree of transparency to make it appear in the background.</p>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="epidemic-curves.html#cb1148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_histogram</span>(<span class="at">data =</span> <span class="fu">select</span>(central_data, <span class="sc">-</span>age_cat), <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span></code></pre></div>
<p>Note that the y-axis maximum is now based on the height of the entire epidemic.</p>
<div class="sourceCode" id="cb1149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># for background shadow of whole outbreak</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">central_data</span>, <span class="op">-</span><span class="va">age_cat</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"grey"</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>

  <span class="co"># actual epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">age_cat</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
    color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
    
    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
          from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                  
  
  <span class="co"># Labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
    date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># removes excess y-axis space below 0</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>        <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span>
    <span class="op">~</span><span class="va">age_cat</span>,                          <span class="co"># each plot is one value of age_cat</span>
    ncol <span class="op">=</span> <span class="fl">4</span>,                          <span class="co"># number of columns</span>
    strip.position <span class="op">=</span> <span class="st">"top"</span>,            <span class="co"># position of the facet title/strip</span>
    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             <span class="co"># labeller defines above</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
    subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
    fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-742-1.png" width="672"></div>
</div>
<div id="one-facet-with-all-data" class="section level3 unnumbered">
<h3>One facet with ALL data<a class="anchor" aria-label="anchor" href="#one-facet-with-all-data"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to have one facet box that contains all the data, complete the following steps. To do this, duplicate the entire dataset so that the number of rows doubles. There will also be a new column, in this case called <code>facet</code>. In this column, the duplicated rows will have the value “all”, and in the original rows will be the value of the faceting column - thus you have created a new column to facet on in which one of the unique values contains all the data from the original dataset. A “helper” function <code>CreateAllFacet()</code> below assist with this:</p>
<div class="sourceCode" id="cb1150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define helper function</span>
<span class="va">CreateAllFacet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span><span class="op">)</span><span class="op">{</span>
     <span class="va">df</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span>
     <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">df</span>
     <span class="va">temp</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"all"</span>
     <span class="va">merged</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">df</span><span class="op">)</span>
     
     <span class="co"># ensure the facet value is a factor</span>
     <span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
     
     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now apply the helper function to the dataset, on column <code>age_cat</code>:</p>
<div class="sourceCode" id="cb1151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create dataset that is duplicated and with new column "facet" to show "all" age categories as another facet level</span>
<span class="va">central_data2</span> <span class="op">&lt;-</span> <span class="fu">CreateAllFacet</span><span class="op">(</span><span class="va">central_data</span>, col <span class="op">=</span> <span class="st">"age_cat"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    facet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">facet</span>,
                  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"0-4"</span>, <span class="st">"5-9"</span>,
                             <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>,
                             <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># check</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">central_data2</span><span class="op">$</span><span class="va">facet</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   all   0-4   5-9 10-14 15-19 20-29 30-49 50-69   70+  &lt;NA&gt; 
##   454    74    82    63    55    99    59    10     3     9</code></pre>
<p>Notable changes to the <code>ggplot()</code> command are:</p>
<ul>
<li>The data used is now central_data2 (double the rows, with new column “facet”)</li>
<li>Labeller will need to be updated, if used<br>
</li>
<li>Optional: to achieve vertically stacked facets: the facet column is moved to rows side of equation and on right is replaced by “.” (<code>facet_wrap(facet~.)</code>), and <code>ncol = 1</code>. You may also need to adjust the width and height of the saved png plot image (see <code>ggsave()</code> in <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a>).</li>
</ul>
<div class="sourceCode" id="cb1153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># actual epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">age_cat</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
        
        <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
          from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
          by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
                      
  <span class="co"># Labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
               date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>               
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">facet</span><span class="op">~</span><span class="va">.</span> ,                            <span class="co"># each plot is one value of facet</span>
             ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>            

  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-745-1.png" width="480"></div>
</div>
</div>
<div id="moving-averages-2" class="section level2" number="28.5">
<h2>
<span class="header-section-number">28.5</span> Moving averages<a class="anchor" aria-label="anchor" href="#moving-averages-2"><i class="fas fa-link"></i></a>
</h2>
<p>See the page on <a href="epidemic-curves.html#moving-averages-2">Moving averages</a> for detailed description and several options. Below is one option for calculating moving averages with the package <strong>slider</strong>.<br>
* Plot the pre-calculated moving average:<br>
* Aggregate the data as necessary (daily, weekly, etc.)<br>
* Calculate the moving average<br>
* Add the moving average to the ggplot (e.g. with <code>geom_line()</code>)</p>
<div id="using-slider" class="section level3" number="28.5.1">
<h3>
<span class="header-section-number">28.5.1</span> <strong>Using slider</strong><a class="anchor" aria-label="anchor" href="#using-slider"><i class="fas fa-link"></i></a>
</h3>
<p>In this approach, the moving average is calculated in the dataset prior to plotting:</p>
<ul>
<li>Within <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, a new column is created to hold the average. <code>slide_index()</code> from <strong>slider</strong> package is used as shown below.<br>
</li>
<li>In the <code>ggplot()</code>, a <code>geom_line()</code> is added after the histogram, reflecting the moving average.</li>
</ul>
<p>See the helpful online <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">vignette for the <strong>slider</strong> package</a></p>
<div class="sourceCode" id="cb1154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">slider</span><span class="op">)</span>  <span class="co"># slider used to calculate rolling averages</span>

<span class="co"># make dataset of daily counts and 7-day moving average</span>
<span class="co">#######################################################</span>
<span class="va">ll_counts_7day</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="co">## count cases by date</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span>,
        name <span class="op">=</span> <span class="st">"new_cases"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># name of new column</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># remove cases with missing date_onset</span>
  
  <span class="co">## calculate the average number of cases in the preceding 7 days</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    avg_7day <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/slider/man/slide_index.html">slide_index</a></span><span class="op">(</span>    <span class="co"># create new column</span>
      <span class="va">new_cases</span>,                       <span class="co"># calculate based on value in new_cases column</span>
      .i <span class="op">=</span> <span class="va">date_onset</span>,                 <span class="co"># index is date_onset col, so non-present dates are included in window </span>
      .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,    <span class="co"># function is mean() with missing values removed</span>
      .before <span class="op">=</span> <span class="fl">6</span>,                     <span class="co"># window is the day and 6-days before</span>
      .complete <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,              <span class="co"># must be FALSE for unlist() to work in next step</span>
    avg_7day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">avg_7day</span><span class="op">)</span><span class="op">)</span>


<span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ll_counts_7day</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">new_cases</span><span class="op">)</span>,
                   fill<span class="op">=</span><span class="st">"#92a8d1"</span>,
                   stat <span class="op">=</span> <span class="st">"identity"</span>,
                   position <span class="op">=</span> <span class="st">"stack"</span>,
                   colour <span class="op">=</span> <span class="st">"#92a8d1"</span><span class="op">)</span><span class="op">+</span> 
    <span class="fu">geom_line</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">avg_7day</span>, lty <span class="op">=</span> <span class="st">"7-day \nrolling avg"</span><span class="op">)</span>,
              color<span class="op">=</span><span class="st">"red"</span>,
              size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,
                 date_labels <span class="op">=</span> <span class="st">'%d/%m'</span>,
                 expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span>,
         y <span class="op">=</span><span class="st">"Number of confirmed cases"</span>,
         fill <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span><span class="op">+</span> 
    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># removes title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-746-1.png" width="672"></div>
</div>
</div>
<div id="tentative-data" class="section level2" number="28.6">
<h2>
<span class="header-section-number">28.6</span> Tentative data<a class="anchor" aria-label="anchor" href="#tentative-data"><i class="fas fa-link"></i></a>
</h2>
<p>The most recent data shown in epicurves should often be marked as tentative, or subject to reporting delays. This can be done in by adding a vertical line and/or rectangle over a specified number of days. Here are two options:</p>
<ol style="list-style-type: decimal">
<li>Use <code>annotate()</code>:
<ul>
<li>
<strong>Pros:</strong> Transparency of rectangle is easy to adjust. <strong>Cons:</strong> Items will not appear in legend.<br>
</li>
<li>For a line use <code>annotate(geom = "segment")</code>. Provide <code>x</code>, <code>xend</code>, <code>y</code>, and <code>yend</code>. Adjust size, linetype (<code>lty</code>), and color.<br>
</li>
<li>For a rectangle use <code>annotate(geom = "rect")</code>. Provide xmin/xmax/ymin/ymax. Adjust color and alpha.<br>
</li>
</ul>
</li>
<li>Use <code>geom_segment()</code> and <code>geom_rect()</code>:
<ul>
<li>
<strong>Pros:</strong> Items can easily appear in legend. <strong>Cons:</strong> Difficult to achieve semi-transparency of rectangle.<br>
</li>
<li>Provide the same x/y arguments as noted above for <code>annotate()</code>
</li>
</ul>
</li>
</ol>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> While you can use <code>geom_rect()</code> to draw a rectangle, adjusting the transparency (alpha) does not work in a linelist context. This function overlays a rectangle for each observation/row!. Try a very low alpha (e.g. 0.01), or use <code>annotate(geom = "rect")</code> as shown. </span></p>
<div id="using-annotate" class="section level3 unnumbered">
<h3>Using <code>annotate()</code><a class="anchor" aria-label="anchor" href="#using-annotate"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Within <code>annotate(geom = "rect")</code>, the <code>xmin</code> and <code>xmax</code> arguments must be given inputs of class Date.<br>
</li>
<li>Note that because these data are aggregated into weekly bars, and the last bar extends to the Monday after the last data point, the shaded region may appear to cover 4 weeks<br>
</li>
<li>Here is an <code>annotate()</code> <a href="https://ggplot2.tidyverse.org/reference/annotate.html">online example</a>
</li>
</ul>
<div class="sourceCode" id="cb1155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,           <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,     <span class="co"># 1st of month</span>
    date_labels <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>          <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Using annotate()\nRectangle and line showing that data from last 21-days are tentative"</span>,
    x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y <span class="op">=</span> <span class="st">"Weekly case indicence"</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add semi-transparent red rectangle to tentative data</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"rect"</span>,
           xmin  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># note must be wrapped in as.Date()</span>
           xmax  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>,                                          <span class="co"># note must be wrapped in as.Date()</span>
           ymin  <span class="op">=</span> <span class="fl">0</span>,
           ymax  <span class="op">=</span> <span class="cn">Inf</span>,
           alpha <span class="op">=</span> <span class="fl">0.2</span>,          <span class="co"># alpha easy and intuitive to adjust using annotate()</span>
           fill  <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add black vertical line on top of other layers</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"segment"</span>,
           x     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, <span class="co"># 21 days before last data</span>
           xend  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, 
           y     <span class="op">=</span> <span class="fl">0</span>,         <span class="co"># line begins at y = 0</span>
           yend  <span class="op">=</span> <span class="cn">Inf</span>,       <span class="co"># line to top of plot</span>
           size  <span class="op">=</span> <span class="fl">2</span>,         <span class="co"># line size</span>
           color <span class="op">=</span> <span class="st">"black"</span>,
           lty   <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># linetype e.g. "solid", "dashed"</span>

  <span class="co"># add text in rectangle</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>,
           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">15</span>,
           y <span class="op">=</span> <span class="fl">15</span>,
           label <span class="op">=</span> <span class="st">"Subject to reporting delays"</span>,
           angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-747-1.png" width="672"></div>
<p>The same black vertical line can be achieved with the code below, but using <code>geom_vline()</code> you lose the ability to control the height:</p>
<div class="sourceCode" id="cb1156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,
           size <span class="op">=</span> <span class="fl">2</span>,
           color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
</div>
<div id="using-geom_segment-and-geom_rect" class="section level3 unnumbered">
<h3>Using <code>geom_segment()</code> and <code>geom_rect()</code><a class="anchor" aria-label="anchor" href="#using-geom_segment-and-geom_rect"><i class="fas fa-link"></i></a>
</h3>
<p>In this alternative method, the red color is explained in the legend.</p>
<div class="sourceCode" id="cb1157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,           <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Using geom_segment() and geom_rect()\nRectangle and line showing that data from last 21-days are tentative"</span>,
    subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># make rectangle covering last 21 days</span>
  <span class="fu">geom_rect</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
              xmin  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># note must be wrapped in as.Date()</span>
              xmax  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>,                                          <span class="co"># note must be wrapped in as.Date()</span>
              ymin  <span class="op">=</span> <span class="fl">0</span>,
              ymax  <span class="op">=</span> <span class="cn">Inf</span>,
              color <span class="op">=</span> <span class="st">"Reporting delays\npossible"</span><span class="op">)</span>,    <span class="co"># sets label for legend (note: is within aes())</span>
              alpha <span class="op">=</span> <span class="fl">.002</span>,                             <span class="co"># !!! Difficult to adjust transparency with this option</span>
              fill  <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># make vertical line</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,
                   xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,
                   y <span class="op">=</span> <span class="fl">0</span>,
                   yend <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>,
               color <span class="op">=</span> <span class="st">"black"</span>,
               lty <span class="op">=</span> <span class="st">"solid"</span>,
               size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># remove title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-749-1.png" width="672"></div>
</div>
</div>
<div id="multi-level-date-labels" class="section level2" number="28.7">
<h2>
<span class="header-section-number">28.7</span> Multi-level date labels<a class="anchor" aria-label="anchor" href="#multi-level-date-labels"><i class="fas fa-link"></i></a>
</h2>
<p>If you want multi-level date labels (e.g. month and year) <em>without duplicating the lower label levels</em>, consider one of the approaches below:</p>
<p>Remember - you can can use tools like <code>\n</code> <em>within</em> the <code>date_labels</code> or <code>labels</code> arguments to put parts of each label on a new line below. However, the code below helps you take years or months (for example) on a lower line <em>and only once</em>.</p>
<p>A few notes on the code below:</p>
<ul>
<li>Case counts are aggregated into weeks for aesthetic reasons. See Epicurves page (aggregated data tab) for details.<br>
</li>
<li>A line is used instead of a histogram, as the faceting approach below does not work well with histograms.</li>
</ul>
<p><strong>Aggregate to weekly counts</strong></p>
<div class="sourceCode" id="cb1158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create dataset of case counts by week</span>
<span class="co">#######################################</span>
<span class="va">central_weekly</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span>           <span class="co"># filter linelist</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span>, .drop<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="op">%&gt;%</span>                             <span class="co"># summarize weekly case counts</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                             <span class="co"># remove cases with missing onset_date</span>
  <span class="fu">complete</span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,           <span class="co"># fill-in all weeks with no cases reported</span>
                           to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,
                           by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Make plots</strong></p>
<div class="sourceCode" id="cb1159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with box border on year</span>
<span class="co">##############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,    <span class="co"># make line, specify x and y</span>
            stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># because line height is count number</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,             <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,          <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># remove excess space</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>, <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,                <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                   <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,         <span class="co"># facet labels placement</span>
        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># facet labels no fill grey border</span>
                                        colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,
        panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># no space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels, grey label border"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-751-1.png" width="672"></div>
<div class="sourceCode" id="cb1160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with no box border on year</span>
<span class="co">#################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># establish x and y for entire plot</span>
  <span class="fu">geom_line</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,              <span class="co"># make line, line height is count number</span>
            color <span class="op">=</span> <span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>            <span class="co"># line color</span>
  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># make points at the weekly data points</span>
  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#69b3a2"</span>,               <span class="co"># fill area below line</span>
            alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># fill transparency</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,            <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,         <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># remove excess space</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,   <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,               <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,                     <span class="co"># facet label placement</span>
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,            <span class="co"># no facet lable background</span>
          panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,          
          panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey40"</span><span class="op">)</span>,  <span class="co"># grey border to facet PANEL</span>
          panel.spacing<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># No space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels - points, shaded, no label border"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-751-2.png" width="672"></div>
<p>The above techniques were adapted from <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">this</a> and <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">this</a> post on stackoverflow.com.</p>
</div>
<div id="aggregated-data" class="section level2" number="28.8">
<h2>
<span class="header-section-number">28.8</span> Aggregated data<a class="anchor" aria-label="anchor" href="#aggregated-data"><i class="fas fa-link"></i></a>
</h2>
<div id="aggregating-linelist-data" class="section level3 unnumbered">
<h3>Aggregating linelist data<a class="anchor" aria-label="anchor" href="#aggregating-linelist-data"><i class="fas fa-link"></i></a>
</h3>
<p>To learn generally how to group and aggregate data, see the page on <a href="grouping-data.html#grouping-data">Grouping data</a>.</p>
<p>In this circumstance, we demonstrate aggregating into weeks, months, and days.</p>
<div id="aggregating-linelist-into-days" class="section level4 unnumbered">
<h4>Aggregating linelist into days<a class="anchor" aria-label="anchor" href="#aggregating-linelist-into-days"><i class="fas fa-link"></i></a>
</h4>
<p>To aggregate a linelist into days, use the same approach but there is no need to create a new column. Use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> on the date column (e.g. <code>date_onset</code>).</p>
<p>If plotting a histogram, missing days in the data are not a problem as long as the column is class Date. However, it may be important for other types of plots or tables to have all possible days apear in the data. This is done with: <code><a href="https://tidyr.tidyverse.org/reference/complete.html">tidyr::complete()</a></code></p>
<div class="sourceCode" id="cb1161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">daily_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                           <span class="co"># count number of rows per unique date</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                  <span class="co"># remove aggregation of rows that were missing date_onset</span>
  <span class="fu">complete</span><span class="op">(</span>date_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span>, <span class="co"># ensure all days appear</span>
                                 <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span>,
                                 by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
</div>
<div id="aggregating-linelist-into-weeks" class="section level4 unnumbered">
<h4>Aggregating linelist into weeks<a class="anchor" aria-label="anchor" href="#aggregating-linelist-into-weeks"><i class="fas fa-link"></i></a>
</h4>
<p>Create a new column that is weeks, then use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> to get weekly case counts.</p>
<p>To aggregate into weeks and show ALL weeks (even ones with no cases), do this:</p>
<ol style="list-style-type: decimal">
<li>Create a new ‘week’ column within <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, using <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package:
<ul>
<li>use <code>unit =</code> to set the desired time unit, e.g. "week`<br>
</li>
<li>use <code>week_start =</code> to set the weekday start of the week (7 = Sunday, 1 = Monday)</li>
</ul>
</li>
<li>Follow with <code>complete()</code> to ensure that all weeks appear - even those with no cases.</li>
</ol>
<p>For example:</p>
<div class="sourceCode" id="cb1162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>,
                                 unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># new column of week of onset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                                     <span class="co"># group data by week and count rows per group</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                            <span class="co"># remove entries for cases missing date_onset</span>
  <span class="fu">complete</span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,          <span class="co"># fill-in all weeks with no cases reported</span>
                           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,
                           by<span class="op">=</span><span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>                                           <span class="co"># deactivate grouping</span></code></pre></div>
<p>Here are the first 50 rows of the resulting dataframe:</p>
<div id="htmlwidget-f8b41f563622d4ca5e67" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f8b41f563622d4ca5e67">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1396742400000\" data-max=\"1426377600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"322\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15"],[1,1,4,4,12,15,16,23,22,18,30,25,33,36,56,59,81,86,118,130,168,201,224,322,301,300,293,268,259,255,231,182,142,176,156,130,125,124,94,101,107,101,87,81,67,80,80,76,68,61]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Alternatively, you can use the <a href="https://cran.r-project.org/web/packages/aweek/vignettes/introduction.html"><strong>aweek</strong></a> package’s <code>date2week()</code> function</strong>. As shown below, set <code>week_start =</code> to “Sunday”, or “Monday”, etc. Set <code>floor_date = TRUE</code> so the output is YYYY-Www. Set <code>factor = TRUE</code> so that all possible weeks are included, even if there are no cases (this replaces the <code>complete()</code> step in the <strong>lubridate</strong> approach above). You can also use <code>numeric = TRUE</code> if you want only the week number (note this will not distinguish between years).</p>
<div class="sourceCode" id="cb1163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">date2week</a></span><span class="op">(</span><span class="va">date_onset</span>,          <span class="co"># new column of week of onset</span>
                                 floor_day <span class="op">=</span> <span class="cn">T</span>,       <span class="co"># show as weeks without weekday</span>
                                 factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># include all possible weeks</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>                                           <span class="co"># deactivate grouping</span>

<span class="co"># Optional: add column of start DATE for each week - e.g. for ggplot() when date x-axis is expected</span>
<span class="co"># note: add this step AFTER the above code, to ensure all weeks are present</span>
<span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">weekly_counts</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week_as_date <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">week2date</a></span><span class="op">(</span><span class="va">week</span>, week_start <span class="op">=</span> <span class="st">"Monday"</span><span class="op">)</span><span class="op">)</span> <span class="co"># output is Monday date of each week</span></code></pre></div>
</div>
<div id="aggregating-linelist-into-months" class="section level4 unnumbered">
<h4>Aggregating linelist into months<a class="anchor" aria-label="anchor" href="#aggregating-linelist-into-months"><i class="fas fa-link"></i></a>
</h4>
<p>To aggregate cases into months, again use <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package, but with the argument <code>unit = "months"</code>. This rounds each date down to the 1st of its month. The output will be class Date.</p>
<p>Note that in the <code>complete()</code> step we also use “months”</p>
<div class="sourceCode" id="cb1164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">monthly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># new column, 1st of month of onset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">complete</span><span class="op">(</span>month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span>,     <span class="co"># fill-in all months with no cases reported</span>
                            <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span>,
                            by<span class="op">=</span><span class="st">"month"</span><span class="op">)</span><span class="op">)</span>    </code></pre></div>
<div id="htmlwidget-842b44b4049edfe4a94f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-842b44b4049edfe4a94f">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1396310400000\" data-max=\"1427846400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"7\" data-max=\"1205\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01"],[7,69,103,231,550,1159,1205,789,570,434,308,277,186]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>month<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="plotting-aggregated-count-data" class="section level3 unnumbered">
<h3>Plotting aggregated count data<a class="anchor" aria-label="anchor" href="#plotting-aggregated-count-data"><i class="fas fa-link"></i></a>
</h3>
<p>Often instead of a linelist, you begin with aggregated counts from facilities, districts, etc. You can make an epicurve from <code>ggplot()</code> but the code will be slightly different. The <strong>incidence</strong> package does not currently support plotting of aggregated count data.</p>
<p>This section will utilize the <code>count_data</code> dataset that was imported earlier, in the data preparation section. It is the <code>linelist</code> aggregated to day-hospital counts. The first 50 rows are displayed below.</p>
<div id="htmlwidget-df23fae43c63e801511a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-df23fae43c63e801511a">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1410307200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>As before, we must ensure date variables are correctly classified.</p>
<div class="sourceCode" id="cb1165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert Date variable to Date class</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">date_hospitalisation</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Date"</code></pre>
<div id="plotting-daily-counts" class="section level4 unnumbered">
<h4>Plotting daily counts<a class="anchor" aria-label="anchor" href="#plotting-daily-counts"><i class="fas fa-link"></i></a>
</h4>
<p>We can plot a daily epicurve from these <em>daily counts</em>. Here are the differences:</p>
<ul>
<li>Specify <code>y =</code> to the counts column within the primary aesthetics <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>
</li>
<li>Use of <code>stat = "identity"</code> within <code>geom_histogram()</code> indicates that the y-values could be counts from the <code>y =</code> column in <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>
</li>
</ul>
<div class="sourceCode" id="cb1167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">date_hospitalisation</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">n_cases</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">geom_histogram</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date of report"</span>, 
          y <span class="op">=</span> <span class="st">"Number of cases"</span>,
          Title <span class="op">=</span> <span class="st">"Daily case incidence, from daily count data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-760-1.png" width="672"></div>
</div>
<div id="plotting-weekly-counts" class="section level4 unnumbered">
<h4>Plotting weekly counts<a class="anchor" aria-label="anchor" href="#plotting-weekly-counts"><i class="fas fa-link"></i></a>
</h4>
<p>To aggregated the daily counts into weekly counts, we use the package <strong>lubridate</strong> and function <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code>, as described above.</p>
<p>Note that we use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> in place of <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> because we need to <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> case counts instead of just counting the number of rows per group.</p>
<div class="sourceCode" id="cb1168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create weekly dataset with epiweek column</span>
<span class="va">count_data_weekly</span> <span class="op">&lt;-</span> <span class="va">count_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_hospitalisation</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">epiweek</span>, .drop<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_cases_weekly <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n_cases</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>   </code></pre></div>
<p>The first 50 rows of <code>count_data_weekly</code> are displayed below. You can see that the counts have been aggregated into weeks. Each week is displayed by the first day of the week (Monday by default).</p>
<div id="htmlwidget-719910be8e486b4e3948" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-719910be8e486b4e3948">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital"],["2014-05-04","2014-05-11","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-07-06","2014-07-13","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-13","2014-05-11"],[2,1,2,1,2,1,3,7,5,6,6,13,9,15,12,23,24,23,25,26,23,19,25,19,14,9,10,9,8,12,5,10,5,6,6,4,8,9,8,2,5,3,4,5,6,3,6,5,1,6]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>epiweek<\/th>\n      <th>n_cases_weekly<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>YOu can also specify the factor level order of <code>hospital</code> (optional)</p>
<div class="sourceCode" id="cb1169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count_data_weekly</span> <span class="op">&lt;-</span> <span class="va">count_data_weekly</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>,
         hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>,
                                <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Port Hospital"</span>,
                                  <span class="st">"Military Hospital"</span>, <span class="st">"Central Hospital"</span>,
                                  <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,
                                  <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now plot by epiweek. Remember <code>stat = "identity"</code> when making the histogram.</p>
<div class="sourceCode" id="cb1170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data_weekly</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>,
           y <span class="op">=</span> <span class="va">n_cases_weekly</span>,
           group <span class="op">=</span> <span class="va">hospital</span>,
           fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">geom_histogram</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>
     
  <span class="co"># labels for x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,      <span class="co"># labels every 2 months </span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># gridlines every month</span>
               date_labels <span class="op">=</span> <span class="st">'%b\n%Y'</span><span class="op">)</span><span class="op">+</span>       <span class="co">#labeled by month with year below</span>
     
  <span class="co"># Choose color palette (uses RColorBrewer package)</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Pastel2"</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week of onset"</span>, 
       y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,
       fill <span class="op">=</span> <span class="st">"Hospital"</span>,
       title <span class="op">=</span> <span class="st">"Weekly case incidence, from aggregated count data by hospital"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-764-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="dual-axis" class="section level2" number="28.9">
<h2>
<span class="header-section-number">28.9</span> Dual-axis<a class="anchor" aria-label="anchor" href="#dual-axis"><i class="fas fa-link"></i></a>
</h2>
<p>Although there are fierce discussions about the validity of dual axes within the data visualization community, many epi supervisors want to see an epicurve or similar chart with a percent overlaid with a second axis.</p>
<p>See the handbook page on <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> for details on how to make a second axis.</p>
</div>
<div id="cumulative-incidence" class="section level2" number="28.10">
<h2>
<span class="header-section-number">28.10</span> Cumulative Incidence<a class="anchor" aria-label="anchor" href="#cumulative-incidence"><i class="fas fa-link"></i></a>
</h2>
<p>If beginning with a case linelist, create a new column containing the cumulative number of cases per day in an outbreak using <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> from <strong>base</strong> R:</p>
<div class="sourceCode" id="cb1171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                <span class="co"># count of rows per day (returned in column "n")   </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>                         
    cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>       <span class="co"># new column of the cumulative number of rows at each date</span>
    <span class="op">)</span></code></pre></div>
<p>The first 10 rows are shown below:</p>
<div id="htmlwidget-7cb7d738df42e9294804" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7cb7d738df42e9294804">{"x":{"filter":"none","data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05"],[1,1,2,1,1,1,2,1,1,1],[1,2,4,5,6,7,9,10,11,12]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n      <th>cumulative_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>This cumulative column can then be plotted against <code>date_onset</code>, using <code>geom_line()</code>:</p>
<div class="sourceCode" id="cb1172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>

<span class="va">plot_cumulative</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-767-1.png" width="672"></div>
<p>It can also be overlaid onto the epicurve, with dual-axis using the <strong>cowplot</strong> method described in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page:</p>
<div class="sourceCode" id="cb1173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>

<span class="co"># Make first plot of epicurve histogram</span>
<span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>          
    data <span class="op">=</span> <span class="va">linelist</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    y <span class="op">=</span> <span class="st">"Daily cases"</span>,
    x <span class="op">=</span> <span class="st">"Date of symptom onset"</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>

<span class="co"># make second plot of cumulative cases line</span>
<span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,
       y <span class="op">=</span> <span class="st">"Cumulative cases"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>
    axis.line.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now use <strong>cowplot</strong> to overlay the two plots. Attention has been paid to the x-axis alignment, side of the y-axis, and use of <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb1174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">align_plots</span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_cumulative</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>
<span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-769-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="resources-21" class="section level2" number="28.11">
<h2>
<span class="header-section-number">28.11</span> Resources<a class="anchor" aria-label="anchor" href="#resources-21"><i class="fas fa-link"></i></a>
</h2>
<p>Links to other online tutorials or resources.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ggplot-tips.html"><span class="header-section-number">27</span> ggplot tips</a></div>
<div class="next"><a href="plot-continuous-data.html"><span class="header-section-number">29</span> Plot continuous data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#epidemic-curves"><span class="header-section-number">28</span> Epidemic curves</a></li>
<li>
<a class="nav-link" href="#preparation-18"><span class="header-section-number">28.1</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#packages-5">Packages</a></li>
<li><a class="nav-link" href="#load-data-7">Load data</a></li>
<li><a class="nav-link" href="#set-parameters">Set parameters</a></li>
<li><a class="nav-link" href="#verify-dates">Verify dates</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epicurves-with-incidence-package"><span class="header-section-number">28.2</span> Epicurves with incidence package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simple-example">Simple example</a></li>
<li><a class="nav-link" href="#change-time-interval-of-case-aggregation">Change time interval of case aggregation</a></li>
<li><a class="nav-link" href="#filtered-data">Filtered data</a></li>
<li><a class="nav-link" href="#modifications-with-plot">Modifications with plot()</a></li>
<li><a class="nav-link" href="#modifications-with-ggplot2">Modifications with ggplot2</a></li>
<li><a class="nav-link" href="#group-and-color-by-values">Group and color by values</a></li>
<li><a class="nav-link" href="#change-colors">Change colors</a></li>
<li><a class="nav-link" href="#adjust-level-order-1">Adjust level order</a></li>
<li><a class="nav-link" href="#change-legend">Change legend</a></li>
<li><a class="nav-link" href="#date-axis-labelsgridlines">Date-axis labels/gridlines</a></li>
<li><a class="nav-link" href="#facetssmall-multiples">Facets/small multiples</a></li>
<li><a class="nav-link" href="#other-tips"><span class="header-section-number">28.2.1</span> Other tips</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epicurves-with-ggplot2"><span class="header-section-number">28.3</span> Epicurves with ggplot2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#examples-2">Examples</a></li>
<li><a class="nav-link" href="#groupcolor-by-value">Group/color by value</a></li>
<li><a class="nav-link" href="#adjust-colors">Adjust colors</a></li>
<li><a class="nav-link" href="#adjust-level-order-2">Adjust level order</a></li>
<li><a class="nav-link" href="#adjust-legend">Adjust legend</a></li>
<li><a class="nav-link" href="#bars-side-by-side">Bars side-by-side</a></li>
<li><a class="nav-link" href="#axis-limits">Axis limits</a></li>
<li><a class="nav-link" href="#date-axis-labelsgridlines-1">Date-axis labels/gridlines</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#facetingsmall-multiples"><span class="header-section-number">28.4</span> Faceting/small-multiples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#facet_wrap">facet_wrap()</a></li>
<li><a class="nav-link" href="#total-epidemic-in-facet-background">Total epidemic in facet background</a></li>
<li><a class="nav-link" href="#one-facet-with-all-data">One facet with ALL data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#moving-averages-2"><span class="header-section-number">28.5</span> Moving averages</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#using-slider"><span class="header-section-number">28.5.1</span> Using slider</a></li></ul>
</li>
<li>
<a class="nav-link" href="#tentative-data"><span class="header-section-number">28.6</span> Tentative data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-annotate">Using annotate()</a></li>
<li><a class="nav-link" href="#using-geom_segment-and-geom_rect">Using geom_segment() and geom_rect()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#multi-level-date-labels"><span class="header-section-number">28.7</span> Multi-level date labels</a></li>
<li>
<a class="nav-link" href="#aggregated-data"><span class="header-section-number">28.8</span> Aggregated data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#aggregating-linelist-data">Aggregating linelist data</a></li>
<li><a class="nav-link" href="#plotting-aggregated-count-data">Plotting aggregated count data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#dual-axis"><span class="header-section-number">28.9</span> Dual-axis</a></li>
<li><a class="nav-link" href="#cumulative-incidence"><span class="header-section-number">28.10</span> Cumulative Incidence</a></li>
<li><a class="nav-link" href="#resources-21"><span class="header-section-number">28.11</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-03-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
