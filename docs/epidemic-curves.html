<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>29 Epidemic curves | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">2</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">3</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">4</span> R Basics</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">5</span> Importing data</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">7</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">8</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with Dates</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="" href="groupingaggregating-data.html"><span class="header-section-number">11</span> Grouping/aggregating data</a></li>
<li><a class="" href="joining-matching-datasets.html"><span class="header-section-number">12</span> Joining &amp; matching datasets</a></li>
<li><a class="" href="charactersstrings.html"><span class="header-section-number">13</span> Characters/strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="" href="ifelse-for-loops.html"><span class="header-section-number">15</span> if/else &amp; ‘for’ loops</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Iteration</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">17</span> Descriptive analysis</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Simple statistical tests</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">19</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">20</span> Moving averages</a></li>
<li><a class="" href="outbreak-detection.html"><span class="header-section-number">21</span> Outbreak detection</a></li>
<li><a class="" href="time-series-analysis.html"><span class="header-section-number">22</span> Time series analysis</a></li>
<li><a class="" href="epidemicmodels.html"><span class="header-section-number">23</span> Epidemic modeling</a></li>
<li><a class="" href="modeling.html"><span class="header-section-number">24</span> Modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis-1.html"><span class="header-section-number">26</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">28</span> ggplot tips</a></li>
<li><a class="active" href="epidemic-curves.html"><span class="header-section-number">29</span> Epidemic curves</a></li>
<li><a class="" href="plotting-continuous-data.html"><span class="header-section-number">30</span> Plotting continuous data</a></li>
<li><a class="" href="plotting-discrete-variables.html"><span class="header-section-number">31</span> Plotting discrete variables</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">32</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">33</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">34</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">35</span> Combination analysis</a></li>
<li><a class="" href="heatmaps-density-plots.html"><span class="header-section-number">36</span> Heatmaps &amp; density plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Transmission Chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">40</span> Errors &amp; Warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">41</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">42</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">43</span> Routine reports</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">44</span> R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">45</span> Shiny basics</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">47</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">48</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">49</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="epidemic-curves" class="section level1 tabset tabset-fade" number="29">
<h1>
<span class="header-section-number">29</span> Epidemic curves<a class="anchor" aria-label="anchor" href="#epidemic-curves"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="overview-25" class="section level2 tabset tabset-fade" number="29.1">
<h2>
<span class="header-section-number">29.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-25"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-388-1.png" width="75%"></div>
<!-- ======================================================= -->
</div>
<div id="preparation-20" class="section level2" number="29.2">
<h2>
<span class="header-section-number">29.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-20"><i class="fas fa-link"></i></a>
</h2>
<div id="packages-5" class="section level3" number="29.2.1">
<h3>
<span class="header-section-number">29.2.1</span> Packages<a class="anchor" aria-label="anchor" href="#packages-5"><i class="fas fa-link"></i></a>
</h3>
<p>This code chunk shows the loading of packages required for the analyses.</p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rio</span>,          <span class="co"># File import</span>
               <span class="va">here</span>,         <span class="co"># File locator</span>
               <span class="va">lubridate</span>,    <span class="co"># working with  dates    </span>
               <span class="va">aweek</span>,        <span class="co"># alternative package for working with dates</span>
               <span class="va">incidence</span>,    <span class="co"># an option for epicurves of linelist data</span>
               <span class="va">stringr</span>,      <span class="co"># Search and manipulate character strings</span>
               <span class="va">forcats</span>,      <span class="co"># working with factors</span>
               <span class="va">RColorBrewer</span>, <span class="co"># Color palettes from colorbrewer2.org</span>
               <span class="va">tidyverse</span>,    <span class="co"># data management + ggplot2 graphics</span>
<span class="op">)</span> </code></pre></div>
<pre><code>## 
## Your package installed</code></pre>
<pre><code>## Warning in pacman::p_load(rio, here, lubridate, aweek, incidence, stringr, : Failed to install/load:</code></pre>
</div>
<div id="load-data-4" class="section level3" number="29.2.2">
<h3>
<span class="header-section-number">29.2.2</span> Load data<a class="anchor" aria-label="anchor" href="#load-data-4"><i class="fas fa-link"></i></a>
</h3>
<p>Two example datasets are used in this section:</p>
<ul>
<li>Linelist of individual cases from a simulated epidemic<br>
</li>
<li>Aggregated counts by hospital from the same simulated epidemic</li>
</ul>
<p>The dataset is imported using the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the <em>rio</em> package. See the <em>page on importing data</em> for various ways to import data. The linelist and aggregated versions of the data are displayed below.</p>
<p>For most of this document, the <em>linelist dataset</em> will be used. The aggregated counts dataset will be used at the end.</p>
<div class="sourceCode" id="cb632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fake import the linelist</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p>Review the two datasets and notice the differences</p>
<p><strong>Case linelist</strong></p>
<p>The first 50 rows are displayed</p>
<div id="htmlwidget-7644d659c3e4a7d29569" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7644d659c3e4a7d29569">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1.405728e+12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1.39752e+12\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1406851200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1408838400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"43\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"43\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2628934511971\" data-max=\"-13.2093776169918\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45020022241045\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"18.5860458051297\" data-max=\"90.5769525550137\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"28.1660762993844\" data-max=\"211.611265576819\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"36.2427185251953\" data-max=\"37.8861007735333\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"21\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["20b688","a3c8b8","72b905","8689b7","11f8ea","893f25","c4e706","e02f66","ce9c02","56d39e","07e3e8","8a4580","369449","f393b4","60f0c2","9f6884","d6f195","2eaa9a","c97dd9","542d07","3a7673","7f5a01","f86ce2","c9e790","99e8fa","af1c1f","c62127","b799eb","c2e83e","bc2adf","170473","f3881f","f0461f","1c1848","42e1a9","e56412","62a2ef","52ea64","148f18","f81362","58b968","342b03","92ddf7","386dfb","eae3e8","c76676","896214","baacc1","917506","23e499"],[3,4,4,4,2,3,5,4,5,5,4,4,4,4,7,4,4,5,9,5,8,7,9,9,7,5,9,5,8,6,7,6,9,8,12,9,9,7,6,8,10,7,9,9,7,9,11,12,9,9],[null,"2014-05-07","2014-05-06",null,null,"2014-05-18",null,"2014-05-18","2014-05-27",null,"2014-05-22",null,"2014-05-28",null,"2014-06-04","2014-06-02",null,"2014-06-07",null,"2014-06-10",null,"2014-06-23",null,"2014-06-12","2014-06-24",null,"2014-06-20","2014-06-27","2014-06-29","2014-07-03","2014-07-05",null,"2014-07-09","2014-07-09",null,"2014-07-12","2014-07-02","2014-07-15",null,null,"2014-07-18",null,"2014-07-19","2014-07-19","2014-06-26","2014-07-18","2014-07-18","2014-07-18","2014-07-18",null],["2014-04-15","2014-05-08","2014-05-12","2014-05-13","2014-05-16","2014-05-21",null,null,"2014-05-27","2014-05-27","2014-05-27","2014-06-02","2014-06-02","2014-06-05","2014-06-07","2014-06-07","2014-06-10","2014-06-17","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-27","2014-06-28",null,"2014-07-02","2014-07-03","2014-07-07","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12",null,"2014-07-15","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-23","2014-07-23","2014-07-23","2014-07-25","2014-07-26","2014-07-27","2014-07-27",null],["2014-05-06","2014-05-10","2014-05-13","2014-05-14","2014-05-18","2014-05-22","2014-05-24","2014-05-25","2014-05-29","2014-05-28","2014-05-29","2014-06-02","2014-06-03","2014-06-06","2014-06-08","2014-06-07","2014-06-12","2014-06-17","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-26","2014-06-29","2014-06-29","2014-06-29","2014-07-03","2014-07-05","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-14","2014-07-14","2014-07-17","2014-07-19","2014-07-20","2014-07-20","2014-07-21","2014-07-21","2014-07-24","2014-07-25","2014-07-23","2014-07-25","2014-07-25","2014-07-28","2014-07-27","2014-07-27","2014-08-01"],["2014-05-14","2014-05-14",null,"2014-05-18","2014-05-30","2014-05-29","2014-06-02","2014-05-31","2014-06-17",null,"2014-06-01",null,"2014-06-07","2014-06-18","2014-05-30","2014-07-01",null,null,"2014-07-11","2014-06-28","2014-06-25","2014-07-06",null,"2014-07-25","2014-07-09","2014-07-01","2014-07-17","2014-07-12","2014-07-30",null,"2014-08-09","2014-07-17","2014-07-17","2014-07-14","2014-07-20","2014-07-19","2014-07-23","2014-07-26","2014-07-23","2014-08-07","2014-07-28","2014-08-24",null,null,"2014-08-03",null,"2014-07-29",null,null,"2014-08-06"],["Death","Recover","Recover","Recover","Recover","Recover",null,null,"Death","Death","Recover","Death","Death","Recover","Death",null,"Death","Recover","Recover","Death",null,"Death","Recover","Recover","Recover",null,"Recover","Recover",null,null,"Recover","Recover",null,"Death","Death","Death","Death","Death","Death","Death",null,null,"Recover","Recover","Recover","Death","Death","Death","Death","Death"],["m","m","m","f","m","m","m","f","m","f","f","m","f","m","m","m","m","f","m","m","f","f","m","f","m","f","m","m","m","m","f","m","m","f","f","f","f","f","f","m","m","f","m","f","f","f","m","m","m","f"],[14,12,26,25,18,22,6,1,13,27,15,5,12,9,8,10,3,4,26,2,11,1,5,15,18,2,11,12,5,13,43,4,15,29,22,4,14,4,37,16,26,9,19,5,25,22,23,16,29,12],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[14,12,26,25,18,22,6,1,13,27,15,5,12,9,8,10,3,4,26,2,11,1,5,15,18,2,11,12,5,13,43,4,15,29,22,4,14,4,37,16,26,9,19,5,25,22,23,16,29,12],["10-14","10-14","20-29","20-29","15-19","20-29","5-9","0-4","10-14","20-29","15-19","5-9","10-14","5-9","5-9","10-14","0-4","0-4","20-29","0-4","10-14","0-4","5-9","15-19","15-19","0-4","10-14","10-14","5-9","10-14","30-49","0-4","15-19","20-29","20-29","0-4","10-14","0-4","30-49","15-19","20-29","5-9","15-19","5-9","20-29","20-29","20-29","15-19","20-29","10-14"],["10-14","10-14","25-29","25-29","15-19","20-24","5-9","0-4","10-14","25-29","15-19","5-9","10-14","5-9","5-9","10-14","0-4","0-4","25-29","0-4","10-14","0-4","5-9","15-19","15-19","0-4","10-14","10-14","5-9","10-14","40-44","0-4","15-19","25-29","20-24","0-4","10-14","0-4","35-39","15-19","25-29","5-9","15-19","5-9","25-29","20-24","20-24","15-19","25-29","10-14"],["Central Hospital","Port Hospital","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Military Hospital","Missing","Missing","Port Hospital","Port Hospital","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Military Hospital","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Missing","Missing","Military Hospital","Military Hospital","Missing","Port Hospital","Military Hospital","Central Hospital","Central Hospital","Missing","Missing","Other","Port Hospital","Other","Missing","Military Hospital","Port Hospital","Military Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Port Hospital","Other"],[-13.2330769474001,-13.2231931914572,-13.2122631729853,-13.2152339775486,-13.212910703914,-13.2228638912441,-13.2143394209926,-13.2599196027204,-13.2243703238737,-13.2115157489446,-13.2331547837254,-13.2222002700958,-13.2320975453153,-13.2225511595637,-13.2270219251255,-13.2242058657802,-13.2183252570302,-13.209391925612,-13.2243437095992,-13.2628934511971,-13.21422143145,-13.2339681355349,-13.2289363806984,-13.2343804000797,-13.2250089377786,-13.2338585724463,-13.2593132020914,-13.2162953240809,-13.2093776169918,-13.2266742923612,-13.247814368147,-13.2472804825882,-13.2362371704204,-13.2113470441303,-13.2142410663192,-13.2343341712241,-13.2379376608352,-13.2177946632397,-13.2483677722899,-13.2163318124535,-13.238964614443,-13.2209544818868,-13.2221173306518,-13.2510797882678,-13.2181811346655,-13.2209026809759,-13.2261633517308,-13.2330734719715,-13.250631166599,-13.2547212675054],[8.46002984141364,8.47325128269697,8.46838441895748,8.45171855856465,8.46481700596819,8.46082377490923,8.48932072596067,8.45436259178895,8.47024789713924,8.45094401624318,8.46272931462646,8.46388925014565,8.46144367534271,8.46191259217774,8.47745440981732,8.48663467687094,8.47967725011828,8.47570184950483,8.47145134147474,8.46479592922727,8.48528034195779,8.46957530395867,8.46886903678583,8.46901638731497,8.47404889511544,8.47955475519858,8.45810737927856,8.46395131808455,8.4765592834436,8.48408263734462,8.47038713612408,8.46592212548667,8.48544694884164,8.47982352763317,8.4641347894342,8.47832062438022,8.4697737543226,8.45020022241045,8.48466158574339,8.4630635336683,8.48776686246878,8.48436046542975,8.46420961833913,8.47178418137766,8.4757725605068,8.46353857052336,8.47203374851162,8.46178968158864,8.47947718621549,8.45825808128071],[null,"2ae019","2ae019",null,null,"11f8ea",null,"bd8c0e","53da57",null,"893f25",null,"133ee7",null,"cbbe78","431135",null,"9f6884",null,"4977bd",null,"a75c7f",null,"2671fa","ab634e",null,"c36eb4","ea3740","beb26e","b799eb","71577a",null,"b80480","3e6957",null,"894024","b0c500","64c8ef",null,null,"62a2ef",null,"d15be5","f36522","8940e5","cfd79c","021718","d145b7","cfd79c",null],[null,"other","other",null,null,"other",null,"other","other",null,"other",null,"other",null,"funeral","other",null,"other",null,"funeral",null,"other",null,"other","other",null,"other","other","funeral","other","other",null,"other","other",null,"funeral","other","other",null,null,"other",null,"other","other","other","other","other","other","other",null],[57.9543370750053,72.903315711843,61.3550373807362,74.9252154987378,60.8140332121575,73.0392927197671,40.3952926046292,18.5860458051297,65.915405266829,59.7407289858923,58.850023146804,41.7793981661872,64.3207186043017,45.3071059265302,49.2346597712611,55.6132568449462,44.7917460048021,36.1029809686007,78.4242900973357,34.0573768682361,37.1666798452591,23.3102599354947,54.1674564323421,60.1511973138815,64.5714791642557,24.2673242687725,68.0484697494943,63.8629037670008,49.8224101387143,64.5379712152469,90.5769525550137,36.0166754500094,64.7999465562328,71.0494317101083,63.6769790626423,39.698689226328,56.848873724477,35.9567070403828,76.1176769410485,65.0476759466627,62.3022824150437,44.9747053136027,61.5511693539164,43.2422219122552,63.2672625030581,47.4381108715924,72.1707361942321,67.853226553865,73.6857714546986,47.2529971424094],[166.749418687763,133.818602320123,151.695755303934,153.316319514732,165.290650391993,120.122123158907,108.261883736877,47.4422250141074,166.387318202026,156.775506829027,118.160296743799,84.9245792519324,119.097329118499,124.904352980613,72.5598509739827,149.021006790393,75.1358593284519,55.0179963945138,210.543288076169,50.8667977790487,110.215510985474,28.1660762993844,80.2852746720437,120.963312698541,167.656991740146,37.2430369850988,132.609319255062,142.729680187775,84.5131434907977,151.212937283442,200.582682003085,77.7531591755265,120.247308139647,140.245897914456,142.433078928918,82.8576503511686,146.911391485897,67.388094657533,211.611265576819,145.5168399601,178.785450175307,104.916098108791,184.2272908349,76.9581212124093,167.176929885444,142.262756500034,166.053378508752,124.15789217315,171.478674181257,110.647858657317],[21,22,21,23,22,21,21,23,22,22,22,22,24,21,22,21,22,20,22,21,22,23,23,22,22,23,22,24,24,23,22,22,23,21,24,21,21,23,22,22,21,23,21,21,23,22,22,21,21,23],["no","no",null,"no","no","no",null,"no","no","no","no",null,"no","no","no",null,null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no","no",null,null,"no","no","no",null,null,"no","no","no",null],["no","no",null,"no","yes","no",null,"no","yes","no","no",null,"yes","yes","no",null,null,"yes","no","yes","no","yes","no","no","no","yes","no","no",null,"no","yes","no","no","no",null,"yes","no","no","no",null,null,"no","no","no",null,null,"no","yes","no",null],["no","yes",null,"yes","yes","yes",null,"yes","yes","no","yes",null,"no","yes","yes",null,null,"yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","no","yes","no",null,null,"yes","no","yes",null,null,"no","yes","yes",null],["no","no",null,"no","no","no",null,"no","no","no","yes",null,"no","no","no",null,null,"no","no","yes","no","yes","no","yes","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no","no",null,null,"no","no","no",null,null,"no","no","yes",null],["no","no",null,"no","no","yes",null,"yes","no","no","yes",null,"no","yes","no",null,null,"yes","yes","yes","yes","no","yes","no","no","yes","no","yes",null,"no","yes","yes","no","no",null,"no","yes","yes","yes",null,null,"yes","no","yes",null,null,"yes","yes","yes",null],[36.2840110708362,37.4817129799808,37.1331561923118,36.5729378731705,36.6132940820539,36.9562671678823,36.8447226634927,37.2397852010363,37.2266736491902,37.2344022830661,36.5330245928798,36.4644771929462,37.6041462353006,37.3284244592967,36.3361625891291,37.7085947123389,37.4823622504343,36.6778850163965,36.9665689427275,36.2427185251953,37.1978056174955,36.5110221161676,37.0110832645393,37.6299404880321,36.9521080508208,37.3753025924304,37.5791540988549,36.9014777869365,37.2885432396843,37.2261179823582,36.8817916145012,37.2096759938222,36.949229724288,37.0421117401582,36.4546360878183,36.7214069539379,36.6154216315974,37.8861007735333,37.7850506908724,37.4765739629385,37.3965605173202,37.1551734248063,36.3735869941929,37.2017322796443,37.0261875673878,37.8233197801684,36.8393765475446,37.635014845436,36.6533129418459,37.4625706486188],[null,"12:25",null,"13:23","19:49","15:31","13:10","14:27","20:43","15:55","21:32","15:36","05:49","08:47","16:37","16:47","12:38","16:28","20:36","13:49","07:24","13:37","14:54","06:60","13:49","13:30","17:26","13:33","07:35","09:18","18:46","12:38","10:08","12:52","11:13","18:26","09:29","16:17","18:34","16:37","16:41",null,null,"15:17","19:29","15:54","10:30","13:36",null,"13:47"],[21,2,1,1,2,1,null,null,2,1,2,0,1,1,1,0,2,0,0,1,1,2,0,2,1,null,1,2,1,0,1,1,0,2,null,2,2,2,1,1,1,2,2,0,2,0,2,0,0,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Case counts aggregated by hospital</strong></p>
<p>The first 50 rows are displayed</p>
<div id="htmlwidget-429bb2a005943c3c5a1a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-429bb2a005943c3c5a1a">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1410307200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="set-parameters" class="section level3" number="29.2.3">
<h3>
<span class="header-section-number">29.2.3</span> Set parameters<a class="anchor" aria-label="anchor" href="#set-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>You may want to set certain parameters for production of a report, such as the date for which the data is current (the “data date”).
You can then reference the <code>data_date</code> in the code when applying filters or in captions that auto-update.</p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set the report date for the report</span>
<span class="co">## note: can be set to Sys.Date() for the current date</span>
<span class="va">data_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-05-15"</span><span class="op">)</span></code></pre></div>
</div>
<div id="verify-dates" class="section level3" number="29.2.4">
<h3>
<span class="header-section-number">29.2.4</span> Verify dates<a class="anchor" aria-label="anchor" href="#verify-dates"><i class="fas fa-link"></i></a>
</h3>
<p>Verify that each relevant date column is class Date and has an appropriate range of values. This <code>for</code> loop prints a histogram for each column.</p>
<div class="sourceCode" id="cb634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create character vector of column names </span>
<span class="va">DateCols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/vars_select.html">vars_select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"date|Date|dt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Produce histogram of each date column</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">Col</span> <span class="kw">in</span> <span class="va">DateCols</span><span class="op">)</span> <span class="op">{</span>     <span class="co"># open loop. iterate for each name in vector DateCols</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">[</span>, <span class="va">Col</span><span class="op">]</span>,     <span class="co"># print histogram of the column in linelist dataframe</span>
       breaks <span class="op">=</span> <span class="fl">50</span>,         <span class="co"># number of breaks for the histogram</span>
       xlab <span class="op">=</span> <span class="va">Col</span><span class="op">)</span>          <span class="co"># x-axis label is the name of the column</span>
  <span class="op">}</span>                         <span class="co"># close the loop</span></code></pre></div>
<p><img src="_main_files/figure-html/verify_dates-1.png" width="50%"><img src="_main_files/figure-html/verify_dates-2.png" width="50%"><img src="_main_files/figure-html/verify_dates-3.png" width="50%"><img src="_main_files/figure-html/verify_dates-4.png" width="50%"></p>
<!-- ======================================================= -->
</div>
</div>
<div id="incidence-package" class="section level2 tabset tabset-fade" number="29.3">
<h2>
<span class="header-section-number">29.3</span> <code>incidence</code> package<a class="anchor" aria-label="anchor" href="#incidence-package"><i class="fas fa-link"></i></a>
</h2>
<p>Below are tabs on making quick epicurves using the <strong>incidence</strong> package</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Epicontacts expects data to be in a “linelist” format of one row per case (not aggregated). If your data is aggregated counts, look to the ggplot epicurves tab.</span></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> The documentation for plotting an <strong>incidence</strong> object can be accessed by entering <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">?plot.incidence</a></code> in your R console.</span></p>
<p><a href="https://cran.r-project.org/web/packages/incidence/vignettes/customize_plot.html#example-data-simulated-ebola-outbreak" class="uri">https://cran.r-project.org/web/packages/incidence/vignettes/customize_plot.html#example-data-simulated-ebola-outbreak</a></p>
<!-- ======================================================= -->
<div id="intro" class="section level3 tabset tabset-fade" number="29.3.1">
<h3>
<span class="header-section-number">29.3.1</span> Intro<a class="anchor" aria-label="anchor" href="#intro"><i class="fas fa-link"></i></a>
</h3>
<p><strong>2 steps are requires to plot an epicurve with the <em>incidence</em> package:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Create</strong> an <em>incidence object</em> (using the function <code><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence()</a></code>)
<ul>
<li>Provide the case linelist<br>
</li>
<li>Specify the <em>time interval</em> into which the cases should be aggregated (daily, weekly, monthly..)<br>
</li>
<li>Specify any sub-groups<br>
</li>
</ul>
</li>
<li>
<strong>Plot</strong> the incidence object
<ul>
<li>Specify labels, aesthetic themes, etc.</li>
</ul>
</li>
</ol>
<p><strong>A simple example</strong> - an epicurve of daily cases:</p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load incidence package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.repidemicsconsortium.org/incidence/">incidence</a></span><span class="op">)</span>

<span class="co"># create the incidence object using data by day</span>
<span class="va">epi_day</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>,  <span class="co"># the linelist data</span>
                       interval <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>     <span class="co"># the time interval</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_day</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-391-1.png" width="672"></div>
<p><strong>Change time interval of case aggregation (bars)</strong></p>
<p>The <code>interval</code> argument defines how the observations are grouped. Available options include all the options from the package <strong>aweek</strong>, including but not limited to:</p>
<ul>
<li>“week” (Monday start day is default)<br>
</li>
<li>“2 weeks” (or 3, 4, 5…)<br>
</li>
<li>“Sunday week”<br>
</li>
<li>“2 Sunday weeks” (or 3, 4, 5…)<br>
</li>
<li>“MMWRweek” (starts on Sunday - see US CDC)<br>
</li>
<li>“month” (1st of month)<br>
</li>
<li>“quarter” (1st of month of quarter)</li>
<li>“2 months” (or 3, 4, 5…)<br>
</li>
<li>“year” (1st day of calendar year)</li>
</ul>
<p>Below are examples of how different intervals look when applied to the linelist.<br>
Format and frequency of the date <em>labels</em> on the x-axis are the defaults for the specified interval.</p>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create the incidence objects (with different intervals)</span>
<span class="co">##############################</span>
<span class="co"># Weekly (Monday week by default)</span>
<span class="va">epi_wk</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sunday week</span>
<span class="va">epi_Sun_wk</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Three weeks (Monday weeks by default)</span>
<span class="va">epi_3wk</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Monthly</span>
<span class="va">epi_month</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot the incidence objects (+ titles for clarity)</span>
<span class="co">############################</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_wk</span><span class="op">)</span><span class="op">+</span>     <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Monday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_Sun_wk</span><span class="op">)</span><span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sunday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_3wk</span><span class="op">)</span><span class="op">+</span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Every 3 Monday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_month</span><span class="op">)</span><span class="op">+</span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Months"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/incidence-1.png" width="50%"><img src="_main_files/figure-html/incidence-2.png" width="50%"><img src="_main_files/figure-html/incidence-3.png" width="50%"><img src="_main_files/figure-html/incidence-4.png" width="50%"></p>
<!-- ======================================================= -->
</div>
<div id="modifications" class="section level3 tabset tabset-fade" number="29.3.2">
<h3>
<span class="header-section-number">29.3.2</span> Modifications<a class="anchor" aria-label="anchor" href="#modifications"><i class="fas fa-link"></i></a>
</h3>
<p>The <strong>incidence</strong> package enables modifications in the following ways:</p>
<ul>
<li>Arguments of <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> (e.g. <code>show_cases</code>, <code>col_pal</code>, <code>alpha</code>…)<br>
</li>
<li>
<code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">scale_x_incidence()</a></code> and <code>make_labels()</code><br>
</li>
<li>
<code>ggplot()</code> additions via the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> operator</li>
</ul>
<p>Read details in the Help files by entering <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">?scale_x_incidence</a></code> and <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">?plot.incidence</a></code> in the R console. Online vignettes are listed in the resources tab.</p>
<div id="plot-modifications" class="section level4" number="29.3.2.1">
<h4>
<span class="header-section-number">29.3.2.1</span> <code>plot()</code> modifications<a class="anchor" aria-label="anchor" href="#plot-modifications"><i class="fas fa-link"></i></a>
</h4>
<p>A incidence plot can be modified in the following ways. Type <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">?plot.incidence</a></code> in the R console for more details.</p>
<ul>
<li>
<code>show_cases =</code> If TRUE, each case is shows as a box. Best on smaller outbreaks.<br>
</li>
<li>
<code>color =</code> Color of case bars/boxes<br>
</li>
<li>
<code>border =</code> Color of line around boxes, if <code>show_cases = TRUE</code><br>
</li>
<li>
<code>alpha =</code> Transparency of case bars/boxes (1 is fully opaque, 0 is fully transparent)<br>
</li>
<li>
<code>xlab =</code> Title of x-axis (axis labels can also be applied using <code>labs()</code> from ggplot)<br>
</li>
<li>
<code>ylab =</code> Title of y-axis; defaults to user-defined incidence time interval<br>
</li>
<li>
<code>labels_week =</code> Logical, indicate whether x-axis labels are in week or date format, absent other modifications</li>
<li>
<code>n_breaks =</code> Number of x-axis label breaks, absent other modifications<br>
</li>
<li>
<code>first_date</code>, <code>last_date</code> Dates used to trim the plot</li>
</ul>
<p>See examples of these arguments in the subsequent tabs.</p>
</div>
<div id="filtered-data" class="section level4" number="29.3.2.2">
<h4>
<span class="header-section-number">29.3.2.2</span> Filtered data<a class="anchor" aria-label="anchor" href="#filtered-data"><i class="fas fa-link"></i></a>
</h4>
<p><strong>To plot the epicurve of a subset of data:</strong></p>
<ol style="list-style-type: decimal">
<li>Filter the linelist data<br>
</li>
<li>Feed the subset to the <code><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence()</a></code> command</li>
</ol>
<p>The example below uses data filtered to show only cases at Central Hospital.</p>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the dataset</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using subset of data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></code></pre></div>
<pre><code>## 15 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weekly case incidence at Central Hospital"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/incidence_filtered-1.png" width="672"></div>
</div>
<div id="date-axis-labelsgridlines" class="section level4 tabset tabset-fade" number="29.3.2.3">
<h4>
<span class="header-section-number">29.3.2.3</span> Date-axis labels/gridlines<a class="anchor" aria-label="anchor" href="#date-axis-labelsgridlines"><i class="fas fa-link"></i></a>
</h4>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Remember that date-axis <strong>labels</strong> are independent from the aggregation of the data into bars</span></p>
<p><strong>Modify the bars</strong><br>
The aggregation of data into bars occurs when you set the <code>interval =</code> when creating the incidence object. The options for <code>interval</code> come from the package <strong>aweek</strong> and include options like “day”, “Monday week”, “Sunday week”, “month”, “2 weeks”, etc. See the incidence intro tab for more information.</p>
<p><strong>Modify date-axis labels (frequency &amp; format)</strong></p>
<p>If working with the <strong>incidence</strong> package, you have several options to make these modifications. Some utilize the <strong>incidence</strong> package functions <code>scale_x_date()</code> and <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">make_breaks()</a></code>, others use the <strong>ggplot2</strong> function <code>scale_x_date()</code>, and others use a combination.</p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Be cautious setting the y-axis scale breaks (e.g. 0 to 30 by 5: <code><a href="https://rdrr.io/r/base/seq.html">seq(0, 30, 5)</a></code>). Static numbers can cut-off your data if the data changes!.</span></p>
<div id="option-1-scale_x_incidence-only" class="section level5" number="29.3.2.3.1">
<h5>
<span class="header-section-number">29.3.2.3.1</span> Option 1: <code>scale_x_incidence()</code> only<a class="anchor" aria-label="anchor" href="#option-1-scale_x_incidence-only"><i class="fas fa-link"></i></a>
</h5>
<ol style="list-style-type: decimal">
<li>Add <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">scale_x_incidence()</a></code> from the <strong>incidence</strong> package:
<ul>
<li>Why use this approach?
<ul>
<li>
<strong>Advantages</strong>: Short code. Auto-adjusts weekly labels to interval of incidence object (Monday, Sunday weeks, etc.)<br>
</li>
<li>
<strong>Disadvantages</strong>: Cannot make fine adjustments to label format or minor vertical gridlines between labels<br>
</li>
</ul>
</li>
<li>Provide the name of the incidence object to ensure labels align with specified <code>interval</code> (e.g. Sundays or Mondays)</li>
<li>
<em>optional:</em> <code>n_breaks</code> specify number of date labels, which start from the <em>interval</em> of the first case.
<ul>
<li>for breaks every nth week, use <code>n_breaks = nrow(i)/n</code> (“i” is the incidence object name and “n” is a number)<br>
</li>
</ul>
</li>
<li>
<em>optional:</em> <code>labels_week</code> labels formatted as either weeks (YYYY-Www) or dates (YYYY-MM-DD)<br>
</li>
<li>One vertical gridline will appear per date label</li>
</ul>
</li>
</ol>
<p>Other notes:</p>
<ul>
<li>Type <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">?scale_x_incidence</a></code> into the R console to see more information.<br>
</li>
<li>If incidence interval is “month”, n_breaks and labels_week will behave differently<br>
</li>
<li>Adding <code>scale_x_date()</code> to the plot will remove labels created by <code>scale_x_incidence</code><br>
</li>
<li><em>Note in plot below that the first label is 27 April 2014, the Sunday before the first case (May 1), aligning with Sunday weeks of the incidence object.</em></li>
</ul>
<div class="sourceCode" id="cb650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create weekly incidence object (Sunday weeks)</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span></code></pre></div>
<pre><code>## 15 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">scale_x_incidence</a></span><span class="op">(</span><span class="va">i</span>,                    <span class="co"># name of incidence object</span>
                    labels_week <span class="op">=</span> <span class="cn">F</span>,      <span class="co"># show dates instead of weeks</span>
                    n_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span> <span class="co"># breaks every 8 weeks from week of first case</span></code></pre></div>
<pre><code>## Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-392-1.png" width="672"></div>
</div>
<div id="option-2-scale_x_date-and-make_breaks" class="section level5" number="29.3.2.3.2">
<h5>
<span class="header-section-number">29.3.2.3.2</span> Option 2: <code>scale_x_date()</code> and <code>make_breaks()</code><a class="anchor" aria-label="anchor" href="#option-2-scale_x_date-and-make_breaks"><i class="fas fa-link"></i></a>
</h5>
<ol start="2" style="list-style-type: decimal">
<li>Add <code>scale_x_date()</code> from <strong>ggplot2</strong>, but also leverage <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">make_breaks()</a></code> from <strong>incidence</strong>:
<ul>
<li>Why use this approach?
<ul>
<li>
<strong>Advantages</strong>: Best of both worlds: weekly labels auto-aligned to incidence interval, <em>and</em> you can make detailed adjustments to label format</li>
<li>
<strong>Disadvantages</strong>: <em>If</em> minor gridlines between Sunday-week date labels are desired, they are not auto-aligned<br>
</li>
</ul>
</li>
<li>After creating the incidence object, use <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">make_breaks()</a></code> to define date label breaks
<ul>
<li>
<code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">make_breaks()</a></code> is similar to <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">scale_x_incidence()</a></code> (described above). Provide the incidence object name and optionally <code>n_breaks</code> as described before.</li>
</ul>
</li>
<li>Add <code>scale_x_date()</code> to the plot:
<ul>
<li>
<code>breaks =</code> provide the breaks vector you created with <code><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">make_breaks()</a></code>, followed by <code>$breaks</code> (see example below)</li>
<li>
<code>date_labels =</code> provide a format for the date labels (e.g. “%d %b”) (use “” for new line)</li>
</ul>
</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Break modification using scale_x_date() and make_breaks()</span>
<span class="co">###########################################################</span>
<span class="co"># make incidence object</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span></code></pre></div>
<pre><code>## 15 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make breaks</span>
<span class="va">i_labels</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/plot.incidence.html">make_breaks</a></span><span class="op">(</span><span class="va">i</span>, n_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">/</span><span class="fl">6</span><span class="op">)</span> <span class="co"># using interval from i, breaks every 6 weeks</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>breaks      <span class="op">=</span> <span class="va">i_labels</span><span class="op">$</span><span class="va">breaks</span>, <span class="co"># call the breaks</span>
               date_labels <span class="op">=</span> <span class="st">"%d\n%b '%y"</span>,    <span class="co"># date format</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span>   <span class="co"># gridlines each week (aligns with Sundays only)  </span></code></pre></div>
<pre><code>## Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-393-1.png" width="672"></div>
</div>
<div id="option-3-use-scale_x_date-only" class="section level5" number="29.3.2.3.3">
<h5>
<span class="header-section-number">29.3.2.3.3</span> Option 3: Use <code>scale_x_date()</code> only<a class="anchor" aria-label="anchor" href="#option-3-use-scale_x_date-only"><i class="fas fa-link"></i></a>
</h5>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>Use <code>scale_x_date()</code> only</strong>
<ul>
<li>
<strong>Advantages</strong>: Complete control over breaks, labels, gridlines, and plot width<br>
</li>
<li>
<strong>Disadvantages</strong>: More code required, more opportunity to make mistakes.<br>
</li>
<li>If your incidence <em>intervals</em> are days or <strong>Monday weeks</strong>, (easy!):
<ul>
<li>Provide interval to <code>date_breaks =</code> (e.g. “day”, “week”, “2 weeks”, “month”, “year”)</li>
<li>Provide interval to <code>date_minor_breaks =</code> for vertical lines between date labels<br>
</li>
</ul>
</li>
<li>If your incidence <em>intervals</em> are <strong>Sunday weeks</strong>, it is more complex - see the tab for a Sunday week example
<ul>
<li>Provide a sequence of Sunday dates to <code>breaks =</code> and to <code>minor_breaks =</code><br>
</li>
</ul>
</li>
<li>Use <code>date_labels =</code> for formatting (see Dates page for tips)<br>
</li>
<li>Add the argument <code>expand = c(0,0)</code> to start labels at the first incidence bar. Otherwise, first label will shift depending on your specified label interval.</li>
</ul>
</li>
</ol>
<p>*Note: if using aggregated counts (for example an epiweek x-axis) your x-axis may not be Date class and may require use <code>scale_x_discrete()</code> instead of <code>scale_x_date()</code> - see ggplot tips page for more details.</p>
<div class="sourceCode" id="cb658"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Break modification using scale_x_date() only</span>
<span class="co">##############################################</span>
<span class="co"># make incidence object</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span></code></pre></div>
<pre><code>## 15 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
               date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span>  <span class="co"># date labels format </span></code></pre></div>
<pre><code>## Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-394-1.png" width="672"></div>
</div>
<div id="a-sunday-week-example" class="section level5" number="29.3.2.3.4">
<h5>
<span class="header-section-number">29.3.2.3.4</span> A Sunday week example<a class="anchor" aria-label="anchor" href="#a-sunday-week-example"><i class="fas fa-link"></i></a>
</h5>
<p>If you want a plot of Sunday weeks and also finely-adjusted label formats, you might find a code example helpful.<br>
Here is an example of producing a weekly epicurve using <strong>incidence</strong> for Sunday weeks, with finely-adjusted date labels through <code>scale_x_date()</code>:</p>
<div class="sourceCode" id="cb662"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load packages</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>,  <span class="co"># for ggplot</span>
               <span class="va">incidence</span>,  <span class="co"># for epicurve</span>
               <span class="va">lubridate</span><span class="op">)</span>  <span class="co"># for floor_date() and ceiling_date()</span>

<span class="co"># create incidence object (specifying SUNDAY weeks)</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span> <span class="co"># equivalent to "MMWRweek" (see US CDC)</span></code></pre></div>
<pre><code>## 15 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb664"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot() the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span><span class="op">)</span><span class="op">+</span>                  
  
  <span class="co">### ggplot() commands added to the plot</span>
  <span class="co"># scale modifications </span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                 <span class="co"># remove excess x-axis space below and after case bars</span>
    
    <span class="co"># sequence by 3 weeks, from Sunday before first case to Sunday after last case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
    
    <span class="co"># sequence by week, from Sunday before first case to Sunday after last case</span>
    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    <span class="co"># date labels</span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b'%y"</span><span class="op">)</span><span class="op">+</span>       <span class="co"># adjust how dates are displayed</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                  <span class="co"># remove excess space under x-axis</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>          <span class="co"># adjust y-axis intervals</span>
  
  <span class="co"># Aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                    <span class="co"># simplify background</span>
  <span class="fu">theme</span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,       <span class="co"># axis titles formatting</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># caption formatting, left-aligned</span>
  
  <span class="co"># Plot labels</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week of symptom onset (Sunday weeks)"</span>, 
       y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>, 
       title <span class="op">=</span> <span class="st">"Weekly case incidence at Central Hospital"</span>,
       <span class="co">#subtitle = "",</span>
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-395-1.png" width="672"></div>
</div>
</div>
<div id="show-individual-cases" class="section level4" number="29.3.2.4">
<h4>
<span class="header-section-number">29.3.2.4</span> Show individual cases<a class="anchor" aria-label="anchor" href="#show-individual-cases"><i class="fas fa-link"></i></a>
</h4>
<p><strong>To show boxes around each individual case, use the argument <code>show_cases = TRUE</code> in the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function.</strong></p>
<p>Boxes around each case can be more reader-friendly, if the outbreak is of a small size. Boxes can be applied when the interval is days, weeks, or any other time period. The code below creates the <em>weekly</em> epicurve for a smaller outbreak (only cases from Central Hospital), with boxes around each case.</p>
<div class="sourceCode" id="cb666"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create filtered dataset for Central Hospital</span>
<span class="va">central_data</span>  <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object (weekly)</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span></code></pre></div>
<pre><code>## 15 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb668"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot outbreak</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span>,
     show_cases <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>                 <span class="co"># show boxes around individual cases</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-396-1.png" width="672"></div>
<p>The same epicurve showing individual cases, but with other aesthetic modifications:</p>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add plot() arguments and ggplot() commands</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span>,
     show_cases <span class="op">=</span> <span class="cn">T</span>,                 <span class="co"># show boxes around each individual case</span>
     color <span class="op">=</span> <span class="st">"lightblue"</span>,            <span class="co"># color inside boxes</span>
     border <span class="op">=</span> <span class="st">"darkblue"</span>,            <span class="co"># color of border around boxes</span>
     alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>                    <span class="co"># transparency</span>
  
  <span class="co">### ggplot() commands added to the plot</span>
  <span class="co"># scale modifications</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"4 weeks"</span>,      <span class="co"># labels appear every 4 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%d\n%b'%y"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># date labels format </span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,              <span class="co"># remove excess space under x-axis</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">35</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># adjust y-axis intervals</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                                 <span class="co"># simplify background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,       <span class="co"># axis title format</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># caption format and left-align</span>
  
  <span class="co"># plot labels</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week of symptom onset (Monday weeks)"</span>, 
       y <span class="op">=</span> <span class="st">"Weekly reported cases"</span>, 
       title <span class="op">=</span> <span class="st">"Weekly case incidence at Central Hospital"</span>,
       <span class="co">#subtitle = "",</span>
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-397-1.png" width="672"></div>
</div>
<div id="color-by-value" class="section level4" number="29.3.2.5">
<h4>
<span class="header-section-number">29.3.2.5</span> Color by value<a class="anchor" aria-label="anchor" href="#color-by-value"><i class="fas fa-link"></i></a>
</h4>
<p>To color the cases by value, provide the column to the <code>groups =</code> argument in the <code><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence()</a></code> command. In the example below the cases are colored by their age category. Note the use of <code><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence()</a></code> argument <code>na_as_group =</code>. If TRUE (by default) missing values (<code>NA</code>) will form their own group.</p>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category</span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>,            <span class="co"># date of onset for x-axis</span>
                               interval <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># weekly aggregation of cases</span>
                               groups <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, <span class="co"># color by age_cat value</span>
                               na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>        <span class="co"># missing values assigned their own group</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the epicurve</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-398-1.png" width="672"></div>
<p><strong>Adjusting order</strong></p>
<p>To adjust the order of group appearance (on plot and in legend), the group column must be class Factor. Adjust the order by adjusting the order of the levels (including <code>NA</code>). Below is an example with gender groups using data from Central Hospital only.</p>
<ul>
<li>First, the dataset is defined and gender is re-defined as a factor<br>
</li>
<li>The order of levels of gender are defined with <code>NA</code> first, so it appears on the top of the bars<br>
</li>
<li>More appropriate labels are defined for each factor level - these appear in the legend<br>
</li>
<li>The argument <code>exclude = NULL</code> in <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> is necessary to adjust the order of <code>NA</code>, which is excluded by default.<br>
</li>
<li>Title of legend adjusted using <code>fill =</code> in <code>labs()</code>
</li>
</ul>
<p>You can read more about factors in their page (LINK)</p>
<div class="sourceCode" id="cb674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, data grouped by gender</span>
<span class="co">#################################################</span>

<span class="co"># Classify "gender" column as factor</span>
<span class="co">####################################</span>
<span class="co"># with specific level order and labels, includin for missing values</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">gender</span>,
                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>,
                         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span>,
                         exclude <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create incidence object, by gender</span>
<span class="co">####################################</span>
<span class="va">gender_outbreak_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, 
                                     interval <span class="op">=</span> <span class="st">"week"</span>, 
                                     groups <span class="op">=</span> <span class="va">central_data</span><span class="op">$</span><span class="va">gender</span>,
                                     na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   <span class="co"># Missing values assigned their own group</span></code></pre></div>
<pre><code>## 15 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb676"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot epicurve with modifications</span>
<span class="co">##################################</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gender_outbreak_central</span>,
     show_cases <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span>                            <span class="co"># show box around each case</span>
     
     <span class="co">### ggplot commands added to plot</span>
     <span class="co"># scale modifications</span>
     <span class="fu">scale_x_date</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                  date_breaks <span class="op">=</span> <span class="st">"6 weeks"</span>,
                  date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,
                  date_labels <span class="op">=</span> <span class="st">"%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span>
  
     <span class="co"># aesthetic themes</span>
     <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                               <span class="co"># simplify plot background</span>
     <span class="fu">theme</span><span class="op">(</span>
       legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
       axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># axis title bold</span>
     
      <span class="co"># plot labels</span>
      <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Gender"</span>,                         <span class="co"># title of legend</span>
           title <span class="op">=</span> <span class="st">"Show case boxes, with modifications"</span>,
           y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,
           x <span class="op">=</span> <span class="st">"Week of symptom onset"</span><span class="op">)</span>      </code></pre></div>
<pre><code>## Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-399-1.png" width="672"></div>
</div>
<div id="change-colors-and-legend" class="section level4" number="29.3.2.6">
<h4>
<span class="header-section-number">29.3.2.6</span> Change colors and legend<a class="anchor" aria-label="anchor" href="#change-colors-and-legend"><i class="fas fa-link"></i></a>
</h4>
<p><strong>To change the legend</strong><br>
Use <code>ggplot()</code> commands such as:</p>
<ul>
<li>
<code>theme(legend.position = "top")</code> (or “bottom”, “left”, “right”)</li>
<li>
<code>theme(legend.direction = "horizontal")</code><br>
</li>
<li>
<code>theme(legend.title = element_blank())</code> to have no title</li>
</ul>
<p>See the page of ggplot() tips for more details on legends.</p>
<p><strong>To specify colors manually</strong>, provide the name of the color or a character vector of multiple colors to the argument <code>color =</code>. Note to function properly the number of colors listed must equal the number of groups (be aware of missing values as a group)</p>
<div class="sourceCode" id="cb678"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># weekly outbreak by hospital</span>
<span class="va">hosp_outbreak</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, 
                               interval <span class="op">=</span> <span class="st">"week"</span>, 
                               groups <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,
                               na_as_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>   <span class="co"># Missing values not assigned their own group</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb680"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># default colors</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hosp_outbreak</span><span class="op">)</span>

<span class="co"># manual colors</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hosp_outbreak</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"darkblue"</span>, <span class="st">"purple"</span>, <span class="st">"grey"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-400-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-400-2.png" width="50%"></p>
<p><strong>To change the color palette</strong><br>
Use the argument <code>col_pal</code> in <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> to change the color palette to one of the default <strong>base</strong> R palettes (do <em>not</em> put the name of the palette in quotes).</p>
<p>Other palettes include TO DO add page with palette names… To DO</p>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category</span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html">incidence</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>,            <span class="co"># date of onset for x-axis</span>
                               interval <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># weekly aggregation of cases</span>
                               groups <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, <span class="co"># color by age_cat value</span>
                               na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>        <span class="co"># missing values assigned their own group</span></code></pre></div>
<pre><code>## 248 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the epicurve</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span><span class="op">)</span>

<span class="co"># plot with different color palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, col_pal <span class="op">=</span> <span class="va">rainbow</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-401-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-401-2.png" width="50%"></p>
</div>
<div id="facetssmall-multiples" class="section level4" number="29.3.2.7">
<h4>
<span class="header-section-number">29.3.2.7</span> Facets/small multiples<a class="anchor" aria-label="anchor" href="#facetssmall-multiples"><i class="fas fa-link"></i></a>
</h4>
<p>To facet the plot by a variable (make “small multiples”), see the tab on epicurves with <code>ggplot()</code></p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="ggplot" class="section level2 tabset tabset-fade" number="29.4">
<h2>
<span class="header-section-number">29.4</span> <code>ggplot()</code><a class="anchor" aria-label="anchor" href="#ggplot"><i class="fas fa-link"></i></a>
</h2>
<p>Below are tabs on using the <strong>ggplot2</strong> package to produce epicurves from a linelist dataset.</p>
<p>Unlike using <strong>incidence</strong> package, you must manually control the aggregation of the data (into weeks, months, etc) <em>and</em> the labels on the date axis. If not carefully managed, this can lead to many headaches.</p>
<p>These tabs use a subset of the <code>linelist</code> dataset - only the cases from Central Hospital.</p>
<div class="sourceCode" id="cb684"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/detach.html">detach</a></span><span class="op">(</span><span class="st">"package:tidyverse"</span>, unload<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<div id="intro-1" class="section level3 tabset tabset-fade" number="29.4.1">
<h3>
<span class="header-section-number">29.4.1</span> Intro<a class="anchor" aria-label="anchor" href="#intro-1"><i class="fas fa-link"></i></a>
</h3>
<p>To produce an epicurve with <code>ggplot()</code> there are three main elements:</p>
<ul>
<li>A histogram, to aggregate the linelisted cases into “bins” and display bars of the counts per bin (potentially by grouped values)<br>
</li>
<li>Scales for the axes and their associated labels (see tab on modifications)</li>
<li>Aesthetic themes for the plot, including titles, labels, captions, etc.</li>
</ul>
<p>Below is perhaps the most simple code to produce daily and weekly epicurves. Axis scales and labels use default options.</p>
<div class="sourceCode" id="cb686"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># daily </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># x column must be class Date</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># date values binned by 1 day </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Daily"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="sourceCode" id="cb688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># weekly</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># date values binned each 7 days (arbitrary 7 days!) </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weekly"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="_main_files/figure-html/ggplot_simple-1.png" width="50%"><img src="_main_files/figure-html/ggplot_simple-2.png" width="50%"><span style="color: orange;"><strong><em>CAUTION:</em></strong> Using <code>binwidth = 7</code> starts the first bin at the first case, which could be any day of the week! To create specific Monday or Sunday weeks, see below .</span></p>
<p>To create weekly epicurves where the bins begin on a specific day of the week (e.g. Monday, Sunday), specify the histogram <code>breaks =</code> manually (not <code>binwidth</code>). This can be done by creating a sequence of dates using <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> from <strong>base</strong> R. You can start/end the sequence at a specific date (<code><a href="https://rdrr.io/r/base/as.Date.html">as.Date("YYYY-MM-DD")</a></code>, or write flexible code to begin the sequence at a specific day of the week before the first case. An example of creating such weekly breaks is below:</p>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span></code></pre></div>
<p>To achieve the “from” value (earliest date of the sequence), the minimum value in the column <code>date_onset</code> is fed to <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package, which according to the above specified arguments produces the start date of that “week”, given that the start of each week is a Monday (<code>week_start = 1</code>). Likewise, the “to” value (end date of the sequence) is specified using the inverse <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date()</a></code> function to produce the Monday <em>after</em> the last case. The “by” argument can be set to any length of days, weeks, or months.</p>
<p>This code is applied to create the histogram breaks, and also the breaks for the date labels. Read more about the date labels in the Modifications tab. Defining your breaks like above will be necessary if your weekly bins are not by Monday weeks.</p>
<p>Below is detailed code to produce weekly epicurves for Monday and Sunday weeks. See the tab on Modifications (axes) to learn the nuances of date-axis label management.</p>
<p><strong>Monday weeks</strong></p>
<p>Of note:</p>
<ul>
<li>The break points of the <em>histogram bins</em> are specified manually to begin the Monday (<code>week_start = 1</code>) before the earliest case and to end the Monday after the last case (see explanation above).<br>
</li>
<li>The breaks for <em>date labels</em> on x-axis - because the bins are Monday weeks this code uses <code>date_breaks =</code> within <code>scale_x_date()</code>, which also uses Monday weeks. Sunday weeks use a different method.<br>
</li>
<li>Minor vertical gridlines between date labels are made using <code>date_minor_breaks =</code> within <code>scale_x_date()</code>, again because this plot is for Monday weeks. Sunday weeks use a different method.<br>
</li>
<li>Adding <code>expand = c(0,0)</code> to the x and y scales removes excess space on each side of the plot, which also ensures the labels begin at the first bar.<br>
</li>
<li>Color and fill are defined in <code>geom_histogram()</code>
</li>
</ul>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL MONDAY WEEK ALIGNMENT</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>, <span class="co"># bins are 7-days</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,   <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># color of fill within bars</span>
  
  <span class="co"># x-axis labels</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
               date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># remove excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases (Monday weeks)"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle: Note alignment of bars, vertical lines, and axis labels on Mondays"</span>,
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-405-1.png" width="672"></div>
<p><strong>Sunday weeks</strong></p>
<p>The below code creates a histogram of the rows, using a date column as the x-axis. Of note:</p>
<ul>
<li>The break points of the <em>histogram bins</em> are specified manually to begin the Sunday (<code>week_start = 7</code>) before the earliest case and to end the Monday after the last case (see explanation above).</li>
<li>The breaks for <em>date labels</em> on the x-axis and vertical gridlines - because the bins are <em>not</em> Monday weeks, manually specified vectors of dates are given to <code>breaks =</code> and <code>minor_breaks =</code> within <code>scale_x_date()</code>. You <em>cannot</em> use the <code>scale_x_date()</code> arguments of <code>date_breaks</code> and <code>date_minor_breaks</code> as these align with Monday weeks.<br>
</li>
<li>Adding <code>expand = c(0,0)</code> to the x and y scales removes excess space on each side of the plot, which also ensures the labels begin at the first bar.<br>
</li>
<li>Color and fill are defined in <code>geom_histogram()</code>
</li>
</ul>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL SUNDAY WEEK ALIGNMENT</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># For histogram, manually specify bin break points: starts the Sunday before first case, end Sunday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>                    
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>, <span class="co"># bins are 7-days</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,   <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># color of fill within bars</span>
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
               breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                                 to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                                 by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
               minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                                       to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                                       by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
               date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>             <span class="co"># day, above month abbrev., above 2-digit year</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases (Sunday weeks)"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle: Note alignment of bars, vertical lines, and axis labels on Sundays"</span>,
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-406-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="modifications-1" class="section level3 tabset tabset-fade" number="29.4.2">
<h3>
<span class="header-section-number">29.4.2</span> Modifications<a class="anchor" aria-label="anchor" href="#modifications-1"><i class="fas fa-link"></i></a>
</h3>
<div id="modify-axes" class="section level4" number="29.4.2.1">
<h4>
<span class="header-section-number">29.4.2.1</span> Modify axes<a class="anchor" aria-label="anchor" href="#modify-axes"><i class="fas fa-link"></i></a>
</h4>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Remember that date-axis <strong>labels</strong> are independent from the aggregation of the data into bars</span></p>
<p>To <strong>modify the aggregation of data into bins/bars</strong>, do one of the following:</p>
<ul>
<li>Specify a <code>binwidth =</code> within <code>geom_histogram()</code> - for a column of class Date, the given number is interpreted in days<br>
</li>
<li>Specify <code>breaks =</code> as a sequence of bin break-point dates<br>
</li>
<li>Group the rows into aggregated counts (by week, month, etc.) and feed the aggregated counts to <code>ggplot()</code>. See the tab on aggregated counts for more information.</li>
</ul>
<p>To <strong>modify the date labels</strong>, use <code>scale_x_date()</code> in one of these ways:</p>
<ul>
<li>If your histogram bins are days, Monday weeks, months, or years:
<ul>
<li>Use <code>date_breaks =</code> to specify label frequency (e.g. “day”, “week”, “3 weeks”, “month”, or “year”)</li>
<li>Use <code>date_minor_breaks =</code> to specify frequency of minor vertical gridlines between date labels<br>
</li>
<li>Add <code>expand = c(0,0)</code> to begin the labels at the first bar (otherwise, first label will shift forward depending on specified frequency)<br>
</li>
<li>Use <code>date_labels =</code> to specify format of date labels - see the Dates page for tips (use <code>\n</code> for a new line)<br>
</li>
</ul>
</li>
<li>If your histogram bins are Sunday weeks:
<ul>
<li>Use <code>breaks =</code> and <code>minor_breaks =</code> by providing a sequence of dates for breaks</li>
<li>You can still use <code>date_labels =</code> for formatting as described above</li>
</ul>
</li>
</ul>
<p>To <strong>create a sequence of dates</strong><br>
You can use <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> from <strong>base</strong> R. You can start/end the sequence at a specific date (<code><a href="https://rdrr.io/r/base/as.Date.html">as.Date("YYYY-MM-DD")</a></code>, or write flexible code to begin the sequence at a specific day of the week before the first case. An example of creating such flexible breaks is below:</p>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span></code></pre></div>
<p>To achieve the “from” value (earliest date of the sequence), the minimum value in the column <code>date_onset</code> is fed to <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package, which according to the above specified arguments produces the start date of that “week”, given that the start of each week is a Monday (<code>week_start = 1</code>). Likewise, the “to” value (end date of the sequence) is specified using the inverse <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date()</a></code> function to produce the Monday <em>after</em> the last case. The “by” argument can be set to any length of days, weeks, or months.</p>
<p>If using aggregated counts (for example an epiweek x-axis) your x-axis may not be Date class and may require use <code>scale_x_discrete()</code> instead of <code>scale_x_date()</code> - see ggplot tips page for more details.</p>
<p>Set maximum and minimum date values using <code>limits = c()</code> within <code>scale_x_date()</code>. E.g. <code>scale_x_date(limits = c(as.Date("2014-04-01), NA))</code> sets a minimum but leaves the maximum open.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Caution using limits! They remove all data outside the limits, which can impact y-axis max/min, modeling, and other statistics. Strongly consider instead using limits by adding <code>coord_cartesian()</code> to your plot, which acts as a “zoom” without removing data. </span></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Be cautious setting the y-axis scale breaks (e.g. 0 to 30 by 5: <code><a href="https://rdrr.io/r/base/seq.html">seq(0, 30, 5)</a></code>). Static numbers can cut-off your data if the data changes!.</span></p>
<p><a href="https://rdrr.io/r/base/strptime.html" class="uri">https://rdrr.io/r/base/strptime.html</a> —– see all % shortcuts</p>
<p><strong>Below is a demonstration of some plots where the bins and the plot labels/gridlines are aligned and not aligned:</strong><br>
Click “Code” to see the code</p>
<div class="sourceCode" id="cb696"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7-day binwidth defaults</span>
<span class="co">#################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># x column must be class Date</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,                       <span class="co"># 7 days per bin (! starts at first case!)</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,                 <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>               <span class="co"># color of bar fill</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays with first case\ndefault axis labels/ticks not aligned"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="sourceCode" id="cb698"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7-day bins + Monday labels</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,                 <span class="co"># 7-day bins with start at first case</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,               <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,       <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,    <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>              <span class="co"># remove excess space under x-axis, make flush with labels</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays with first case\nDate labels and gridlines on Mondays"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="sourceCode" id="cb700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7-day bins + Months</span>
<span class="co">#####################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                 <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"months"</span>,          <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,      <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>    <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remove excess space under x-axis, make flush with labels</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"!CAUTION: 7-day bars start Thursdays with first case\nGridlines at 1st of each month (with labels) and weekly on Mondays\nLabels on 1st of each month"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="sourceCode" id="cb702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL MONDAY ALIGNMENT: specify manual bin breaks to be mondays</span>
<span class="co">#################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,           <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"ALIGNED Mondays"</span>,
    subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Monday before first case (28 Apr)\nDate labels and gridlines on Mondays as well"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="sourceCode" id="cb704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL SUNDAY ALIGNMENT: specify manual bin breaks AND labels to be Sundays</span>
<span class="co">############################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="co"># histogram breaks set to 7 days beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
    <span class="co"># date label breaks set to every 3 weeks beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
    <span class="co"># gridlines set to weekly beginning Sunday before first case</span>
    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,
                            by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ALIGNED Sundays"</span>,
       subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Sunday before first case (27 Apr)\nDate labels and gridlines manually set to Sundays as well"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="sourceCode" id="cb706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check values of bars by creating dataframe of grouped values</span>
<span class="co"># central_tab &lt;- central_data %&gt;% </span>
<span class="co">#   mutate(week = aweek::date2week(date_onset, floor_day = TRUE, factor = TRUE)) %&gt;% </span>
<span class="co">#   group_by(week, .drop=F) %&gt;%</span>
<span class="co">#   summarize(n = n()) %&gt;% </span>
<span class="co">#   mutate(groups_3wk = 1:(nrow(central_tab)+1) %/% 3) %&gt;% </span>
<span class="co">#   group_by(groups_3wk) %&gt;% </span>
<span class="co">#   summarize(n = n())</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-408-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-408-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-408-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-408-4.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-408-5.png" width="50%"></p>
</div>
<div id="color-by-groups" class="section level4" number="29.4.2.2">
<h4>
<span class="header-section-number">29.4.2.2</span> Color by groups<a class="anchor" aria-label="anchor" href="#color-by-groups"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Designate a column containing groups</strong></p>
<p>In any of the code template (Sunday weeks, Monday weeks), make the following changes:</p>
<ul>
<li>Add the <em>aesthetics</em> argument <code>aes()</code> within the <code>geom_histogram()</code> (don’t forget comma afterward)</li>
<li>
<strong>Within <code>aes()</code></strong>, provide the grouping column name to <code>group =</code> and <code>fill =</code> (no quotes needed). <code>group</code> is necessary, while <code>fill</code> changes the color of the bar.<br>
</li>
<li>Remove any <code>fill =</code> argument outside of the <code>aes()</code>, as it will override the one inside<br>
</li>
<li>Arguments <em>inside</em> <code>aes()</code> will apply by group, whereas any <em>outside</em> will apply to all bars (e.g. you may want <code>color =</code> outside, so each bar has the same color perimeter/border)</li>
</ul>
<pre><code>geom_histogram(
    aes(group = gender, fill = gender))</code></pre>
<p><strong>Adjust colors</strong>:</p>
<ul>
<li>To manually adjust the bar fill color of each group, use <code>scale_fill_manual()</code> (note <code>scale_color_manual()</code> is different!).
<ul>
<li>Use the <code>values =</code> argument to apply a vector of colors.<br>
</li>
<li>Use <code>na.value =</code> to specify a color for missing values.<br>
</li>
<li>! While you <em>can</em> use the <code>labels =</code> argument in <code>scale_fill_manual()</code> change the legend text labels - it is easy to accidentally give labels in the incorrect order and have an incorrect legend! It is recommended to instead convert the group column to class Factor and designate factor <code>labels</code> and order, as explained below.<br>
</li>
</ul>
</li>
<li>To adjust the colors via a <strong>color scale</strong>, see the page on ggplot tips</li>
</ul>
<p><strong>Adjust the stacking order and Legend</strong></p>
<p>Stacking order, and the labels for each group in the legend, is best adjusted by classifying the group column as class Factor. You can then designate the levels and their labels, and the order (which is reflected in stack order).</p>
<p>Step 1: Before making the ggplot, convert the <code>group</code> column to class Factor using <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> from <strong>base</strong> R.<br>
For example, with a column “gender” with values “m” and “f” and <code>NA</code>, this can be put in a <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> command as:</p>
<pre><code>dataset &lt;- dataset %&gt;% 
  mutate(gender = factor(gender,
                    levels = c(NA, "f", "m"),
                    labels = c("Missing", "Female", "Male"),
                    exclude = NULL))</code></pre>
<p>The above code establishes the levels, in the ordering that missing values are “first” (and will appear on top). Then the labels that will show are given in the same order. Lastly, the exclude statement ensures that <code>NA</code> is included in the ordering (by default <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> ignores <code>NA</code>).</p>
<p>Read more about factors in their dedicated handbook page (LINK).</p>
<p><strong>Adjusting the legend</strong></p>
<p>Read more about legends in the ggplot tips page. Here are a few highlights:</p>
<ul>
<li>
<code>theme(legend.position = "top")</code> (or “bottom”, “left”, “right”)</li>
<li>
<code>theme(legend.direction = "horizontal")</code><br>
</li>
<li>
<code>theme(legend.title = element_blank())</code> to have no title</li>
</ul>
<p>See the page of ggplot() tips for more details on legends.</p>
<p>These steps are shown in the example below:</p>
<p><em>Click “Code” to see the code</em></p>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">########################</span>
<span class="co"># bin break points for histogram defined here for clarity</span>
<span class="co"># starts the Monday before first case, end Monday after last case</span>
<span class="va">bin_breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span> <span class="co"># bins are 7-days</span>

<span class="co"># Set gender as factor and missing values as first level (to show on top)</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span>
    <span class="va">gender</span>,
    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span>,
    exclude <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>  

<span class="co"># make plot</span>
<span class="co">###########</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,    <span class="co"># arguments inside aes() apply by group</span>
    color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
    breaks <span class="op">=</span> <span class="va">bin_breaks</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># see breaks defined above</span>
                      
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co">#scale of colors and legend labels</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"orange"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># specify fill colors ("values") - attention to order!</span>

  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by gender"</span>,
    subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
    fill     <span class="op">=</span> <span class="st">"Gender"</span>,                                      <span class="co"># provide new title for legend</span>
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-409-1.png" width="672"></div>
<p><strong>Display bars side-by-side</strong></p>
<p>Side-by-side display of group bars (as opposed to stacked) is specified within <code>geom_histogram()</code> with <code>position = "dodge"</code>.<br>
If there are more than two value groups, these can become difficult to read. Consider instead using a faceted plot (small multiples) (see tab). To improve readability in this example, missing gender values are removed.</p>
<p><em>Click “Code” to see the code</em></p>
<div class="sourceCode" id="cb711"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">########################</span>
<span class="co"># bin break points for histogram defined here for clarity</span>
<span class="co"># starts the Monday before first case, end Monday after last case</span>
<span class="va">bin_breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span> <span class="co"># bins are 7-days</span>

<span class="co"># New dataset without rows missing gender</span>
<span class="va">central_data_dodge</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                            <span class="co"># remove rows missing gender</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">gender</span>,                        <span class="co"># factor now has only two levels (missing not included)</span>
                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>,
                         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  

<span class="co"># make plot</span>
<span class="co">###########</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data_dodge</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span>
        <span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,    <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
        breaks <span class="op">=</span> <span class="va">bin_breaks</span>,
        position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># see breaks defined above</span>
                      
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
               date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co">#scale of colors and legend labels</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pink"</span>, <span class="st">"lightblue"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     <span class="co"># specify fill colors ("values") - attention to order!</span>

  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by gender"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Gender"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 14 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-410-1.png" width="672"></div>
</div>
<div id="facetingsmall-multiples" class="section level4" number="29.4.2.3">
<h4>
<span class="header-section-number">29.4.2.3</span> Faceting/small-multiples<a class="anchor" aria-label="anchor" href="#facetingsmall-multiples"><i class="fas fa-link"></i></a>
</h4>
<p>As with other ggplots, you can create facetted plots (“small multiples”) off values in a column. As explained in the ggplot tips page of this handbook, you can use either:</p>
<ul>
<li><code>facet_wrap()</code></li>
<li><code>facet_grid()</code></li>
</ul>
<p>For epicurves, <code>facet_wrap()</code> is typically easiest as it is likely that you only need to facet on one column. The general syntax is <code>facet_wrap(rows ~ cols)</code>, where to the left of the tilde (~) is the name of a column to be spread across the “rows” of the new plot, and to the right of the tilde is the name of a column to be spread across the “columns” of the new plot.</p>
<p><strong>Most simply, just use one column name, to the right of the tilde</strong>: <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Free axes</strong><br>
You will need to decide whether the scales (<code>scales =</code>) of the axes for each facet are “fixed” to the same dimensions (default), or “free” (meaning they will change based on the data within the facet). You can also specify “free_x” or “free_y” to release in only one dimension.</p>
<p><strong>Number of cols and rows</strong><br>
This can be specified with <code>ncol =</code> and <code>nrow =</code> within <code>facet_wrap()</code>.</p>
<p><strong>Order of panels</strong><br>
To change the order of appearance, change the underlying order of the levels of the factor column used to create the facets.</p>
<p><strong>Aesthetics</strong><br>
Font size and face, strip color, etc. can be modified through <code>theme()</code> with arguments like:</p>
<ul>
<li>
<code>strip.text = element_text()</code> (size, colour, face, angle…)</li>
<li>
<code>strip.background = element_rect()</code> (e.g. element_rect(fill=“red”))</li>
</ul>
<p>The position of the strip can be modified as the <code>strip.position =</code> argument within <code>facet_wrap()</code> (e.g. “bottom”, “top”, “left”, “right”)</p>
<p><strong>Strip labels</strong><br>
Labels of the facet plots can be modified through the “labels” of the column as a factor, or by the use of a “labeller”.</p>
<p>Make a labeller like this, using the function <code>as_labeller()</code> from <strong>ggplot2</strong>:</p>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
     <span class="st">"0-4"</span>   <span class="op">=</span> <span class="st">"Ages 0-4"</span>,
     <span class="st">"5-9"</span>   <span class="op">=</span> <span class="st">"Ages 5-9"</span>,
     <span class="st">"10-14"</span> <span class="op">=</span> <span class="st">"Ages 10-14"</span>,
     <span class="st">"15-19"</span> <span class="op">=</span> <span class="st">"Ages 15-19"</span>,
     <span class="st">"20-29"</span> <span class="op">=</span> <span class="st">"Ages 20-29"</span>,
     <span class="st">"30-49"</span> <span class="op">=</span> <span class="st">"Ages 30-49"</span>,
     <span class="st">"50-69"</span> <span class="op">=</span> <span class="st">"Ages 50-69"</span>,
     <span class="st">"70+"</span>   <span class="op">=</span> <span class="st">"Over age 70"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>An example plot</strong><br>
Faceted by column <code>age_cat</code>. Click “Code” to see the code.</p>
<div class="sourceCode" id="cb714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make plot</span>
<span class="co">###########</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">geom_histogram</span><span class="op">(</span>
        <span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">age_cat</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,    <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
        breaks <span class="op">=</span> <span class="va">bin_breaks</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># see breaks defined above</span>
                      
    
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
               date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
        strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">age_cat</span>,
             ncol <span class="op">=</span> <span class="fl">4</span>,
             strip.position <span class="op">=</span> <span class="st">"top"</span>,
             labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-412-1.png" width="672"></div>
<p>See this <a href="https://ggplot2.tidyverse.org/reference/labellers.html">link</a> for more information on labellers.</p>
<p><strong>Add total epidemic to background</strong><br>
Add a separate <code>geom_histogram()</code> command <em>before</em> the current one. Specify that the data used is the data <em>without</em> the column used for faceting (see <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>). Then, specify a color like “grey” and a degree of transparency to make it appear in the background.</p>
<pre><code>geom_histogram(data = select(central_data, -age_cat), color = "grey", alpha = 0.5)+</code></pre>
<p>Note that the y-axis maximum is now based on the height of the entire epidemic. Click “Code” to see the code.</p>
<div class="sourceCode" id="cb717"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># for background shadow of whole outbreak</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">central_data</span>, <span class="op">-</span><span class="va">age_cat</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>

  <span class="co"># actual epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
        <span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">age_cat</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
        breaks <span class="op">=</span> <span class="va">bin_breaks</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># see breaks defined above</span>
                      
  <span class="co"># Labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
               date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
        strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">age_cat</span>,                          <span class="co"># each plot is one value of age_cat</span>
             ncol <span class="op">=</span> <span class="fl">4</span>,                          <span class="co"># number of columns</span>
             strip.position <span class="op">=</span> <span class="st">"top"</span>,            <span class="co"># position of the facet title/strip</span>
             labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             <span class="co"># labeller defines above</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 105 rows containing non-finite values (stat_bin).</code></pre>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-413-1.png" width="672"></div>
<p><strong>Create one facet with ALL data</strong><br>
To do this, you duplicate all the data (double the number of rows in the dataset) and in the faceted column have a new value (e.g. “all”) which indicates all the duplicated rows. A helped function is below that enables this:</p>
<div class="sourceCode" id="cb721"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define helper function</span>
<span class="va">CreateAllFacet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span><span class="op">)</span><span class="op">{</span>
     <span class="va">df</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span>
     <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">df</span>
     <span class="va">temp</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"all"</span>
     <span class="va">merged</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">df</span><span class="op">)</span>
     
     <span class="co"># ensure the facet value is a factor</span>
     <span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
     
     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Create dataset that is duplicated, to show "all zones" as another facet level</span>
<span class="va">central_data2</span> <span class="op">&lt;-</span> <span class="fu">CreateAllFacet</span><span class="op">(</span><span class="va">central_data</span>, col <span class="op">=</span> <span class="st">"age_cat"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>facet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">facet</span>,
                        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># check</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">central_data2</span><span class="op">$</span><span class="va">facet</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   all   0-4   5-9 10-14 15-19 20-29 30-49 50-69   70+  &lt;NA&gt; 
##   454    84    87    77    73    84    37     0     0    12</code></pre>
<p>Notable changes to the ggplot command are:</p>
<ul>
<li>The data used is now central_data2 (double the rows, with new column “facet”)</li>
<li>Labeller will need to be updated, if used<br>
</li>
<li>To achieve long/thin plot, facet variable moved to rows side of equation, replaced by “.” <code>facet_wrap(facet~.)</code>, and <code>ncol = 1</code>
</li>
</ul>
<p>You may also need to adjust the width and height of the save plot image (see <code>ggsave()</code>).</p>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data2</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># actual epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
        <span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">age_cat</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,                       <span class="co"># arguments outside aes() apply to all data</span>
        breaks <span class="op">=</span> <span class="va">bin_breaks</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># see breaks defined above</span>
                      
  <span class="co"># Labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
               date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>               
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">facet</span><span class="op">~</span><span class="va">.</span> ,                            <span class="co"># each plot is one value of facet</span>
             ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>            

  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 30 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-415-1.png" width="288"></div>
</div>
<div id="moving-averages-1" class="section level4" number="29.4.2.4">
<h4>
<span class="header-section-number">29.4.2.4</span> Moving averages<a class="anchor" aria-label="anchor" href="#moving-averages-1"><i class="fas fa-link"></i></a>
</h4>
<p>Add a moving averages to a <code>ggplot()</code> epicurve in one of two ways:</p>
<ol style="list-style-type: decimal">
<li>Plot the pre-calculated moving average:
<ul>
<li>Aggregate the data as necessary (daily, weekly, etc.)<br>
</li>
<li>Calculate the moving average<br>
</li>
<li>Add the moving average to the ggplot (e.g. with <code>geom_line()</code>)<br>
</li>
</ul>
</li>
<li>Calculate on-the-fly within the <code>ggplot()</code> command</li>
</ol>
<div id="using-slider" class="section level5" number="29.4.2.4.1">
<h5>
<span class="header-section-number">29.4.2.4.1</span> <strong>Using slider</strong><a class="anchor" aria-label="anchor" href="#using-slider"><i class="fas fa-link"></i></a>
</h5>
<p>In this approach, the moving average is calculated in the dataset prior to plotting:</p>
<ul>
<li>Within <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, a new column is created to hold the average. <code>slide_index()</code> from <strong>slider</strong> package is used as shown below.<br>
</li>
<li>In the <code>ggplot()</code>, a <code>geom_line()</code> is added after the histogram, reflecting the moving average.</li>
</ul>
<p>See the helpful online <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">vignette for the <strong>slider</strong> package</a></p>
<div class="sourceCode" id="cb725"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">slider</span><span class="op">)</span>  <span class="co"># slider used to calculate rolling averages</span>

<span class="co"># make dataset of daily counts and 7-day moving average</span>
<span class="co">#######################################################</span>
<span class="va">ll_counts_7day</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="co">## count cases by date</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span>,
        name <span class="op">=</span> <span class="st">"new_cases"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># name of new column</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># remove cases with missing date_onset</span>
  
  <span class="co">## calculate the average number of cases in the preceding 7 days</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    avg_7day <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/slider/man/slide_index.html">slide_index</a></span><span class="op">(</span>    <span class="co"># create new column</span>
      <span class="va">new_cases</span>,                       <span class="co"># calculate based on value in new_cases column</span>
      .i <span class="op">=</span> <span class="va">date_onset</span>,                 <span class="co"># index is date_onset col, so non-present dates are included in window </span>
      .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,    <span class="co"># function is mean() with missing values removed</span>
      .before <span class="op">=</span> <span class="fl">6</span>,                     <span class="co"># window is the day and 6-days before</span>
      .complete <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,              <span class="co"># must be FALSE for unlist() to work in next step</span>
    avg_7day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">avg_7day</span><span class="op">)</span><span class="op">)</span>


<span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ll_counts_7day</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">new_cases</span><span class="op">)</span>,
                   fill<span class="op">=</span><span class="st">"#92a8d1"</span>,
                   stat <span class="op">=</span> <span class="st">"identity"</span>,
                   position <span class="op">=</span> <span class="st">"stack"</span>,
                   colour <span class="op">=</span> <span class="st">"#92a8d1"</span><span class="op">)</span><span class="op">+</span> 
    <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">avg_7day</span>, lty <span class="op">=</span> <span class="st">"7-day \nrolling avg"</span><span class="op">)</span>,
              color<span class="op">=</span><span class="st">"red"</span>,
              size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,
                 date_labels <span class="op">=</span> <span class="st">'%d/%m'</span>,
                 expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span>,
         y <span class="op">=</span><span class="st">"Number of confirmed cases"</span>,
         fill <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span><span class="op">+</span> 
    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># removes title of legend</span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-416-1.png" width="672"></div>
</div>
<div id="using-tidyquant" class="section level5" number="29.4.2.4.2">
<h5>
<span class="header-section-number">29.4.2.4.2</span> <strong>Using tidyquant</strong><a class="anchor" aria-label="anchor" href="#using-tidyquant"><i class="fas fa-link"></i></a>
</h5>
<p>Using the <strong>tidyquant</strong> package to calculate the moving average on-the-fly (within <code>ggplot()</code>).</p>
<p>This option is more difficult to modify than pre-calculating the moving average. By default,<code><a href="https://rdrr.io/pkg/tidyquant/man/geom_ma.html">geom_ma()</a></code> uses the Simple Moving Average (SMA) (<code>TRR::SMA()</code>). See documentation by entering <code>?SMA</code> in your R console. Calculates the arithmatic mean over the past <code>n</code> observations. Also note how the moving average does not begin as early as the previous example.</p>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/tidyquant">tidyquant</a></span><span class="op">)</span>

<span class="co"># make daily count data</span>
<span class="co">#######################</span>
<span class="va">ll_counts_7day</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span>, name <span class="op">=</span> <span class="st">"daily_cases"</span><span class="op">)</span>


<span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ll_counts_7day</span>,   <span class="co"># use daily count data</span>
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,      <span class="co"># date x-axis</span>
           y <span class="op">=</span> <span class="va">daily_cases</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># counts</span>
  
  <span class="co"># histogram in the background</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,    <span class="co"># height = value in the cell, not number of rows</span>
                 color <span class="op">=</span> <span class="st">"#92a8d1"</span>,    <span class="co"># color of lines within histogram</span>
                 fill <span class="op">=</span> <span class="st">"#92a8d1"</span><span class="op">)</span><span class="op">+</span>    <span class="co"># color of histogram</span>
  
  <span class="co"># moving average line</span>
  <span class="fu">tidyquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/geom_ma.html">geom_ma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span>,            <span class="co"># window width</span>
                     size <span class="op">=</span> <span class="fl">2</span>,         <span class="co"># line size</span>
                     color <span class="op">=</span> <span class="st">"black"</span>,  <span class="co"># line color</span>
                     lty <span class="op">=</span> <span class="st">"solid"</span>     <span class="co"># line type ()</span>
                     <span class="op">)</span><span class="op">+</span>
     
  <span class="co"># labels for x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,      <span class="co"># labels every 2 months </span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># gridlines every month</span>
               date_labels <span class="op">=</span> <span class="st">'%b\n%Y'</span><span class="op">)</span><span class="op">+</span>       <span class="co">#labeled by month with year below</span>
     
  <span class="co"># Choose color palette (uses RColorBrewer package)</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Pastel2"</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date of onset"</span>, 
       y <span class="op">=</span> <span class="st">"Daily case incidence"</span>,
       title <span class="op">=</span> <span class="st">"Daily case incidence, with 7-day moving average"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (position_stack).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-417-1.png" width="672"></div>
</div>
</div>
<div id="tentative-data" class="section level4" number="29.4.2.5">
<h4>
<span class="header-section-number">29.4.2.5</span> Tentative data<a class="anchor" aria-label="anchor" href="#tentative-data"><i class="fas fa-link"></i></a>
</h4>
<p>The most recent data shown in epicurves should often be marked as tentative, or subject to reporting delays. This can be done in by adding a vertical line and/or rectangle over a specified number of days. Here are two options:</p>
<ol style="list-style-type: decimal">
<li>Use <code>annotate()</code>:<br>
</li>
</ol>
<ul>
<li>
<strong>Pros:</strong> Transparency of rectangle is easy. <strong>Cons:</strong> Items will not appear in legend.<br>
</li>
<li>For a line use <code>annotate(geom = "segment")</code>. Provide <code>x</code>, <code>xend</code>, <code>y</code>, and <code>yend</code>. Adjust size, linetype (<code>lty</code>), and color.<br>
</li>
<li>For a rectangle use <code>annotate(geom = "rect")</code>. Provide xmin/xmax/ymin/ymax. Adjust color and alpha.<br>
</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Use <code>geom_segment()</code> and <code>geom_rect()</code>:<br>
</li>
</ol>
<ul>
<li>
<strong>Pros:</strong> Items can easily appear in legend. <strong>Cons:</strong> Difficult to achieve semi-transparency of rectangle.<br>
</li>
<li>Provide the same x/y arguments as noted above for <code>annotate()</code>
</li>
</ul>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> While you can use <code>geom_rect()</code> to draw a rectangle, adjusting the transparency (alpha) does not work in a linelist context. This function overlays a rectangle for each observation/row!. Try a very low alpha (e.g. 0.01), or use <code>annotate(geom = "rect")</code> as shown. </span></p>
<div id="using-annotate" class="section level5" number="29.4.2.5.1">
<h5>
<span class="header-section-number">29.4.2.5.1</span> <strong>Using <code>annotate()</code></strong><a class="anchor" aria-label="anchor" href="#using-annotate"><i class="fas fa-link"></i></a>
</h5>
<ul>
<li>Within <code>annotate(geom = "rect")</code>, the <code>xmin</code> and <code>xmax</code> arguments must be given inputs of class Date.<br>
</li>
<li>Note that because these data are aggregated into weekly bars, and the last bar extends to the Monday after the last data point, the shaded region may appear to cover 4 weeks<br>
</li>
<li>
<code>annotate()</code> <a href="https://ggplot2.tidyverse.org/reference/annotate.html">online example</a>
</li>
</ul>
<div class="sourceCode" id="cb730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,           <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,     <span class="co"># 1st of month</span>
    date_labels <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>          <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Using annotate()\nRectangle and line showing that data from last 21-days are tentative"</span>,
    x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y <span class="op">=</span> <span class="st">"Weekly case indicence"</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add semi-transparent red rectangle to tentative data</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"rect"</span>,
           xmin  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># note must be wrapped in as.Date()</span>
           xmax  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>,                                          <span class="co"># note must be wrapped in as.Date()</span>
           ymin  <span class="op">=</span> <span class="fl">0</span>,
           ymax  <span class="op">=</span> <span class="cn">Inf</span>,
           alpha <span class="op">=</span> <span class="fl">0.2</span>,          <span class="co"># alpha easy and intuitive to adjust using annotate()</span>
           fill  <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add black vertical line on top of other layers</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"segment"</span>,
           x     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, <span class="co"># 21 days before last data</span>
           xend  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, 
           y     <span class="op">=</span> <span class="fl">0</span>,         <span class="co"># line begins at y = 0</span>
           yend  <span class="op">=</span> <span class="cn">Inf</span>,       <span class="co"># line to top of plot</span>
           size  <span class="op">=</span> <span class="fl">2</span>,         <span class="co"># line size</span>
           color <span class="op">=</span> <span class="st">"black"</span>,
           lty   <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># linetype e.g. "solid", "dashed"</span>

  <span class="co"># add text in rectangle</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>,
           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">15</span>,
           y <span class="op">=</span> <span class="fl">20</span>,
           label <span class="op">=</span> <span class="st">"Subject to reporting delays"</span>,
           angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-418-1.png" width="672"></div>
<p>The same black vertical line can be achieved with the code below, but using <code>geom_vline()</code> you lose the ability to control the height:</p>
<pre><code>geom_vline(xintercept = max(central_data$date_onset, na.rm = T) - 21,
           size = 2,
           color = "black")</code></pre>
</div>
<div id="using-geom_segment-and-geom_rect" class="section level5" number="29.4.2.5.2">
<h5>
<span class="header-section-number">29.4.2.5.2</span> <strong>Using <code>geom_segment()</code> and <code>geom_rect()</code></strong><a class="anchor" aria-label="anchor" href="#using-geom_segment-and-geom_rect"><i class="fas fa-link"></i></a>
</h5>
<div class="sourceCode" id="cb733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,           <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Using geom_segment() and geom_rect()\nRectangle and line showing that data from last 21-days are tentative"</span>,
    subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># make rectangle covering last 21 days</span>
  <span class="fu">geom_rect</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>
              xmin  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># note must be wrapped in as.Date()</span>
              xmax  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>,                                          <span class="co"># note must be wrapped in as.Date()</span>
              ymin  <span class="op">=</span> <span class="fl">0</span>,
              ymax  <span class="op">=</span> <span class="cn">Inf</span>,
              color <span class="op">=</span> <span class="st">"Reporting delays\npossible"</span><span class="op">)</span>,    <span class="co"># sets label for legend (note: is within aes())</span>
              alpha <span class="op">=</span> <span class="fl">.002</span>,                             <span class="co"># !!! Difficult to adjust transparency with this option</span>
           fill  <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># make vertical line</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,
                   xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,
                   y <span class="op">=</span> <span class="fl">0</span>,
                   yend <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>,
               color <span class="op">=</span> <span class="st">"black"</span>,
               lty <span class="op">=</span> <span class="st">"solid"</span>,
               size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># remove title of legend</span></code></pre></div>
<pre><code>## Warning: Use of `central_data$date_onset` is discouraged. Use `date_onset` instead.

## Warning: Use of `central_data$date_onset` is discouraged. Use `date_onset` instead.

## Warning: Use of `central_data$date_onset` is discouraged. Use `date_onset` instead.</code></pre>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_bin).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-419-1.png" width="672"></div>
</div>
</div>
<div id="dual-axis" class="section level4" number="29.4.2.6">
<h4>
<span class="header-section-number">29.4.2.6</span> Dual axis<a class="anchor" aria-label="anchor" href="#dual-axis"><i class="fas fa-link"></i></a>
</h4>
<p>Two axes - TBD</p>
</div>
<div id="multi-level-date-labels" class="section level4" number="29.4.2.7">
<h4>
<span class="header-section-number">29.4.2.7</span> Multi-level date labels<a class="anchor" aria-label="anchor" href="#multi-level-date-labels"><i class="fas fa-link"></i></a>
</h4>
<p>Here is an option if you want multi-level date labels, without duplicating the lower label levels (e.g. for year or month).</p>
<p>Remember, you can can use tools like <code>\n</code> <em>within</em> the <code>date_labels</code> or <code>labels</code> arguments to put parts of each label on a new line below. However, the code below helps you take years or months (for example) on a lower line <em>and only once</em>.</p>
<p>A few notes on the code below:</p>
<ul>
<li>Case counts are aggregated into weeks for aesthetic reasons. See Epicurves page (aggregated data tab) for details.<br>
</li>
<li>A line is used instead of a histogram, as the faceting approach below does not work well with histograms.</li>
</ul>
<p>Aggregate the weekly counts</p>
<div class="sourceCode" id="cb736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create dataset of case counts by week</span>
<span class="co">#######################################</span>
<span class="va">central_weekly</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span>           <span class="co"># filter linelist</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span>, .drop<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="op">%&gt;%</span>                             <span class="co"># summarize weekly case counts</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                             <span class="co"># remove cases with missing onset_date</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,           <span class="co"># fill-in all weeks with no cases reported</span>
                           to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,
                           by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Make plots</p>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,    <span class="co"># make line, specify x and y</span>
            stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># because line height is count number</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,             <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,          <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># remove excess space</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>, <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,                <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                   <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,         <span class="co"># facet labels placement</span>
        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># facet labels no fill grey border</span>
                                        colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,
        panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># no space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels, grey label border"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-421-1.png" width="672"></div>
<div class="sourceCode" id="cb738"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot no border</span>
<span class="co">################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># establish x and y for entire plot</span>
  <span class="fu">geom_line</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,              <span class="co"># make line, line height is count number</span>
            color <span class="op">=</span> <span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>            <span class="co"># line color</span>
  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># make points at the weekly data points</span>
  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#69b3a2"</span>,               <span class="co"># fill area below line</span>
            alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># fill transparency</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,            <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,         <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># remove excess space</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,   <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,               <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,                     <span class="co"># facet label placement</span>
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,            <span class="co"># no facet lable background</span>
          panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,          
          panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey40"</span><span class="op">)</span>,  <span class="co"># grey border to facet PANEL</span>
          panel.spacing<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># No space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels - points, shaded, no label border"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing missing values (position_stack).</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-421-2.png" width="672"></div>
<p>The above techniques were adapted from <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">this</a> and <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">this</a> post on stackoverflow.com.</p>
</div>
<div id="aggregating-linelist-data" class="section level4" number="29.4.2.8">
<h4>
<span class="header-section-number">29.4.2.8</span> Aggregating linelist data<a class="anchor" aria-label="anchor" href="#aggregating-linelist-data"><i class="fas fa-link"></i></a>
</h4>
<p>To learn generally how to group and aggregate data, see the handbook page on Grouping/Aggregating.</p>
<p>In this circumstance, we demonstrate aggregating into weeks, months, and days.</p>
<div id="weeks" class="section level5" number="29.4.2.8.1">
<h5>
<span class="header-section-number">29.4.2.8.1</span> <strong>Weeks</strong><a class="anchor" aria-label="anchor" href="#weeks"><i class="fas fa-link"></i></a>
</h5>
<p>Create a new column that is weeks, then use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> to get weekly case counts.</p>
<p>To aggregate into weeks and show ALL weeks (even ones with no cases), do this:</p>
<ol style="list-style-type: decimal">
<li>Create a new ‘week’ column within <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, using <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package:
<ul>
<li>use <code>unit =</code> to set the desired time unit, e.g. "week`<br>
</li>
<li>use <code>week_start =</code> to set the weekday start of the week (7 = Sunday, 1 = Monday)</li>
</ul>
</li>
<li>Follow with <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> to ensure that all weeks appear - even those with no cases.</li>
</ol>
<p>For example:</p>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>,
                                 unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># new column of week of onset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                                     <span class="co"># group data by week and count rows per group</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                            <span class="co"># remove entries for cases missing date_onset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,          <span class="co"># fill-in all weeks with no cases reported</span>
                           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,
                           by<span class="op">=</span><span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>                                           <span class="co"># deactivate grouping</span></code></pre></div>
<p>Here are the first 50 rows of the resulting dataframe:</p>
<div id="htmlwidget-aeef36410ff843c7814a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-aeef36410ff843c7814a">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1396742400000\" data-max=\"1426377600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"298\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15"],[1,2,4,4,11,14,14,23,21,17,29,25,31,34,55,57,76,82,115,125,162,191,217,298,276,278,264,251,236,239,219,175,140,171,153,127,123,122,94,101,106,101,86,81,67,80,80,76,68,61]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>week<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Alternatively, you can use the <a href="https://cran.r-project.org/web/packages/aweek/vignettes/introduction.html"><strong>aweek</strong></a> package’s <code>date2week()</code> function</strong>. As shown below, set <code>week_start =</code> to “Sunday”, or “Monday”, etc. Set <code>floor_date = TRUE</code> so the output is YYYY-Www. Set <code>factor = TRUE</code> so that all possible weeks are included, even if there are no cases (this replaces the <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> step in the <strong>lubridate</strong> approach above). You can also use <code>numeric = TRUE</code> if you want only the week number (note this will not distinguish between years).</p>
<div class="sourceCode" id="cb742"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">date2week</a></span><span class="op">(</span><span class="va">date_onset</span>,          <span class="co"># new column of week of onset</span>
                                 floor_day <span class="op">=</span> <span class="cn">T</span>,       <span class="co"># show as weeks without weekday</span>
                                 factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># include all possible weeks</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>                                           <span class="co"># deactivate grouping</span>

<span class="co"># Optional: add column of start DATE for each week - e.g. for ggplot() when date x-axis is expected</span>
<span class="co"># note: add this step AFTER the above code, to ensure all weeks are present</span>
<span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">weekly_counts</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week_as_date <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">week2date</a></span><span class="op">(</span><span class="va">week</span>, week_start <span class="op">=</span> <span class="st">"Monday"</span><span class="op">)</span><span class="op">)</span> <span class="co"># output is Monday date of each week</span></code></pre></div>
</div>
<div id="months" class="section level5" number="29.4.2.8.2">
<h5>
<span class="header-section-number">29.4.2.8.2</span> <strong>Months</strong><a class="anchor" aria-label="anchor" href="#months"><i class="fas fa-link"></i></a>
</h5>
<p>To aggregate cases into months, again use <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package, but with the argument <code>unit = "months"</code>. This rounds each date down to the 1st of its month. The output will be class Date.</p>
<p>Note that in the <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> step we also use “months”</p>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">monthly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># new column, 1st of month of onset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span>,     <span class="co"># fill-in all months with no cases reported</span>
                            <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span>,
                            by<span class="op">=</span><span class="st">"month"</span><span class="op">)</span><span class="op">)</span>    </code></pre></div>
<div id="htmlwidget-f0589744430d99f2f69e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f0589744430d99f2f69e">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1396310400000\" data-max=\"1427846400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8\" data-max=\"1111\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01"],[8,65,99,221,531,1082,1111,761,560,432,308,277,186]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>month<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="days" class="section level5" number="29.4.2.8.3">
<h5>
<span class="header-section-number">29.4.2.8.3</span> <strong>Days</strong><a class="anchor" aria-label="anchor" href="#days"><i class="fas fa-link"></i></a>
</h5>
<p>To aggregate a linelist into days, use the same approach but there is no need to create a new column. Use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> on the date column (e.g. <code>date_onset</code>).</p>
<p>If plotting a histogram, missing days in the data are not a problem as long as the column is class Date. However, it may be important for other types of plots or tables to have all possible days apear in the data. This is done with: <code><a href="https://tidyr.tidyverse.org/reference/complete.html">tidyr::complete()</a></code></p>
<div class="sourceCode" id="cb744"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">daily_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                           <span class="co"># count number of rows per unique date</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                  <span class="co"># remove aggregation of rows that were missing date_onset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span>date_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span>, <span class="co"># ensure all days appear</span>
                                 <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span>,
                                 by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
<!-- ======================================================= -->
</div>
</div>
</div>
</div>
<div id="aggregated-data" class="section level2 tabset tabset-fade" number="29.5">
<h2>
<span class="header-section-number">29.5</span> Aggregated data<a class="anchor" aria-label="anchor" href="#aggregated-data"><i class="fas fa-link"></i></a>
</h2>
<p>Often instead of a linelist, you begin with aggregated counts from facilities, districts, etc. You can make an epicurve from <code>ggplot()</code> but the code will be slightly different. The incidence package does not support aggregate data.</p>
<p>This section will utilize the <code>count_data</code> dataset that was imported earlier, in the data preparation section. It is the <code>linelist</code> aggregated to day-hospital counts. The first 50 rows are displayed below.</p>
<div id="htmlwidget-9fbcbf2c6a5a279e85c8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9fbcbf2c6a5a279e85c8">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1410307200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>As before, we must ensure date variables are correctly classified.</p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert Date variable to Date class</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">date_hospitalisation</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Date"</code></pre>
<p>We can plot a daily epicurve from these data. Here are the differences:</p>
<ul>
<li>Specify <code>y =</code> to the counts column within the primary aesthetics <code>aes()</code>
</li>
<li>Use of <code>stat = "identity"</code> within <code>geom_histogram()</code> indicates that the y-values could be counts from the <code>y =</code> column in <code>aes()</code>
</li>
</ul>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">date_hospitalisation</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">n_cases</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">geom_histogram</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>
     <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week of report"</span>, 
          y <span class="op">=</span> <span class="st">"Number of cases"</span>,
          Title <span class="op">=</span> <span class="st">"Daily case incidence, from daily count data"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-429-1.png" width="672"></div>
<p><strong>aggregate further</strong></p>
<p>To aggregated further, into weeks, we use the package <strong>lubridate</strong> and function <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code>, as described above. Note that we use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> in place of <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> becase we need to <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> case counts instead of just counting the number of rows per group.</p>
<div class="sourceCode" id="cb749"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create weekly dataset with epiweek column</span>
<span class="va">count_data_weekly</span> <span class="op">&lt;-</span> <span class="va">count_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_hospitalisation</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">epiweek</span>, .drop<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_cases_weekly <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n_cases</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>   </code></pre></div>
<pre><code>## `summarise()` has grouped output by 'hospital'. You can override using the `.groups` argument.</code></pre>
<p>The first 50 rows of <code>count_data</code> are displayed below.</p>
<div id="htmlwidget-a54aecabde655c60312c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a54aecabde655c60312c">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1397347200000\" data-max=\"1430006400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"26\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital"],["2014-05-04","2014-05-11","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-07-06","2014-07-13","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-13","2014-05-11"],[2,1,2,1,2,1,3,7,5,6,6,13,9,15,12,23,24,23,25,26,23,19,25,19,14,9,10,9,8,12,5,10,5,6,6,4,8,9,8,2,5,3,4,5,6,3,6,5,1,6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>epiweek<\/th>\n      <th>n_cases_weekly<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>For the plotting we also specify the factor level order of <code>hospital</code>.</p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count_data_weekly</span> <span class="op">&lt;-</span> <span class="va">count_data_weekly</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">hospital</span>,
                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Port Hospital"</span>, <span class="st">"Military Hospital"</span>, <span class="st">"Central Hospital"</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now plot by epiweek.</p>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data_weekly</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>,
           y <span class="op">=</span> <span class="va">n_cases_weekly</span>,
           group <span class="op">=</span> <span class="va">hospital</span>,
           fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">geom_histogram</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>
     
  <span class="co"># labels for x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,      <span class="co"># labels every 2 months </span>
               date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># gridlines every month</span>
               date_labels <span class="op">=</span> <span class="st">'%b\n%Y'</span><span class="op">)</span><span class="op">+</span>       <span class="co">#labeled by month with year below</span>
     
  <span class="co"># Choose color palette (uses RColorBrewer package)</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Pastel2"</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week of onset"</span>, 
       y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,
       fill <span class="op">=</span> <span class="st">"Hospital"</span>,
       title <span class="op">=</span> <span class="st">"Weekly case incidence, from aggregated count data by hospital"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-432-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="dual-axis-1" class="section level2 tabset tabset-fade" number="29.6">
<h2>
<span class="header-section-number">29.6</span> Dual-axis<a class="anchor" aria-label="anchor" href="#dual-axis-1"><i class="fas fa-link"></i></a>
</h2>
<p>Although there are fierce discussions about the validity of this within the data visualization community, many supervisors want to see an epicurve or similar chart with a percent overlaid with a second axis.</p>
<p>In ggplot it is difficult to do this, except for the case where you are showing a line reflecting the proportion of a category shown in the bars below.</p>
<p>See the handbook page on ggplot tips for details on how to make a second axis.</p>
<!-- ======================================================= -->
</div>
<div id="resources-18" class="section level2 tabset tabset-fade" number="29.7">
<h2>
<span class="header-section-number">29.7</span> Resources<a class="anchor" aria-label="anchor" href="#resources-18"><i class="fas fa-link"></i></a>
</h2>
<p>Links to other online tutorials or resources.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ggplot-tips.html"><span class="header-section-number">28</span> ggplot tips</a></div>
<div class="next"><a href="plotting-continuous-data.html"><span class="header-section-number">30</span> Plotting continuous data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#epidemic-curves"><span class="header-section-number">29</span> Epidemic curves</a></li>
<li><a class="nav-link" href="#overview-25"><span class="header-section-number">29.1</span> Overview</a></li>
<li>
<a class="nav-link" href="#preparation-20"><span class="header-section-number">29.2</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#packages-5"><span class="header-section-number">29.2.1</span> Packages</a></li>
<li><a class="nav-link" href="#load-data-4"><span class="header-section-number">29.2.2</span> Load data</a></li>
<li><a class="nav-link" href="#set-parameters"><span class="header-section-number">29.2.3</span> Set parameters</a></li>
<li><a class="nav-link" href="#verify-dates"><span class="header-section-number">29.2.4</span> Verify dates</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#incidence-package"><span class="header-section-number">29.3</span> incidence package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#intro"><span class="header-section-number">29.3.1</span> Intro</a></li>
<li><a class="nav-link" href="#modifications"><span class="header-section-number">29.3.2</span> Modifications</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ggplot"><span class="header-section-number">29.4</span> ggplot()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#intro-1"><span class="header-section-number">29.4.1</span> Intro</a></li>
<li><a class="nav-link" href="#modifications-1"><span class="header-section-number">29.4.2</span> Modifications</a></li>
</ul>
</li>
<li><a class="nav-link" href="#aggregated-data"><span class="header-section-number">29.5</span> Aggregated data</a></li>
<li><a class="nav-link" href="#dual-axis-1"><span class="header-section-number">29.6</span> Dual-axis</a></li>
<li><a class="nav-link" href="#resources-18"><span class="header-section-number">29.7</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-03.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
