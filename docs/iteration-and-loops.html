<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>15 Iteration and loops | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome - THIS IS A DRAFT</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">1</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">2</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">4</span> Import and export</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">5</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">6</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">7</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">8</span> Working with dates</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">9</span> Factors</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">11</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">12</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">13</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="active" href="iteration-and-loops.html"><span class="header-section-number">15</span> Iteration and loops</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">16</span> Descriptive analysis</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">17</span> Simple statistical tests</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">18</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">19</span> Moving averages</a></li>
<li><a class="" href="outbreak-detection.html"><span class="header-section-number">20</span> Outbreak detection</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">21</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">22</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">23</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">24</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">25</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">26</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">27</span> Epidemic curves</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">28</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">29</span> Plot categorical data</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">30</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">31</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">32</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">33</span> Combination analysis</a></li>
<li><a class="" href="heatmaps-density-plots.html"><span class="header-section-number">34</span> Heatmaps &amp; density plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">36</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">38</span> Errors &amp; warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">39</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">40</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">41</span> Routine reports</a></li>
<li><a class="" href="r-markdown-1.html"><span class="header-section-number">42</span> R Markdown</a></li>
<li><a class="" href="shiny-and-dashboards.html"><span class="header-section-number">43</span> Shiny and dashboards</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">44</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">46</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="iteration-and-loops" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Iteration and loops<a class="anchor" aria-label="anchor" href="#iteration-and-loops"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="preparation-7" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-7"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Load packages</strong></p>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
     <span class="va">rio</span>,
     <span class="va">here</span>, 
     <span class="va">purrr</span>,
     <span class="va">tidyverse</span>
<span class="op">)</span></code></pre></div>
<p><strong>Load data</strong></p>
<div class="sourceCode" id="cb666"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fake import the linelist</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p>The first 50 rows are displayed:</p>
<div id="htmlwidget-008b5323c22644152450" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-008b5323c22644152450">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1407283200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399507200000\" data-max=\"1407628800000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1.39968e+12\" data-max=\"1407715200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"40\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"40\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2688968279886\" data-max=\"-13.2097478342339\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.44852192548534\" data-max=\"8.48604294056283\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"85\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"22\" data-max=\"203\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"25\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"35.6\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"228.928199791883\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["d8a13d","8689b7","11f8ea","dae8c7","acf422","1a4ac9","275cc7","1389ca","057e7a","c97dd9","02d8fd","c36eb4","88eff2","542d07","f50e8a","7f5a01","b799eb","415e3a","bc2adf","188c88","959170","dd9d20","6d788e","67be4e","a9feb3","f81362","4c1040","2cb9a5","342b03","92ddf7","69446e","583717","0a9827","3789ee","d9f1b9","14224c","c5d4ec","53f4ae","c8c030","6b70f0","675f57","1a9636","059cc0","9cd6d0","4ade58","571076","7d99f2","6dca26","579c1d","267434"],[4,4,2,3,6,6,5,4,7,9,9,8,5,5,10,7,5,6,6,10,8,7,11,8,6,8,7,11,7,9,12,10,9,10,8,8,7,7,9,7,11,14,10,12,11,13,12,14,11,15],["2014-05-06",null,null,"2014-05-23","2014-05-25",null,"2014-05-24",null,"2014-06-04",null,"2014-06-14","2014-06-15",null,"2014-06-10",null,"2014-06-23","2014-06-27",null,"2014-07-03","2014-07-03","2014-06-29",null,"2014-07-12","2014-07-15","2014-06-29",null,"2014-07-17",null,null,"2014-07-19",null,null,null,"2014-07-26","2014-07-18","2014-07-17","2014-07-21","2014-07-30",null,null,"2014-07-30",null,null,"2014-08-01","2014-08-02","2014-08-06","2014-07-24",null,"2014-08-03","2014-08-01"],["2014-05-08","2014-05-13","2014-05-16",null,"2014-05-27","2014-05-27","2014-05-27","2014-06-05","2014-06-14",null,"2014-06-20","2014-06-20","2014-06-20",null,"2014-06-22","2014-06-25","2014-07-03","2014-07-06","2014-07-09","2014-07-09","2014-07-13",null,"2014-07-16","2014-07-17","2014-07-19","2014-07-20",null,"2014-07-22","2014-07-22","2014-07-23","2014-07-23","2014-07-27","2014-07-28","2014-08-01","2014-08-02","2014-08-02","2014-08-02",null,"2014-08-02","2014-08-03","2014-08-04","2014-08-05","2014-08-05","2014-08-06","2014-08-07","2014-08-07","2014-08-08","2014-08-09","2014-08-09","2014-08-10"],["2014-05-10","2014-05-14","2014-05-18","2014-05-27","2014-05-28","2014-05-29","2014-05-28","2014-06-07","2014-06-15","2014-06-19","2014-06-20","2014-06-21","2014-06-21","2014-06-23","2014-06-23","2014-06-27","2014-07-05","2014-07-08","2014-07-09","2014-07-11","2014-07-13","2014-07-17","2014-07-17","2014-07-19","2014-07-21","2014-07-21","2014-07-20","2014-07-22","2014-07-24","2014-07-25","2014-07-25","2014-07-28","2014-07-30","2014-08-02","2014-08-03","2014-08-02","2014-08-02","2014-08-04","2014-08-02","2014-08-04","2014-08-04","2014-08-06","2014-08-05","2014-08-07","2014-08-09","2014-08-08","2014-08-10","2014-08-10","2014-08-10","2014-08-11"],[null,"2014-05-18","2014-05-30","2014-05-30","2014-06-27","2014-06-07","2014-06-07","2014-06-09",null,"2014-07-11","2014-07-01","2014-06-24","2014-06-24","2014-06-28","2014-07-01","2014-07-06","2014-07-12","2014-07-26",null,"2014-07-16","2014-07-19","2014-07-21",null,"2014-08-14","2014-08-03","2014-08-07",null,"2014-08-28","2014-08-24",null,"2014-07-27","2014-08-06","2014-07-20","2014-09-13","2014-08-24","2014-08-19",null,null,"2014-08-11",null,"2014-08-18","2014-08-13","2014-08-24","2014-08-13","2014-09-08","2014-08-24","2014-08-27","2014-08-14","2014-08-16","2014-08-21"],[null,"Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover","Death","Death","Death","Death",null,"Death","Recover","Recover",null,null,"Death","Recover","Recover","Recover","Death","Death","Recover","Recover",null,"Recover","Death","Death",null,null,null,null,null,"Death",null,"Death","Recover","Death","Recover","Recover","Recover","Recover","Recover","Death","Death","Recover"],["f","f","m","f","m","m","f","f","f","m","m","m","f","m","f","f","m","f","m","f","f","m","m","f","f","m",null,"f","f","m","f","m","m","f","m","m","m","f","f","m","f","m","m","m","m","f","f","f","f","m"],[3,7,21,4,4,30,13,2,4,22,20,16,5,16,0,13,14,13,19,3,2,23,13,7,14,35,null,10,9,32,31,27,12,12,21,24,33,9,8,40,28,3,18,17,14,17,1,20,29,1],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[3,7,21,4,4,30,13,2,4,22,20,16,5,16,0,13,14,13,19,3,2,23,13,7,14,35,null,10,9,32,31,27,12,12,21,24,33,9,8,40,28,3,18,17,14,17,1,20,29,1],["0-4","5-9","20-29","0-4","0-4","30-49","10-14","0-4","0-4","20-29","20-29","15-19","5-9","15-19","0-4","10-14","10-14","10-14","15-19","0-4","0-4","20-29","10-14","5-9","10-14","30-49",null,"10-14","5-9","30-49","30-49","20-29","10-14","10-14","20-29","20-29","30-49","5-9","5-9","30-49","20-29","0-4","15-19","15-19","10-14","15-19","0-4","20-29","20-29","0-4"],["0-4","5-9","20-24","0-4","0-4","30-34","10-14","0-4","0-4","20-24","20-24","15-19","5-9","15-19","0-4","10-14","10-14","10-14","15-19","0-4","0-4","20-24","10-14","5-9","10-14","35-39",null,"10-14","5-9","30-34","30-34","25-29","10-14","10-14","20-24","20-24","30-34","5-9","5-9","40-44","25-29","0-4","15-19","15-19","10-14","15-19","0-4","20-24","25-29","0-4"],["St. Mark's Maternity Hospital (SMMH)","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Central Hospital","Port Hospital","Central Hospital","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Port Hospital","Missing","Missing","Other","Missing","Central Hospital","Central Hospital","Missing","Missing","Other","St. Mark's Maternity Hospital (SMMH)","Other","Other","Port Hospital","Other","Missing","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Missing","Port Hospital","Port Hospital","Missing","Port Hospital","Other","Military Hospital","Missing","Port Hospital","Other","Other"],[-13.2354719577436,-13.2152339775486,-13.212910703914,-13.2197320896877,-13.2688968279886,-13.2604684939726,-13.2369393782451,-13.2572163655863,-13.2180326141688,-13.2243437095992,-13.2124311244169,-13.2619688324425,-13.2195578885261,-13.2628934511971,-13.2336087079551,-13.2339681355349,-13.2162953240809,-13.2531041397858,-13.2266742923612,-13.2123762615712,-13.2452992638476,-13.2192936985287,-13.2199077448676,-13.2343062806506,-13.2155668757305,-13.2163318124535,-13.2359603887432,-13.2097478342339,-13.2209544818868,-13.2221173306518,-13.2306657089937,-13.2587625731645,-13.2243932729634,-13.2137356012883,-13.2207093341173,-13.2564700881739,-13.2258087869163,-13.2223378683793,-13.2106014146595,-13.2486407324245,-13.2188046852032,-13.2461808628649,-13.2123634125052,-13.2111276946553,-13.2591405401705,-13.2191390852229,-13.2301859855135,-13.2481679868778,-13.2163350530737,-13.217405738006],[8.4627682729487,8.45171855856465,8.46481700596819,8.44852192548534,8.47845973648553,8.45421479878989,8.46916113869591,8.47292327643506,8.47155535608018,8.47145134147474,8.45344099552146,8.48475855218221,8.46210832824745,8.46479592922727,8.47804840685363,8.46957530395867,8.46395131808455,8.46110718866038,8.48408263734462,8.4594706833607,8.48334624336805,8.4859413033916,8.4693933891765,8.47121232619015,8.4627846208641,8.4630635336683,8.47704542384682,8.47714159984428,8.48436046542975,8.46420961833913,8.47808779372907,8.45574180260702,8.48325844901445,8.4732571907655,8.47571579396786,8.48329801272452,8.47317350834362,8.46136226718465,8.47793008081529,8.48480340615605,8.47782489076703,8.48313501406402,8.48309382244331,8.46975025432843,8.45279482787079,8.44933234263738,8.47770243597866,8.46556229437808,8.48604294056283,8.47529881925793],["20b688",null,null,"be7f8a","1511c5",null,"e02f66",null,"cbbe78",null,"e61cb9","057e7a",null,"4977bd",null,"a75c7f","ea3740",null,"b799eb","9d07e6","beb26e",null,"36e2e7","7baf73","af1c1f",null,"916d0a",null,null,"d15be5",null,null,null,"3b096b","7baf73","d0eead","805a4f","4af3d1",null,null,"7ee655",null,null,"0e3c82","3789ee","9cd6d0","ce4ec6",null,"b56849","db7b54"],["other",null,null,"other","other",null,"other",null,"funeral",null,"other","other",null,"funeral",null,"other","other",null,"other","funeral","funeral",null,"other","other","other",null,"other",null,null,"other",null,null,null,"other","other","other","funeral","other",null,null,"other",null,null,"funeral","other","other","other",null,"other","other"],[33,41,61,42,51,74,55,19,39,69,61,59,37,67,0,49,79,48,70,28,22,67,70,24,53,85,25,51,48,74,71,69,66,49,65,73,67,53,42,74,74,41,64,64,67,58,21,55,63,20],[55,104,171,60,89,173,115,52,67,135,133,149,78,141,22,113,153,142,137,50,31,160,168,84,144,174,42,115,120,201,203,182,140,134,132,166,176,112,100,173,124,62,126,113,164,98,40,130,163,53],[22,22,23,24,24,22,22,23,23,22,22,21,23,23,25,23,21,22,21,20,21,21,21,24,22,21,23,22,23,23,22,21,23,23,22,22,24,22,21,22,22,21,21,23,22,21,22,23,23,22],["no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no","no",null,null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,null,"no","no","no","no",null,"no","no","no","no","no","no","no",null,"no","no"],["no","no","no",null,"no","no","yes","yes","no","no","no","yes","yes","no","no","no","no",null,null,"no","no",null,"yes","no","no","yes","no","no","no","no","no","no","no",null,null,"yes","yes","no","no",null,"yes","yes","no","no","no","yes","yes",null,"no","no"],["no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes",null,null,"yes","yes",null,"yes","no","yes","yes","yes","yes","yes","yes","yes","yes","no",null,null,"yes","yes","yes","yes",null,"yes","no","no","no","yes","yes","yes",null,"yes","yes"],["no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no","no",null,null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,null,"no","no","no","no",null,"no","no","no","no","no","no","no",null,"no","no"],["no","no","no",null,"yes","no","yes","no","no","yes","yes","no","no","no","yes","yes","no",null,null,"yes","yes",null,"yes","yes","yes","no","yes","no","no","no","yes","no","yes",null,null,"yes","yes","no","yes",null,"no","no","no","no","no","yes","no",null,"no","yes"],[37.2,37,37,37.4,36.9,37.3,37.5,37.3,36.8,36.5,36.9,37,37.3,35.6,37.3,37,37,37.1,36.8,36.8,37.5,36.6,36.6,37.1,37.2,37.1,37.1,36.9,37.4,37.7,36.8,36.7,36.3,37.2,37.4,38,36,37.3,37.8,36.3,36.7,37.3,37.5,36,37,37.3,37.4,36.4,37.1,36.5],["19:08","14:47","11:19","17:22","10:37",null,"09:40","10:28","18:15","10:20","21:28","12:31","11:17",null,null,"11:48","15:03","14:26","10:49","14:32","08:48","17:27","23:27","19:03","16:40",null,"18:58","12:28","14:19",null,"16:54","10:11","06:53","09:48","05:56","07:21","14:48","16:29",null,"15:42",null,"15:07","15:45",null,null,"21:54","09:13","05:17","14:30","09:32"],[109.090909090909,37.9068047337278,20.8611196607503,116.666666666667,64.3858098724908,24.7251829329413,41.5879017013233,70.2662721893491,86.879037647583,37.8600823045267,34.4847080106281,26.5753794874105,60.8152531229454,33.7005180825914,0,38.374187485316,33.7477038745782,23.8048006347947,37.2955405189408,112,228.928199791883,26.171875,24.8015873015873,34.0136054421769,25.5594135802469,28.075042938301,141.72335600907,38.5633270321361,33.3333333333333,18.3163783074676,17.2292460384867,20.8308175341142,33.6734693877551,27.288928491869,37.3048668503214,26.4915082014806,21.6296487603306,42.2512755102041,42,24.7251829329413,48.1269510926119,106.659729448491,40.3124212648022,50.121387735923,24.9107674003569,60.3915035401916,131.25,32.5443786982248,23.7118446309609,71.1997152011392],[2,1,2,null,1,2,1,2,1,null,0,1,1,null,1,2,2,2,0,2,0,null,1,2,2,1,null,0,2,2,2,1,2,1,1,0,0,null,0,1,0,1,0,1,2,1,2,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="for-loops" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> <em>for loops</em><a class="anchor" aria-label="anchor" href="#for-loops"><i class="fas fa-link"></i></a>
</h2>
<p>As an epidemiologist, it is a common need to repeat analyses on sub-groups (e.g. jurisdictions or sub-populations). Iterating with a <em>for loop</em> is one method to automate this process.</p>
<p>For example, let’s say we are making epidemic curves. We can make an epidemic curve (LINK) of all the cases:</p>
<div class="sourceCode" id="cb667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create 'incidence' object</span>
<span class="va">outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>   
     <span class="va">linelist</span>,                       <span class="co"># dataframe</span>
     date_index <span class="op">=</span> <span class="va">date_onset</span>,        <span class="co"># date column</span>
     interval <span class="op">=</span> <span class="st">"week"</span>,              <span class="co"># aggregate counts weekly</span>
     groups <span class="op">=</span> <span class="va">gender</span>,                <span class="co"># group values by gender</span>
     na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>             <span class="co"># missing gender is own group</span></code></pre></div>
<pre><code>## 241 missing observations were removed.</code></pre>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot epi curve</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak</span>,                       <span class="co"># name of incidence object</span>
     fill <span class="op">=</span> <span class="st">"gender"</span>,                <span class="co"># color bars by gender</span>
     color <span class="op">=</span> <span class="st">"black"</span>,                <span class="co"># outline color of bars</span>
     title <span class="op">=</span> <span class="st">"Outbreak of ALL cases"</span> <span class="co"># title</span>
     <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-472-1.png" width="672"></div>
<p>To produce a separate plot for each hospital’s cases, we can put this code within a <em>for loop</em>. The elementary syntax is: <code>for (item in vector) {do something}</code>.</p>
<ul>
<li>The “item” can be any word you wish. Keep it short. Often “i” is used.<br>
</li>
<li>The word “in” is special and must be present.<br>
</li>
<li>The vector can be character, as in this example, but is more often numeric (<code>c(1,2,3,4,5...)</code>) so that it can be used with index brackets <code>[[x]]</code> to extract and save. See subsequent example below.</li>
</ul>
<p>First, we save a named vector of the unique hospital names, <code>hospital_names</code>. The <em>for loop</em> will run once for each of these names (<code>for (hosp in hospital_names) {</code> and each time the current hospital name will be represented as “hosp” for use within the loop.</p>
<ul>
<li>In the loop, a <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> is applied to <code>linelist</code>, such that column <code>hospital</code> must equal the current value of <code>hosp</code><br>
</li>
<li>The incidence object is created on the filtered linelist<br>
</li>
<li>The plot for the current hospital is created, with an auto-adjusting title<br>
</li>
<li>The plot for the current hospital is temporarily saved and then printed<br>
</li>
<li>The loop then moves onward to repeat with the next hospital in <code>hospital_names</code>
</li>
</ul>
<div class="sourceCode" id="cb670"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make vector of the hospital names</span>
<span class="va">hospital_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="co"># for each name ("hosp") in hospital_names, create and print the epi curve</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">hosp</span> <span class="kw">in</span> <span class="va">hospital_names</span><span class="op">)</span> <span class="op">{</span>
     
     <span class="co"># create incidence object specific to the current hospital</span>
     <span class="va">outbreak_hosp</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>
                    <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">hosp</span><span class="op">)</span>,   <span class="co"># linelist is filtered to the current hospital</span>
                    date_index <span class="op">=</span> <span class="va">date_onset</span>,
                    interval <span class="op">=</span> <span class="st">"week"</span>, 
                    groups <span class="op">=</span> <span class="va">gender</span>,
                    na_as_group <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span>
     
     <span class="co"># Create and save the plot. Title automatically adjusts to the current hospital</span>
     <span class="va">plot_hosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak_hosp</span>,
                       fill <span class="op">=</span> <span class="st">"gender"</span>,
                       color <span class="op">=</span> <span class="st">"black"</span>,
                       title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Epidemic of cases admitted to {hosp}"</span><span class="op">)</span>
                       <span class="op">)</span>
     
     <span class="co"># print the plot for the current hospital</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot_hosp</span><span class="op">)</span>

<span class="op">}</span> <span class="co"># end the for loop when it has been run for every hospital in hospital_names </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-473-1.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-473-2.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-473-3.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-473-4.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-473-5.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-473-6.png" width="32%"></p>
<p>When “i” is a number:</p>
<p><strong>What is “i”?</strong></p>
<p>Often in loops it is useful to have the iterating “item” be a number - this allows indexing <code>[[x]]</code> to assign or extract. This is often written “i”.</p>
<p>Here is the above <em>for loop</em>, but written so that the vector is numeric <code><a href="https://rdrr.io/r/base/c.html">c(1,2,3,4,5,6)</a></code> and the hospital names are extracted from <code>hospital_names</code> with this indexing number (e.g. <code>hospital_names[[2]]</code>)</p>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hospital_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">hospital_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
     <span class="va">outbreak_i</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>
                    <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">hospital_names</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                    date_index <span class="op">=</span> <span class="va">date_onset</span>,
                    interval <span class="op">=</span> <span class="st">"week"</span>, 
                    groups <span class="op">=</span> <span class="va">gender</span>,
                    na_as_group <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span>
     <span class="va">plot_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak_i</span>,
                    fill <span class="op">=</span> <span class="st">"gender"</span>,
                    color <span class="op">=</span> <span class="st">"black"</span>,
                    title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Epidemic of cases admitted to {hospital_names[[i]]}"</span><span class="op">)</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot_i</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div id="tracking-progress-of-a-loop" class="section level3" number="15.2.1">
<h3>
<span class="header-section-number">15.2.1</span> Tracking progress of a loop<a class="anchor" aria-label="anchor" href="#tracking-progress-of-a-loop"><i class="fas fa-link"></i></a>
</h3>
<p>In a loop with many iterations it can run for minutes or even hours. Thus, it can be helpful to print the progress to the R console.<br>
Below, code is placed <em>within</em> the loop to print every 100th number.</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="iteration-and-loops.html#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loop with code to print progress every 100 iterations</span></span>
<span id="cb672-2"><a href="iteration-and-loops.html#cb672-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(linelist)){</span>
<span id="cb672-3"><a href="iteration-and-loops.html#cb672-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-4"><a href="iteration-and-loops.html#cb672-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print progress</span></span>
<span id="cb672-5"><a href="iteration-and-loops.html#cb672-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(row <span class="sc">%%</span> <span class="dv">100</span><span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb672-6"><a href="iteration-and-loops.html#cb672-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(row)</span>
<span id="cb672-7"><a href="iteration-and-loops.html#cb672-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-8"><a href="iteration-and-loops.html#cb672-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="purrr" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> <strong>purrr</strong><a class="anchor" aria-label="anchor" href="#purrr"><i class="fas fa-link"></i></a>
</h2>
<p>TO DO - Under construction</p>
<p>To iterate a function over columns in a dataframe:</p>
<div class="sourceCode" id="cb673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">wt_kg</span>, <span class="va">ht_cm</span>, <span class="va">ct_blood</span>, <span class="va">temp</span>, <span class="va">bmi</span>, <span class="va">days_onset_hosp</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <a href="https://r4ds.had.co.nz/iteration.html#iteration">R for Data Science page on iteration</a></p>
<p>A purrr <a href="https://jennybc.github.io/purrr-tutorial/index.html">tutorial</a></p>
<!-- ======================================================= -->
</div>
<div id="apply-functions" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> apply functions<a class="anchor" aria-label="anchor" href="#apply-functions"><i class="fas fa-link"></i></a>
</h2>
<!-- ======================================================= -->
</div>
<div id="resources-8" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> Resources<a class="anchor" aria-label="anchor" href="#resources-8"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="de-duplication.html"><span class="header-section-number">14</span> De-duplication</a></div>
<div class="next"><a href="descriptive-analysis.html"><span class="header-section-number">16</span> Descriptive analysis</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#iteration-and-loops"><span class="header-section-number">15</span> Iteration and loops</a></li>
<li><a class="nav-link" href="#preparation-7"><span class="header-section-number">15.1</span> Preparation</a></li>
<li>
<a class="nav-link" href="#for-loops"><span class="header-section-number">15.2</span> for loops</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#tracking-progress-of-a-loop"><span class="header-section-number">15.2.1</span> Tracking progress of a loop</a></li></ul>
</li>
<li><a class="nav-link" href="#purrr"><span class="header-section-number">15.3</span> purrr</a></li>
<li><a class="nav-link" href="#apply-functions"><span class="header-section-number">15.4</span> apply functions</a></li>
<li><a class="nav-link" href="#resources-8"><span class="header-section-number">15.5</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
