<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>14 Iteration and loops | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome - THIS IS A DRAFT</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">1</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">2</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="importing-and-exporting.html"><span class="header-section-number">4</span> Importing and exporting</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">5</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">6</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">7</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">8</span> Working with dates</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">9</span> Missing data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">10</span> Grouping data</a></li>
<li><a class="" href="joining-matching-datasets.html"><span class="header-section-number">11</span> Joining &amp; matching datasets</a></li>
<li><a class="" href="charactersstrings.html"><span class="header-section-number">12</span> Characters/strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">13</span> De-duplication</a></li>
<li><a class="active" href="iteration-and-loops.html"><span class="header-section-number">14</span> Iteration and loops</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">15</span> Descriptive analysis</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">16</span> Simple statistical tests</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">17</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">18</span> Moving averages</a></li>
<li><a class="" href="outbreak-detection.html"><span class="header-section-number">19</span> Outbreak detection</a></li>
<li><a class="" href="time-series-analysis.html"><span class="header-section-number">20</span> Time series analysis</a></li>
<li><a class="" href="epidemicmodels.html"><span class="header-section-number">21</span> Epidemic modeling</a></li>
<li><a class="" href="modeling.html"><span class="header-section-number">22</span> Modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">23</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis-1.html"><span class="header-section-number">24</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">25</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">26</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">27</span> Epidemic curves</a></li>
<li><a class="" href="plotting-continuous-data.html"><span class="header-section-number">28</span> Plotting continuous data</a></li>
<li><a class="" href="plotting-categorical-variables.html"><span class="header-section-number">29</span> Plotting categorical variables</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">30</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">31</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">32</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">33</span> Combination analysis</a></li>
<li><a class="" href="heatmaps-density-plots.html"><span class="header-section-number">34</span> Heatmaps &amp; density plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">36</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">38</span> Errors &amp; Warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">39</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">40</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">41</span> Routine reports</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">42</span> R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny basics</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">44</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">46</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="iteration-and-loops" class="section level1 tabset tabset-fade" number="14">
<h1>
<span class="header-section-number">14</span> Iteration and loops<a class="anchor" aria-label="anchor" href="#iteration-and-loops"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="preparation-5" class="section level2 tabset tabset-fade tabset-pills" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-5"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Load packages</strong></p>
<div class="sourceCode" id="cb590"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
     <span class="va">rio</span>,
     <span class="va">here</span>, 
     <span class="va">purrr</span>,
     <span class="va">tidyverse</span>
<span class="op">)</span></code></pre></div>
<p><strong>Load data</strong></p>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fake import the linelist</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p>The first 50 rows are displayed:</p>
<div id="htmlwidget-7267395ce08b5cb22ae4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7267395ce08b5cb22ae4">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399161600000\" data-max=\"1406937600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1398556800000\" data-max=\"1.407024e+12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1398556800000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399420800000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"66\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"66\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2700264337236\" data-max=\"-13.2083805379189\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45020022241045\" data-max=\"8.48932072596067\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"7\" data-max=\"98\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"13\" data-max=\"258\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"36\" data-max=\"37.9\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"14.7226729162911\" data-max=\"414.201183431953\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["6c286a","5fe599","6285c9","893f25","c4e706","275cc7","133ee7","dbebea","788a99","2978ac","57a565","a6c614","c15f36","c97dd9","02d8fd","bd14fc","af9f9a","589e9f","ae96ac","ec8ee4","b799eb","ceed40","9371a9","403057","7fd086","1c1848","959170","64c8ef","a47529","52ea64","92ab68","f81362","6670a5","4c1040","ae50c8","583717","770e5e","1e1825","b013ab","9fcf61","c5bc73","db7b54","38cc4a","cc7393","3789ee","8188cd","c8c030","a81f7d","6b70f0","316781"],[2,4,4,3,5,5,3,7,5,4,4,5,5,9,9,6,6,9,10,6,5,5,8,10,7,8,8,6,5,7,8,8,9,7,9,10,7,8,8,10,7,14,8,8,10,7,9,12,7,8],[null,"2014-05-08","2014-05-04","2014-05-18",null,"2014-05-24","2014-05-23",null,"2014-06-01","2014-05-30","2014-05-28","2014-06-05",null,null,"2014-06-14","2014-06-04",null,"2014-06-11","2014-06-20","2014-06-15","2014-06-27",null,null,null,null,"2014-07-09","2014-06-29",null,"2014-06-13","2014-07-15",null,null,"2014-07-18","2014-07-17","2014-07-20",null,null,null,"2014-07-24",null,"2014-07-27","2014-07-26","2014-07-19",null,"2014-07-26","2014-07-16",null,"2014-08-02",null,"2014-07-22"],["2014-04-27","2014-05-13","2014-05-14","2014-05-21","2014-05-23","2014-05-27","2014-05-27","2014-06-02","2014-06-06","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-19","2014-06-20","2014-06-20","2014-06-20","2014-06-24","2014-06-25","2014-06-30","2014-07-03","2014-07-07","2014-07-08","2014-07-09","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-20","2014-07-25","2014-07-27","2014-07-29","2014-07-29","2014-07-30","2014-07-30","2014-07-31","2014-07-31","2014-08-01","2014-08-01","2014-08-01","2014-08-02","2014-08-02","2014-08-03","2014-08-03","2014-08-03"],["2014-04-27","2014-05-15","2014-05-14","2014-05-22","2014-05-24","2014-05-28","2014-05-29","2014-06-03","2014-06-07","2014-06-08","2014-06-15","2014-06-18","2014-06-19","2014-06-19","2014-06-20","2014-06-22","2014-06-20","2014-06-26","2014-06-25","2014-07-02","2014-07-05","2014-07-09","2014-07-09","2014-07-11","2014-07-13","2014-07-14","2014-07-13","2014-07-15","2014-07-18","2014-07-20","2014-07-20","2014-07-21","2014-07-22","2014-07-20","2014-07-27","2014-07-28","2014-07-30","2014-07-31","2014-07-30","2014-07-31","2014-08-02","2014-08-01","2014-08-03","2014-08-03","2014-08-02","2014-08-03","2014-08-02","2014-08-04","2014-08-04","2014-08-04"],["2014-05-07",null,"2014-05-17","2014-05-29","2014-06-02","2014-06-07","2014-05-29","2014-06-05","2014-06-25","2014-06-15",null,"2014-06-26","2014-06-28","2014-07-11","2014-07-01","2014-06-27","2014-07-13","2014-06-30","2014-06-27",null,"2014-07-12","2014-07-31","2014-07-20","2014-07-22","2014-07-27","2014-07-14","2014-07-19","2014-07-25","2014-07-26","2014-07-26","2014-08-05","2014-08-07","2014-08-01",null,"2014-08-08","2014-08-06",null,"2014-08-01","2014-08-05","2014-08-05","2014-08-11",null,"2014-08-21","2014-08-09","2014-09-13","2014-08-29","2014-08-11","2014-09-05",null,"2014-08-07"],["Death",null,"Death","Recover",null,"Death","Death",null,"Recover","Death","Death","Recover","Recover","Recover","Death","Death",null,null,"Death","Death","Recover","Recover",null,"Death","Recover","Death","Death","Recover","Death","Death",null,"Death","Death","Recover","Death","Death","Recover","Death","Death","Recover","Death","Death","Recover","Death",null,"Recover",null,"Recover","Death","Death"],["f","m","f","m","m","f","f","m","m","m","m","f","f","m","m","f","f","m","m","m","m","m","f","f","m","f","f","m","m","f","f","m","f","f","f","m","f","f","m","f","f","f","m","f","f","f","f","m","m","m"],[14,12,4,66,18,7,10,7,2,7,11,19,15,19,3,14,32,6,6,11,30,7,1,4,19,0,4,8,41,9,3,19,16,16,5,43,16,16,33,33,26,17,6,2,35,5,22,25,46,24],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[14,12,4,66,18,7,10,7,2,7,11,19,15,19,3,14,32,6,6,11,30,7,1,4,19,0,4,8,41,9,3,19,16,16,5,43,16,16,33,33,26,17,6,2,35,5,22,25,46,24],["10-14","10-14","0-4","50-69","15-19","5-9","10-14","5-9","0-4","5-9","10-14","15-19","15-19","15-19","0-4","10-14","30-49","5-9","5-9","10-14","30-49","5-9","0-4","0-4","15-19","0-4","0-4","5-9","30-49","5-9","0-4","15-19","15-19","15-19","5-9","30-49","15-19","15-19","30-49","30-49","20-29","15-19","5-9","0-4","30-49","5-9","20-29","20-29","30-49","20-29"],["10-14","10-14","0-4","65-69","15-19","5-9","10-14","5-9","0-4","5-9","10-14","15-19","15-19","15-19","0-4","10-14","30-34","5-9","5-9","10-14","30-34","5-9","0-4","0-4","15-19","0-4","0-4","5-9","40-44","5-9","0-4","15-19","15-19","15-19","5-9","40-44","15-19","15-19","30-34","30-34","25-29","15-19","5-9","0-4","35-39","5-9","20-24","25-29","45-49","20-24"],["Missing","Other","Missing","Military Hospital","Missing","Central Hospital","Missing","Port Hospital","Port Hospital","Port Hospital","Military Hospital","Other","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Missing","Port Hospital","Missing","Missing","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Port Hospital","Port Hospital","Central Hospital","Central Hospital","Military Hospital","Missing","Military Hospital","Other","Military Hospital","Other","Port Hospital","Other","Port Hospital","Port Hospital","Missing","Port Hospital","Military Hospital","Military Hospital","Missing","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Missing","Port Hospital","Missing","Other"],[-13.2311229156957,-13.2157351064963,-13.2205862656383,-13.2228638912441,-13.2143394209926,-13.2369393782451,-13.2230208115547,-13.2164705932244,-13.2128924575825,-13.2206286746001,-13.253989309478,-13.2190654487695,-13.2189533374241,-13.2243437095992,-13.2124311244169,-13.2322364148998,-13.2371313571269,-13.2083835761865,-13.2131457458534,-13.2578516459532,-13.2162953240809,-13.2471655635541,-13.2680671272333,-13.2160179088168,-13.2353020203708,-13.2113470441303,-13.2452992638476,-13.2614705796373,-13.2227293309912,-13.2177946632397,-13.2333516655879,-13.2163318124535,-13.2217866965605,-13.2359603887432,-13.2472895700622,-13.2587625731645,-13.2351591427265,-13.2083805379189,-13.2700264337236,-13.2631399589905,-13.2224162932627,-13.2194851717021,-13.2573683214693,-13.2589430372533,-13.2137356012883,-13.2611950766249,-13.2106014146595,-13.2477515432081,-13.2486407324245,-13.2331787372694],[8.46477606739351,8.46897295100924,8.45056919644254,8.46082377490923,8.48932072596067,8.46916113869591,8.46142781816041,8.48666377289188,8.46852156267174,8.48401630165138,8.45837125340844,8.47737640975659,8.45136291368722,8.47145134147474,8.45344099552146,8.47727846519132,8.48777544809491,8.46320325007363,8.46397733703235,8.45196229052854,8.46395131808455,8.48811520075179,8.473437335922,8.46242233645879,8.46849944119707,8.47982352763317,8.48334624336805,8.45750552360835,8.48480589906514,8.45020022241045,8.46517148129756,8.4630635336683,8.4623972994508,8.47704542384682,8.48450777619227,8.45574180260702,8.46765214132969,8.45570803751877,8.47765318263688,8.4653055523942,8.46186770657403,8.45077238424485,8.4532568143863,8.45415199059547,8.4732571907655,8.46334217568605,8.47793008081529,8.48500469856184,8.48480340615605,8.46382313795279],[null,"f547d6","f9149b","11f8ea",null,"e02f66","76b97a",null,"374728","996f3a","133ee7","3ff1bc",null,null,"e61cb9","db11a9",null,"8b4c1c","02d8fd","be502d","ea3740",null,null,null,null,"3e6957","beb26e",null,"a2086d","64c8ef",null,null,"67be4e","916d0a","26c588",null,null,null,"eae3e8",null,"4af3d1","df7c34","53608c",null,"3b096b","916d0a",null,"a5bda8",null,"d05405"],[null,"other","other","other",null,"other","other",null,"other","other","other","funeral",null,null,"other","other",null,"other","other","other","other",null,null,null,null,"other","funeral",null,"other","other",null,null,"other","other","other",null,null,null,"other",null,"other","other","funeral",null,"other","other",null,"funeral",null,"other"],[71,60,29,98,66,43,50,40,35,42,46,62,50,64,43,57,81,35,44,60,74,52,20,48,57,7,40,57,93,32,31,59,59,52,33,71,51,55,67,72,67,64,30,20,63,45,60,62,74,63],[121,146,78,258,124,114,100,89,55,97,140,143,128,184,66,163,165,112,96,117,178,126,33,54,119,13,57,124,180,96,51,118,130,143,94,206,132,162,193,190,161,147,70,39,187,77,159,190,223,164],[22,22,23,22,22,23,22,21,21,24,23,21,22,22,23,23,22,23,23,21,22,22,21,23,22,23,22,21,24,22,24,22,22,22,22,23,22,21,22,24,22,21,21,21,24,20,20,21,24,23],["no","no","no","no","no","no","no","no",null,"no",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no",null,"no","no","no","no","no",null,"no","no","no","no","no","no","no",null,null,"no",null,"no",null,"no","no"],["no","yes","no","no","no","no","yes","no",null,"no",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"no",null,"yes","yes","no","no","no",null,"no","yes","no","no","no","yes","no",null,null,"no",null,"no",null,"no","no"],["yes","no","yes","yes","yes","yes","no","yes",null,"yes",null,"yes","yes",null,"no","no","yes","no","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes",null,"yes","yes","yes","yes","no",null,"no","yes","yes","yes","yes","yes","yes",null,null,"yes",null,"yes",null,"yes","yes"],["no","no","no","no","no","no","no","no",null,"yes",null,"no","no",null,"no","no","no","no","no","no","no","no","no","no","no","no",null,"yes",null,"no","no","no","no","no",null,"no","no","no","no","no","no","no",null,null,"no",null,"no",null,"no","no"],["no","yes","yes","yes","no","no","no","yes",null,"no",null,"no","no",null,"yes","no","no","yes","yes","yes","yes","yes","yes","yes","no","no",null,"no",null,"no","no","yes","no","no",null,"no","yes","no","yes","yes","yes","no",null,null,"yes",null,"no",null,"no","no"],[36.5,37.7,36.3,37.1,37.4,36.9,36.9,37.1,36.6,36,37.1,36.4,37,37.3,37.2,36.7,36.9,37.6,36.2,36.3,36.6,37.9,36.5,36.7,37.4,37.1,36.9,36.6,37.4,37.2,36.7,36.6,36.5,37,37.2,36.2,37.4,37.3,37.6,36.9,36.4,37.3,37.2,37.3,36.4,37.1,37.2,36.3,37,37.1],["12:38","05:39",null,"08:32","10:32","10:57","11:11","16:40","12:53","17:18","07:34",null,"10:30","08:45","12:12","11:23","11:31",null,"15:34",null,"18:07",null,"10:12","13:19","11:26",null,"16:60","09:35","14:47",null,"15:40","16:07","12:28","22:18","15:39","16:47","17:42","05:18","14:32","12:02","05:25","15:36","16:01","16:23","13:35","13:33","18:36","13:36","12:47","11:32"],[48.49395533092,28.1478701444924,47.6660092044707,14.7226729162911,42.9240374609781,33.0871037242228,50,50.4986744097967,115.702479338843,44.6381124455309,23.469387755102,30.3193310186317,30.517578125,18.9035916824197,98.7144168962351,21.4535737137265,29.7520661157025,27.9017857142857,47.7430555555556,43.8308130615823,23.355636914531,32.7538422776518,183.654729109275,164.609053497942,40.2513946755173,414.201183431953,123.114804555248,37.0707596253902,28.7037037037037,34.7222222222222,119.18492887351,42.3728813559322,34.9112426035503,25.4291163382073,37.3472159348121,16.7310773871241,29.2699724517906,20.9571711629325,17.9870600553035,19.9445983379501,25.8477682188187,29.6172890925078,61.2244897959184,131.492439184747,18.0159569904773,75.8981278461798,23.7332384003797,17.1745152354571,14.8806531400189,23.4235574063058],[0,2,0,1,1,1,2,1,1,2,2,2,2,0,0,2,0,2,0,2,2,2,1,2,2,2,0,1,1,2,1,1,2,0,2,1,1,2,0,1,2,1,2,2,1,1,0,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="for-loops" class="section level2 tabset tabset-fade tabset-pills" number="14.2">
<h2>
<span class="header-section-number">14.2</span> <em>for loops</em><a class="anchor" aria-label="anchor" href="#for-loops"><i class="fas fa-link"></i></a>
</h2>
<p>As an epidemiologist, it is a common need to repeat analyses on sub-groups (e.g. jurisdictions or sub-populations). Iterating with a <em>for loop</em> is one method to automate this process.</p>
<p>For example, let’s say we are making epidemic curves. We can make an epidemic curve (LINK) of all the cases:</p>
<div class="sourceCode" id="cb592"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create 'incidence' object</span>
<span class="va">outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>   
     <span class="va">linelist</span>,                       <span class="co"># dataframe</span>
     date_index <span class="op">=</span> <span class="va">date_onset</span>,        <span class="co"># date column</span>
     interval <span class="op">=</span> <span class="st">"week"</span>,              <span class="co"># aggregate counts weekly</span>
     groups <span class="op">=</span> <span class="va">gender</span>,                <span class="co"># group values by gender</span>
     na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>             <span class="co"># missing gender is own group</span>

<span class="co"># plot epi curve</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak</span>,                       <span class="co"># name of incidence object</span>
     fill <span class="op">=</span> <span class="st">"gender"</span>,                <span class="co"># color bars by gender</span>
     color <span class="op">=</span> <span class="st">"black"</span>,                <span class="co"># outline color of bars</span>
     title <span class="op">=</span> <span class="st">"Outbreak of ALL cases"</span> <span class="co"># title</span>
     <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-430-1.png" width="672"></div>
<p>To produce a separate plot for each hospital’s cases, we can put this code within a <em>for loop</em>. The elementary syntax is: <code>for (item in vector) {do something}</code>.</p>
<ul>
<li>The “item” can be any word you wish. Keep it short. Often “i” is used.<br>
</li>
<li>The word “in” is special and must be present.<br>
</li>
<li>The vector can be character, as in this example, but is more often numeric (<code>c(1,2,3,4,5...)</code>) so that it can be used with index brackets <code>[[x]]</code> to extract and save. See subsequent example below.</li>
</ul>
<p>First, we save a named vector of the unique hospital names, <code>hospital_names</code>. The <em>for loop</em> will run once for each of these names (<code>for (hosp in hospital_names) {</code> and each time the current hospital name will be represented as “hosp” for use within the loop.</p>
<ul>
<li>In the loop, a <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> is applied to <code>linelist</code>, such that column <code>hospital</code> must equal the current value of <code>hosp</code><br>
</li>
<li>The incidence object is created on the filtered linelist<br>
</li>
<li>The plot for the current hospital is created, with an auto-adjusting title<br>
</li>
<li>The plot for the current hospital is temporarily saved and then printed<br>
</li>
<li>The loop then moves onward to repeat with the next hospital in <code>hospital_names</code>
</li>
</ul>
<div class="sourceCode" id="cb593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make vector of the hospital names</span>
<span class="va">hospital_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="co"># for each name ("hosp") in hospital_names, create and print the epi curve</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">hosp</span> <span class="kw">in</span> <span class="va">hospital_names</span><span class="op">)</span> <span class="op">{</span>
     
     <span class="co"># create incidence object specific to the current hospital</span>
     <span class="va">outbreak_hosp</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>
                    <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">hosp</span><span class="op">)</span>,   <span class="co"># linelist is filtered to the current hospital</span>
                    date_index <span class="op">=</span> <span class="va">date_onset</span>,
                    interval <span class="op">=</span> <span class="st">"week"</span>, 
                    groups <span class="op">=</span> <span class="va">gender</span>,
                    na_as_group <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span>
     
     <span class="co"># Create and save the plot. Title automatically adjusts to the current hospital</span>
     <span class="va">plot_hosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak_hosp</span>,
                       fill <span class="op">=</span> <span class="st">"gender"</span>,
                       color <span class="op">=</span> <span class="st">"black"</span>,
                       title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Epidemic of cases admitted to {hosp}"</span><span class="op">)</span>
                       <span class="op">)</span>
     
     <span class="co"># print the plot for the current hospital</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot_hosp</span><span class="op">)</span>

<span class="op">}</span> <span class="co"># end the for loop when it has been run for every hospital in hospital_names </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-431-1.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-431-2.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-431-3.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-431-4.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-431-5.png" width="32%"><img src="_main_files/figure-html/unnamed-chunk-431-6.png" width="32%"></p>
<p>When “i” is a number:</p>
<p><strong>What is “i”?</strong></p>
<p>Often in loops it is useful to have the iterating “item” be a number - this allows indexing <code>[[x]]</code> to assign or extract. This is often written “i”.</p>
<p>Here is the above <em>for loop</em>, but written so that the vector is numeric <code><a href="https://rdrr.io/r/base/c.html">c(1,2,3,4,5,6)</a></code> and the hospital names are extracted from <code>hospital_names</code> with this indexing number (e.g. <code>hospital_names[[2]]</code>)</p>
<div class="sourceCode" id="cb594"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hospital_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">hospital_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
     <span class="va">outbreak_i</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>
                    <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">hospital_names</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                    date_index <span class="op">=</span> <span class="va">date_onset</span>,
                    interval <span class="op">=</span> <span class="st">"week"</span>, 
                    groups <span class="op">=</span> <span class="va">gender</span>,
                    na_as_group <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span>
     <span class="va">plot_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak_i</span>,
                    fill <span class="op">=</span> <span class="st">"gender"</span>,
                    color <span class="op">=</span> <span class="st">"black"</span>,
                    title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Epidemic of cases admitted to {hospital_names[[i]]}"</span><span class="op">)</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot_i</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div id="tracking-progress-of-a-loop" class="section level3" number="14.2.1">
<h3>
<span class="header-section-number">14.2.1</span> Tracking progress of a loop<a class="anchor" aria-label="anchor" href="#tracking-progress-of-a-loop"><i class="fas fa-link"></i></a>
</h3>
<p>In a loop with many iterations it can run for minutes or even hours. Thus, it can be helpful to print the progress to the R console.<br>
Below, code is placed <em>within</em> the loop to print every 100th number.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="iteration-and-loops.html#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loop with code to print progress every 100 iterations</span></span>
<span id="cb595-2"><a href="iteration-and-loops.html#cb595-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(linelist)){</span>
<span id="cb595-3"><a href="iteration-and-loops.html#cb595-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-4"><a href="iteration-and-loops.html#cb595-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print progress</span></span>
<span id="cb595-5"><a href="iteration-and-loops.html#cb595-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(row <span class="sc">%%</span> <span class="dv">100</span><span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb595-6"><a href="iteration-and-loops.html#cb595-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(row)</span>
<span id="cb595-7"><a href="iteration-and-loops.html#cb595-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-8"><a href="iteration-and-loops.html#cb595-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="purrr" class="section level2 tabset tabset-fade" number="14.3">
<h2>
<span class="header-section-number">14.3</span> <strong>purrr</strong><a class="anchor" aria-label="anchor" href="#purrr"><i class="fas fa-link"></i></a>
</h2>
<p>TO DO - Under construction</p>
<p>To iterate a function over columns in a dataframe:</p>
<div class="sourceCode" id="cb596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">wt_kg</span>, <span class="va">ht_cm</span>, <span class="va">ct_blood</span>, <span class="va">temp</span>, <span class="va">bmi</span>, <span class="va">days_onset_hosp</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <a href="https://r4ds.had.co.nz/iteration.html#iteration">R for Data Science page on iteration</a></p>
<p>A purrr <a href="https://jennybc.github.io/purrr-tutorial/index.html">tutorial</a></p>
<!-- ======================================================= -->
</div>
<div id="apply-functions" class="section level2 tabset tabset-fade" number="14.4">
<h2>
<span class="header-section-number">14.4</span> apply functions<a class="anchor" aria-label="anchor" href="#apply-functions"><i class="fas fa-link"></i></a>
</h2>
<!-- ======================================================= -->
</div>
<div id="resources-6" class="section level2 tabset tabset-fade" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Resources<a class="anchor" aria-label="anchor" href="#resources-6"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="de-duplication.html"><span class="header-section-number">13</span> De-duplication</a></div>
<div class="next"><a href="descriptive-analysis.html"><span class="header-section-number">15</span> Descriptive analysis</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#iteration-and-loops"><span class="header-section-number">14</span> Iteration and loops</a></li>
<li><a class="nav-link" href="#preparation-5"><span class="header-section-number">14.1</span> Preparation</a></li>
<li>
<a class="nav-link" href="#for-loops"><span class="header-section-number">14.2</span> for loops</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#tracking-progress-of-a-loop"><span class="header-section-number">14.2.1</span> Tracking progress of a loop</a></li></ul>
</li>
<li><a class="nav-link" href="#purrr"><span class="header-section-number">14.3</span> purrr</a></li>
<li><a class="nav-link" href="#apply-functions"><span class="header-section-number">14.4</span> apply functions</a></li>
<li><a class="nav-link" href="#resources-6"><span class="header-section-number">14.5</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
