<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>9 Factors | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome - THIS IS A DRAFT</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">1</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">2</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">4</span> Import and export</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">5</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">6</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">7</span> Cleaning data</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">8</span> Working with dates</a></li>
<li><a class="active" href="factors.html"><span class="header-section-number">9</span> Factors</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">11</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">12</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">13</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="" href="iteration-and-loops.html"><span class="header-section-number">15</span> Iteration and loops</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">16</span> Descriptive analysis</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">17</span> Simple statistical tests</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">18</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">19</span> Moving averages</a></li>
<li><a class="" href="outbreak-detection.html"><span class="header-section-number">20</span> Outbreak detection</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">21</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">22</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">23</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">24</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">25</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">26</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">27</span> Epidemic curves</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">28</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">29</span> Plot categorical data</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">30</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">31</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">32</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">33</span> Combination analysis</a></li>
<li><a class="" href="heatmaps-density-plots.html"><span class="header-section-number">34</span> Heatmaps &amp; density plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">36</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">38</span> Errors &amp; warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">39</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">40</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">41</span> Routine reports</a></li>
<li><a class="" href="r-markdown-1.html"><span class="header-section-number">42</span> R Markdown</a></li>
<li><a class="" href="shiny-and-dashboards.html"><span class="header-section-number">43</span> Shiny and dashboards</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">44</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">46</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="factors" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Factors<a class="anchor" aria-label="anchor" href="#factors"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="overview-4" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-4"><i class="fas fa-link"></i></a>
</h2>
<p>Under construction - TBD</p>
<p>In R, <em>factors</em> allow for ordered categorical data. A column can be converted from class numeric, categorical, or even logical to class <em>factor</em>. In this case, the values are stored as <em>ordered integer <strong>levels</strong></em>, and can display with assigned <em>labels</em>.</p>
<p>In a column of class <em>factor</em>:</p>
<ul>
<li>the possible values are restricted - values not already defined as levels are rejected<br>
</li>
<li>values are ordered, which impacts how they display in tables and plots</li>
</ul>
<p>Most of this page will use functions from the package <strong>forcats</strong> (a short name for “For categorical variables”).</p>
<p><em>Factors are useful in statistical modeling, which allows integer values such as 1/0 to be evaluated categorically and not continuously.</em></p>
<!-- ======================================================= -->
</div>
<div id="preparation" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Load packages</strong></p>
<p>Below are the packages used in this page</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,           <span class="co"># import/export</span>
  <span class="va">here</span>,          <span class="co"># filepaths</span>
  <span class="va">lubridate</span>,     <span class="co"># working with dates</span>
  <span class="va">forcats</span>,       <span class="co"># factors</span>
  <span class="va">tidyverse</span>      <span class="co"># data mgmt and viz</span>
  <span class="op">)</span></code></pre></div>
<p><strong>Load data</strong></p>
<p>In this page we demonstrate using the <code>linelist</code> loaded below with <code>import()</code> (see page on <a href="import-and-export.html#import-and-export">Import and Export</a>).</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the linelist into R</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"linelist_cleaned.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fake import the linelist</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="preparation-1" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-1"><i class="fas fa-link"></i></a>
</h2>
<p>We begin in a common epidemiological scenario - the creation of a categorical column. In this case, we use the existing column <code>time_admission</code> (in format “HH:MM”) to classify hospital admissions into either morning, afternoon, evening, or night.</p>
<ol style="list-style-type: decimal">
<li>The <code>time_admission</code> is converted to a time class with <code><a href="https://rdrr.io/r/base/strptime.html">strptime()</a></code> from <strong>base</strong> R, and then the <code>hour</code> is extracted with the <strong>lubridate</strong> function <code><a href="http://lubridate.tidyverse.org/reference/hour.html">hour()</a></code><br>
</li>
<li>The <strong>dplyr</strong> function <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> is used to apply logical criteria on each row, resulting in values for the new column <code>time_period</code>
</li>
</ol>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">2</span>                        <span class="op">~</span> <span class="st">"&lt;2 days"</span>,
    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"2-5 days"</span>,
    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">5</span>                       <span class="op">~</span> <span class="st">"&gt;5 days"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">days_onset_hosp</span><span class="op">)</span>                     <span class="op">~</span> <span class="cn">NA_character_</span>,
    <span class="cn">TRUE</span>                                       <span class="op">~</span> <span class="st">"Check me"</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
<p>This is a column of character categorical values, but is <strong>not</strong> yet classified as a factor. Thus, in a frequency table, we see that the values appear in a default alphabetical order - an order that does not make much intuitive sense:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  &lt;2 days  &gt;5 days 2-5 days     &lt;NA&gt; 
##     3008      602     2037      241</code></pre>
<p>Likewise, if we make a bar plot the values also appear in this order from the bottom:<br>
This probably does not make sense to show.</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-225-1.png" width="672"></div>
</div>
<div id="convert-to-factor" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Convert to factor<a class="anchor" aria-label="anchor" href="#convert-to-factor"><i class="fas fa-link"></i></a>
</h2>
<p>To initially convert a column to class <em>factor</em>, use the <strong>base</strong> R function <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>. Below the dataframe <code>linelist</code> is modified such that the column <code>time_period</code> is converted to a factor.</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Unless specified, the levels will still be in alphabetic (or numeric) order. Use the <strong>base</strong> R function <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code> to see how the levels of <code>time_period</code> are ordered. Note that <code>NA</code> is not a factor level.</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "&gt;5 days"  "2-5 days"</code></pre>
</div>
<div id="adjust-level-order" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> Adjust level order<a class="anchor" aria-label="anchor" href="#adjust-level-order"><i class="fas fa-link"></i></a>
</h2>
<p>Using the package <strong>forcats</strong>, there are several functions to adjust the order of a factor’s levels:</p>
<ul>
<li>Use <code>fct_relevel()</code> to <em>manually</em> adjust the order<br>
</li>
<li>Use <code>fct_infreq()</code> to reorder by frequency (highest to lowest)<br>
</li>
<li>Use <code>fct_inorder()</code> to reorder by order of appearance in the data<br>
</li>
<li>Use <code>fct_reorder()</code> to reorder by another column (e.g. order time_period levels by their row’s median delay to admission)<br>
</li>
<li>Use <code>fct_rev()</code> to reverse the existing order<br>
</li>
<li>Use <code>fct_reorder2()</code> to reorder by the final values when plotted with two other columns</li>
</ul>
<p>These functions can be applied outside of a plot to re-define the column, or within a plot to affect just one specific plot.</p>
<div id="examples-1" class="section level3 unnumbered">
<h3>Examples<a class="anchor" aria-label="anchor" href="#examples-1"><i class="fas fa-link"></i></a>
</h3>
<p><strong><code>fct_relevel()</code></strong></p>
<p>This function is used to manually assign factor levels. If desired, you can write all the levels in the desired order. However, it is not necessary to specify the order of <em>all</em> levels - you can adjust the order only certain levels using the <code>after =</code> argument.</p>
<p>Here are examples of redefining the column, with mew order of levels:</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># re-define level order</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>


<span class="co"># using base R </span>
<span class="va">linelist</span><span class="op">$</span><span class="va">delay</span> <span class="op">&lt;-</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Alternatively, you can adjust the levels of a factor from <em>within</em> a plot, and the re-ordering of the levels will only apply within the plot. Below, you can see how the specified order begins from the bottom to the top. The missing value <code>NA</code> are at the end.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-229-1.png" width="672"></div>
<p>Note how the default x-axis label is now quite complicated - you can overwrite this with the <code>labs()</code> in ggplot.</p>
<p><strong><code>fct_infreq()</code></strong></p>
<p>To order by frequency that the value appears in the data, use <code>fct_infreq()</code>. Any missing values (<code>NA</code>) will automatically be included at the end.</p>
<p>You can reverse the order by wrapping with <code>fct_rev()</code>, like this: <code>fct_rev(fct_infreq(time_period))</code>.</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ordered by frequency</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span><span class="op">)</span>

<span class="co"># reversed frequency</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-230-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-230-2.png" width="50%"></p>
<p><strong><code>fct_reorder()</code></strong></p>
<p>Use this function to order the levels by another column. For example, to order boxplots showing delay <em>by the median CT value of each delay group</em>.</p>
<p>In the examples below, the x-axis if delay group, and the y = axis is CT value. The boxplots are also colored by delay group.</p>
<p>In the first example, the baseline order of the levels applies (as set earlier in this page) - they increase incrementally updward by delay.<br>
In the second example, the x-axis column has been wrapped in <code>fct_reorder()</code>, with the column <code>ct_blood</code> as the second argument. The default is order <code>delay</code> by the <em>median</em> <code>ct_value</code>. An alternative function can be supplied, e.g. “mean”, or “max”.</p>
<p>Note there are no explicit grouping steps required prior to the <code>ggplot()</code> - the grouping and calculations are all done internally.</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># boxplots ordered by original factor levels</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span>,
        y <span class="op">=</span> <span class="va">ct_blood</span>, 
        fill <span class="op">=</span> <span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Ordered by increasing delay (original factor levels)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-231-1.png" width="672"></div>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># boxplots ordered by median CT value</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">delay</span>, <span class="va">ct_blood</span>, <span class="st">"median"</span><span class="op">)</span>,
        y <span class="op">=</span> <span class="va">ct_blood</span>,
        fill <span class="op">=</span> <span class="va">delay</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Ordered by median CT value in group"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-231-2.png" width="672"></div>
<p><strong><code>fct_reorder2()</code></strong></p>
<p>Use this function to order the <em>legend colors</em> by the vertical order of groups at the “end” of the plot. For example, if you have lines showing case counts by hospital over time, you can apply <code>fct_reorder2()</code> to the <code>color =</code> argument within <code>aes()</code>, such that the vertical order of hospitals appearing in the legend aligns with the order of lines at the terminal end of the plot. Read more in the <a href="https://forcats.tidyverse.org/reference/fct_reorder.html">function documentation</a>.</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>         <span class="co"># begin with the linelist            </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span>             <span class="co"># summarise so n = counts of rows by epiweek and by hospital</span>
    epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span>,  <span class="co"># create and group by epiweeks</span>
    <span class="va">hospital</span>         <span class="co"># also group by hospital</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>           <span class="co"># start plot</span>
  <span class="fu">geom_line</span><span class="op">(</span>          <span class="co"># make lines</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>,  <span class="co"># x-axis epiweek</span>
        y <span class="op">=</span> <span class="va">n</span>,        <span class="co"># height in number of rows</span>
        color <span class="op">=</span> <span class="fu">fct_reorder2</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">epiweek</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># grouped by hospital and colors ordered by n value at end of plot</span>
  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>  <span class="co"># change legend title</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-232-1.png" width="672"></div>
<p><strong><code>fct_lump()</code></strong></p>
<p>To “lump” together many low-frequency levels into an “Other” group, you can use this function. Do one of the following:</p>
<ul>
<li>Set <code>n =</code> argument as the number of groups you want to keep. All other values will combine into “Other”.<br>
</li>
<li>set <code>prop =</code> argument as the proportion above which you want to keep. All other values will combine into “Other”.</li>
</ul>
<p>You can also change the label for “Other” by using <code>other_level =</code>. Below, all but the two most-frequent hospitals are combined into “Other hospitals”.</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_lump</span><span class="op">(</span><span class="va">hospital</span>,    <span class="co"># column for x-axis</span>
                            n <span class="op">=</span> <span class="fl">2</span>,       <span class="co"># keep two most-frequent levels</span>
                            other_level <span class="op">=</span> <span class="st">"Other hospitals"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># label for "Other" group</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-233-1.png" width="672"></div>
<p>You can also use <code>fct_other()</code> to manually assign factor levels to an “Other” group. Below, all <code>hospital</code> values aside from “Port Hospital” and “Central Hospital” are combined into “Other”.</p>
<p>You can use the arguments <code>keep =</code>, or <code>drop =</code>, and can change the label of “Other” with <code>other_label =</code>.</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_other</span><span class="op">(</span><span class="va">hospital</span>, keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Port Hospital"</span>, <span class="st">"Central Hospital"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
## Central Hospital    Port Hospital            Other 
##              454             1762             3672</code></pre>
<p><strong>Missing values</strong></p>
<p>If you have <code>NA</code> values in your column, you can easily convert them to a named value such as “Missing” with <code>fct_explicit_na()</code>, as performed below temporarily on the column <code>delay</code>:</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span><span class="va">delay</span>, na_level <span class="op">=</span> <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## .
##  &lt;2 days 2-5 days  &gt;5 days  Missing     &lt;NA&gt; 
##     3008     2037      602      241        0</code></pre>
</div>
</div>
<div id="edit-labels" class="section level2" number="9.6">
<h2>
<span class="header-section-number">9.6</span> Edit labels<a class="anchor" aria-label="anchor" href="#edit-labels"><i class="fas fa-link"></i></a>
</h2>
<p>Adjust the factor labels with <code>fct_recode()</code>. remember that these do not change the underlying values, only their labels.<br>
Below, the labels of the factor column <code>delay</code> (grouped days from onset to admission) are edited:</p>
<p>The old labels:</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  &lt;2 days 2-5 days  &gt;5 days     &lt;NA&gt; 
##     3008     2037      602      241</code></pre>
<p>Now the labels are changed, using syntax <code>fct_recode(column, "new" = "old","new" = "old", "new" = "old")</code>. Remember that <code>NA</code> is not a formal level unless changed (e.g. with <code>fct_explicit_na()</code> as shown above).</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span><span class="va">delay</span>,
                            <span class="st">"Less than 2 days"</span> <span class="op">=</span> <span class="st">"&lt;2 days"</span>,
                            <span class="st">"2 to 5 days"</span>      <span class="op">=</span> <span class="st">"2-5 days"</span>,
                            <span class="st">"More than 5 days"</span> <span class="op">=</span> <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Less than 2 days      2 to 5 days More than 5 days 
##             3008             2037              602</code></pre>
</div>
<div id="adddrop-levels" class="section level2" number="9.7">
<h2>
<span class="header-section-number">9.7</span> Add/drop levels<a class="anchor" aria-label="anchor" href="#adddrop-levels"><i class="fas fa-link"></i></a>
</h2>
<p>If you have a factor and want to add levels (regardless of whether there are any rows with those values), use <code>fct_expand()</code>.</p>
<p>See how if we classify “hospital” as a factor, and then try to change the values, an error is returned:</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Central Hospital"                     "Military Hospital"                    "Missing"                              "Other"                               
## [5] "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"</code></pre>
<p>Now we can add the level “University Hospital”:</p>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_expand</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"University Hospital"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Central Hospital"                     "Military Hospital"                    "Missing"                              "Other"                               
## [5] "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)" "University Hospital"</code></pre>
<div id="epiweeks" class="section level3 unnumbered">
<h3>Epiweeks<a class="anchor" aria-label="anchor" href="#epiweeks"><i class="fas fa-link"></i></a>
</h3>
<p>TBD - under construction</p>
<p>Epiweeks produced by <strong>aweek</strong> will appear as an ordered factor</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epiweek <span class="op">=</span> <span class="fu">aweek</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/aweek/reference/date2week.html">date2week</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="op">)</span><span class="op">)</span>


<span class="va">a</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epiweek <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/week.html">isoweek</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">epiweek</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-2" class="section level2" number="9.8">
<h2>
<span class="header-section-number">9.8</span> Resources<a class="anchor" aria-label="anchor" href="#resources-2"><i class="fas fa-link"></i></a>
</h2>
<p>R for Data Science page on <a href="https://r4ds.had.co.nz/factors.html">factors</a>.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="working-with-dates.html"><span class="header-section-number">8</span> Working with dates</a></div>
<div class="next"><a href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#factors"><span class="header-section-number">9</span> Factors</a></li>
<li><a class="nav-link" href="#overview-4"><span class="header-section-number">9.1</span> Overview</a></li>
<li><a class="nav-link" href="#preparation"><span class="header-section-number">9.2</span> Preparation</a></li>
<li><a class="nav-link" href="#preparation-1"><span class="header-section-number">9.3</span> Preparation</a></li>
<li><a class="nav-link" href="#convert-to-factor"><span class="header-section-number">9.4</span> Convert to factor</a></li>
<li>
<a class="nav-link" href="#adjust-level-order"><span class="header-section-number">9.5</span> Adjust level order</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#examples-1">Examples</a></li></ul>
</li>
<li><a class="nav-link" href="#edit-labels"><span class="header-section-number">9.6</span> Edit labels</a></li>
<li>
<a class="nav-link" href="#adddrop-levels"><span class="header-section-number">9.7</span> Add/drop levels</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#epiweeks">Epiweeks</a></li></ul>
</li>
<li><a class="nav-link" href="#resources-2"><span class="header-section-number">9.8</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
