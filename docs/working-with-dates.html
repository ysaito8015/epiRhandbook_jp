<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>9 Working with Dates | R Handbook for Epidemiologists</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Handbook for Epidemiologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">About this book</li>
<li><a class="" href="style-and-editorial-notes.html"><span class="header-section-number">2</span> Style and editorial notes</a></li>
<li><a class="" href="datasets-used.html"><span class="header-section-number">3</span> Datasets used</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">4</span> R Basics</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">5</span> Importing data</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="suggested-packages.html"><span class="header-section-number">7</span> Suggested packages</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data.html"><span class="header-section-number">8</span> Cleaning data</a></li>
<li><a class="active" href="working-with-dates.html"><span class="header-section-number">9</span> Working with Dates</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="" href="groupingaggregating-data.html"><span class="header-section-number">11</span> Grouping/aggregating data</a></li>
<li><a class="" href="joining-matching-datasets.html"><span class="header-section-number">12</span> Joining &amp; matching datasets</a></li>
<li><a class="" href="charactersstrings.html"><span class="header-section-number">13</span> Characters/strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="" href="ifelse-for-loops.html"><span class="header-section-number">15</span> if/else &amp; ‘for’ loops</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Iteration</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-analysis.html"><span class="header-section-number">17</span> Descriptive analysis</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Simple statistical tests</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">19</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">20</span> Moving averages</a></li>
<li><a class="" href="outbreak-detection.html"><span class="header-section-number">21</span> Outbreak detection</a></li>
<li><a class="" href="time-series-analysis.html"><span class="header-section-number">22</span> Time series analysis</a></li>
<li><a class="" href="epidemicmodels.html"><span class="header-section-number">23</span> Epidemic modeling</a></li>
<li><a class="" href="modeling.html"><span class="header-section-number">24</span> Modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis-1.html"><span class="header-section-number">26</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></li>
<li class="book-part">Data Vizualization</li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">28</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">29</span> Epidemic curves</a></li>
<li><a class="" href="plotting-continuous-data.html"><span class="header-section-number">30</span> Plotting continuous data</a></li>
<li><a class="" href="plotting-discrete-variables.html"><span class="header-section-number">31</span> Plotting discrete variables</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">32</span> Tables</a></li>
<li><a class="" href="age-pyramids.html"><span class="header-section-number">33</span> Age pyramids</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">34</span> Diagrams</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">35</span> Combination analysis</a></li>
<li><a class="" href="heatmaps-density-plots.html"><span class="header-section-number">36</span> Heatmaps &amp; density plots</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Transmission Chains</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Interactive plots</a></li>
<li class="book-part">Advanced</li>
<li><a class="" href="errors-warnings-1.html"><span class="header-section-number">40</span> Errors &amp; Warnings</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">41</span> Advanced RStudio</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">42</span> Relational databases</a></li>
<li><a class="" href="routine-reports.html"><span class="header-section-number">43</span> Routine reports</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">44</span> R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">45</span> Shiny basics</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Collaboration</a></li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">47</span> Writing functions</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">48</span> R on network drives</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">49</span> Directory interactions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="working-with-dates" class="section level1 tabset tabset-fade" number="9">
<h1>
<span class="header-section-number">9</span> Working with Dates<a class="anchor" aria-label="anchor" href="#working-with-dates"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="overview-3" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-3"><i class="fas fa-link"></i></a>
</h2>
<p>Working with dates in <code>R</code> is notoriously difficult when compared to other object classes. <code>R</code> often interprets dates as character objects - this means they cannot be used for general date operations such as making time series and calculating time intervals. To make matters more difficult, there are many date formats, some of which can be confused for other formats. Luckily, dates can be wrangled easily with practice, and with a set of helpful packages.</p>
<p>Dates in <code>R</code> are their own class of object - the <code>Date</code> class. It should be noted that there is also a class that stores objects with date <em>and</em> time. Date time objects are formally referred to as and/or <code>POSIXt</code>, <code>POSIXct</code>, and/or <code>POSIXlt</code> classes (the difference isn’t important). These objects are informally referred to as <em>datetime</em> classes.</p>
<p>You can get the system date or system datetime by doing the following:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the system date - this is a DATE class</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2021-02-03"</code></pre>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the system time - this is a DATETIME class</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2021-02-03 11:48:09 EST"</code></pre>
<ul>
<li>It is important to make R recognize when a variable contains dates.<br>
</li>
<li>Dates are an object class and can be tricky to work with.<br>
</li>
<li>Here we present several ways to convert date variables to Date class.</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="packages-2" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Packages<a class="anchor" aria-label="anchor" href="#packages-2"><i class="fas fa-link"></i></a>
</h2>
<p>The following packages are recommended for working with dates:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Checks if package is installed, installs if necessary, and loads package for current session</span>

<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">aweek</span>,      <span class="co"># flexibly converts dates to weeks, and vis-versa</span>
               <span class="va">lubridate</span>,  <span class="co"># for conversions to months, years, etc.</span>
               <span class="va">linelist</span>,   <span class="co"># function to guess messy dates</span>
               <span class="va">ISOweek</span>,    <span class="co"># another option for creating weeks</span>
               <span class="va">tidyverse</span>,
               <span class="op">)</span>    </code></pre></div>
<pre><code>## 
## Your package installed</code></pre>
<pre><code>## Warning in pacman::p_load(aweek, lubridate, linelist, ISOweek, tidyverse, : Failed to install/load:</code></pre>
<!-- ======================================================= -->
</div>
<div id="converting-objects-to-date-class" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Converting objects to Date class<a class="anchor" aria-label="anchor" href="#converting-objects-to-date-class"><i class="fas fa-link"></i></a>
</h2>
<p>The standard, <strong>base</strong> R function to convert an object or variable to class Date is <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> (note capitalization).</p>
<p><code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> requires that the user <em>specify the </em><strong>existing</strong>* format of the date*, so it can understand, convert, and store each element (day, month, year, etc.) correctly. <a href="https://www.stat.berkeley.edu/~s133/dates.html">Read more online about <code>as.Date()</code></a>.</p>
<p><strong>If used on a variable, <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> therefore requires that all the character date values be in the same format before converting.</strong> If your data are messy, try cleaning them or consider using <code>guess_dates()</code> from the <strong>linelist</strong> package.</p>
<p>It can be easiest to first convert the variable to character class, and then convert to date class:</p>
<ol style="list-style-type: decimal">
<li>Turn the variable into character values using the function <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_cleaned</span><span class="op">$</span><span class="va">date_of_onset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">linelist_cleaned</span><span class="op">$</span><span class="va">date_of_onset</span><span class="op">)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Convert the variable from character values into date values, using the function <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code><br>
(note the capital “D”)<br>
</li>
</ol>
<ul>
<li>
<p>Within the <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> function, you must use the <code>format=</code> argument to tell R the <em>current</em> format of the date components - which characters refer to the month, the day, and the year, and how they are separated. If your values are already in one of R’s standard date formats (YYYY-MM-DD or YYYY/MM/DD) the <code>format=</code> argument is not necessary.</p>
<ul>
<li>The codes are:<br>
%d = Day # (of the month e.g. 16, 17, 18…)<br>
%a = abbreviated weekday (Mon, Tues, Wed, etc.)<br>
%A = full weekday (Monday, Tuesday, etc.)<br>
%m = # of month (e.g. 01, 02, 03, 04)<br>
%b = abbreviated month (Jan, Feb, etc.)<br>
%B = Full Month (January, February, etc.)<br>
%y = 2-digit year (e.g. 89)<br>
%Y = 4-digit year (e.g. 1989)</li>
</ul>
</li>
</ul>
<p>For example, if your character dates are in the format DD/MM/YYYY, like “24/04/1968”, then your command to turn the values into dates will be as below. <strong>Putting the format in quotation marks is necessary.</strong></p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_cleaned</span><span class="op">$</span><span class="va">date_of_onset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">linelist_cleaned</span><span class="op">$</span><span class="va">date_of_onset</span>, format <span class="op">=</span> <span class="st">"%d/%m/%Y"</span><span class="op">)</span></code></pre></div>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> The <code>format =</code> argument is <em>not</em> telling R the format you want the dates to be, but rather how to identify the date parts as they are <em>before</em> you run the command.</span></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong>Be sure that in the <code>format =</code> argument you use the <em>date-part separator</em> (e.g. /, -, or space) that is present in your dates.</span></p>
<p>Conveting character objects to dates can be made <em>far</em> easier by using the lubridate package. The <code>lubridate</code> package is a <code>tidyverse</code> package designed to make working with dates and time more simple and consistent than in base R. For these reasons, <code>lubridate</code> is often considered the gold-standard package for dates and time, and is recommended whenever working with them.</p>
<p>The <code>lubridate</code> package provides a number of different helper functions designed to convert character objects to dates in an intuitive, and more lenient way than specifying the format in <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code>. These functions are specific to the rough date format, but allow for a variety of separators, and synonyms for dates (e.g. 01 vs Jan vs January) - they are named after abbreviations of date formats.</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load packages </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="co"># read date in year-month-day format</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020-10-11"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-10-11"</code></pre>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"20201011"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-10-11"</code></pre>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read date in month-day-year format</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"10/11/2020"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-10-11"</code></pre>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"Oct 11 20"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-10-11"</code></pre>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read date in day-month-year format</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="st">"11 10 2020"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-10-11"</code></pre>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="st">"11 October 2020"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-10-11"</code></pre>
<!-- The `as.character()` and `as.Date()` commands can optionally be combined as:   -->
<!-- ```{r eval=F} -->
<!-- linelist_cleaned$date_of_onset <- as.Date(as.character(linelist_cleaned$date_of_onset), format = "%d/%m/%Y") -->
<!-- ``` -->
<p>If using <a href="r-basics.html#piping">piping</a> and the tidyverse, the converting a character column to dates might look like this:</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_cleaned</span> <span class="op">&lt;-</span> <span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>date_of_onset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Once complete, you can run a command to verify the class of the variable</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check the class of the variable</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist_cleaned</span><span class="op">$</span><span class="va">date_of_onset</span><span class="op">)</span>  </code></pre></div>
<p>Once the values are in class Date, R will by default display them in the standard format, which is YYYY-MM-DD.</p>
<!-- ======================================================= -->
</div>
<div id="converting-to-datetime-classes" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Converting to <code>datetime</code> classes<a class="anchor" aria-label="anchor" href="#converting-to-datetime-classes"><i class="fas fa-link"></i></a>
</h2>
<p>As previously mentioned, R also supports a <code>datetime</code> class - a variable that contains date <strong>and</strong> time information. As with the <code>Date</code> class, these often need to be converted from <code>character</code> objects to <code>datetime</code> objects.</p>
<p>A standard <code>datetime</code> object is formatted with the date first, which is followed by a time component - for example <em>01 Jan 2020, 16:30</em>. As with dates, there are many ways this can be formatted, and there are numerous levels of precision (hours, minutes, seconds) that can be supplied. Luckily, lubridate helper functions also exist to help convert these strings to <code>datetime</code> objects. These functions are the same as the date helper functions, with <code>_h</code> (only hours supplied), <code>_hm</code> (hours and minutes supplied), or <code>_hms</code> (hours, minutes, and seconds supplied) appended to the end (e.g. <code><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">dmy_hms()</a></code>). These can be used as shown:</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert datetime with only hours to datetime object</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_h</a></span><span class="op">(</span><span class="st">"2020-01-01 16hrs"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-01-01 16:00:00 UTC"</code></pre>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_h</a></span><span class="op">(</span><span class="st">"2020-01-01 4PM"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-01-01 16:00:00 UTC"</code></pre>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert datetime with hours and minutes to datetime object</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">dmy_hm</a></span><span class="op">(</span><span class="st">"Jan 1st 2020 16:20"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert datetime with hours, minutes, and seconds to datetime object</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hms</a></span><span class="op">(</span><span class="st">"01 January 20, 16:20:40"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># you can supply time zone but it is ignored</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hms</a></span><span class="op">(</span><span class="st">"01 January 20, 16:20:40 PST"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<pre><code>## [1] NA</code></pre>
<p>When working with a linelist, time and date columns can be combined to create a datetime column using these functions:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="working-with-dates.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># time_admission is a variable in hours:minutes</span></span>
<span id="cb244-2"><a href="working-with-dates.html#cb244-2" aria-hidden="true" tabindex="-1"></a>linelist_cleaned <span class="ot">&lt;-</span> linelist_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="working-with-dates.html#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assume that when time of admission is not given, it the median admission time</span></span>
<span id="cb244-4"><a href="working-with-dates.html#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-5"><a href="working-with-dates.html#cb244-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_admission_clean =</span> <span class="fu">ifelse</span>(</span>
<span id="cb244-6"><a href="working-with-dates.html#cb244-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(time_admission),</span>
<span id="cb244-7"><a href="working-with-dates.html#cb244-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">median</span>(time_admission),</span>
<span id="cb244-8"><a href="working-with-dates.html#cb244-8" aria-hidden="true" tabindex="-1"></a>      time_admission</span>
<span id="cb244-9"><a href="working-with-dates.html#cb244-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb244-10"><a href="working-with-dates.html#cb244-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use paste0 to combine two columns to create a character vector, and use ymd_hm() to convert to datetime</span></span>
<span id="cb244-11"><a href="working-with-dates.html#cb244-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-12"><a href="working-with-dates.html#cb244-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time_of_admission =</span> <span class="fu">paste0</span>(</span>
<span id="cb244-13"><a href="working-with-dates.html#cb244-13" aria-hidden="true" tabindex="-1"></a>      date_hospitalisation, time_admission_clean, <span class="at">sep =</span> <span class="st">" "</span></span>
<span id="cb244-14"><a href="working-with-dates.html#cb244-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">ymd_hm</span>()</span>
<span id="cb244-15"><a href="working-with-dates.html#cb244-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="lubridate" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> lubridate<a class="anchor" aria-label="anchor" href="#lubridate"><i class="fas fa-link"></i></a>
</h2>
<p><code>lubridate</code> can also be used for a variety of other functions, such as <strong>extracting aspects of a date/datetime</strong>, <strong>performing date arithmetic</strong>, or <strong>calculating date intervals</strong></p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># extract the month from this date</span>
  
  <span class="va">example_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>
  
  <span class="co"># extract the month and year from this date</span>
  <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">example_date</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">example_date</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2020</code></pre>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># get the epiweek of this date (this will be expanded later)</span>
  <span class="fu"><a href="http://lubridate.tidyverse.org/reference/week.html">epiweek</a></span><span class="op">(</span><span class="va">example_date</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># get the day of the week for this date (this will be expanded later)</span>
  <span class="fu"><a href="http://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">example_date</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># add 3 days to this date</span>
  <span class="va">example_date</span> <span class="op">+</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-03-04"</code></pre>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># add 7 weeks and subtract two days from this date</span>
  <span class="va">example_date</span> <span class="op">+</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/period.html">weeks</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-04-17"</code></pre>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># find the interval between this date and Feb 20 2020 </span>
  
  <span class="va">example_date</span> <span class="op">-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020-02-20"</span><span class="op">)</span></code></pre></div>
<pre><code>## Time difference of 10 days</code></pre>
<p>This can all be brought together to work with data - for example:</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="va">linelist_cleaned</span> <span class="op">&lt;-</span> <span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span>
    <span class="co"># convert date of onset from character to date objects by specifying dmy format</span>
    <span class="fu">mutate</span><span class="op">(</span>date_of_onset <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span>,
           date_of_hospitalisation <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="va">date_of_hospitalisation</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co"># filter out all cases without onset in march</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co"># find the difference in days between onset and hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>onset_to_hosp_days <span class="op">=</span> <span class="va">date_of_hospitalisation</span> <span class="op">-</span> <span class="va">date_of_onset</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="guess_dates" class="section level2" number="9.6">
<h2>
<span class="header-section-number">9.6</span> <code>guess_dates()</code><a class="anchor" aria-label="anchor" href="#guess_dates"><i class="fas fa-link"></i></a>
</h2>
<p><strong>The function <code>guess_dates()</code> attempts to read a “messy” date variable containing dates in many different formats and convert the dates to a standard format.</strong> You can <a href="https://www.repidemicsconsortium.org/linelist/reference/guess_dates.html">read more online about <code>guess_dates()</code></a>, which is in the <strong>linelist</strong> package.</p>
<blockquote>
<p><strong>For example:</strong> <code>guess_dates</code> would see the following dates “03 Jan 2018”, “07/03/1982”, and “08/20/85” and convert them in the class Date to: 2018-01-03, 1982-03-07, and 1985-08-20.</p>
</blockquote>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">linelist</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/linelist/man/guess_dates.html">guess_dates</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"03 Jan 2018"</span>, <span class="st">"07/03/1982"</span>, <span class="st">"08/20/85"</span><span class="op">)</span><span class="op">)</span> <span class="co"># guess_dates() not yet available on CRAN for R 4.0.2</span>
                                                                  <span class="co"># try install via devtools::install_github("reconhub/linelist")</span></code></pre></div>
<p><em>Some optional arguments for <code>guess_dates()</code> that you might include are:</em></p>
<ul>
<li>
<code>error_tolerance</code> - The proportion of entries which cannot be identified as dates to be tolerated (defaults to 0.1 or 10%)</li>
<li>
<code>last_date</code> - the last valid date (defaults to current date)<br>
</li>
<li>
<code>first_date</code> - the first valid date. Defaults to fifty years before the last_date.</li>
</ul>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="working-with-dates.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># An example using guess_dates on the variable dtdeath</span></span>
<span id="cb261-2"><a href="working-with-dates.html#cb261-2" aria-hidden="true" tabindex="-1"></a>data_cleaned <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb261-3"><a href="working-with-dates.html#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb261-4"><a href="working-with-dates.html#cb261-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtdeath =</span> linelist<span class="sc">::</span><span class="fu">guess_dates</span>(</span>
<span id="cb261-5"><a href="working-with-dates.html#cb261-5" aria-hidden="true" tabindex="-1"></a>      dtdeath, <span class="at">error_tolerance =</span> <span class="fl">0.1</span>, <span class="at">first_date =</span> <span class="st">"2016-01-01"</span></span>
<span id="cb261-6"><a href="working-with-dates.html#cb261-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="excel-dates" class="section level2" number="9.7">
<h2>
<span class="header-section-number">9.7</span> Excel Dates<a class="anchor" aria-label="anchor" href="#excel-dates"><i class="fas fa-link"></i></a>
</h2>
<p>Excel stores dates as the number of days since December 30, 1899. If the dataset you imported from Excel shows dates as numbers or characters like “41369”… use the <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> or <code><a href="http://lubridate.tidyverse.org/reference/as_date.html">as_date()</a></code> function to convert, but <strong>instead of supplying a format as above, supply an origin date</strong>. This will not work if the excel date is read as a character type, so be sure to ensure the date is a numeric class (or convert it to one)!</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> You should provide the origin date in R’s default date format (<code>"YYYY-MM-DD"</code>).</span></p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co"># An example of providing the Excel 'origin date' when converting Excel number dates</span>
<span class="va">data_cleaned</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_of_onset <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span>, origin <span class="op">=</span> <span class="st">"1899-12-30"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="how-dates-are-displayed" class="section level2" number="9.8">
<h2>
<span class="header-section-number">9.8</span> How dates are displayed<a class="anchor" aria-label="anchor" href="#how-dates-are-displayed"><i class="fas fa-link"></i></a>
</h2>
<p>Once dates are the correct class, you often want them to display differently (e.g. in a plot, graph, or table). For example, to display as “Monday 05 Jan” instead of 2018-01-05. You can do this with the function <code><a href="https://rdrr.io/r/base/format.html">format()</a></code>, which works in a similar way as <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code>. Read more <a href="https://www.statmethods.net/input/dates.html">in this online tutorial</a>. Remember that the output from <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> is a character type, so is generally used for display purposes only!</p>
<p>%d = Day # (of the month e.g. 16, 17, 18…)
%a = abbreviated weekday (Mon, Tues, Wed, etc.)<br>
%A = full weekday (Monday, Tuesday, etc.)<br>
%m = # of month (e.g. 01, 02, 03, 04)<br>
%b = abbreviated month (Jan, Feb, etc.)<br>
%B = Full Month (January, February, etc.)<br>
%y = 2-digit year (e.g. 89)<br>
%Y = 4-digit year (e.g. 1989)<br>
%h = hours (24-hr clock)<br>
%m = minutes<br>
%s = seconds
%z = offset from GMT<br>
%Z = Time zone (character)</p>
<p>An example of formatting today’s date:</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># today's date, with formatting</span>
<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%d %B %Y"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "03 February 2021"</code></pre>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># easy way to get full date and time (no formatting)</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/date.html">date</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Wed Feb 03 11:48:10 2021"</code></pre>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># formatted date, time, and time zone (using paste0() function)</span>
<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%A, %b %d '%y, %z  %Z, "</span><span class="op">)</span>, 
  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%H:%M:%S"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## [1] "Wednesday, Feb 03 '21, +0000  UTC, 11:48:10"</code></pre>
<!-- ======================================================= -->
</div>
<div id="calculating-distance-between-dates" class="section level2" number="9.9">
<h2>
<span class="header-section-number">9.9</span> Calculating distance between dates<a class="anchor" aria-label="anchor" href="#calculating-distance-between-dates"><i class="fas fa-link"></i></a>
</h2>
<p>The difference between dates can be calculated by:</p>
<ol style="list-style-type: decimal">
<li>Correctly formating <em>both</em> date variable as class date (see instructions above)<br>
</li>
<li>Creating a new variable that is defined as one date variable subtracted from the other</li>
<li>Converting the result to numeric class (default is class “datediff”). This ensures that subsequent mathematical calculations can be performed.</li>
</ol>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define variables as date classes</span>
<span class="va">date_of_onset</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020-03-16"</span><span class="op">)</span>
<span class="va">date_lab_confirmation</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020-03-20"</span><span class="op">)</span>

<span class="co"># find the delay between onset and lab confirmation</span>
<span class="va">days_to_lab_conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">date_lab_confirmation</span> <span class="op">-</span> <span class="va">date_of_onset</span><span class="op">)</span>
<span class="va">days_to_lab_conf</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>In a dataframe format (i.e. when working with a linelist), if either of the above dates is missing, the operation will fail for that row. This will result in an <code>NA</code> instead of a numeric value. When using this column for calculations, be sure to set the <code>na.rm</code> option to <code>TRUE</code>. For example:</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add a new column</span>
<span class="co"># calculating the number of days between symptom onset and patient outcome</span>
<span class="va">linelist_delay</span> <span class="op">&lt;-</span> <span class="va">linelist_cleaned</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    days_onset_to_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">date_of_outcome</span> <span class="op">-</span> <span class="va">date_of_onset</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># calculate the median number of days to outcome for all cases where data are available</span>
<span class="va">med_days_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">linelist_delay</span><span class="op">$</span><span class="va">dats_onset_to_outcome</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co"># often this operation might be done only on a subset of data cases, e.g. those who died</span>
<span class="co"># this is easy to look at and will be explained later in the handbook</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="converting-datestime-zones" class="section level2" number="9.10">
<h2>
<span class="header-section-number">9.10</span> Converting dates/time zones<a class="anchor" aria-label="anchor" href="#converting-datestime-zones"><i class="fas fa-link"></i></a>
</h2>
<p>When data is present in different time time zones, it can often be important to standardise this data in a unified time zone. This can present a further challenge, as the time zone component of data must be coded manually in most cases.</p>
<p>In R, each <em>datetime</em> object has a timezone component. By default, all datetime objects will carry the local time zone for the computer being used - this is generally specific to a <em>location</em> rather than a named timezone, as time zones will often change in locations due to daylight savings time. It is not possible to accurately compensate for time zones without a time component of a date, as the event a date variable represents cannot be attributed to a specific time, and therefore time shifts measured in hours cannot be reasonably accounted for.</p>
<p>To deal with time zones, there are a number of helper functions in lubridate that can be used to change the time zone of a datetime object from the local time zone to a different time zone. Time zones are set by attributing a valid tz database time zone to the datetime object. A list of these can be found here - if the location you are using data from is not on this list, nearby large cities in the time zone are available and serve the same purpose.</p>
<p><a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="uri">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a></p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># assign the current time to a variable</span>
<span class="va">time_now</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_now</span></code></pre></div>
<pre><code>## [1] "2021-02-03 11:48:10 EST"</code></pre>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use with_tz() to assign a new timezone to the variable, while CHANGING the clock time</span>
<span class="va">time_london_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">time_now</span>, <span class="st">"Europe/London"</span><span class="op">)</span>

<span class="co"># use force_tz() to assign a new timezone to the variable, while KEEPING the clock time</span>
<span class="va">time_london_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/force_tz.html">force_tz</a></span><span class="op">(</span><span class="va">time_now</span>, <span class="st">"Europe/London"</span><span class="op">)</span>


<span class="co"># note that as long as the computer that was used to run this code is NOT set to London time, there will be a difference in the times (the number of hours difference from the computers time zone to london)</span>

<span class="va">time_london_real</span> <span class="op">-</span> <span class="va">time_london_local</span></code></pre></div>
<pre><code>## Time difference of 5 hours</code></pre>
<p>This may seem largely abstract, and is often not needed if the user isn’t working across time zones. One simple example of its implementation is:</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TODO add when time variable is here</span>
<span class="co"># set the time variable to time zone for ebola outbreak </span>

<span class="co"># "Africa/Lubumbashi" is the time zone for eastern DRC/Kivu Nord</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="epidemiological-weeks" class="section level2" number="9.11">
<h2>
<span class="header-section-number">9.11</span> Epidemiological weeks<a class="anchor" aria-label="anchor" href="#epidemiological-weeks"><i class="fas fa-link"></i></a>
</h2>
<p>Use the <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> function from <strong>lubridate</strong>, with <code>unit = "week"</code>. See example below for specifying the week start day. The returned output is the start date of the week, in Date class.</p>
<p>For example, to create a new column that is weeks, then use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> to get weekly case counts.</p>
<p>To aggregate into weeks and show ALL weeks (even ones with no cases), do this:</p>
<ol style="list-style-type: decimal">
<li>Create a new ‘week’ column within <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, using <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> from the <strong>lubridate</strong> package:
<ul>
<li>use <code>unit =</code> to set the desired time unit, e.g. "week`<br>
</li>
<li>use <code>week_start =</code> to set the weekday start of the week (7 = Sunday, 1 = Monday)</li>
</ul>
</li>
<li>Follow with <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> to ensure that all weeks appear - even those with no cases.</li>
</ol>
<p>For example:</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make dataset of weekly case counts</span>
<span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>,
                                 unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># new column of week of onset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                                     <span class="co"># group data by week and count rows per group</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                            <span class="co"># remove entries for cases missing date_onset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,          <span class="co"># fill-in all weeks with no cases reported</span>
                           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,
                           by<span class="op">=</span><span class="st">"week"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here are the first 20 rows of the resulting dataframe:</p>
<div id="htmlwidget-c2865870f07233ad25b8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c2865870f07233ad25b8">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1396742400000\" data-max=\"1408233600000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"125\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17"],[1,2,4,4,11,14,14,23,21,17,29,25,31,34,55,57,76,82,115,125]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>week<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>You can also use the package <strong>aweek</strong> to set epidemiological weeks. You can read more about it <a href="https://www.repidemicsconsortium.org/aweek/">on the RECON website</a></p>
<!-- ======================================================= -->
</div>
<div id="dates-in-epicurves" class="section level2" number="9.12">
<h2>
<span class="header-section-number">9.12</span> Dates in Epicurves<a class="anchor" aria-label="anchor" href="#dates-in-epicurves"><i class="fas fa-link"></i></a>
</h2>
<p>See the section on <a href="#epicurves">epicurves</a>.</p>
<!-- ======================================================= -->
</div>
<div id="dates-miscellaneous" class="section level2" number="9.13">
<h2>
<span class="header-section-number">9.13</span> Dates miscellaneous<a class="anchor" aria-label="anchor" href="#dates-miscellaneous"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date( )</a></code> returns the current date of your computer<br>
</li>
<li>
<code>Sys.Time()</code> returns the current time of your computer</li>
<li>
<code><a href="http://lubridate.tidyverse.org/reference/date.html">date()</a></code> returns the current date and time.</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cleaning-data.html"><span class="header-section-number">8</span> Cleaning data</a></div>
<div class="next"><a href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#working-with-dates"><span class="header-section-number">9</span> Working with Dates</a></li>
<li><a class="nav-link" href="#overview-3"><span class="header-section-number">9.1</span> Overview</a></li>
<li><a class="nav-link" href="#packages-2"><span class="header-section-number">9.2</span> Packages</a></li>
<li><a class="nav-link" href="#converting-objects-to-date-class"><span class="header-section-number">9.3</span> Converting objects to Date class</a></li>
<li><a class="nav-link" href="#converting-to-datetime-classes"><span class="header-section-number">9.4</span> Converting to datetime classes</a></li>
<li><a class="nav-link" href="#lubridate"><span class="header-section-number">9.5</span> lubridate</a></li>
<li><a class="nav-link" href="#guess_dates"><span class="header-section-number">9.6</span> guess_dates()</a></li>
<li><a class="nav-link" href="#excel-dates"><span class="header-section-number">9.7</span> Excel Dates</a></li>
<li><a class="nav-link" href="#how-dates-are-displayed"><span class="header-section-number">9.8</span> How dates are displayed</a></li>
<li><a class="nav-link" href="#calculating-distance-between-dates"><span class="header-section-number">9.9</span> Calculating distance between dates</a></li>
<li><a class="nav-link" href="#converting-datestime-zones"><span class="header-section-number">9.10</span> Converting dates/time zones</a></li>
<li><a class="nav-link" href="#epidemiological-weeks"><span class="header-section-number">9.11</span> Epidemiological weeks</a></li>
<li><a class="nav-link" href="#dates-in-epicurves"><span class="header-section-number">9.12</span> Dates in Epicurves</a></li>
<li><a class="nav-link" href="#dates-miscellaneous"><span class="header-section-number">9.13</span> Dates miscellaneous</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Handbook for Epidemiologists</strong>" was written by the handbook team. It was last built on 2021-02-03.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
