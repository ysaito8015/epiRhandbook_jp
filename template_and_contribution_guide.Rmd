---
title: "Template for contributions and style guide"
author: "Neale Batra, version 1.0.0"
date: "Produced `r format(Sys.time(), '%A %d %B %Y')`"
output:
  html_document:
    code_folding: show
    highlight: zenburn
    number_sections: no
    theme: sandstone
    toc: yes
    toc_collapse: no
    toc_depth: 3
    toc_float: yes
    #css: !expr here::here('css', 'style.css')
---


```{r setup, include=FALSE}
# THIS SETUP CHUNK IS NOT NEEDED IN YOUR PAGE
# This chunk is already at the very top of the handbook and sets default settings for figures, pixels, warnings, errors, etc.

knitr::opts_chunk$set(echo = TRUE,
                      collapse = TRUE,
                      fig.width = 8,
                      fig.height = 6,
                      dpi = 150,
                      warning = FALSE,
                      message = FALSE)
```


```{r klippy, echo=FALSE, include=TRUE}
# THIS CHUNK IS NOT NEEDED IN YOUR PAGE
# This chunk is at the top of the handbook and enables the clipboard feature throughout the whole handbook

# Enables "copy to clipboard" icons   https://rlesur.github.io/klippy/articles/klippy.html
klippy::klippy(position = c('top', 'right'))
```


<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
# Style and Mechanics of Contribution {#overview .tabset .tabset-fade}

Points here about welcome and thanking




<!-- ======================================================= -->
## Objectives

Objectives here  
*  
*  
*  Written language that is simple and can be understood by non-native English speakers





<!-- ======================================================= -->
## Code Style

In your code, please maintain [tidyverse style](https://style.tidyverse.org/) as much as possible. A few key principles taken from this style guide:  

* When making assignments, use `<-`, NOT `=`  
* Object names should use generally use underscores such as `my_data`, NOT `my.data`, `mydata`, not `myData` (again to make easy for readers who who are not as comfortable in English)  
*Use *spaces* liberally, e.g. even after hash symbols (`# this is my comment` and not `#this is my comment`)  
* Prefer to make code *longer* (vertically) and NOT next a lot of functions within each other. There are exceptions, but more vertically is easier to read and allows you to make comments on each action. For example:  

```{r eval=F}
# Good
do_something_very_complicated(
  something = "that",
  requires = many,
  arguments = "some of which may be long"
)

# Bad
do_something_very_complicated("that", requires, many, arguments,
                              "some of which may be long"
                              )
```


* Also note above the attempt to vertically align comments, when practical.  
* Using pipes:  

```{r, eval=F}
# Good
iris %>%
  group_by(Species) %>%
  summarize_if(is.numeric, mean) %>%
  ungroup() %>%
  gather(measure, value, -Species) %>%
  arrange(value)

# Bad
iris %>% group_by(Species) %>% summarize_all(mean) %>%
ungroup %>% gather(measure, value, -Species) %>%
arrange(value)
```


If the arguments to a function don’t all fit on one line, put each argument on its own line and indent:  

```{r, eval=F}
# an example from the handbook
linelist <- linelist %>% 
  mutate(new_var_dup    = id,                  # new variable - replicate another variable
         new_var_static = 7,                   # new variable - all values the same
         new_var_static = new_var_static + 5   # you can modify a variable multiple times
         new_var_calc   = (age / 12) + months  # new variable - calculation
         new_var_paste  = paste0(district, "(", province, ")") # new variable - pasting together values

```

In your # comments:  

* Be concise  
* Avoid abbreviations ("don't")  
* Do not use country-specific slang or phrases






<!-- ======================================================= -->
## Rmarkdown
https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf







<!-- ======================================================= -->
## Using Github and R

Here is an online guide: https://happygitwithr.com/rstudio-git-github.html. Much of the below text is taken from this guide.  

### First steps

1) Register for a free account with Github 

* You will need to set up *2-factor authentification* (e.g. app on your phone that provides a code to confirm it is you logging in)
2) Have installed/updated R and RStudio  
3) Install Git to your computer  
4) Introduce yourself to Git  

7) Be registered as a contibutor to the R_epi_handbook Github repository (email neale.batra@gmail.com)

8) Clone the Github repository to your computer  
     * In RStudio start a new project *File > New Project > Version Control > Git*  
     * In “Repository URL”, paste the URL *https://github.com/nsbatra/R_epi_handbook.git*  
     * Accept the default project directory name R_epi_handbook  
     * Take charge of – or at least notice! – where the Project will be saved locally.  
     * Check "Open in new session" and click "Create project"  
     * You should now be in a new local RStudio project that is a clone of the R_epi_handbook repository on Github
     
In your RStudio you will now have a Git tab in the same tab as your R Environment: 


```{r echo=F, out.width = "50%", out.height="50%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Git_console.png"))
```  
Please note the buttons circled as they will be referenced later (from left to right):  

* Button to begin "commiting" your changes to your branch (will open a new window)  
* Arrows to PULL (update your local version of the branch with any changes to made your branch by others) and to PUSH (send any completed commits stored in your local version of the branch to the remote/Github version of your branch)  
* The Git tab in RStudio  
* Button to create a NEW branch of whichever version is listed to the right. **You almost always want to branch off of the master (after you PULL to update the master first)**.  
* The branch you are currently working in.  
* Below all this, changes you make to code or files will begin to appear  

**To work on your Handbook page:**  

**!!!ONLY MAKE EDITS TO YOUR HANDBOOK PAGE!!!**  

*Note: Last I heard, Github will soon change their terminology of "master" to "main", as it is an unnecessary reference to slavery*  

1) **Create a branch**  

* Ensure you are in *master* and then click the branch button.  
* Give your branch a one-word descriptive name (can use underscores if needed). You will see that locally, you are still in the project R_epi_handbook, but you are no longer working on the master branch. Once created, the new branch will also appear on the Github website as a branch.  
*  Make your changes to files, code, etc.  
     * Your changes are tracked. Every change you make that is substantial (e.g. adding a section, etc.), stop and *commit* those changes. Think of a commit as a "batch" of changes related to a common purpose.  
* Commit the changes  
     * Press "Commit" in the git tab, opens new window  
     * Review the changes you made (green, red etc.)  
     * Highlight all the changes for the commit and "stage" them by checking their boxes or highlighting all the rows and clicking "stage all"  
     * Write a commit message that is short but descriptive  
     * Press "commit" on the right side  
     
* PULL (pulls any changes from your branch down to your local computer)
* PUSH your changes up to the remote/Github version of your branch  

2) **Request to merge your branch with master**

* Go to R_epi_handbook master branch on GitHub website
* Switch to view your branch
* at top you will see green button saying "Compare and Pull Request". If not, look for another button that says pull request.
* Write a detailed comment and click "Create Pull Request")
* On the right, request a review from certain people. You need one review to be able to complete the merge
* Once completed, delete your branch as explained below

3) **Delete your branch on Github** 
*https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/creating-and-deleting-branches-within-your-repository#deleting-a-branch*  

Be sure to also delete the branch locally on your computer:

* Make sure you are in Master (PULL just in case)
* Switch to typing in the "terminal" (another tab near the R console), and enter this: git branch -d branch_name , where branch_name is the name of your branch to be deleted  
* Refresh your Git tab and it should be gone.


**TEST IT**

You can test your abilit to make changes, commits, pull requests, etc. on this R code which is saved to the main Rproject folder:  
`test_your_abilities.R`



**Asked to provide password on each PUSH?**  
Instructions for connecting to the repository via a SSH key:  

* Connect to the webite Github via SSH address (use the SSH address available in the green "Clone or Download" botton on the github's <code> page (use SSH, not the HTTPS address).
     * But this requires the following pre-requisite: Establish a SSH key authenticating your computer with Github. There are two parts to the key - one for your computer, and one for your github account. Use this guide: https://happygitwithr.com/ssh-keys.html  (but I'll give the steps I took below anyway for my Windows 10 machine:
          * I opened Git on my machine (for me that was GitBash) and entered: ssh-keygen -t rsa -b 4096 -C "New SSH Key" (You can decide the words in quotes - it's just reminder text for yourself). This produces a two-part (private/public) SSH token.  
          * I then added the token to my computer: ssh-add ~/.ssh/id_rsa  (no need to change this command at all)  
          * I then clipped the long part of the token to my clipboard (to then paste in Github) using this command: clip < ~/.ssh/id_rsa.pub
          * Then I went to my Github account and in personal settings there is an SSH key section.  
          * Click to make a new one, and paste in the public key that is on your clipboard. Save the key.  
          * NOW go through the steps of making the new RStudio project via the SSH connection, as described below.


`usethis::create_from_github('nsbatra/R_epi_handbook', fork = TRUE)`

  


<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
# Template for contribution {#template .tabset .tabset-fade}



<!-- ======================================================= -->
## Tab structure

Here is an example of how a cascade of headers/tabs looks in the handbook. A **Level 1 header** (`# R Basics`) with a **Level 2 header** tab (`## Operators`), and below that several **Level 3 header** tabs (`### Relational and Logical Operators`, `### Missing Values`).  

Note how the first level of tabs looks slightly different than the second level of tabs.  


```{r basics_objects_structures, echo=F, out.width = "80%", out.height="80%", fig.align = "center"}
knitr::include_graphics(here::here("images", "template_example_tabs.png"))
```  


Here is the code structure of these highlighted tabs (code for other tabs not shown for simplicity). A few things to note:  

* The **3 dashed lines** are used for **Level 1 headers** only and signify start of a new handbook page. They are not necessary, but assist us writers visually when we quickly skim the Rmarkdown handbook.  
* Inside the curly brackets after the header name is an *optional* single-word tag `{#rbasics}` (hash with no following space). It can be used to create internal links within the handbook.  
* Also in the brackets `{ }` are arguments that create the tabs:  
     * **Level 1 Headers** use two: ` .tabset .tabset-fade`, which create tabs that are not "pilled" in appearance.  
     * **Level 2 Headers** *that contain sub-tabs* use three: `{.tabset .tabset-fade .tabset-pills}`, the last of which makes the tabs "pilled" in appearance (to distinguish more visually the types of tabs)  
* The level 2 and 3 headers have only one dashed line, to distinguish from the 3 lines of a new handbook page  
* The level 2 headers, in order to appear in the Table of Contents, have an extra line like this `<h2> Operators </h2>` just above the header. A bug caused by using tabs means that level 2 headers that are a tab do not appear in the ToC. This line fixes that. We don't include level 3 headers in the ToC.  


```{r, eval=F}

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
# R Basics {#rbasics .tabset .tabset-fade}

(Other handbook pages can have internal links to this page using the tag #rbasics)




<!-- ======================================================= -->
<h2> Operators </h2>   (having this line ensures that a Level2 header in a tab appears in the Table of Contents)
## Operators {#operators .tabset .tabset-fade .tabset-pills}

(This is a tab of R basics, with the tab appearance not "pilled")
(this tab has a tag so that other handbook pages can have internal links to it using the tag #objects)
     
This section details operators in R, such as ...  
     




<!-- ======================================================= -->
### Relational and logical operators  

(This is a sub-tab of Operators, with "pilled" tab appearance because `.tabset-pills` is included in the `{}` of its parent tab)
 
**Relational operators compare values** and are often used when defining new variables and subsets of datasets. Here are the common relational operators in R ...





<!-- ======================================================= -->
### Missing Values
(This is a sub-tab of Operators, also with "pilled" tab appearance because `.tabset-pills` is included in the `{}` of its parent tab)

**In R, missing values are represented by the special value `NA`** ...
```






<!-- ======================================================= -->
## Datasets

Add your datasets to the Data folder in the R project






<!-- ======================================================= -->
## Add images

Use code like this to add a static image or a GIF:  

(note: remove the eval=F)
```{r eval=F, out.width = "80%", out.height="80%", fig.align = "center"}
knitr::include_graphics(here::here("images", "template_example_tabs.png"))
```  

