---
title: "Template for contributions and style guide"
author: "Neale Batra, version 1.0.0"
date: "Produced `r format(Sys.time(), '%A %d %B %Y')`"
output:
  html_document:
    code_folding: show
    highlight: zenburn
    number_sections: no
    theme: sandstone
    toc: yes
    toc_collapse: no
    toc_depth: 3
    toc_float: yes
    #css: !expr here::here('css', 'style.css')
---


```{r setup, include=FALSE}
# THIS SETUP CHUNK IS NOT NEEDED IN YOUR PAGE
# This chunk is already at the very top of the handbook and sets default settings for figures, pixels, warnings, errors, etc.

knitr::opts_chunk$set(echo = TRUE,
                      collapse = TRUE,
                      fig.width = 8,
                      fig.height = 6,
                      dpi = 150,
                      warning = FALSE,
                      message = FALSE)
```


```{r klippy, echo=FALSE, include=TRUE}
# THIS CHUNK IS NOT NEEDED IN YOUR PAGE
# This chunk is at the top of the handbook and enables the clipboard feature throughout the whole handbook

# Enables "copy to clipboard" icons   https://rlesur.github.io/klippy/articles/klippy.html
klippy::klippy(position = c('top', 'right'))
```


<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
# Style and Mechanics of Contribution {#overview .tabset .tabset-fade}

Points here about welcome and thanking




<!-- ======================================================= -->
## Objectives

Objectives here  
*  
*  
*  Written language that is simple and can be understood by non-native English speakers





<!-- ======================================================= -->
## Code Style

In your code, please maintain [tidyverse style](https://style.tidyverse.org/) as much as possible. A few key principles taken from this style guide:  

* When making assignments, use `<-`, NOT `=`  
* Object names should use generally use underscores such as `my_data`, NOT `my.data`, `mydata`, not `myData` (again to make easy for readers who who are not as comfortable in English)  
*Use *spaces* liberally, e.g. even after hash symbols (`# this is my comment` and not `#this is my comment`)  
* Prefer to make code *longer* (vertically) and NOT next a lot of functions within each other. There are exceptions, but more vertically is easier to read and allows you to make comments on each action. For example:  

```{r eval=F}
# Good
do_something_very_complicated(
  something = "that",
  requires = many,
  arguments = "some of which may be long"
)

# Bad
do_something_very_complicated("that", requires, many, arguments,
                              "some of which may be long"
                              )
```


* Also note above the attempt to vertically align comments, when practical.  
* Using pipes:  

```{r, eval=F}
# Good
iris %>%
  group_by(Species) %>%
  summarize_if(is.numeric, mean) %>%
  ungroup() %>%
  gather(measure, value, -Species) %>%
  arrange(value)

# Bad
iris %>% group_by(Species) %>% summarize_all(mean) %>%
ungroup %>% gather(measure, value, -Species) %>%
arrange(value)
```


If the arguments to a function don’t all fit on one line, put each argument on its own line and indent:  

```{r, eval=F}
# an example from the handbook
linelist <- linelist %>% 
  mutate(new_var_dup    = id,                  # new variable - replicate another variable
         new_var_static = 7,                   # new variable - all values the same
         new_var_static = new_var_static + 5   # you can modify a variable multiple times
         new_var_calc   = (age / 12) + months  # new variable - calculation
         new_var_paste  = paste0(district, "(", province, ")") # new variable - pasting together values

```

In your # comments:  

* Be concise  
* Avoid abbreviations ("don't")  
* Do not use country-specific slang or phrases






<!-- ======================================================= -->
## Rmarkdown
https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf







<!-- ======================================================= -->
## Using Github and R

Here is an online guide: https://happygitwithr.com/rstudio-git-github.html. Much of the below text is taken from this guide.  

### Overview of GitHub  
Github is a website that supports **collaborative projects** with **version control**.  In a nutshell, the project's files exist in the **Github repository** as a **"master"** version (called a **"branch"**). If you want to make a change to those files you must create a different branch (version) to build and test the changes in. Master remains unaffected by your changes until your branch is **merged** (after some verification steps) into the master branch. A **"commit"** is the saving of a smaller group of changes you make within your branch. A **Pull Request** is your request to merge your changes into the master branch.  

The way RStudio and Github interact is as follows:  

* There is a REMOTE version of the R_epi_hanbook R project that lives on Github website repository. Master and other branches exist and are viewable there.  
* On your computer, you **clone** a LOCAL version of the repository (all its files, in all its branches/versions). Here you can edit files and make commits of those changes to various branches. These changes are only stored locally on your computer until...  
* Your LOCAL repository/Rproject interacts with the REMOTE one by **pulling** (updating local files from the remote ones) and **pushing** (pushing local changes to the remote repository)  
* The software *Git* on your computer underlies all this. You can write Git command-line, or just interact with Git as point-and-click through RStudio (easier). As noted below, you may *occassionally* have to write Git commands in the RStudio terminal.  


```{r echo=F, out.width = "50%", out.height="50%", fig.align = "center"}
knitr::include_graphics(here::here("images", "GitHub-Flow.png"))
``` 
*Image [source](https://build5nines.com/introduction-to-git-version-control-workflow/)*


### First steps

1) Register for a free account with Github 
2) Have installed/updated R and RStudio  
3) Install **Git** to your computer (Git is a software, Github is a website that )  
4) Introduce yourself to Git by reading about it  
5) Be registered as a contibutor to the R_epi_handbook Github repository (email neale.batra@gmail.com)
6) Clone the Github repository to your computer  
     * In RStudio start a new project *File > New Project > Version Control > Git*  
     * In “Repository URL”, paste the URL *https://github.com/nsbatra/R_epi_handbook.git*  
     * Accept the default project directory name R_epi_handbook  
     * Take charge of – or at least notice! – where the Project will be saved locally.  
     * Check "Open in new session" and click "Create project"  
     * You should now be in a new local RStudio project that is a clone of the R_epi_handbook repository on Github
     
In your RStudio you will now have a Git tab in the same tab as your R Environment: 


```{r echo=F, out.width = "50%", out.height="50%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Git_console.png"))
```  
Please note the buttons circled as they will be referenced later (from left to right):  

* Button to begin "commiting" your changes to your branch (will open a new window)  
* Arrows to PULL (update your local version of the branch with any changes to made your branch by others) and to PUSH (send any completed commits stored in your local version of the branch to the remote/Github version of your branch)  
* The Git tab in RStudio  
* Button to create a NEW branch of whichever version is listed to the right. **You almost always want to branch off of the master (after you PULL to update the master first)**.  
* The branch you are currently working in.  
* Below all this, changes you make to code or files will begin to appear  

### **To work on your Handbook page:**  

**!!!ONLY MAKE EDITS TO YOUR HANDBOOK PAGE!!!**  

*Note: Last I heard, Github will soon change their terminology of "master" to "main", as it is an unnecessary reference to slavery*  

1) **Create a branch**  

* Ensure you are in *master* branch and then click the branch button/icon.  
* **Name your branch** with a one-word descriptive name (can use underscores if needed). You will see that locally, you are still in the project R_epi_handbook, but you are no longer working on the master branch. Once created, the new branch will also appear on the Github website as a branch.  
*  **Make your changes**... to files, code, etc. Your changes are tracked.  
* **Commit the changes**. Every series of changes you make that are substantial (e.g. adding or updating a section, etc.), stop and *commit* those changes. Think of a commit as a "batch" of changes related to a common purpose.  
     * Press "Commit" in the git tab, opens new window  
     * Review the changes you made (green, red etc.)  
     * Highlight all the changes for the commit and "stage" them by checking their boxes or highlighting all the rows and clicking "stage all"  
     * Write a commit message that is short but descriptive (required) 
     * Press "commit" on the right side  
* Make and commit more changes, as many time as you would like  
* **PULL** - click the PULL icon (downward arrow) which updates the branch version on your local computer with any changes that have been made to it and stored in the remote/Github version  
     * PULL often. Don't hesitate. **Always** pull before pushing.  
* **PUSH** your changes up to the remote/Github version of your branch.  
     * You may be asked to enter your Github username and password.  
     * The first time you are asked, you may need to enter two Git command lines into the *Terminal* (the tab next to the R Console):
     * **git config --global user.email "you@example.com"** and **git config --global user.name "Your Github username"**  
     


2) **Request to merge your branch with master**
Once done with your commits and pushed everything up to the remote Github repository, you may want to request that your branch be merged with the master branch. 

* Go to R_epi_handbook on GitHub website
* Use the branch drop-down to view your branch, not master
* At top you will see green button saying "Compare and Pull Request". If not, look for another button that says pull request.
* Write a detailed comment and click "Create Pull Request"
* On the right, request a review from certain people in the project. You need one review to be able to complete the merge.
* Once completed, delete your branch as explained below

3) **Delete your branch on Github**  
GO to the repository on Github and click the button to view all the branches (next to the drop-down to select branches). Now find your branch and click the trash icon next to it. Read more [here](https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/creating-and-deleting-branches-within-your-repository#deleting-a-branch)  

Be sure to also delete the branch locally on your computer:

* From RStudio, make sure you are in Master branch
* Switch to typing in the "terminal" (tab adjacent to the R console), and enter this: **git branch -d branch_name** , where "branch_name" is the name of your branch to be deleted  
* Refresh your Git tab and this branch should be gone.


**TEST IT**
You can test your ability to make changes, commits, pull requests, etc. by modifying this R script which is saved to the main Rproject folder:  
`test_your_abilities.R`


**Asked to provide password too often??**  
Instructions for connecting to the repository via a SSH key (more complicated): 
See chapters 10 and 11 of [this tutorial](https://happygitwithr.com/credential-caching.html#credential-caching)






<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
# Template for contribution {#template .tabset .tabset-fade}




<!-- ======================================================= -->
## General structure

Have several tabs in your Handbook page, generally structured as follows:  

**Tab 1** - Must be called "Overview". Can just contain a bit of intro text describing the objectives of the page. You can also include a graphic to demonstrate graphics or skills what the page will explain. This is so when a user is scrolling, it will catch their eye. If you include a graphic here, please be considerate and shrink it to a reasonably small size. Think of it as a thumbnail.  

**Set-up tabs** - If you page involves data import, cleaning, or other set-up, put it in a set-up tab. Feel free to add sub-tabs if necessary to break up the steps - use your judgement. We don't want tabs to get too long that they require lots of scrolling.  

**Explicity show data transformations** - When melting, spreading, or otherwise making major changes to data in your page, **please explicity show those changes to the user**. These are points where beginners often get lost. Use the command below as often as necessary to show your dataset and its transformations:  
```{r, eval=F}
DT::datatable(linelist, rownames = FALSE, filter="top", options = list(pageLength = 5, scrollX=T))
```

**Different approaches** - Create tabs for different approaches to the task your page addresses. For example, there may be 2 or 3 R packages that you want to offer to the reader (one using base R, and another package). **Be clear in which approach you recommend and why**. We have to balance the reader's desire to learn a recommended way, with the need to give them a few options in case they can't download a particular package.  

Other points:  

* Use bullets, they are easy to read  
* Use notes, tips, caution, and danger warnings - the code to produce these is below:  

```
FOR EXAMPLE: This is a boxed example

```

<span style="color: black;">**_NOTE:_** This is a note</span>

<span style="color: darkgreen;">**_TIP:_** This is a tip.</span>

<span style="color: orange;">**_CAUTION:_** This is a cautionary note.</span>

<span style="color: red;">**_DANGER:_** This is a warning.</span>

Here is the code to produce these:  

```{r, eval=F}
#```
FOR EXAMPLE: This is a boxed example, surrounded by three tickmarks above and below (without the hashes)

#```

<span style="color: black;">**_NOTE:_** This is a note</span>


<span style="color: darkgreen;">**_TIP:_** This is a tip.</span>


<span style="color: orange;">**_CAUTION:_** This is a cautionary note.</span>


<span style="color: red;">**_DANGER:_** This is a warning.</span>

```


<!-- ======================================================= -->
## Tab structure

Here is an example of how a cascade of headers/tabs looks in the handbook. A **Level 1 header** (`# R Basics`) with a **Level 2 header** tab (`## Operators`), and below that several **Level 3 header** tabs (`### Relational and Logical Operators`, `### Missing Values`).  

Note how the first level of tabs looks slightly different than the second level of tabs.  


```{r basics_objects_structures, echo=F, out.width = "80%", out.height="80%", fig.align = "center"}
knitr::include_graphics(here::here("images", "template_example_tabs.png"))
```  


Here is the code structure of these highlighted tabs (code for other tabs not shown for simplicity). A few things to note:  

* The **3 dashed lines** are used for **Level 1 headers** only and signify start of a new handbook page. They are not necessary, but assist us writers visually when we quickly skim the Rmarkdown handbook.  
* Inside the curly brackets after the header name is an *optional* single-word tag `{#rbasics}` (hash with no following space). It can be used to create internal links within the handbook.  
* Also in the brackets `{ }` are arguments that create the tabs:  
     * **Level 1 Headers** use two: ` .tabset .tabset-fade`, which create tabs that are not "pilled" in appearance.  
     * **Level 2 Headers** *that contain sub-tabs* use three: `{.tabset .tabset-fade .tabset-pills}`, the last of which makes the tabs "pilled" in appearance (to distinguish more visually the types of tabs)  
* The level 2 and 3 headers have only one dashed line, to distinguish from the 3 lines of a new handbook page  
* The level 2 headers, in order to appear in the Table of Contents, have an extra line like this `<h2> Operators </h2>` just above the header. A bug caused by using tabs means that level 2 headers that are a tab do not appear in the ToC. This line fixes that. We don't include level 3 headers in the ToC.  


```{r, eval=F}

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
# R Basics {#rbasics .tabset .tabset-fade}

(Other handbook pages can have internal links to this page using the tag #rbasics)




<!-- ======================================================= -->
<h2> Operators </h2>   (having this line ensures that a Level2 header in a tab appears in the Table of Contents)
## Operators {#operators .tabset .tabset-fade .tabset-pills}

(This is a tab of R basics, with the tab appearance not "pilled")
(this tab has a tag so that other handbook pages can have internal links to it using the tag #objects)
     
This section details operators in R, such as ...  
     




<!-- ======================================================= -->
### Relational and logical operators  

(This is a sub-tab of Operators, with "pilled" tab appearance because `.tabset-pills` is included in the `{}` of its parent tab)
 
**Relational operators compare values** and are often used when defining new variables and subsets of datasets. Here are the common relational operators in R ...





<!-- ======================================================= -->
### Missing Values
(This is a sub-tab of Operators, also with "pilled" tab appearance because `.tabset-pills` is included in the `{}` of its parent tab)

**In R, missing values are represented by the special value `NA`** ...
```






<!-- ======================================================= -->
## Datasets

Add your datasets to the "Data" folder in the R project. 
Then you can reference them using code with the **here** package like below:  

```{r, eval=F}
# import aggregated case counts of disease X
count_data <- rio::import(here::here("data", "aggregated_counts_diseaseX.xlsx"))  

```






<!-- ======================================================= -->
## Add images

Use code like this to add a static image or a GIF. The image must be saved in the R project's "images" folder.  
```
Use the code chunk below to add a graphic (which is saved to the "images" folder)
Obviously, delete the hash symbols - those are just to allow me to show this here in the tutorial

# ```{r eval=F, out.width = "80%", out.height="80%", fig.align = "center"}
# knitr::include_graphics(here::here("images", "template_example_tabs.png"))
# ```  
```
