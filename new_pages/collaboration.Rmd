
# Version control and collaboration with Github { }  

This page presents an overview of using Github to collaborate with others. More extensive tutorials, which informed the writing of this page, can be found at the bottom in the Resources section.  



## Why use Github  

Github is a website that supports **collaborative projects** with **version control**. Basically, it facilitates:  

1) Archiving versions with incremental changes so that you can easily revert backwards  
2) Collaboration so that others can review, comment on, and accept/decline changes  
3) Having parallel developing/"working" versions with structured ways to integrate the changes after review  
4) the option to publicly share your code, data, and outputs, and invite feedback from the public  

Using Github is helpful if working within a team, if you want to have a system for code review, and if you want Github to take care of version control and archiving. Github helps avoid the having many saved versions of scripts and files with various dates stamps.  

Github's value as a collaboration and quality-control tool does come at the cost of some speed - the processes of uploading and reviewing may not be optimal for some teams working in emergency contexts.  





## Github basics  

### What is Git? {-}

*Git* is a version control software. When you use Github, the software *Git* on your computer is the engine behind the scenes that tracks changes, branches (versions), merges, and reverting. **To use Github with your R work, you must first install *Git* from [https://git-scm.com/downloads](https://git-scm.com/downloads).**  

In typical use, you rarely have to interact directly with Git. You can interact with it through RStudio or Github Desktop. However, Git has its own language of commands, which can be typed into either a command line terminal (or an application like Git Bash for Windows), or can also be typed into the RStudio "Terminal" pane (a tab adjacent to the R Console).  

As noted below, you may *occasionally* have to write Git commands into a terminal such as the RStudio terminal. To learn Git commands see this online [interactive tutorial](learngitbranching.js.org), or the later section on [Git](#git).  

### What is Github? {-}  

*Github* is a website ([github.com](github.com)) that facilitates and enhances the use of Git, including capabilities for code review, issue-tracking, and sharing with the public.  
  

### Github account {-}  

Sign-up for a free account at [github.com](github.com).  

You may be requested to set-up two-factor authentication with an app on your phone. Read more in the Github  [help documents](https://docs.github.com/en/github/authenticating-to-github/securing-your-account-with-two-factor-authentication-2fa).  


### Github repositories {-}  

A Github repository ("repo") is like a folder that contains all the sub-folders and files for your project (data, code, images, etc.) and their revision histories. A Github repository aligns nicely with an *R Project* (see handbook page on [R projects]. 

To create a new repository, log-in to Github and look for the green button to create a new repository.  

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_new.png"))
``` 

Some general considerations when you open a new repository:  

#### Public or private {-}  

You must choose if you want your repository to be public (visible to everyone on the internet) or private (only visible to those with permission). This has important implications if your data are sensitive. If your repository is private you will encounter some quotas in advanced special circumstances, such as if you are using Github *actions* to automatically run your code in the cloud.  

#### Start-up files {-}  

All of the below files are offered when you create a new repository, are optional, and you can also add them to your repository at a later stage. They would typically live in the "root" folder of the repository. Brief descriptions are below:  

* A *README* file. This is a file that someone can read to understand why your project exists and what else they should know to use it. It will be empty at first, but you can complete it later.  

* A *.gitignore* file is a text file where each line would contain folders or files that Github should ignore (not track changes). Read more about it and see examples [here](https://www.freecodecamp.org/news/gitignore-what-is-it-and-how-to-add-to-repo/).  

* You can choose a *license* for your work, so that it is not reproduced by others without due acknowledgment. For more information, see the [Creative Commons licenses](https://creativecommons.org/licenses/).  



### Key vocabulary {-}  

* To *clone* - to create a copy of a Github repository locally on your computer (could manifest as an R project)  
* When you have cloned a repository, the project files will then exist in two places:  
  * *REMOTE* - the versions of your project files that exist online in the Github repository  
  * *LOCAL* - this is a *clone* of the online repository that exists on your physical computer. This is where you make the actual changes to the files/code.  
* *Pull* and *push* - these are how the REMOTE repository syncs changes with the LOCAL repository  
* *Branches* - these are parallel, alternate versions of your project files  
  * The *"main" branch* is the primary/final/"live" version of your files  
  * Other branches are made to test changes before they are incorporated into the "main" branch  
* A *commit* - is a trackable unit of changes (the delta) made to your files. For example, perhaps you edit some lines of code and update a related dataset. Once your changes are saved, you can bundle these changes togeher into one "commit". For version control purposes, you can revert your project back in time based on commits, so it is best to keep them relatively small. You will also attach a brief description of the changes as the "commit message".   
* To *merge* - To adopt changes from one branch into another (e.g. into "main"), you *merge* one branch into the other.  
* A *pull request* - (a "PR") is a request to merge one branch into another. A pull request typically involves multiple commits, which each contain changes to certain files. A pull request usually begins a conversation and review process before the it is accepted and the branch is merged.  





## Set-up  

Two general approaches to set-up are:  

* Create a new R Project from an existing or new Github repository (*preferred*), or  
* Create a Github repository for an existing R project  

### New R project from Github repo {-}  

This approach involves *cloning* an existing Github repository to create a new local R project on your computer.  

The Github repository could be one that already exists and contains lots of content, but it could also be an empty repository because you are just beginning your work. In this latter case you are essentially creating the Github repo and local R project at the same time.    

0) (if necessary) create the Github repository (see instructions above). If the repository already exists, this is not necessary.  

1) Navigate in Github to the repository, click the green "Code" button and copy the HTTPS clone URL (see image below)  

```{r echo=F, out.width = '100%', out.height='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_clone.png"))
```

2) In RStudio, start a new R project by clicking *File > New Project > Version Control > Git*  
     * When prompted for the “Repository URL”, paste the HTTPS URL from Github (see Step 1)  
     * Assign the R project a short, informative name  
     * Designate where the new R Project will be saved locally  
     * Check "Open in new session" and click "Create project"  

You are now in a new, local, RStudio project that is a clone of the Github repository. This local project and the Github repository are now linked.


### New Github repo from existing R project {-}  

An alternative setup scenario is that you have an existing R project with content, and you now want to create a Github repository for it. 

1) Create a new, empty Github repository for the project (see instructions above)  
2) Create a new local R project that is a clone of the new empty Github repository (see HTTPS instructions above)  
3) On your computer, copy all the content from your pre-existing R project (codes, data, etc.) into the new empty R project that is a clone of the new Github repository (e.g. use copy and paste).  
4) In RStudio (the new R project), adding these copied files will register as file changes that are tracked by Git. Therefore, you can bundle these changes as a *commit* and *push* them up to Github. Once *pushed*, the repository on Github will reflect all the files. See the Github workflow section below for details on this process.  


### Git - RStudio integration {-}  

Once you have cloned a Github repository to a new R project, in RStudio you will now see a "Git" tab. This tab appears in the same RStudio pane as your R Environment:  

```{r echo=F, out.width = "75%", out.height="75%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Git_console.png"))
```  

Please note the buttons circled in the image above, as they will be referenced later (from left to right):  

* Button to begin "committing" the saved file changes to the local branch (this will open a new window)  
* Blue arrow to *pull* (update your local version of the branch with any changes made to that branch by others)  
* Green arrow to *push* (send any commits/changes for your local version of the branch to the remote/Github version of the branch) 
* The Git tab in RStudio  
* Button to create a NEW branch using whichever local branch is shown to the right as the base. *You almost always want to branch off of the main branch (after you first pull to update the main branch)*.  
* The branch you are currently working in.  
* Below all this, changes you make to code or other files will appear  




## Github workflow {}  

Familiarize yourself to the Github workflow by viewing this interactive example at [the Github website](https://guides.github.com/introduction/flow/)  

### Orientation {-}  

When using Github, your R project files will exist in several dimensions:  

* The files will exist in the *online* Github repository **and** on your computer in a *local* version of that repository  
  * Remote and local versions are synced by *pushing* and *pulling* changes  
* The files will also exist as a *"main" branch* (version), and also in other "working" *branches*  
  * Changes made to working branches can be merged into Main branch  

### Process overview {-}  

Once you have completed the setup (described above), you will have a Github repo that is connected (*cloned*) to a local R project. The "main" branch (created by default) is the so-called "live" version of *all* the files. When you want to add/delete/make changes, you begin locally, on your computer, by making a new branch from the "main" branch (like "Make a Copy"). You can then proceed to make changes to the project code, files, etc on your computer. The changes are recorded in this new "working" branch, locally on your computer. When satisfied with your changes, group them together as a *commit*, and *push* them up to the working branch's online version. Then, you can merge the online version of the working branch into the online "main" branch to transfer the changes.  

Other team members may be doing the same thing with their own branches, or perhaps contributing commits into your working branch as well. We go through the above process step-by-step in more detail below.   

### Visual aids {-}  

Here is a schematic we've developed - it's in the format of a two-way table so it should help epidemiologists understand...  

```{r echo=F, out.height='150%', out.width='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_table.png"))
``` 

Here's another diagram from [this website](https://build5nines.com/introduction-to-git-version-control-workflow/). Until recently, the term "master" branch was used, but it is now referred to as "main" branch.    

```{r echo=F, out.width = '100%', out.height='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "GitHub-Flow.png"))
``` 
Image [source](https://build5nines.com/introduction-to-git-version-control-workflow/)

### Step-by-Step {-}  

Below, we go through an example process step-by-step:  

#### Make changes {-}  

To make a change to your files and have it reflected in the online main branch, you can do the following steps. These steps assume you are using Github with RStudio. For the slight variation if you are using Github Desktop instead of RStudio, see the next section.  

##### Create a branch {-}  

Ensure you are in "main" branch, and then click the purple icon to create a new branch (see image above).  

* You will be prompted to name your branch with a one-word descriptive name (can use underscores if needed).  
* You will see that locally, you are still in the same R project, but you are no longer working on the "main" branch.  
* Once created, the new branch will also appear in the Github website as a branch.  

#### Make changes {-}  

Now you can edit code, add new files, update datasets, etc.  

Every one of these changes is tracked, once the respective file is saved. Changed files will appear in the RStudio Git tab. In the example below, it has been recorded that I modified an R Markdown script called "collaboration.Rmd" and also several PNG images.    

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_tracking2.png"))
```
You might wonder what the yellow, blue, green, and red squares next to the file names represent. Here is a snapshot from the [RStudio cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf) that explains their meaning. Note that changes with yellow "?" can still be staged, committed, and pushed.  

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_tracking.png"))
```


#### Commit changes {-}  

Every bunch of changes that you make that are substantial (e.g. adding or updating a section of code), pause and *commit* those changes. Think of a commit as a "batch" of changes related to a common purpose. You can always continue to revise a file after having committed changes on it.  

* Press the "Commit" button in the Git tab, which will open a new window (shown below)  
* Click on a file name in the upper-left box  
* Review the changes you made to that file (highlighted below in green or red)  
* "Stage" the file, which will include those changes in the commit. Do this by checking the box next to the file name. Alternatively, you can highlight multiple file names and then click "Stage"  
* Write a commit message that is short but descriptive (required) 
* Press the "Commit" button. A pop-up box will appear showing success or an error message.  
* Make more changes and more commits, as many times as you would like  
     
```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_commit.png"))
```  


#### Push changes up to Github {-}  

"First PULL, then PUSH"  

*PULL* - First, click the PULL icon (downward arrow) which updates the branch version on your local computer with any changes that have been made to it in the remote/Github version. PULL often. Don't hesitate. *Always pull before pushing*.  

*PUSH*  - Then, *push* your commits up to the remote/Github version of your branch by clicking the green "Pull" icon (upward arrow). You may be asked to enter your Github username and password. The first time you are asked, you may need to enter two Git command lines into the *Terminal*: 

* **git config --global user.email "you@example.com"**   (your Github email address), and  
* **git config --global user.name "Your Github username"**  

To learn more about how to enter these commands, see the section below on Git commands.   

<span style="color: darkgreen;">**_TIP:_** Asked to provide your password too often? See these chapters 10 & 11 of this [tutorial](https://happygitwithr.com/credential-caching.html#credential-caching) to connect to a repository via SSH key (more complicated)</span>



#### Merge branch into Main {-}  

If you have finished making changes, you can begin the process of merging those changes into the main branch. Depending on your situation, this may be fast, or you may build in deliberate review and approval steps involving teammates.  

#### Submit a Pull Request {-}  

Once done making changes and commmits, and you have *pushed* the commits up to the remote Github repository, you can then request that your working branch be merged with the "main" branch. 

* Go to Github repository (online)  
* View the tab "Pull Requests"  and click the "New pull request" button.  
        * Select from the drop-down menus to merge your brach into main  
        * Write a detailed Pull Request comment and click "Create Pull Request". 

*In the image below, the branch "forests" has been selected to be merged into "main":*  
```{r echo=F, out.width = '100%', out.height='150%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_pull_request2.png"))
```        
        
Now you should be able to see the pull request (example image below):  

* Review the tab "Files changed" to see how the "main" branch would change if the branch is merged.  
* On the right, you can request a review from members of your team by tagging their Github ID. If you like, you can set the repository settings to require one approving review in order to merge into main.  
* Once the pull request is approved you will see a button available to "Merge pull request". Click this.  
* Once completed, delete your branch as explained below

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_pull_request.png"))
```



#### Delete your branch {-}  

Go to the repository on Github and click the button to view all the branches (next to the drop-down to select branches). Now find your branch and click the trash icon next to it. Read more detail on deleting a branch [here](https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/creating-and-deleting-branches-within-your-repository#deleting-a-branch)  

Be sure to also delete the branch locally on your computer. This will not happen automatically.  

* From RStudio, make sure you are in the Main branch
* Switch to typing Git commands in the RStudio "Terminal" (the tab adjacent to the R console), and enter this: **git branch -d branch_name** , where "branch_name" is the name of your branch to be deleted  
* Refresh your Git tab and this branch should be gone  

## Advanced Github {}  

UNDER CONSTRUCTION  

### Resolving conflicts {-}  

### Github actions {-}  



### Gitignore

File that says what git should ignore (not save to history)
file or pattern . Ones that are really big (500MB) or sensitive (tokens)
CAP size?
.gitignore  


.Rproj.use
.RHistory
.RData
phifunc_token   (txt file with no extension)
*~   (anything followed by tilde)
outputs/          (take lots of space) 
data/raw/for_quick_loading
data/clean/final_dat*


## Github Desktop  

THIS SECTION IS UNDER CONSTRUCTION  


## Git commands {#git} 

THIS SECTION IS UNDER CONSTRUCTION  

### Recommended learning {-}  

To learn Git commands in an interactive tutorial, please see [this website](https://learngitbranching.js.org/).  

### Where to enter commands {-}  

*Option 1* You can open a new Terminal in RStudio. This tab is next to the R Console. If it does not seem to be accepting any text, click the drop-down menu below "Terminal" and select "New terminal". Type the commands at the blicking space in front of the dollar sign "$".  

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_terminal.png"))
```

*Option 2* You can also open a *Shell* (a terminal to enter commands) by clicking the blue "gears" icon in the Git tab (near the RStudio Environment). Select "Shell" from the drop-down menu. A new window will open where you can type the commands after the dollar sign "$".  


### Sample commands {-}

Below we present a few git commands that are more common. Keep in mind if you use them which branch you is active (checked-out) when you write the command, as that will change the action!  

In the commands below, <name> represents a branch name (do not type the < or > symbols). <commit_hash> represents the hash ID of a specific commit. <num> represents a number.  

Git command               |Action   
--------------------------|------------------------------------
`git branch <name>`       |Create a new branch with the name <name>
`git checkout <name>`     |Switch current branch to <name>
`git checkout -b <name>`  |Shortcut to create new branch *and* switch to it
`git switch       `       |An alternative to `git checkout` that is being phased in to Git
`git commit`              |Commit the currently saved changes to the current branch
`git branch <name>`       |Make a new branch called <name> as copy of the current branch  
`git merge <name>`        |Merge <name> branch into current branch
`git rebase <name>`       |Append commits from current branch on to <name> branch

^ | Move backwards one commit
~<num> |Move backwards <num> commits
git checkout HEAD~4
git log | see hashes
git checkout <commit_hash>
git checkout <name>; git merge main = Merge main into bugfix

### Revert mistakes {-}  

git branch -f main HEAD~3   = Moves by force the main branch to three parents behind HEAD (e.g. HEAD may be in bugFix branch) (other branches may stay where they are)


main^ is the parent commit of main
git checkout main^ = this moves the HEAD to the commit before main's last commit
HEAD can be used as a relatively reference, e.g. using HEAD^ multiple time to keep moving backwards

git reset | Moves HEAD back "rewriting history" move a branch reference backwards in time to an older commit, as if that commit had never been made in the first place. Works well for local branches on your own machine. But doesn't work for remote branches that others are using.
git reset HEAD~1     Moves branch backwards from most recent C2 back to C1
to reverse changes and SHARE those reversed changes with others, use git revert  

git revert
git revert HEAD    makes new commit that is prime e.g. C2 to C2'

git commit



## Package management with **renv**  




<!-- ======================================================= -->
## Resources {  }

Much of this page was informed by [this "Happy Git with R" website](https://happygitwithr.com/) by Jenny Bryan. There is a helpful section of this website that helps you troubleshoot common Git and R-related errors.  

The [Github.com documentation and start guide](https://docs.github.com/en/github)

The RStudio ["IDE" cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf) which includes tips on Git with RStudio 

https://ohi-science.org/news/github-going-back-in-time

This website provides an [interactive tutorial](learngitbranching.js.org) to learn Git commands 
