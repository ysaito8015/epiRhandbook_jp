
# Dashboards with R Markdown { }

THIS PAGE IS UNDER CONSTRUCTION

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "flexdashboard_output.png"))
```

This page will cover the basic use of the **flexdashboard** package. This package allows you to easily format R Markdown output as a dashboard with panels and pages. The dashboard content can be text, static images or interactive graphics.  

Advantages of **flexdashboard**:  

* Very little User Interface (UI) or non-standard R coding required  
* Requires minimal up-front knowledge - an hour of practice and you can likely create a dashboard  
* The outputs can be emailed as an HTML report - no server required  
* You can combine **flexdashboard** with **shiny**, **ggplotly**, and other *htmlwidgets* to add interactivity to a static report dashboard  

Disadvantages of **flexdashboard**:  

* Interactivity can be constrained  
* Less customization less possible than if using Shiny directly  

Very comprehensive tutorials on using **flexdashboard** that informed this page can be found in the Resources section. Below we describe the core features and give an example of building a dashboard to explore an outbreak, using the case `linelist` data.  


## Preparation

### Load packages {-}  

In this handbook we emphasize `p_load()` from **pacman**, which installs the package if necessary and loads it for use. You can also load packages with `library()` from **base** R. See the page on [R basics] for more information on R packages.  

```{r}
pacman::p_load(
  rio,            
  here,
  tidyverse,
  flexdashboard,   # dashboard versions of R Markdown reports
  shiny,           # interactive 
  plotly 
)
```

### Import data {-}

We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the [Download book and data] page. The dataset is imported using the `import()` function from the **rio** package. See the page on [Import and export] for various ways to import data.

```{r, echo=F}
# import the linelist into R
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))
```

```{r, eval=F}
# import the linelist
linelist <- import("linelist_cleaned.xlsx")
```

The first 50 rows of the linelist are displayed below.

```{r, message=FALSE, echo=F}
# display the linelist data as a table
DT::datatable(head(linelist, 50), rownames = FALSE, filter="top", options = list(pageLength = 5, scrollX=T), class = 'white-space: nowrap' )
```


## New R Markdown  

After you have installed the package, create a new R Markdown file by clicking through to *File > New file > R Markdown*. 

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "flexdashboard_new1.png"))
```


In the window that opens, select "From Template" and select the "Flex Dashboard" template. You will then be prompted to name the document. In this page's example, we will name our R Markdown as "outbreak_dashboard.Rmd".  
  

```{r out.width = "100%", out.height="75%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "flexdashboard_new2.png"))
```




## The script  

The script is a R Markdown script, and so has the same components and organization:  

### YAML {-}  

At the top, the "YAML" header must begin with three dashes `---` and must close with three dashes `---`. YAML parameters comes in `key:value` pairs. The placement of colons in YAML is important - the `key:value` pairs are separated by colons (not equals signs!). 

The YAML should begin with metadata for the document. The order of these primary YAML parameters (not indented) does not matter. For example:  

```yaml
title: "My document"
author: "Me"
date: "`r Sys.Date()`"
```

You can use R code in YAML values by putting it like in-line code (preceeded by `r` within backticks) but also within quotes (see above for Date).  

A required YAML parameter is `output: `, which specifies the type of file to be produced (e.g. `html_document`, `pdf_document`, `word_document`, or `powerpoint_presentation`). For **flexdashboard** this parameter value is a bit confusing - it must be set as `output:flexdashboard::flex_dashboard`. Not the single and double colons. It is often followed by an additional colon and indented sub-parameters.  

```yaml
title: "My dashboard"
author: "Me"
date: "`r Sys.Date()`"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
```

As shown above, indentations (2 spaces) are used for sub-parameters. In this case, do not forget to put an additional colon after the primary, like `key:value:`.  

If appropriate, logical values should be given in lowercase (`true`, `false`, `null`). If a colon is part of your value (e.g. in the title) put it the value in quotes. See the examples in sections below.  


### Narrative text {-}  

Outside of an R code "chunk", you can write narrative text as described in the page on [R Markdown reports]. You can italicize text by surrounding it with one asterisk (*), or bold by surrounding it with two asterisks (**). Recall that bullets and numbering schemes are sensitive newlines, indentation, and finishing a line with two spaces.  

You can also insert in-line R code into text as described in the [R Markdown reports] page, by surrounding the code with backticks and starting the command with r (see example scripts below).  

### Headings {-}  

Different heading levels are established with different numbers of hash symbols, as described in the [R Markdown reports] page. One hash symbol is a primary heading (in **flexdashboard** this represents a "page" of the dashboard). Two hash symbols are a second-level heading, and will reflect with a column or a row depending on your `orientation:` parameter (see details below). Third- and fourth-level headings can be made with successively more hash symbols.  

```md
# First-level heading (page)

## Second level heading (row or column)  

### Third-level heading (plot, chart, etc.)
```

### Code chunks {-}  

"Chunks" of R code work just like R scripts. They are created with three back-ticks and curly brackets with a lowercase r within. The chunk is closed with three backticks. See the examples below, or the page on [R Markdown reports] for more information.  





## Attributes 

As in a normal R markdown, you can specify attributes to apply to parts of your dashboard by including specifications with curly brackets `{ }` after a heading. For example, in a typical HTML R Markdown report you might organize content into tabs with `## My heading {.tabset}`. 

Attributes specific to **flexdashboard** include:  

* `{data-width = }` and `{data-height = }` set relative size of charts, columns, rows laid out in the same dimension (horizontal or vertical). Absolute sizes are adjusted to best fill the space on any display device thanks to the [flexbox](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Using_CSS_flexible_boxes) engine.  
     * Height of charts also depends on whether you set the YAML parameter `vertical_layout: fill` or `vertical_layout: scroll`. If set to scroll, height will reflect the traditional `fig.height = ` option in the R code chunk.  
     * See complete size documentation at the [flexdashboard site](https://rmarkdown.rstudio.com/flexdashboard/using.html#sizing)  
     
* `{data-orientation=}` Set to either `rows` or `columns`. If your dashboard has multiple pages, add this attribute to each page to indicate orientation.  
* `{.hidden}` Use this to exclude a specific page from the navigation bar  
* `{data-navbar=}` Use this in a page-level heading to nest it within a navigation bar drop-down menu. Provide the name (in quotes) of the drop-down menu. See example below.  


## Layout {}  

Adjust the layout of your dashboard in the following ways:  

* Add pages, columns/rows, and charts with R Markdown headings (e.g. #, ##, or ###)  
* Adjust the YAML parameter `orientation:` to either `rows` or `columns`  
* Specify whether the layout fills the browser or allows scrolling  
* Add tabs to a particular section heading  


### Pages {-}  

First-level headings (#) in the R Markdown will represent "pages" of the dashboard. By default pages will appear in a navigation bar along the top of the dashboard.  

```{r, echo=F}
#knitr::include_graphics(here::here("images", "flexdashboard_pages_top_script.png"))
knitr::include_graphics(here::here("images", "flexdashboard_pages_top_view.png"))
```



You can group pages into a "menu" within the navigaton bar by adding the attribute `{data-navmenu=}` to the page heading. Be careful - do not include spaces around the equals sign otherwise it will not work!  

```{r, out.width = c('100%'), out.height = c('200%'), echo=F}
knitr::include_graphics(here::here("images", "flexdashboard_navmenu_script.png"))
knitr::include_graphics(here::here("images", "flexdashboard_navmenu_view.png"))
```

You can also transfer the navigation bar into a "sidebar" on the left side of the dashboard. 

```{r, out.width = c('100%'), echo=F}
#knitr::include_graphics(here::here("images", "flexdashboard_sidebar_script.png"))
knitr::include_graphics(here::here("images", "flexdashboard_sidebar_view.png"))
```

```md
---
title: "Outbreak dashboard"
date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard
---

# Outbreak dashboard

This dashboard is produced for the leadership of Tenaya County.
It aims to advise them on the status of the COVID-19 pandemic. 

## Epidemic Curve

# Overview {.sidebar}

This is a sidebar that can be viewed from all pages.  

You could just have text here. 

Or if using **shiny** within **flexdashboard**, you might put your input controls here (e.g. via `selectInput()` or `sliderInput()`).  


# Health indicators {data-navmenu="Indicators"} 


# Economic indicators {data-navmenu="Indicators"}  


# Appleville {data-navmenu="Towns"}


# Orangetown {data-navmenu="Towns"}


# New Kiwi {data-navmenu="Towns"}

```



### Orientation {-}  

Set the `orientation:` yaml parameter to indicate how your R Markdown headings should be interpreted - as either `orientation: columns` or `orientation: rows`. 

Second-level headings (##) will be interpreted as new columns or rows based on this `orientation` setting.  

#### Column orientation {-} 

If you set `orientation: columns`, second-level headers will create new columns in the dashboard. The below dashboard has:  

* Code chunks at the beginning to load packages and data - these are not under any header and do not appear in the dashboard  
* Three columns:  
     * The first is named "Intro text" and has no panels. It does have R Markdown narrative text including an example of dynamic text that includes R code to display the  has no 

Below is the output  


```{r, echo=F}
knitr::include_graphics(here::here("images", "flexdashboard_columns_script.png"))
knitr::include_graphics(here::here("images", "flexdashboard_columns_view.png"))
```


## Interactive

### Add plotly {-}

### Add shiny {-}  



htmlwidgets
shiny embedded
visNetwork


## Resources  

Excellent tutorials that informed this page can be found below. If you review these, most likely within an hour you can have your own dashboard.  

https://bookdown.org/yihui/rmarkdown/dashboards.html

https://rmarkdown.rstudio.com/flexdashboard/

https://rmarkdown.rstudio.com/flexdashboard/using.html

https://rmarkdown.rstudio.com/flexdashboard/examples.html
